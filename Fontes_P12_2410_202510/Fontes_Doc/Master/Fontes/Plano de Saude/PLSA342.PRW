#INCLUDE 'PROTHEUS.CH'
#INCLUDE "PLSMGER.CH"
/*


ͻ
Programa  PLSA342   Autor  Totvs                Data   01/11/11   
͹
Desc.      Cadastro de CBOS...                                        
ͼ


*/
Function PLSA342()
//
// Validacao
//
If !PLSALIASEXI("B50")                                       
	MsgAlert( "No  possvel utilizar esta rotina! (Execute o compatibilizador da rotina)" )
	Return                                                  
EndIf
//
// Cadastro
//
AxCadastro("B82","Codigos CBOS",,"PLSVL342(nOpc)")
//
// Fim da Rotina
//
Return Nil                                                                                           
/*/


Ŀ
Funcao     PLSVL342    Autor  Totvs                  Data  09.02.12 
Ĵ
Descricao  Validacao de tela                                            
ٱ


/*/
Function PLSVL342(nOpc)
LOCAL lRet 	 	:= .T.                                                        
LOCAL nRecB82	:= B82->( Recno() )  
LOCAL cChave	:= M->(B82_VERSAO + B82_CODIGO)
//
// Ordem
//
B82->( DbSetOrder(1) ) //B82_FILIAL + B82_VERSAO + B82_CODIGO + B82_SEQUEN
//
// Alterar
//
If  nOpc == K_Alterar
	//
	// Verifica se o registro ja existe
	//
	If B82->( DbSeek( xFilial("B82") + cChave ) ) 
		//
		// Verifica se existe outro registro igual
		//
		While !B82->( Eof() ) .And. B82->(B82_VERSAO + B82_CODIGO) == cChave 
			
			If nRecB82 <> B82->( Recno() )
		        lRet := .F.
		        Exit
		    EndIf     
		    
		B82->( DbSkip() )
		EndDo  
	EndIf	  
//
// Inclusao
//
ElseIf nOpc == K_Incluir
	lRet := !B82->( DbSeek( xFilial("B82") + cChave ) ) 
EndIf    
//
// MSG
//
If !lRet
	MsgStop('Verso e Cdigo j existente')
EndIf    
//
// Fim da Rotina
//
Return(lRet)