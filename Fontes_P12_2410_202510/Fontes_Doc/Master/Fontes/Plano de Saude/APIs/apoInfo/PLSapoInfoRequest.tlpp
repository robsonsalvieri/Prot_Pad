#INCLUDE 'protheus.ch'
#INCLUDE 'restful.ch'

//-------------------------------------------------------------------
/*/{Protheus.doc} PLSapoInfoReq
retorna status dos fontes, parametros, campos e arquivos/diretórios 

@author  Daniel Silva
@version P12
@since   13/07/2023
/*/
//------------------------------------------------------------------- 
class PLSapoInfoReq from CenRequest 

    Data oSvc as Object 

    Public Method New()
    Public Method valida()
    Public Method enviromentPost()
    
endClass

Method New(oRest) class PLSapoInfoReq

    _Super:New(oRest)
    self:oSvc := PLSapoInfoSvc():new()
    self:oSvc:setObjRequest(self:jRequest)
 
Return self

Method valida() class PLSapoInfoReq

    Local lValid := .T.
    _Super:checkBody()
    
    if self:lSuccess
        lValid := self:oSvc:vldJson()
        if lValid 
            self:lSuccess  := .T.
            self:nStatus   := self:oSvc:getStatusCode()
        else
            oErrorAux         := self:oSvc:getError()
            self:lSuccess     := .F.
            self:nFault       := oErrorAux['status']
            self:nStatus      := oErrorAux['status']
            self:cFaultDesc   := oErrorAux['message']
            self:cFaultDetail := oErrorAux['detailedMessage']
        endIf
       
    else
        self:lSuccess   := .F.
        self:nFault     := 400
        self:nStatus    := 400
        self:cFaultDesc := "Requisição invalida."
    endif

Return self:lSuccess

Method enviromentPost() class PLSapoInfoReq

    if self:lSuccess 
        self:oSvc:enviromentPost()
        self:lSuccess  := .T.
        self:cResponse := self:oSvc:getResult()
        self:nStatus   := self:oSvc:getStatusCode()   
    endIf

Return
