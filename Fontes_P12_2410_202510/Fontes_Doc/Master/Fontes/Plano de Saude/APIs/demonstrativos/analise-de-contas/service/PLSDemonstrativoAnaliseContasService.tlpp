#include 'Protheus.ch'
#include "Fileio.ch"

//-------------------------------------------------------------------
/*/{Protheus.doc} PLSDemonstrativoAnaliseContasService

@author    Daniel Silva
@version   V12
@since     11/01/2024
/*/
class PLSDemonstrativoAnaliseContasService

public method new() constructor
public method get()


public data oRest as object
public data oJson as object
endclass

//-------------------------------------------------------------------
/*/{Protheus.doc} new

@author    Daniel Silva
@version   V12
@since     11/01/2024
/*/
method new(oRest) class PLSDemonstrativoAnaliseContasService
::oRest := oRest
return self


//-------------------------------------------------------------------
/*/{Protheus.doc} get

@author    Daniel Silva
@version   V12
@since     11/01/2024
/*/
method get() class PLSDemonstrativoAnaliseContasService
local cBlob     := ""
local cDirDocs  := ""
local aSizes    := {}
local aFiles    := {}
local nHandle   := 0
local aFileName := {}

//Acha o caminho de onde sao gravados os relatorios
cDirDocs := lower(getMV("MV_RELT"))

aFileName := PLSRELDAC(self:oRest:healthProviderCode,"","",.f.,cDirDocs,"",nil, .f., nil,.f.,self:oRest:protocol,.t.) // grava na pasta e gera demonstrativo de analise 

//Verifica o tamanho do arquivo, parâmetro exigido na FRead.
if aDir(cDirDocs + upper(aFileName[1]) , aFiles, aSizes) > 0
	nHandle := fopen(cDirDocs + upper(aFileName[1]) , FO_READWRITE + FO_SHARED )
	cString := ""
	fRead( nHandle, cString, aSizes[1] ) //Carrega na variável cString, a string ASCII do arquivo.

	cBlob := Encode64(cString) //Converte o arquivo para BASE64

	fclose(nHandle)
endif

return cBlob


