 #Include "tlpp-core.th"

Namespace totvs.protheus.health.plans.api.attendanceNetwork.referencednetwork

Using Namespace totvs.protheus.health.plans.api.util

/*/{Protheus.doc} referencedNetworkService
Classe de serviço Plano de Saúde - Regra de Negócio

@type class
@author Pls Team
@since 20/02/2024
@version Protheus 12
/*/ 
Class referencedNetworkService From BaseService

    Private Data oAdapter As Object

    Public Method new() Constructor
    Public Method getReferencedNetwork() As Logical

EndClass

/*/{Protheus.doc} new
Método construtor da classe

@type method
@author Pls Team
@since 20/02/2024
@version Protheus 12
/*/
Method new() Class referencedNetworkService 

    _Super:new()

Return Self

/*/{Protheus.doc} getreferencedNetwork
Método responsavel por retornar as paginas dos planos de saúde cadastrados

@type method
@author Pls Team
@since 20/02/2024
@version Protheus 12
/*/
Method getReferencedNetwork() As Logical Class referencedNetworkService

    Local lSucess := .F. As Logical
    Local aKeys := {} As Array
    Local aFields := {} As Array

    aAdd(aKeys, {"type" : "queryParams", "key" : "healthInsurerCode"})

	aAdd(aFields, {"field" : "healthProduct", "required" : .t., "type" : "C", "size" : tamSX3("BI3_CODIGO")[1]+tamSX3("BI3_VERSAO")[1]})
    aAdd(aFields, {"field" : "specialtieCode", "required" : .t., "type" : "C", "size" : tamSX3("BAX_CODESP")[1]})

    If Self:checkRequiredKeys(aKeys, "E001") .AND. self:checkBodyFields(aFields, "E002", self:jPath)

        Self:oAdapter := referencedNetworkAdapter():New()
        Self:oAdapter:setPathParams(Self:jPath)
        Self:oAdapter:setQueryParams(Self:jParams)   

        If Self:oAdapter:getPagereferencedNetwork() 
            lSucess := .T.
            Self:nCodeStatus := 200
            Self:jResult := Self:oAdapter:getJsonResult()
        EndIf

    EndIf

Return lSucess
