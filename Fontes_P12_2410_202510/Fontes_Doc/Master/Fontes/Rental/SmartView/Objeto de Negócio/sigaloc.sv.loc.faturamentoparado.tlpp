#include "msobject.ch"
#include "TOTVS.ch"
#include "totvs.framework.treports.integratedprovider.th"

/*/{PROTHEUS.DOC} sigaloc.sv.loc.faturamentoparado.tlpp
ITUP BUSINESS - TOTVS RENTAL
Faturamento Parado e Substituição Pendente
@AUTHOR LEONARDO PACHECO FUGA
@SINCE 11/08/2025
/*/

namespace totvs.protheus.rental.manutencao.integratedprovider

@totvsFrameworkTReportsIntegratedProvider(active=.T., team="SIGALOC", tables="FP0,FP1,FPA,CTT,SED,AC3,CN6,DA4", name="Rental", country="ALL", initialRelease="12.1.2210")
class faturamentoparado from totvs.framework.treports.integratedprovider.integratedprovider
public method new() as object
public method getData() as object
public method getSchema() as object 
endclass

/*/{PROTHEUS.DOC} faturamentoparado
ITUP BUSINESS - TOTVS RENTAL
Declaração das classes
@AUTHOR LEONARDO PACHECO FUGA
@SINCE 11/08/2025
/*/

method new() class faturamentoparado
	_Super:new()
	self:appendArea("Rental")

	self:setDisplayName("Faturamento Parado e Substituicao Pendente")

	self:setDescription("Faturamento Parado e Substituicao Pendente")
return self

/*/{PROTHEUS.DOC} getData
ITUP BUSINESS - TOTVS RENTAL
Processamento do relatório
@AUTHOR LEONARDO PACHECO FUGA
@SINCE 11/08/2025
/*/

method getData(nPage as numeric, oFilter as object) as object class faturamentoparado
Local cQuery as character
Local aBind       := {}
Local nX          := 0
Local cTemp1      := ""
Local cVar1       := ""
Local cComando    := ""

	//Define a quantidade máxima por página (Default 100)
	self:setPageSize(20)

	jParams := oFilter:getParameters() //metodo para retorno do json dos parâmetros
	If type("jParams['01'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['01'][1] := space(TamSx3("FP0_CLI")[1])
	EndIf
	If empty(jParams['01'][1])
		jParams['01'][1] := space(TamSx3("FP0_CLI")[1])
	EndIf

	If type("jParams['02'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['02'][1] := space(TamSx3("FP0_CLI")[1])
	EndIf
	If empty(jParams['02'][1])
		jParams['02'][1] := space(TamSx3("FP0_CLI")[1])
	EndIf

	If type("jParams['03'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['03'][1] := space(TamSx3("FP0_LOJA")[1])
	EndIf
	If empty(jParams['03'][1])
		jParams['03'][1] := space(TamSx3("FP0_LOJA")[1])
	EndIf

	If type("jParams['04'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['04'][1] := space(TamSx3("FP0_LOJA")[1])
	EndIf
	If empty(jParams['04'][1])
		jParams['04'][1] := space(TamSx3("FP0_LOJA")[1])
	EndIf

	If type("jParams['05'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['05'][1] := space(TamSx3("FP0_PROJET")[1])
	EndIf
	If empty(jParams['05'][1])
		jParams['05'][1] := space(TamSx3("FP0_PROJET")[1])
	EndIf

	If type("jParams['06'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['06'][1] := space(TamSx3("FP0_PROJET")[1])
	EndIf
	If empty(jParams['06'][1])
		jParams['06'][1] := space(TamSx3("FP0_PROJET")[1])
	EndIf

	If type("jParams['07'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['07'][1] := space(TamSx3("FP1_OBRA")[1])
	EndIf
	If empty(jParams['07'][1])
		jParams['07'][1] := space(TamSx3("FP1_OBRA")[1])
	EndIf

	If type("jParams['08'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['08'][1] := space(TamSx3("FP1_OBRA")[1])
	EndIf
	If empty(jParams['08'][1])
		jParams['08'][1] := space(TamSx3("FP1_OBRA")[1])
	EndIf

	If type("jParams['09'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['09'][1] := space(TamSx3("B1_COD")[1])
	EndIf
	If empty(jParams['09'][1])
		jParams['09'][1] := space(TamSx3("B1_COD")[1])
	EndIf

	If type("jParams['10'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['10'][1] := space(TamSx3("B1_COD")[1])
	EndIf
	If empty(jParams['10'][1])
		jParams['10'][1] := space(TamSx3("B1_COD")[1])
	EndIf

	If type("jParams['11'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['11'][1] := space(TamSx3("FPA_GRUA")[1])
	EndIf
	If empty(jParams['11'][1])
		jParams['11'][1] := space(TamSx3("FPA_GRUA")[1])
	EndIf

	If type("jParams['12'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['12'][1] := space(TamSx3("FPA_GRUA")[1])
	EndIf
	If empty(jParams['12'][1])
		jParams['12'][1] := space(TamSx3("FPA_GRUA")[1])
	EndIf

	jParams['13'][1] := StrTran(SubStr(jParams["13"][1],1,10),"-","") // "20000101"
	If empty(jParams['13'][1])
		jParams['13'][1] := space(8)
	EndIf

	jParams['14'][1] := StrTran(SubStr(jParams["14"][1],1,10),"-","") // "20000101"
	If empty(jParams['14'][1])
		jParams['14'][1] := space(8)
	EndIf

	jParams['15'][1] := StrTran(SubStr(jParams["15"][1],1,10),"-","") // "20000101"
	If empty(jParams['15'][1])
		jParams['15'][1] := space(8)
	EndIf

	jParams['16'][1] := StrTran(SubStr(jParams["16"][1],1,10),"-","") // "20000101"
	If empty(jParams['16'][1])
		jParams['16'][1] := space(8)
	EndIf

	jParams['17'][1] := StrTran(SubStr(jParams["17"][1],1,10),"-","") // "20000101"
	If empty(jParams['17'][1])
		jParams['17'][1] := space(8)
	EndIf

	jParams['18'][1] := StrTran(SubStr(jParams["18"][1],1,10),"-","") // "20000101"
	If empty(jParams['18'][1])
		jParams['18'][1] := space(8)
	EndIf

	If type("jParams['19'][1]") <> "C" .or. file("\SYSTEM\LOCSV014.TXT")
		jParams['19'][1] := space(TamSx3("FP0_TIPFAT")[1])
	EndIf
	If empty(jParams['19'][1])
		jParams['19'][1] := "P"
	EndIf
	
	cQuery := "SELECT "
	cQuery += "FP0.FP0_PROJET, "
	cQuery += "FP0.FP0_REVISA, "
	cQuery += "CASE "
	cQuery += "WHEN FP0.FP0_TIPO = 'E' THEN 'EFETIVO' "
	cQuery += "WHEN FP0.FP0_TIPO = 'O' THEN 'ORIENTATIVO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP0_TIPO, "
	cQuery += "CASE "
	cQuery += "WHEN FP0.FP0_TIPOSE = 'T' THEN 'TRANSPORTE' "
	cQuery += "WHEN FP0.FP0_TIPOSE = 'E' THEN 'EQUIPAMENTOS' "
	cQuery += "WHEN FP0.FP0_TIPOSE = 'L' THEN 'LOCACAO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP0_TIPOSE, "
	cQuery += "CASE "
	cQuery += "WHEN FP0.FP0_RECEIT = 'T' THEN 'TRANSPORTE' "
	cQuery += "WHEN FP0.FP0_RECEIT = 'E' THEN 'EQUIPAMENTOS' "
	cQuery += "WHEN FP0.FP0_RECEIT = 'L' THEN 'LOCACAO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP0_RECEIT, "
	cQuery += "CASE "
	cQuery += "WHEN FP0.FP0_STATUS = '1' THEN 'DIGITADO' "
	cQuery += "WHEN FP0.FP0_STATUS = '2' THEN 'EM APROVACAO' "
	cQuery += "WHEN FP0.FP0_STATUS = '3' THEN 'APROVADO' "
	cQuery += "WHEN FP0.FP0_STATUS = '4' THEN 'NAO APROVADO' "
	cQuery += "WHEN FP0.FP0_STATUS = '5' THEN 'FECHADO' "
	cQuery += "WHEN FP0.FP0_STATUS = '6' THEN 'CANCELADO' "
	cQuery += "WHEN FP0.FP0_STATUS = '7' THEN 'REJEITADO' "
	cQuery += "WHEN FP0.FP0_STATUS = '8' THEN 'FINALIZADO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP0_STATUS, "
	cQuery += "FP0.FP0_DATINC, FP0.FP0_HORINC, FP0.FP0_CLI, FP0.FP0_LOJA, FP0.FP0_CLINOM, FP0.FP0_CLICGC, FP0.FP0_CLIINS, "
	cQuery += "FP0.FP0_PROSPE, FP0.FP0_LOJAP, FP0.FP0_PRONOM, FP0.FP0_CLIEND, FP0.FP0_CLIMUN, FP0.FP0_CLIBAI, FP0.FP0_CLIEST, "
	cQuery += "FP0.FP0_CLICEP, FP0.FP0_CLICON, FP0.FP0_NOMECO, FP0.FP0_CLIDEP, FP0.FP0_CLIEMA, FP0.FP0_CLIDDD, FP0.FP0_CLITEL, FP0.FP0_VENDED, FP0.FP0_NOMVEN, "
	cQuery += "CASE "
	cQuery += "WHEN FP0.FP0_TPENVI = '1' THEN 'E-MAIL' "
	cQuery += "WHEN FP0.FP0_TPENVI = '2' THEN 'FAX' "
	cQuery += "WHEN FP0.FP0_TPENVI = '3' THEN 'CORREIO' "
	cQuery += "WHEN FP0.FP0_TPENVI = '4' THEN 'EM MAOS' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP0_TPENVI, "
	cQuery += "FP0.FP0_DTRETO, FP0.FP0_DATAS, FP0.FP0_PREVFT, FP0.FP0_DTLIBE, FP0.FP0_HRLIBE, FP0.FP0_CONVIT, "
	cQuery += "CASE "
	cQuery += "WHEN FP0.FP0_TIPOPR = 'P' THEN 'PROJETO' "
	cQuery += "WHEN FP0.FP0_TIPOPR = 'L' THEN 'LICITACAO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP0_TIPOPR, "
	cQuery += "FP0.FP0_CODCON, FP0.FP0_VALCON, FP0.FP0_HORAPR, FP0.FP0_DTAPRO, FP0.FP0_USUAPR, FP0.FP0_ORCAM, FP0.FP0_NUMPED, FP0.FP0_PMEDIC, "
	cQuery += "CASE "
	cQuery += "WHEN FP0.FP0_TIPFAT = 'M' THEN 'MEDICAO' "
	cQuery += "WHEN FP0.FP0_TIPFAT = 'P' THEN 'PADRAO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP0_TIPFAT, "
	cQuery += "FP0.FP0_POSSIB, FP0.FP0_UNIDES, FP0.FP0_DESORI, FP0.FP0_VALPRO, FP0.FP0_WFID, "
	cQuery += "CASE "
	cQuery += "WHEN FP0.FP0_MINPFT = '0' THEN 'SINTETICO' "
	cQuery += "WHEN FP0.FP0_MINPFT = '1' THEN 'ANALITICO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP0_MINPFT, "
	cQuery += "FP0.FP0_MOEDA, FP0.FP0_NIVEL, FP0.FP0_PDESCO, FP0.FP0_PMARGE, "
	cQuery += "CASE "
	cQuery += "WHEN FP0.FP0_AGLUNF = 'S' THEN 'SIM' "
	cQuery += "WHEN FP0.FP0_AGLUNF = 'N' THEN 'NAO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP0_AGLUNF, "
	cQuery += "FP0.FP0_PRODL, FP0.FP0_PRODM, FP0.FP0_PRODOZ, "
	cQuery += "CASE "
	cQuery += "WHEN FP0.FP0_TPFRAN = 'I' THEN 'INDIVIDUAL' "
	cQuery += "WHEN FP0.FP0_TPFRAN = 'G' THEN 'COMPARTILHADO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP0_TPFRAN, "
	cQuery += "FP1.FP1_OBRA, "
	cQuery += "CASE "
	cQuery += "WHEN FP1.FP1_TPMES = '0' THEN 'MES FECHADO' "
	cQuery += "WHEN FP1.FP1_TPMES = '1' THEN 'DIAS CORRIDOS' "
	cQuery += "WHEN FP1.FP1_TPMES = '2' THEN 'MES FIXO' "
	cQuery += "ELSE ' ' "
	cQuery += "END TPMES, "
	cQuery += "FP1.FP1_CLIORI, FP1.FP1_LOJORI, FP1.FP1_NOMORI, "
	cQuery += "CASE "
	cQuery += "WHEN FP1.FP1_TEMVIS = 'S' THEN 'SIM' "
	cQuery += "WHEN FP1.FP1_TEMVIS = 'N' THEN 'NAO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP1_TEMVIS, "
	cQuery += "FP1.FP1_DTVIS, FP1.FP1_HRVIS, FP1.FP1_NOMRES, FP1.FP1_RESPON, FP1.FP1_CGCORI, FP1.FP1_INSORI, FP1.FP1_CEIORI, "
	cQuery += "FP1.FP1_ENDORI, FP1.FP1_BAIORI, FP1.FP1_MUNORI, FP1.FP1_ESTORI, FP1.FP1_CEPORI, FP1.FP1_CONORI, FP1.FP1_RG, "
	cQuery += "FP1.FP1_DEPORI, FP1.FP1_EMAORI, FP1.FP1_DDDORI, FP1.FP1_TELORI, FP1.FP1_RAMAL, FP1.FP1_CELULA, FP1.FP1_CLIDES, "
	cQuery += "FP1.FP1_LOJDES, FP1.FP1_NOMDES, FP1.FP1_ENDDES, FP1.FP1_BAIDES, FP1.FP1_MUNDES, FP1.FP1_ESTDES, FP1.FP1_CEPDES, "
	cQuery += "FP1.FP1_CONDES, FP1.FP1_RGDEST, FP1.FP1_DEPDES, FP1.FP1_EMADES, FP1.FP1_DDDDES, FP1.FP1_TELDES, "
	cQuery += "CASE "
	cQuery += "WHEN FP1.FP1_TROCEQ = '1' THEN 'PRODUTO' "
	cQuery += "WHEN FP1.FP1_TROCEQ = '2' THEN 'PRODUTO+FAMILIA' "
	cQuery += "WHEN FP1.FP1_TROCEQ = '3' THEN 'PRODUTO+MODELO' "
	cQuery += "WHEN FP1.FP1_TROCEQ = '4' THEN 'PRODUTO+FAMILIA+MODELO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FP1_TROCEQ, "
	cQuery += "FPA.FPA_OBRA, FPA.FPA_SEQGRU, "
	cQuery += "CASE "
	cQuery += "WHEN FPA.FPA_TIPOSE = 'L' THEN 'LOCACAO' "
	cQuery += "WHEN FPA.FPA_TIPOSE = 'O' THEN 'OUTROS' "
	cQuery += "WHEN FPA.FPA_TIPOSE = 'Z' THEN 'COBRANCA UNICA' "
	cQuery += "WHEN FPA.FPA_TIPOSE = 'M' THEN 'MAO DE OBRA' "
	cQuery += "WHEN FPA.FPA_TIPOSE = 'S' THEN 'SUBSTITUIDO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FPA_TIPOSE, "
	cQuery += "FPA.FPA_SEQSUB, FPA.FPA_CODTAB, FPA.FPA_DESTAB, FPA.FPA_LOCAL, FPA.FPA_GRUA, FPA.FPA_DESGRU, FPA.FPA_CARAC, "
	cQuery += "FPA.FPA_PREDIA, FPA.FPA_MINDIA, FPA.FPA_MINMES, FPA.FPA_QUANT, FPA.FPA_ACRESC, FPA.FPA_PRCUNI, FPA.FPA_VLBRUT, "
	cQuery += "FPA.FPA_PDESC, FPA.FPA_VRHOR, FPA.FPA_TPGUIM, FPA.FPA_GUIMON, FPA.FPA_TPGUID, FPA.FPA_GUIDES, "
	cQuery += "CASE "
	cQuery += "WHEN FPA.FPA_TPISS = 'I' THEN 'INCLUSO' "
	cQuery += "WHEN FPA.FPA_TPISS = 'N' THEN 'NAO INCLUSO' "
	cQuery += "WHEN FPA.FPA_TPISS = 'X' THEN 'N/A' "
	cQuery += "ELSE ' ' "
	cQuery += "END FPA_TPISS, "
	cQuery += "FPA.FPA_PERISS, FPA.FPA_VRISS, FPA.FPA_VRSEGU, FPA.FPA_DTINI, FPA.FPA_HRINI, FPA.FPA_HRFIM, FPA.FPA_DTFIM, "
	cQuery += "FPA.FPA_DTENRE, FPA.FPA_LOCDIA, FPA.FPA_DTPRRT, FPA.FPA_ULTFAT, "

	If "ORACLE" $ Upper(TCGetDB()) .or. "POSTGRES" $ Upper(TCGetDB()) .or. file("\SYSTEM\LOCSV015.TXT")
		cQuery += " CASE "
		cQuery += " WHEN FPA.FPA_DTSCRT <> ' ' THEN TO_DATE(FPA.FPA_DTSCRT, 'YYYYMMDD') - TO_DATE(?, 'YYYYMMDD') " //1
		AAdd(aBind, {dtos(dDataBase), "S"})
		cQuery += " WHEN FPA.FPA_DTSCRT = ' ' THEN TO_DATE(FPA.FPA_ULTFAT, 'YYYYMMDD') - TO_DATE(?, 'YYYYMMDD') " //2
		AAdd(aBind, {dtos(dDataBase), "S"})
		cQuery += " WHEN FPA.FPA_DTSCRT = ' ' AND FPA.FPA_ULTFAT = ' ' THEN TO_DATE(FPA.FPA_DTINI, 'YYYYMMDD') - TO_DATE(?, 'YYYYMMDD') " //3
		AAdd(aBind, {dtos(dDataBase), "S"})
		cQuery += " END DIFDATA, "
        If file("\SYSTEM\LOCSV015.TXT")
			return 
		EndIf
	Else
		cQuery += " CASE "
		cQuery += " WHEN FPA.FPA_DTSCRT <> ' ' THEN DATEDIFF(DAY,FPA.FPA_DTSCRT, ?) " //1
		AAdd(aBind, {dtoc(dDataBase), "S"})
		cQuery += " WHEN FPA.FPA_DTSCRT = ' ' THEN DATEDIFF(DAY,FPA.FPA_ULTFAT, ?) " //2
		AAdd(aBind, {dtoc(dDataBase), "S"})
		cQuery += " WHEN FPA.FPA_DTSCRT = ' ' AND FPA.FPA_ULTFAT = ' ' THEN DATEDIFF(DAY,FPA.FPA_DTINI, ?) " //3
		AAdd(aBind, {dtoc(dDataBase), "S"})
		cQuery += " END DIFDATA, "
	EndIF

	cQuery += "CASE "
	cQuery += "WHEN FPA.FPA_SABADO = 'S' THEN 'SIM' "
	cQuery += "WHEN FPA.FPA_SABADO = 'N' THEN 'NAO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FPA_SABADO, "
	cQuery += "CASE "
	cQuery += "WHEN FPA.FPA_DOMING = 'S' THEN 'SIM' "
	cQuery += "WHEN FPA.FPA_DOMING = 'N' THEN 'NAO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FPA_DOMING, "
	cQuery += "FPA.FPA_CONPAG, "
	cQuery += "CASE "
	cQuery += "WHEN FPA.FPA_TIPPAG = '1' THEN 'DA ENTREGA DA NF' "
	cQuery += "WHEN FPA.FPA_TIPPAG = '2' THEN 'DO FECHAMENTO DA MEDICAO' "
	cQuery += "WHEN FPA.FPA_TIPPAG = '3' THEN 'DO ENCERRAMENTO DO SERVICO' "
	cQuery += "WHEN FPA.FPA_TIPPAG = '4' THEN 'DO INICIO DO SERVICO' "
	cQuery += "ELSE ' ' "
	cQuery += "END FPA_TIPPAG, "
	cQuery += "FPA.FPA_AS, FPA.FPA_VIAGEM, FPA.FPA_DTPREN, FPA.FPA_NFREM, FPA.FPA_DNFREM, FPA.FPA_DNFENT, "
	cQuery += "FPA.FPA_PLACAI, FPA.FPA_REBOQI, FPA.FPA_DTSCRT, FPA.FPA_MOTRET, FPA.FPA_NFRET, FPA.FPA_DNFRET, "	
	cQuery += "CASE "
	cQuery += "WHEN FPA.FPA_TPBASE = 'M' THEN 'MENSAL' "
	cQuery += "WHEN FPA.FPA_TPBASE = 'D' THEN 'DIARIA' "
	cQuery += "WHEN FPA.FPA_TPBASE = 'H' THEN 'HORA' "
	cQuery += "ELSE ' ' "
	cQuery += "END FPA_TPBASE, "
	cQuery += "CASE "
	cQuery += "WHEN FPA.FPA_TIPOCA = 'H' THEN 'HORA' "
	cQuery += "WHEN FPA.FPA_TIPOCA = 'D' THEN 'DIA' "
	cQuery += "WHEN FPA.FPA_TIPOCA = 'C' THEN 'CONTADOR' "
	cQuery += "WHEN FPA.FPA_TIPOCA = 'O' THEN 'OUTROS' "
	cQuery += "ELSE ' ' "
	cQuery += "END FPA_TIPOCA, "
	cQuery += "FPA.FPA_SEQEST, FPA.FPA_FILREM, FPA.FPA_SERREM, FPA.FPA_ITEREM, FPA.FPA_HRFRAQ, FPA.FPA_VLHREX, "
	cQuery += "FPA.FPA_ITERET, FPA.FPA_FILEMI,
	cQuery += "FPA.FPA_NIVER, FPA.FPA_TESFAT, FPA.FPA_TESREM, FPA.FPA_QTDPRC, FPA.FPA_CLIFAT, FPA.FPA_LOJFAT, "
	cQuery += "FPA.FPA_NOMFAT, FPA.FPA_GERAEM, FPA.FPA_PACRES, FPA.FPA_GRUPOM, FPA.FPA_BASFRA, "
	cQuery += "COALESCE(CTT.CTT_CUSTO,'SEM CENTRO DE CUSTO') CTT_CUSTO, "
	cQuery += "COALESCE(CTT.CTT_DESC01,'SEM CENTRO DE CUSTO') CTT_DESC01, "
	cQuery += "COALESCE(SED.ED_CODIGO, 'SEM NATUREZA') ED_CODIGO, "
	cQuery += "COALESCE(SED.ED_DESCRIC, 'SEM NATUREZA') ED_DESCRIC, "
	cQuery += "COALESCE(AC3.AC3_NOME, 'SEM CONCORRENTE') AC3_NOME, "
	cQuery += "COALESCE(AC3.AC3_CODCON,'SEM CONCORRENTE') AC3_CODCON, "
	cQuery += "COALESCE(CN6.CN6_CODIGO, 'SEM REAJUSTE') CN6_CODIGO, "
	cQuery += "COALESCE(CN6.CN6_DESCRI,'SEM REAJUSTE') CN6_DESCRI, "
	cQuery += "COALESCE(DA4.DA4_COD, 'SEM MOTORISTA') DA4_COD, "
	cQuery += "COALESCE(DA4.DA4_NOME,'SEM MOTORISTA') DA4_NOME, "
	cQuery += "COALESCE(SB1.B1_COD, 'SEM PRODUTO') B1_COD, "
	cQuery += "COALESCE(SB1.B1_DESC,'SEM PRODUTO') B1_DESC "
	cQuery += "FROM "+RetSqlName("FP0")+" FP0 "
	cQuery += " INNER JOIN " + RetSQLName("FP1") + " FP1 ON "
	cQuery += " FP1.FP1_FILIAL = FP0.FP0_FILIAL AND "
	cQuery += " FP1.FP1_PROJET = FP0.FP0_PROJET AND "
	cQuery += " FP1.FP1_OBRA >= ? AND "
	AAdd(aBind, {jParams['07'][1], "S"})
	cQuery += " FP1.FP1_OBRA <= ? AND "
	AAdd(aBind, {jParams['08'][1], "S"})
	cQuery += " FP1.D_E_L_E_T_ = ' ' "
	cQuery += " INNER JOIN " + RetSQLName("FPA") + " FPA ON "
	cQuery += " FPA.FPA_FILIAL = FP1.FP1_FILIAL AND "
	cQuery += " FPA.FPA_PROJET = FP1.FP1_PROJET AND "
	cQuery += " FPA.FPA_OBRA = FP1.FP1_OBRA AND "
	cQuery += " FPA.D_E_L_E_T_ = ' ' AND "
	cQuery += " FPA.FPA_PROJET >= ? AND "
	AAdd(aBind, {jParams['05'][1], "S"})
	cQuery += " FPA.FPA_PROJET <= ? AND "
	AAdd(aBind, {jParams['06'][1], "S"})
	cQuery += " FPA.FPA_PRODUT >= ? AND "
	AAdd(aBind, {jParams['09'][1], "S"})
	cQuery += " FPA.FPA_PRODUT <= ? AND "
	AAdd(aBind, {jParams['10'][1], "S"})
	cQuery += " FPA.FPA_GRUA >= ? AND "
	AAdd(aBind, {jParams['11'][1], "S"})
	cQuery += " FPA.FPA_GRUA <= ? AND "
	AAdd(aBind, {jParams['12'][1], "S"})
	cQuery += " FPA.FPA_DTINI >= ? AND "
	AAdd(aBind, {jParams['13'][1], "S"})
	cQuery += " FPA.FPA_DTINI <= ? AND "
	AAdd(aBind, {jParams['14'][1], "S"})
	cQuery += " FPA.FPA_DTENRE >= ? AND "
	AAdd(aBind, {jParams['15'][1], "S"})
	cQuery += " FPA.FPA_DTENRE <= ? AND "
	AAdd(aBind, {jParams['16'][1], "S"})
	cQuery += " FPA.FPA_ULTFAT >= ? AND "
	AAdd(aBind, {jParams['17'][1], "S"})
	cQuery += " FPA.FPA_ULTFAT <= ? "
	AAdd(aBind, {jParams['18'][1], "S"})
	cQuery += " LEFT JOIN " + RetSQLName("CTT") + " CTT ON "
	cQuery += " CTT.CTT_CUSTO = FPA.FPA_CUSTO AND "
	cQuery += " CTT.CTT_FILIAL = '"+xFilial("CTT")+"' AND "
	cQuery += " CTT.D_E_L_E_T_ = ' ' "
	cQuery += " LEFT JOIN " + RetSQLName("SED") + " SED ON "
	cQuery += " SED.ED_CODIGO = FPA.FPA_NATURE AND "
	cQuery += " SED.ED_FILIAL = '"+xFilial("SED")+"' AND "
	cQuery += " SED.D_E_L_E_T_ = ' ' "
	cQuery += " LEFT JOIN " + RetSQLName("AC3") + " AC3 ON "
	cQuery += " AC3.AC3_CODCON = FP0.FP0_CODCON AND "
	cQuery += " AC3.AC3_FILIAL = '"+xFilial("AC3")+"' AND "
	cQuery += " AC3.D_E_L_E_T_ = ' ' "
	cQuery += " LEFT JOIN " + RetSQLName("SB1") + " SB1 ON "
	cQuery += " SB1.B1_COD = FPA.FPA_PRODUT AND "
	cQuery += " SB1.B1_FILIAL = '"+xFilial("SB1")+"' AND "
	cQuery += " SB1.D_E_L_E_T_ = ' ' "
	cQuery += " LEFT JOIN " + RetSQLName("CN6") + " CN6 ON "
	cQuery += " CN6.CN6_CODIGO = FPA.FPA_AJUSTE AND "
	cQuery += " CN6.CN6_FILIAL = '"+xFilial("CN6")+"' AND "
	cQuery += " CN6.D_E_L_E_T_ = ' ' "
	cQuery += " LEFT JOIN " + RetSQLName("DA4") + " DA4 ON "
	cQuery += " DA4.DA4_COD = FPA.FPA_MOTRET AND "
	cQuery += " DA4.DA4_FILIAL = '"+xFilial("DA4")+"' AND "
	cQuery += " DA4.D_E_L_E_T_ = ' ' "
	cQuery += " WHERE "
	cQuery += " (FPA_TIPOSE = 'L' AND FPA_DTSCRT <> ' ' AND FPA_NFREM <> ' ' AND FPA_NFRET = ' ') OR "
	cQuery += " (FPA_TIPOSE = 'S' AND FPA_NFREM <> ' ' AND FPA_NFRET = ' ') AND "
	cQuery += " FP0.FP0_CLI >= ? AND "
	AAdd(aBind, {jParams['01'][1], "S"})
	cQuery += " FP0.FP0_CLI <= ? AND "
	AAdd(aBind, {jParams['02'][1], "S"})
	cQuery += " FP0.FP0_LOJA >= ? AND "
	AAdd(aBind, {jParams['03'][1], "S"})
	cQuery += " FP0.FP0_LOJA <= ? AND "
	AAdd(aBind, {jParams['04'][1], "S"})

	cTemp1 := ""
	cVar1 := upper(alltrim(jParams['19'][1]))
	If !empty(cVar1)
		For nX := 1 to len(cVar1)
			If !empty(cTemp1)
				cTemp1 += ","
			EndIf
			cTemp1 += "'"+substr(cVar1,nX,1)+"'"
		Next
	EndIF
	
	If !empty(cTemp1)
		cComando := 'cQuery += " FP0.FP0_TIPFAT IN ('
		cComando +=  cTemp1
		cComando +=  ' ) "'
		&(cComando)
	EndIF

	cQuery := CHANGEQUERY(cQuery)
	cQuery := JurTRepBin(cQuery, aBind)
	self:setOrder("FP0.FP0_PROJET")
	self:setQuery(cQuery)

return self:oData

/*/{PROTHEUS.DOC} getShema
ITUP BUSINESS - TOTVS RENTAL
Declaração dos parâmetros
@AUTHOR LEONARDO PACHECO FUGA
@SINCE 11/08/2025
/*/

method getSchema() as object class faturamentoparado
 
	self:addProperty("Projeto",              "Projeto",                      "string", "Nro. Projeto",                 "FP0_PROJET")
	self:addProperty("Cliente",              "Cliente",                      "string", "Cliente",                      "FP0_CLI")
	self:addProperty("NomeCliente",          "Nome Cliente",                 "string", "Nome Cliente",                 "FP0_CLINOM")
	self:addProperty("Loja",                 "Loja",                         "string", "Loja",                         "FP0_LOJA")
	self:addProperty("Prospect",             "Prospect",                     "string", "Prospect",                     "FP0_PROSPE")
	self:addProperty("Nome Prospect",        "Nome Prospect",                "string", "Nome Prospect",                "FP0_PRONOM")
	self:addProperty("TipoFaturam",          "Tipo Faturam.",                "string", "Tipo Faturam.",                "FP0_TIPFAT")
	self:addProperty("TpConsFran",           "Tp. Cons. Fran.",              "string", "Tp. Cons. Fran.",              "FP0_TPFRAN")
	self:addProperty("TipoServico",          "Tipo de Servico",              "string", "Tipo de Servico",              "FPA_TIPOSE")
	self:addProperty("Produto",              "Produto do Contrato",          "string", "Produto do Contrato",          "B1_COD")
	self:addProperty("DescricaoProduto",     "Descricao do Produto",         "string", "Descricao do Produto",         "B1_DESC")
	self:addProperty("Armazem",              "Armazem",                      "string", "Armazem",                      "FPA_LOCAL ")
	self:addProperty("Equipamento",          "Equipamento",                  "string", "Equipamento",                  "FPA_GRUA")
	self:addProperty("DescricaoEquipamento", "Descricao do Equipamento",     "string", "Descricao do Equipamento",     "FPA_DESGRU")
	self:addProperty("Quantidade",           "Quantidade",                   "number", "Quantidade",                   "FPA_QUANT")
	self:addProperty("ValorUnitario",        "Valor Unitario",               "number", "Valor Unitario",               "FPA_PRCUNI")
	self:addProperty("ValorBase",            "Valor Base",                   "number", "Valor Base",                   "FPA_VRHOR")
	self:addProperty("ValorFreteIda",        "Valor Frete Ida",              "number", "Valor Frete Ida",              "FPA_GUIMON")
	self:addProperty("ValorFreteVolta",      "Valor Frete Volta",            "number", "Valor Frete Volta",            "FPA_GUIDES")
	self:addProperty("ValorSeguro",          "Valor Seguro",                 "number", "Valor Seguro",                 "FPA_VRSEGU")
	self:addProperty("ValorBruto",           "Valor Bruto",                  "number", "ValorBruto",                   "FPA_VLBRUT")
	self:addProperty("PorcentagemAcerscimo", "Porcentagem de Acerscimo",     "number", "Porcentagem de Acerscimo",     "FPA_PACRES")
	self:addProperty("PorcentagemDesconto",  "Porcentagem de Desconto",      "number", "Porcentagem de Desconto",      "FPA_PDESC")
	self:addProperty("DataInicio",           "Data Inicio da locacao",       "date",   "Data Inicio da locacao",       "FPA_DTINI")
	self:addProperty("DataProxFat",          "Data Prox. Fat.",              "date",   "Data Prox. Fat.",              "FPA_DTFIM")
	self:addProperty("DataFim",              "Data Fim da Locacao",          "date",   "Data Fim da Locacao",          "FPA_DTENRE")
	self:addProperty("DataUltFat",           "Data Ultimo Faturamento",      "date",   "Data Ultimo Faturamento",      "FPA_ULTFAT")
	self:addProperty("DifData",              "Tempo de Retirada",            "number", "Tempo de Retirada",            "DIFDATA")
	self:addProperty("DiasLocacao",          "Dias de Locacao",              "number", "Dias de Locacao",              "FPA_LOCDIA")
	self:addProperty("CondicaoDePagamento",  "Condicao de Pagamento",        "string", "Condicao de Pagamento",        "FPA_CONPAG")
	self:addProperty("NrAS",                 "Nr.A.S.",                      "string", "Nr.A.S.",                      "FPA_AS")
	self:addProperty("NFRemessa",            "NF Remessa",                   "string", "NF Remessa",                   "FPA_NFREM")
	self:addProperty("DataNFRemessa",        "Data NF Remessa",              "date",   "Data NF Remessa",              "FPA_DNFREM")
	self:addProperty("NFRetorno",            "NF Retorno",                   "string", "NF Retorno",                   "FPA_NFRET")
	self:addProperty("DataSolicRet",         "Data Solicitacao de Retirada", "date",   "Data Solicitacao de Retirada", "FPA_DTSCRT")
	self:addProperty("DataNFRetorno",        "Data NF Retorno",              "date",   "Data NF Retorno",              "FPA_DNFRET")
	self:addProperty("EstruturaDeProduto",   "Estrutura de Produto",         "string", "Estrutura de Produto",         "FPA_SEQEST")
	self:addProperty("Reajuste",             "Reajuste",                     "string", "Reajuste",                     "CN6_CODIGO")
	self:addProperty("DescReajuste",         "Desc. Reajuste",               "string", "Desc. Reajuste",               "CN6_DESCRI")
	self:addProperty("Aniversario",          "Aniversario",                  "date",   "Aniversario",                  "FPA_NIVER")
	self:addProperty("BaseDeCalculo",        "Base de Calculo",              "string", "Base de Calculo",              "FPA_TPBASE")
	self:addProperty("Franquia",             "Franquia",                     "number", "Franquia",                     "FPA_HRFRAQ")
	self:addProperty("ValorHoraExtra",       "Valor Hora Extra",             "number", "Valor Hora Extra",             "FPA_VLHREX")
	self:addProperty("TipoDeFranquia",       "Tipo de Franquia",             "string", "Tipo de Franquia",             "FPA_TIPOCA")
	self:addProperty("GrupoMedicao",         "Grupo Medicao",                "string", "Grupo Medicao",                "FPA_GRUPOM")
	self:addProperty("DataGeraEm",           "Data Gera Em",                 "date",   "Data Gera Em",                 "FPA_GERAEM")
	self:addProperty("BaseDaFranquia",       "Base da Franquia",             "string", "Base da Franquia",             "FPA_BASFRA")
	self:addProperty("Obra",                 "Obra",                         "string", "Obra",                         "FP1_OBRA")
	self:addProperty("TipoMes",              "Tipo de Mes",                  "string", "Tipo de Mes",                  "TPMES")
	self:addProperty("ClienteObra",          "Cliente da Obra",              "string", "Cliente da Obra",              "FP1_CLIORI")
	self:addProperty("NomeObra",             "Nome da Obra",                 "string", "Nome da Obra",                 "FP1_NOMORI")
	self:addProperty("LojaCliente",          "Loja do Cliente",              "string", "Loja do Cliente",              "FP1_LOJORI")
	self:addProperty("Cidade",               "Cidade",                       "string", "Cidade",                       "FP1_MUNORI")
	self:addProperty("Estado",               "Estado",                       "string", "Estado",                       "FP1_ESTORI")

	self:addParameter("01", "Cliente de",          "string", .F., "", .F., .T., "SA1", "MV_PAR01")
	self:addParameter("02", "Cliente até",         "string", .F., "", .F., .T., "SA1", "MV_PAR02")
	self:addParameter("03", "Loja de",             "string", .F., "", .F., .F., "",    "MV_PAR03")
	self:addParameter("04", "Loja até",            "string", .F., "", .F., .F., "",    "MV_PAR04")
	self:addParameter("05", "Projeto de",          "string", .F., "", .F., .T., "FP0", "MV_PAR05")
	self:addParameter("06", "Projeto até",         "string", .F., "", .F., .T., "FP0", "MV_PAR06")
	self:addParameter("07", "Obra de",             "string", .F., "", .F., .F., "",    "MV_PAR07")
	self:addParameter("08", "Obra até",            "string", .F., "", .F., .F., "",    "MV_PAR08")
	self:addParameter("09", "Produto de",          "string", .F., "", .F., .T., "SB1", "MV_PAR09")
	self:addParameter("10", "Produto até",         "string", .F., "", .F., .T., "SB1", "MV_PAR10")
	self:addParameter("11", "Equipamento de",      "string", .F., "", .F., .T., "ST9", "MV_PAR11")
	self:addParameter("12", "Equipamento até",     "string", .F., "", .F., .T., "ST9", "MV_PAR12")
	self:addParameter("13", "Dt inicio de",        "date",   .F., "", .F., .F., "",    "MV_PAR13")
	self:addParameter("14", "Dt inicio até",       "date",   .F., "", .F., .F., "",    "MV_PAR14")
	self:addParameter("15", "Dt Fim de",           "date",   .F., "", .F., .F., "",    "MV_PAR15")
	self:addParameter("16", "Dt Fim até",          "date",   .F., "", .F., .F., "",    "MV_PAR16")
	self:addParameter("17", "Dt Prox. Fat de",     "date",   .F., "", .F., .F., "",    "MV_PAR17")
	self:addParameter("18", "Dt Prox. Fat até",    "date",   .F., "", .F., .F., "",    "MV_PAR18")
	self:addParameter("19", "Tipo de faturamento", "string", .F., "", .F., .F., "",    "MV_PAR19", "P=Padrao, M=Medicao Ex:PM", .F., {"PM"})

return self:oSchema
