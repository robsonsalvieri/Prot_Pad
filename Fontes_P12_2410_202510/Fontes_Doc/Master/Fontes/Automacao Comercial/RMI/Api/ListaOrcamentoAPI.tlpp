#INCLUDE "TLPP-CORE.TH"
#INCLUDE "TLPP-REST.TH"

namespace totvs.protheus.retail.rmi.api.listaorcamentoapi

using namespace totvs.protheus.retail.rmi.api.listaorcamentoobj
using namespace totvs.protheus.retail.rmi.api.OrcamentoObj

//-------------------------------------------------------------------
/*/{Protheus.doc}
    API para consulta de lista de Orçamentos do Varejo
/*  /api/pdvsyncserver/retaguarda/v2/processoonlineprevendaconsulta
/*/
//-------------------------------------------------------------------

/* ----------------------------------------- */
@Get("/api/retail/v1/ListaOrcamento/processoonlineprevendaconsulta")
Function prevendaConsulta(jParams as Json,cBody as Character)
    Local cReturn  := ""
    Local olistaorcamento := Nil
    
    Default jParams := oRest:getQueryRequest()
    Default cBody   := "{}"
    
    olistaorcamento := listaorcamentoObj():New(oRest, jParams, cBody)
    
    olistaorcamento:Get()    
    cReturn := olistaorcamento:getReturn()    
    LjGrvLog("/api/retail/v1/ListaOrcamento/processoonlineprevendaconsulta/","Return: ",cReturn)

    IIf(Empty(cReturn),Eval({|| oRest:setStatusCode(500), cReturn := "Ops! A consulta não retornou um json válido. Por favor, verifique os logs do Protheus (Console, LogLoja) para analisar o ocorrido."}),) 
        
    oRest:setResponse(cReturn)   
Return
//-------------------------------------------------------------------
/*/{Protheus.doc}
    API para consulta de Orçamento do Varejo
/*  /api/pdvsyncserver/retaguarda/v2/processoonlineprevendaconsulta
/*/
//-------------------------------------------------------------------

/* ----------------------------------------- */
@Get("/api/retail/v1/ListaOrcamento/processoonlineprevenda/:IdPedidoRetaguarda")
Function prevenda()
    Local cReturn  := "" //oRest:setResponse(EncodeUtf8(retorna()))

    Local orcamento := Orcamento():New( oRest, oRest:getPathParamsRequest())
    
    orcamento:Get()
    cReturn := EncodeUtf8(orcamento:getReturn())
    LjGrvLog("Retorno do Orçamento: EndPoint:(/api/retail/v1/ListaOrcamento/processoonlineprevenda/:IdPedidoRetaguarda) ","Return: ",cReturn)

    IIf(Empty(cReturn),Eval({|| oRest:setStatusCode(500), cReturn := "Ops! A consulta não retornou um json válido. Por favor, verifique os logs do Protheus (Console, LogLoja) para analisar o ocorrido."}),) 
       
    oRest:setResponse(cReturn)  
    
Return

//-------------------------------------------------------------------
/*/{Protheus.doc}
    API para consulta de lista de Orçamentos do Varejo (QA) - Uso interno
/*  
//-------------------------------------------------------------------

/* ----------------------------------------- */
@Post("/api/pdvsyncserver/retaguarda/v2/processoonlineprevendaconsulta")
Function prevendaConsultaQa()
    Local jParams  := JsonObject():New()
    jParams:FromJson(oRest:GetBodyRequest())
    LjGrvLog("Realizada chamada de API de uso interno através do endpoint : /api/pdvsyncserver/retaguarda/v2/processoonlineprevendaconsulta")
    prevendaConsulta(jParams)
Return

//-------------------------------------------------------------------
/*/{Protheus.doc}
    API para consulta de Orçamento do Varejo
/*  /api/pdvsyncserver/retaguarda/v2/processoonlineprevenda (QA) - Uso interno
/*/
//-------------------------------------------------------------------

/* ----------------------------------------- */
@Get("/api/pdvsyncserver/retaguarda/v2/processoonlineprevenda/:inquilino/:IdPedidoRetaguarda")
Function prevendaQa()
    LjGrvLog("Realizada chamada de API de uso interno através do endpoint : /api/pdvsyncserver/retaguarda/v2/processoonlineprevenda")
    prevenda()    
Return