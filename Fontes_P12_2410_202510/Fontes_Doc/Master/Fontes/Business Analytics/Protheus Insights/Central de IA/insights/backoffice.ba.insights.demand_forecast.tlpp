#include 'tlpp-core.th'
#include 'InsightDefs.ch'
#include "backoffice.ba.insights.demand_forecast.ch"

REGISTER INSIGHT demand_forecast

//-------------------------------------------------------------------
/*/{Protheus.doc} Class demand_forecast
Classe com configuração do insight Demand_forecast (Compras).

Método New() construtor da classe.
Método Config() configurações do insight gravados na tabela I20.
Método Struct() estrutura da tabela temporária gravada no campo Memo I21_PAYLOD.
Método FromToMock() array com de/para com a propriedade da mensagem antiga I14 e a propriedade na mensagem nova I19.

@author  Lucas Lima
@since   18/06/2025
/*/
//-------------------------------------------------------------------
Class demand_forecast from PinsConfig
	Public Method New() CONSTRUCTOR
	Public Method Config()
	Public Method Struct()
	Public Method FromToMock()
EndClass

//-------------------------------------------------------------------
/*/{Protheus.doc} New
Método construtor da classe.

@author  Lucas Lima
@since   18/06/2025
/*/
//-------------------------------------------------------------------
Method New() class demand_forecast
	_Super:New( 'demand_forecast', 'COM' )
Return Self

//-------------------------------------------------------------------
/*/{Protheus.doc} Config
Indica a configuração dos atributos utilizados pelo insight Demand_forecast
que serão gravados na tabela I20.

@author  Lucas Lima
@since   18/06/2025
/*/
//-------------------------------------------------------------------
Method Config() class demand_forecast

	::SetHasKey( .T. )
	::SetHasFilter( .T. )
	::SetPriority( .T. )

	::SetKey("key")

Return

//-------------------------------------------------------------------
/*/{Protheus.doc} Struct
Indica os campos que fazem parte da tabela temporária e como estas
informações serão tratadas.

A estrutura a ser definida deve ter a seguinte estrutura:
	[1] - nome da propriedade na mensagem ( campo memo da tabela I21 )
	[2] - estrutura de campo da tabela temporária
		[1] - nome da propriedade na mensagem
		[2] - tipo
		[3] - tamanho
		[4] - decimal
		[5] - nome da propriedade referência na mensagem
		[6] - posição utilizada na chave composta
	[3] - Indica se a coluna pode ser usada no filtro de pesquisa
	[4] - Texto apresentado
	[5] - Indica a ordem apresentada no browse
	[6] - Indica que a propriedade da mensagem contém uma chave composta

@author  Lucas Lima
@since   18/06/2025
/*/
//-------------------------------------------------------------------
Method Struct() class demand_forecast
	Local aStruct := {}

	// campos no contrato
	aadd( aStruct, { "quality_category"      	 , { "quali_cat", "C", 2, 0 }                                            				, .F., STR0001, 01 } )					//"Acurácia"
	aadd( aStruct, { "product_code"              , pinsTempSizeDefault( "code", "prodcode" )				             				, .T., STR0003, 03, .T. } )				//"Código"
	aadd( aStruct, { "product_description"       , { "proddescr", "C", TamSX3("B1_DESC")[1] , TamSX3("B1_DESC")[2] }	 				, .T., STR0004, 04 } )					//"Descrição"
	aadd( aStruct, { "product_type"              , { "tpe", "C", TamSX3("B1_TIPO")[1], TamSX3("B1_TIPO")[2] }							, .F., STR0005, 05, .T. } )				//"Tipo Produto"
	aadd( aStruct, { "product_type_description"  , { "prodtpdesc", "C", TamSX3("X5_DESCRI")[1], TamSX3("X5_DESCRI")[2] }   				, .F., STR0006, 06 } )					//"Descrição do Tipo"
	aadd( aStruct, { "product_group"         	 , pinsTempSizeDefault( "code", "prodgroup" )							 				, .F., STR0007, 07, .T. } )				//"Grupo Produto"
	aadd( aStruct, { "product_group_description" , { "prodgrdesc", "C", TamSX3("BM_DESC")[1] , TamSX3("BM_DESC")[2] }	 				, .F., STR0008, 08 } )					//"Descrição do Grupo"
	aadd( aStruct, { "frequency"             	 , { "freqc", "C", 1, 0 }	                                            				, .F., STR0009, 09 } )					//"Periodicidade"
	aadd( aStruct, { "quantity"              	 , pinsTempSizeDefault( "quantity", "quantity" )                           				, .F., STR0010, 10 } )					//"Quantidade"
	aadd( aStruct, { "product_price"         	 , { "price", "N", TamSX3("C7_PRECO")[1], TamSX3("C7_PRECO")[2] }        				, .F., STR0011, 11 } )					//"Preço"
	aadd( aStruct, { "supplier_code"         	 , pinsTempSizeDefault( "code", "supplier" )					         				, .F., STR0012, 12, .T. } )				//"Fornecedor"
	aadd( aStruct, { "supplier_name"         	 , { "desc_sup", "C", TamSX3("A2_NOME")[1], TamSX3("A2_NOME")[2] }       				, .F., STR0013, 14 } )					//"Descrição Fornecedor"
	aadd( aStruct, { "product_unity"     		 , { "prod_um", "C", TamSX3("B1_UM")[1], TamSX3("B1_UM")[2] }            				, .F., STR0014, 15 } )					//"Unidade de Medidas"
	aadd( aStruct, { "product_pkg_quantity"      , { "pkg_qtd", "N", TamSX3("B1_QE")[1], TamSX3("B1_QE")[2] }            				, .F., STR0015, 16 } )					//"Quantidade Pacote"
	aadd( aStruct, { "product_raw_weight"        , { "raw_wght", "N", TamSX3("B1_PESBRU")[1], TamSX3("B1_PESBRU")[2] }   				, .F., STR0016, 17 } )					//"Peso Bruto"
	aadd( aStruct, { "product_last_price"        , { "last_prc", "N", TamSX3("B1_UPRC")[1], TamSX3("B1_UPRC")[2] }       				, .F., STR0017, 18 } )					//"Último Preço"
	aadd( aStruct, { "product_last_review"       , pinsTempSizeDefault( "date", "lst_rev_dt" )							 				, .F., STR0018, 19 } )					//"Última Revisão"
	aadd( aStruct, { "product_last_sell"         , { "last_sll", "C", 26, 0 }       									 				, .F., STR0019, 20 } )					//"Data da Última Compra"
	aadd( aStruct, { "product_prevision_delivery", { "prv_dlv", "N", TamSX3("B1_PE")[1], TamSX3("B1_PE")[2] }            				, .F., STR0020, 21 } )					//"Previsão Entrega"
	aadd( aStruct, { "product_status"            , { "prodstatus", "C", TamSX3("B1_SITPROD")[1] , TamSX3("B1_SITPROD")[2] }				, .F., STR0023, 22 } )					//"Situação" 
	aadd( aStruct, { "product_origin"            , { "origin", "C", TamSX3("B1_ORIGEM")[1] , TamSX3("B1_ORIGEM")[2] }	 				, .F., STR0022, 23 } )					//"Origem"
	aadd( aStruct, { "last_updated"        	 	 , pinsTempSizeDefault( "date", "mLstUpd" )                              				, .F., STR0024, 24 } )					//"Ult. Atualização"
	aadd( aStruct, { "graph_points"           	 , pinsTempSizeDefault( "memo", "grphPt" )                               				, .F., STR0029, 25 } )					//"Graph. Points"
	aadd( aStruct, { "id"                    	 , pinsTempSizeDefault( "guid", "id" )                                   				, .F., STR0027, STRUCT_INVISIBLE } )	//"Id"
	aadd( aStruct, { "product_description_espec" , { "spc_desc", "C", TamSX3("B1_ESPECIF")[1], TamSX3("B1_ESPECIF")[2] } 				, .F., STR0028, STRUCT_INVISIBLE } )	//"Descrição Específica"
	aadd( aStruct, { "product_storage"           , { "prodstorag", "C", TamSX3("B1_LOCPAD")[1] , TamSX3("B1_LOCPAD")[2] }				, .F., STR0021, STRUCT_INVISIBLE } )	//"Armazém Padrão"

	// campo especifico em chave composta
	aadd( aStruct, { ""				          	 , { "sup_unity", "C", TamSX3("A2_LOJA")[1] , TamSX3("A2_LOJA")[2], "supplier_code", 3 }, .F., STR0030, 13 } )					//"Loja do Fornecedor"

	// campos compostos (ocultos no front)
	aadd( aStruct, { ""							 , pinsTempSizeDefault( "code", "prodkey", "product_code" )								, .F., "", STRUCT_INVISIBLE } )			//chave composta do produto
	aadd( aStruct, { ""							 , pinsTempSizeDefault( "code", "prdtpkey", "product_type" )							, .F., "", STRUCT_INVISIBLE } )			//chave composta tipo do produto
	aadd( aStruct, { ""							 , pinsTempSizeDefault( "code", "prdgrkey", "product_group" )							, .F., "", STRUCT_INVISIBLE } )			//chave composta grupo do produto
	aadd( aStruct, { ""							 , pinsTempSizeDefault( "code", "suppkey", "supplier_code" )							, .F., "", STRUCT_INVISIBLE } )			//chave composta do fornecedor

	// campos adicionais a mensagem (I21)
	aadd( aStruct, { "branch"                	 , pinsTempSizeDefault( "branch" )									     				, .T., STR0002, 02 } )					//"Filial"

	aStruct := PINSDebugFields(aStruct)

	_Super:SetStruct( aStruct )

Return

//-----------------------------------------------------------------------------------------------------
/*/{Protheus.doc} FromToMock
	Função  que retorna o De/Para Mock estrutura antiga x nova

	@return aPropMock, Array, Propriedades estrutura antiga x nova que devem ser utilizadas no Mock
	O Retorno do De/Para tem a seguinte estrutura:
	[1] - nome da propriedade na estrutura antiga
	[2] - nome da propriedade na estrutura nova

	@author Victor Vieira
	@since 26/06/2025
/*/
//-----------------------------------------------------------------------------------------------------
Method FromToMock() class demand_forecast

	Local aPropMock   := {}

	aadd( aPropMock, { "code"	    		 , "product_code"     			} )
	aadd( aPropMock, { "description"	     , "product_description"     	} )
	aadd( aPropMock, { "type"	    		 , "product_type"     			} )
	aadd( aPropMock, { "type_description"	 , "product_type_description"	} )
	aadd( aPropMock, { "price"	    		 , "product_price"     			} )
	aadd( aPropMock, { "supplier"	    	 , "supplier_code"     			} )
	aadd( aPropMock, { "unity"	    		 , "sup_unity"	    			} )
	aadd( aPropMock, { "desc_supplier"	     , "supplier_name"     			} )
	aadd( aPropMock, { "package_quantity"	 , "product_pkg_quantity"		} )
	aadd( aPropMock, { "raw_weight"	    	 , "product_raw_weight"  		} )
	aadd( aPropMock, { "last_price"	    	 , "product_last_price"  		} )
	aadd( aPropMock, { "last_rev"	    	 , "product_last_review" 		} )
	aadd( aPropMock, { "last_sell"	    	 , "product_last_sell"   		} )
	aadd( aPropMock, { "measurement_unity" 	 , "product_unity"		   		} )
	aadd( aPropMock, { "prevision_delivery"	 , "product_prevision_delivery" } )
	aadd( aPropMock, { "origin"	    		 , "product_origin" 			} )
	aadd( aPropMock, { "prod_situ"    		 , "product_status" 			} )
	aadd( aPropMock, { "specific_description", "product_description_espec" 	} )
	aadd( aPropMock, { "group_description"	 , "product_group_description" 	} )
	aadd( aPropMock, { "maecategory"		 , "quality_category"			} )
	aadd( aPropMock, { "graphPoints"		 , "graph_points" 				} )
	aadd( aPropMock, { "inicial_reference"	 , "initial_reference_date"		} )
	aadd( aPropMock, { "final_reference"	 , "final_reference_date"		} )
	aadd( aPropMock, { "mdmLastUpdated"		 , "last_updated"				} )

Return aPropMock
