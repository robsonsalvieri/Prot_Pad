#INCLUDE 'msobject.ch'
#INCLUDE 'topconn.ch'
#INCLUDE 'totvs.framework.treports.integratedprovider.th'
#INCLUDE 'backoffice.sv.fat.CanceledInvoices.ch'

namespace custom.faturamento.CanceledInvoices.integratedprovider

//-------------------------------------------------------------------------------
/*{Protheus.doc} PurchasesListTReportsBusinessObject
Classe para creación del Objeto de Negocio de compras para TReports
@author Marcelo Hruschka
@since 29/10/2024
@version 1.0 
*/
//-------------------------------------------------------------------------------

@totvsFrameworkTReportsIntegratedProvider( active=.F., team='SIGAFAT', tables='SF3', name='Documentos de salida cancelados', country='MEX', initialRelease='12.1.2410', customTables='SF3' )
class CanceledInvoicesTReportsBusinessObjectMEX from custom.faturamento.CanceledInvoices.integratedprovider.CanceledInvoicesTReportsBusinessObject
	public method new() as object
	public method preData() as object
	public method processData() as object
	public method preSchema() as object
endclass

method new() class CanceledInvoicesTReportsBusinessObjectMEX
	_Super:new()
return self

method preData() as object class CanceledInvoicesTReportsBusinessObjectMEX
return self:oData

method processData() as object class CanceledInvoicesTReportsBusinessObjectMEX

	Local cQuery as character
	Local oExecMEX as object
	Local nX as numeric
	Local cAliasMEX as character

	aFieldsMEX := { 'F3_STATUS','F3_MOTIVO','F3_CNATREC','F3_CODNFE'}
	aStructMEX := getStrutObj( aFieldsMEX, {} )

	cQuery := "SELECT SF3.F3_STATUS, SF3.F3_MOTIVO, SF3.F3_CNATREC, SF3.F3_CODNFE"
	cQuery += "   FROM " + RetSqlName("SF3") + " SF3"
	cQuery += "   WHERE SF3.R_E_C_N_O_ = ?
	cQuery := ChangeQuery(cQuery)
	oExecMEX := FwExecStatement():New( cQuery )
	oExecMEX:SetString( 01, AllTrim(Str(self:nRecnoSF3)) )
	cAliasMEX := oExecMEX:OpenAlias( )
	For nX := 1 To Len(aStructMEX)
		self:jItems[aStructMEX[nX][1]] := ( cAliasMEX )->&( aStructMEX[nX][5] )
	Next

	// fecha tabela
	( cAliasMEX )->( DbCloseArea( ) )
	oExecMEX:Destroy( )
	oExecMEX := Nil

return

method preSchema() as object class CanceledInvoicesTReportsBusinessObjectMEX

	Local nX as numeric

	aFieldsMEX := { 'F3_STATUS','F3_MOTIVO','F3_CNATREC','F3_CODNFE'}
	aStructMEX := getStrutObj( aFieldsMEX, {} )
	For nX := 1 To Len(aStructMEX)
		self:addProperty( aStructMEX[nX][1], aStructMEX[nX][2], aStructMEX[nX][3], aStructMEX[nX][4], aStructMEX[nX][5] )
	Next

return self:oSchema

