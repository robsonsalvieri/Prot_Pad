#INCLUDE "PROTHEUS.CH"
#INCLUDE "FWLIBVERSION.CH"
#include "totvs.ch"
#include "msobject.ch"
#include "totvs.framework.treports.integratedprovider.th"
#include "tlpp-rest.th"
#include "tlpp-core.th"

namespace totvs.protheus.backoffice.sv.fat.billingbyseller.treportsintegratedprovider
using namespace totvs.framework.treports.integratedprovider

@totvsFrameworkTReportsIntegratedProvider(active=.F., team="SIGAFAT", tables="SF2,SD2,SF1,SD1,SF4,SA3", name="Faturamento por Vendedor", country="BRA")

//-------------------------------------------------------------------
/*/{Protheus.doc} billingbysellerSmartViewBusinessObjectBRA
Classe para criação do Objeto de Negócio para listagem de Faturamento por Vendedor localização Brasil.

@author FAT/CRM
@since 18/07/2023
@version 1.0
*/
//-------------------------------------------------------------------  
class billingbysellerSmartViewBusinessObjectBRA from totvs.protheus.backoffice.sv.fat.billingbyseller.treportsintegratedprovider.billingbysellerSmartViewBusinessObject

    public method new() as object
    public method preData() as object
    public method processData() as object
    public method preSchema() as object

    protected data aFields as array
    protected data aStruct as array

endclass
 
//-------------------------------------------------------------------
/*{Protheus.doc} new
Método de instância da classe

@return object: self

@author FAT/CRM
@since 18/07/2023
@version 1.0
*/
//-------------------------------------------------------------------   
method new() class billingbysellerSmartViewBusinessObjectBRA 

    _Super:new()

return self

//-------------------------------------------------------------------
/*{Protheus.doc} preData
Método chamado antes do getData do objeto principal

@return object: self:oData

@author FAT/CRM
@since 18/07/2023
@version 1.0
*/
//-------------------------------------------------------------------   
method preData() as object class billingbysellerSmartViewBusinessObjectBRA 

    //Aqui é adicionada uma condição no where que será utilizado na query do objeto padrão

Return self:oData

//-------------------------------------------------------------------
/*{Protheus.doc} processData
Deverá ser chamado no momento do processamento da query

@return object: self:oData

@author FAT/CRM
@since 18/07/2023
@version 1.0
*/
//-------------------------------------------------------------------    
method processData(nOperLoc as numeric) as object class billingbysellerSmartViewBusinessObjectBRA

    Local cAliasQry := "" as character

    Local dDtMoeDev := CTOD("//") as date

     Do Case 
        //---------------------------------------------------
        //Operação 1:
        //Utilizado somente para commit dos 
        //campos antes do appendData - Case (nOperLoc == 1)
        //---------------------------------------------------

        //---------------------------------------------------
        //Operação 2:
        //realiza tratamento dos valores dos itens com
        //cáculos localizados
        //---------------------------------------------------
        Case (nOperLoc == 2)
            cAliasQry := self:cAliasSD2

            self:nVlSD2IcmLoc   := xMoeda((cAliasQry)->D2_VALICM,1,mv_par06 ,(cAliasQry)->D2_EMISSAO,self:nDecs+1)
            self:nVlSD2IpiLoc   := xMoeda((cAliasQry)->D2_VALIPI,1,mv_par06 ,(cAliasQry)->D2_EMISSAO,self:nDecs+1)
            self:nVlSD2StLoc    := xMoeda((cAliasQry)->F2_ICMSRET,1,mv_par06,(cAliasQry)->D2_EMISSAO,self:nDecs+1)

        //-----------------------------------------------------
        //Operação 3:
        //realiza tratamento dos valores dos itens de devolução
        //com cáculos localizados.
        //-----------------------------------------------------
        Case (nOperLoc == 3)
            cAliasQry := self:cAliasSD1

            If mv_par10 == 1 .Or. Empty((cAliasQry)->F2_EMISSAO)
                dDtMoeDev := (cAliasQry)->F1_DTDIGIT
            Else
                dDtMoeDev := (cAliasQry)->F2_EMISSAO
            EndIf

			self:nVlSD1TotLoc   := xMoeda(((cAliasQry)->D1_TOTAL - (cAliasQry)->D1_VALDESC),1,mv_par06,dDtMoeDev,self:nDecs+1)
            self:nVlSD1IcmLoc   := xMoeda((cAliasQry)->D1_VALICM,1,mv_par06,dDtMoeDev,self:nDecs+1)
            self:nVlSD1IpiLoc   := xMoeda((cAliasQry)->D1_VALIPI,1,mv_par06,dDtMoeDev ,self:nDecs+1)
            self:nVlSF1AdicLoc  := xMoeda((cAliasQry)->F1_ICMSRET,1,mv_par06,dDtMoeDev,self:nDecs+1)

    EndCase

return

//-------------------------------------------------------------------
/*{Protheus.doc} preSchema
Método chamada antes do getSchema do objeto principal

@return object: self:oSchema

@author FAT/CRM
@since 18/07/2023
@version 1.0
*/
//-------------------------------------------------------------------   
method preSchema() as object class billingbysellerSmartViewBusinessObjectBRA

    //Adição de novos campos personalizados (não existem na tabela)

return self:oSchema
