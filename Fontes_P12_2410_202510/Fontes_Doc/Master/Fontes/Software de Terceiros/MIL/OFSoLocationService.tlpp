#include 'totvs.ch'

/*/{Protheus.doc} OFSoLocationService
	Classe que vai controlar as comunicacoes com endpoints de location
	
	@type class
	@author Vinicius Gati
	@since 13/08/2021
/*/
Class OFSoLocationService
	public data lExplicit
	public data lAsync
	public data oMessage
	public data cMsgVX5
	public data cOriId

	Public Method New() CONSTRUCTOR
	Public Method SendCreatedMessage()
	Public Method SendUpdatedMessage()
	Public Method SendRemovedMessage()
EndClass

/*/{Protheus.doc} New
	Construtor Simples

	@type method
	@author Vinicius Gati
	@since 13/08/2021
/*/
Method New(cMsgVX5, cOriId) Class OFSoLocationService
	::lExplicit := .F.
	::lAsync    := .F.
	::cMsgVX5   := cMsgVX5
	::cOriId    := cOriId
Return SELF

/*/{Protheus.doc} SendCreatedMessage
	envia mensagem de createdinDbs

	@type method
	@author Vinicius Gati
	@since 13/08/2021
/*/
Method SendCreatedMessage(oSoLocation) Class OFSoLocationService
local cJson
local cErro := ""
	self:oMessage := OFSoLocationCreatedInDbsMessage():New(oSoLocation)
	self:oMessage:oSoRequest:Set("VK5_ORITAB", "SM0")
	self:oMessage:oSoRequest:Set("VK5_MESSAG", self:cMsgVX5)
	self:oMessage:oSoRequest:Set("VK5_ORIKEY", self:cOriId)
//	self:oMessage:oSoRequest:Set("VK5_REQBOD", oSoLocation:toJson()) // 2 :toJson() pq a totvs ao inves de chamar de toString o metodo que retorna string chamou de toJson tambem
	cJson := FGX_JSONform( oSoLocation:toJson(), .T., @cErro )
	self:oMessage:oSoRequest:Set("VK5_REQBOD", iif( empty( cErro ), cJson, oSoLocation:toJson() ) )
Return self:oMessage:Send()

/*/{Protheus.doc} SendUpdatedMessage
	SendUpdatedMessage

	@type method
	@author Vinicius Gati
	@since 13/08/2021
/*/
Method SendUpdatedMessage(oSoLocation) Class OFSoLocationService
local cJson
local cErro := ""
	self:oMessage := OFSoLocationUpdatedInDbsMessage():New(oSoLocation)
	self:oMessage:oSoRequest:Set("VK5_ORITAB", "SM0")
	self:oMessage:oSoRequest:Set("VK5_MESSAG", self:cMsgVX5)
	self:oMessage:oSoRequest:Set("VK5_ORIKEY", self:cOriId)
//	self:oMessage:oSoRequest:Set("VK5_REQBOD", oSoLocation:toJson()) // 2 :toJson() pq a totvs ao inves de chamar de toString o metodo que retorna string chamou de toJson tambem
	cJson := FGX_JSONform( oSoLocation:toJson(), .T., @cErro )
	self:oMessage:oSoRequest:Set("VK5_REQBOD", iif( empty( cErro ), cJson, oSoLocation:toJson() ) )
Return self:oMessage:Send()


/*/{Protheus.doc} SendRemovedMessage
	SendRemovedMessage

	@type method
	@author Vinicius Gati
	@since 13/08/2021
/*/
Method SendRemovedMessage(oSoLocation) Class OFSoLocationService
local cJson
local cErro := ""
	self:oMessage := OFSoLocationRemovedInDbsMessage():New(oSoLocation)
	self:oMessage:oSoRequest:Set("VK5_ORITAB", "SM0")
	self:oMessage:oSoRequest:Set("VK5_MESSAG", self:cMsgVX5)
	self:oMessage:oSoRequest:Set("VK5_ORIKEY", self:cOriId)
//	self:oMessage:oSoRequest:Set("VK5_REQBOD", oSoLocation:toJson()) // 2 :toJson() pq a totvs ao inves de chamar de toString o metodo que retorna string chamou de toJson tambem
	cJson := FGX_JSONform( oSoLocation:toJson(), .T., @cErro )
	self:oMessage:oSoRequest:Set("VK5_REQBOD", iif( empty( cErro ), cJson, oSoLocation:toJson() ) )
Return self:oMessage:Send()
