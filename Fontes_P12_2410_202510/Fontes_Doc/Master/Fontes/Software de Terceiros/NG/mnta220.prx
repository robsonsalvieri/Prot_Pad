#INCLUDE "mnta220.ch"
#INCLUDE "PROTHEUS.CH"
#define cCORFA COLOR CLR_HRED
#define cCORBL COLOR CLR_HBLUE

Static lRel12133 := GetRPORelease() >= '12.1.033'

/*/


Ŀ
Funo     MNTA220   Autor  Inacio Luiz Kolling    Data 25/05/05  
Ĵ
Descrio  Desenho do Esquema Padrao                                  
Ĵ
 Uso       Generico                                                   
ٱ


/*/
Function MNTA220()

Local aNGBEGINPRM := {}
Local aInd := {}, cCond

If !FindFunction( 'MNTAmIIn' ) .Or. MNTAmIIn( 19, 95 )

	//Ŀ
	//Guarda conteudo e declara variaveis padroes 
	//
	aNGBEGINPRM := NGBEGINPRM()

	Private lIndTQ1 := If(NgVerify("TQ1"),.T.,.F.)
	Private lTemF7 := NGCADICBASE('TQ1_FAMIL7','A','TQ1')[1]

	Private lGFrota   := MNTA220FR()
	Private lTipMod   := lRel12133 .Or. lGFrota
	Private aRotina   := MenuDef(lTipMod)
	Private cSTEPE    := STR0010 //"RESERVA"
	Private cSpaceFL  := Space(Len(st6->t6_codfami))
	Private nSTEPES   := 0
	Private nQTDITEN  := 0
	Private aESTFAMI  := {}
	Private aESTPADR  := {}
	Private cCadastro := OemtoAnsi(STR0017) //"Cadastro do Esquema Padrao"
	Private nEIXO,nQTDPNE,nLOCPN1,nFAMIL1,nLOCPN2,nFAMIL2,nLOCPN3,nFAMIL3,;
			nLOCPN4,nFAMIL4,nLOCPN5,nFAMIL5,nLOCPN6,nFAMIL6,nLOCPN7,nFAMIL7,;
			nLOCPN8,nFAMIL8,nLOCPN9,nFAMIL9,nLOCPN0,nFAMIL0,nTIPEIX,nSUSPEN
	Private lTpModAlt := .f. //identifica que j havia bem padrao cadastrado antes de integrar com o frota e na alterao do registro chega a chave antiga
	Private lUsaSusp  := (lGFrota .AND. NGCADICBASE("TQ1_SUSPEN","A","TQ1",.F.))

	Store 0 To nEIXO,nQTDPNE,nLOCPN1,nFAMIL1,nLOCPN2,nFAMIL2,nLOCPN3,nFAMIL3,;
			nLOCPN4,nFAMIL4,nLOCPN5,nFAMIL5,nLOCPN6,nFAMIL6,nLOCPN7,nFAMIL7,;
			nLOCPN8,nFAMIL8,nLOCPN9,nFAMIL9,nLOCPN0,nFAMIL0

	aPos1   := {15,1,78,315 }
	aCHOICE := {}
	aVARNAO := {}
	aGETNAO := {{"TQ1_DESENH", "M->TQ0_DESENH"}}
	If !lUsaSusp
		AADD(aGETNAO,{"TQ1_SUSPEN" ,""})
	Endif

	If lTipMod
	cGETWHILE := "TQ1_FILIAL == xFilial('TQ1') .And. TQ1_DESENH == M->TQ0_DESENH .And. TQ1_TIPMOD == M->TQ0_TIPMOD"
	cGETMAKE  := "TQ0->TQ0_DESENH+TQ0->TQ0_TIPMOD"
	cGETKEY   := "M->TQ0_DESENH+M->TQ0_TIPMOD"
	Else
	cGETWHILE := "TQ1_FILIAL == xFilial('TQ1') .And. TQ1_DESENH == M->TQ0_DESENH"
	cGETMAKE  := "TQ0->TQ0_DESENH"
	cGETKEY   := "M->TQ0_DESENH"
	Endif

	cGETALIAS := "TQ1"
	cTUDOOK   := "AllwaysTrue()"
	cLINOK    := "AllwaysTrue()"
	bNGGRAVA  := {}
	aCHKDEL   := {}

	dbSelectArea("TQ0")
	If NGCADICBASE("TQ0_CODEST","D","TQ0",.F.)
		cCond := "Empty(TQ0->TQ0_CODEST)"
		bFiltraBrw := {|| FilBrowse("TQ0",@aInd,@cCond) }
		Eval(bFiltraBrw)
	EndIf

	mBrowse( 6, 1,22,75,"TQ0")

	If Len(aInd) > 0
		aEval(aInd,{|x| Ferase(x[1]+OrdBagExt())})
	EndIf

	DbSelectArea("TQ0")
	//Ŀ
	//Retorna conteudo de variaveis padroes       
	//
	NGRETURNPRM(aNGBEGINPRM)

EndIf

Return

//----------------------------------------------------------------
/*/{Protheus.doc} MNTA220IN()
Programa de inclusao do Esquema Padrao

@param cAlias, Caracter, Alias da tabela utilizada.
@param nReg, Numrico, Recno no registro.
@param nOpcx, Numrico, Opo utilizada.

@author Incio Luiz Kolling
@since	25/05/2005

@return Vazio
/*/
//----------------------------------------------------------------
Function MNTA220IN(cAlias,nReg,nOpcx)

	Local LVar01    := 1
	Local nLinhas   := 0
	Local bCampo    := {||}
	Local nOpcao    := 3
	Local lGravaOK  := .T.
	Local i         := 0
	Local nInd      := 0
	Local nTam      := 0
	Local GetList   := {}
	Local aVirtual  := {}
	Local aStruct   := {}
	Local oPanelTot := Nil //Painel para adequao da tela.
	Local cRelacao  := ""
	Local cCampo    := ""
	Local nTamTot   := 0
	Local nDec      := 0
	Local aNoFields := {}
	Local aHeadBkp  := {}
	Local cTitle    := ""
	Local cPict     := ""
	Local cValid    := ""
	Local cType     := ""
	Local cArq      := ""
	Local cContext  := ""

	Private aOLDCOLS, oDlg, oGet
	Private aTELA[0][0],aGETS[0],aHeader[0],Continua
	Private oMenu
	Private nOpca := 0
	Private aSize := MsAdvSize(,.f.,430), aObjects := {}

	aAdd(aObjects,{050,050,.t.,.t.})
	aAdd(aObjects,{100,100,.t.,.t.})

	aInfo   := {aSize[1],aSize[2],aSize[3],aSize[4],0,0}
	aPosObj := MsObjSize(aInfo, aObjects,.t.)

	nContI   := 0
	bCampo   := {|nCPO| Field(nCPO) }
	aFields  := {}

	DbSelectArea("TQ0")
	DbSetOrder(1)
	DbGobottom()
	DbSkip(1)

	For i := 1 To FCount()
		M->&(EVAL(bCampo,i)) := TQ0->&(EVAL(bCampo,i))
		If ValType(M->&(EVAL(bCampo,i))) == "C"
			M->&(EVAL(bCampo,i)) := SPACE(LEN(M->&(EVAL(bCampo,i))))
		ElseIf ValType(M->&(EVAL(bCampo,i))) == "N"
			M->&(EVAL(bCampo,i)) := 0
		ElseIf ValType(M->&(EVAL(bCampo,i))) == "D"
			M->&(EVAL(bCampo,i)) := cTod("  /  /  ")
		ElseIf ValType(M->&(EVAL(bCampo,i))) == "L"
			M->&(EVAL(bCampo,i)) := .F.
		EndIf
	Next i

	If !lTipMod
		aNoFields := {"TQ0_TIPMOD","TQ0_DESMOD"}
	EndIf

	aNgHeader := NGHeader(cAlias,aNoFields, .F.)
	nTamTot := Len(aNgHeader)

	For nInd := 1 To nTamTot

		cCampo := aNgHeader[nInd,2]
		aAdd(aFields,cCampo)
		cRelacao := Posicione("SX3",2,cCampo,"X3_RELACAO")

		If !Empty(cRelacao)
			xx  := "M->" + Trim(cCampo)
			yy  := Trim(cRelacao)
			&xx.:= &yy.
		EndIf

	Next nInd

	cALIAS  := "TQ1"

	If lGFrota
		aNoFields := {"TQ1_DESENH","TQ1_TIPMOD","TQ1_SEQREL","TQ1_SEQUEN"}
	Else
		aNoFields := {"TQ1_DESENH","TQ1_SEQREL","TQ1_TIPMOD","TQ1_TIPEIX","TQ1_SEQUEN","TQ1_SUSPEN"}
	EndIf

	aNgHeader := NGHeader(cAlias,aNoFields, .F.)
	nTamTot  := Len(aNgHeader)

	For nInd := 1 To nTamTot

		cCampo   := aNgHeader[nInd,2]
		cTitle   := aNgHeader[nInd,1]
		cPict    := aNgHeader[nInd,3]
		nTam     := aNgHeader[nInd,4]
		nDec     := aNgHeader[nInd,5]
		cValid   := aNgHeader[nInd,6]
		cType    := aNgHeader[nInd,8]
		cArq     := Posicione("SX3",2,cCampo,"X3_ARQUIVO")
		cContext := aNgHeader[nInd,10]
		aAdd(aHeader,{cTitle, cCampo,cPict,nTam,nDec,cValid,"   ", cType,cArq,cContext})

	Next nInd

	nContI := Len(aHeader)
	//Inclui coluna de registro atraves de funcao generica
	ADHeadRec("TQ1",aHeader)
	nContI := nContI + 2
	Private aCOLS[1][nContI+1]

	//Faz a inicializacao dos campos da acols
	MNT220CSX3(1,.T.)
	MNTA220VHA()

	nOpca    := 0
	nQTDITEN := 1
	DEFINE MSDIALOG oDlg TITLE OemToAnsi(STR0017) From aSize[7],0 To aSize[6],aSize[5] OF oMainWnd PIXEL STYLE nOR(WS_VISIBLE,WS_POPUP) //"Cadastro do Esquema Padrao"

		//Cria Painel para adequao da tela.
		oPanelTot := TPanel():New(0,0,,oDlg,,,,,,0,0,.F.,.F.)
		oPanelTot:Align := CONTROL_ALIGN_ALLCLIENT

		oEnchoice := Msmget():New("TQ0", nReg, nOpcx,,,,aFields,aPosObj[1],,3,,,,oPanelTot)
		nCbxStepe := aScan(oEnchoice:AENTRYCTRLS,{|x| "TQ0_STEPE" $ x:cREADVAR})
		oEnchoice:AENTRYCTRLS[nCbxStepe]:aItems := {"N="+STR0104,"S="+STR0105} //"Nao"##"Sim" //Altera combo de Reserva
		oGet := MSGetDados():New(aPosObj[2,2],aPosObj[2,2],aPosObj[2,3],aPosObj[2,4],nOpcx,"MNTA220LIN","MNTA220TOK","",.F.,,,,nQTDITEN,,,,,oPanelTot)

		NGPOPUP(asMenu,@oMenu)
		oPanelTot:bRClicked:= { |o,x,y| oMenu:Activate(x,y,oPanelTot)}
		oEnchoice:oBox:bRClicked := { |o,x,y| oMenu:Activate(x,y,oPanelTot)}

	ACTIVATE MSDIALOG oDLG ON INIT EnchoiceBar(oDLG,{||nOpca:=1,If(!MNTA220TOK(),nOpca := 0,oDLG:End())},{||oDLG:End()},;
								   AlignObject(oDlg,{oEnchoice:oBox,oGet:oBrowse},1))
	If nOpcA = 1
		Begin Transaction
			lGravaOk := MNTA220GRA(cAlias,nOpcao)
			If !lGravaOk
				Help(" ",1,"NGFORNAOREG")
			Else
				EvalTrigger()
			EndIf
		End Transaction
	Endif

	DbSelectArea('TQ0')

Return

/*/


Ŀ
Funo    MNTA220VHA Autor  Incio Luiz Kolling    Data 25/05/05  
Ĵ
Descrio Atualiza variaveis de controle                              
Ĵ
 Uso      MNTA220                                                     
ٱ


/*/
Static Function MNTA220VHA()
nEIXO   := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_EIXO" })
nQTDPNE := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_QTDPNE" })
nLOCPN1 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_LOCPN1" })
nFAMIL1 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_FAMIL1" })
nLOCPN2 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_LOCPN2" })
nFAMIL2 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_FAMIL2" })
nLOCPN3 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_LOCPN3" })
nFAMIL3 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_FAMIL3" })
nLOCPN4 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_LOCPN4" })
nFAMIL4 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_FAMIL4" })
nLOCPN5 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_LOCPN5" })
nFAMIL5 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_FAMIL5" })
nLOCPN6 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_LOCPN6" })
nFAMIL6 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_FAMIL6" })
nLOCPN7 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_LOCPN7" })
nFAMIL7 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_FAMIL7" })
nLOCPN8 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_LOCPN8" })
nFAMIL8 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_FAMIL8" })
nLOCPN9 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_LOCPN9" })
nFAMIL9 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_FAMIL9" })
nLOCPN0 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_LOCPN0" })
nFAMIL0 := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_FAMIL0" })
nTIPEIX := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_TIPEIX" })
If lUsaSusp
	nSUSPEN := aSCAN(aHEADER, {|x| AllTrim(Upper(X[2])) == "TQ1_SUSPEN" })
EndIf
Return .t.

//----------------------------------------------------------------
/*/{Protheus.doc} MNTA220AL()
Programa de inclusao do Esquema Padrao

@param cAlias, Caracter, Alias da tabela utilizada.
@param nReg, Numrico, Recno no registro.
@param nOpcx, Numrico, Opo utilizada.

@author Incio Luiz Kolling
@since	25/05/2005

@return Vazio
/*/
//----------------------------------------------------------------
Function MNTA220AL(cAlias,nReg,nOpcx)

	Local bCampo, i
	Local oPanelTot := Nil //Painel para adequao da tela.
	Local LVar01    := 1
	Local nLinhas   := 0
	Local nInd      := 0
	Local nTamTot   := 0
	Local nTam      := 0
	Local nDec      := 0
	Local GetList   := {}
	Local aVirtual  := {}
	Local aStruct   := {}
	Local lGravaOK  := .T.
	Local nOpcao    := 3
	Local cRelacao  := ""
	Local cUso      := ""
	Local cX3NVL    := ""
	Local cTitle    := ""
	Local cCampo    := ""
	Local cPict     := ""
	Local cValid    := ""
	Local cType     := ""
	Local cArq      := ""
	Local aNgHeader := {}
	Local aNoFields := {}

	Private aTELA[0][0],aGETS[0],aHeader[0],Continua,aOLDCOLS
	Private oMenu, nCnt, oDlg, oGet
	Private aSize    := MsAdvSize(,.f.,430)
	Private aObjects := {}
	Private nOpca    := 0

	aAdd(aObjects,{050,050,.t.,.t.})
	aAdd(aObjects,{100,100,.t.,.t.})

	aInfo   := {aSize[1],aSize[2],aSize[3],aSize[4],0,0}
	aPosObj := MsObjSize(aInfo, aObjects,.t.)

	nContI   := 0
	bCampo   := {|nCPO| Field(nCPO) }
	aFields  := {}

	dbSelectArea("TQ0")
	dbSetOrder(1)

	If lTipMod
		MNTA220FPA(tq0->tq0_desenh,tq0->tq0_tipmod)
	Else
		MNTA220FPA(tq0->tq0_desenh)
	Endif

	nSavReg  := Recno()
	dbSelectArea("TQ0")
	For i := 1 To FCount()
		x   := "M->" + FieldName(i)
		&x. := FieldGet(i)
	Next i

	If !lTipMod
		aNoFields := {"TQ0_TIPMOD","TQ0_DESMOD"}
	EndIf
	aNgHeader := NGHeader(cAlias, aNoFields, .F.)
	nTamTot := Len(aNgHeader)

	For nInd := 1 To nTamTot

		cCampo := aNgHeader[nInd,2]
		aAdd(aFields,cCampo)
		cRelacao := Posicione("SX3",2,cCampo,"X3_RELACAO")

		If !Empty(cRelacao)
			xx  := "M->" + Trim(cCampo)
			yy  := Trim(cRelacao)
			&xx.:= &yy.
		EndIf

	Next nInd

	cALIAS  := "TQ1"
	aHeader := {}

	If lGFrota
		aNoFields := {"TQ1_DESENH","TQ1_TIPMOD","TQ1_SEQREL","TQ1_SEQUEN"}
	Else
		aNoFields := {"TQ1_DESENH","TQ1_SEQREL","TQ1_TIPMOD","TQ1_TIPEIX","TQ1_SEQUEN","TQ1_SUSPEN"}
	EndIf

	aNgHeader := NGHeader(cAlias, aNoFields, .F.)
	nTamTot  := Len(aNgHeader)

	For nInd := 1 To nTamTot

		cCampo   := aNgHeader[nInd,2]
		cTitle   := aNgHeader[nInd,1]
		cPict    := aNgHeader[nInd,3]
		nTam     := aNgHeader[nInd,4]
		nDec     := aNgHeader[nInd,5]
		cValid   := aNgHeader[nInd,6]
		cType    := aNgHeader[nInd,8]
		cArq     := Posicione("SX3",2,cCampo,"X3_ARQUIVO")
		cContext := aNgHeader[nInd,10]
		aAdd(aHeader,{cTitle, cCampo,cPict,nTam,nDec,cValid,"   ", cType,cArq,cContext})

	Next nInd

	nContI := Len(aHeader)

	//Adiciona os campos de Alias e Recno ao aHeader para WalkThru.
	ADHeadRec("TQ1",aHeader)
	nContI := nContI + 2
	Private aCOLX[1][nContI+1]
	aCOLS  := Aclone(aCOLX)

	dbSelectArea("SX3")
	dbSetOrder(1)
	dbSeek(cAlias)

	dbSelectArea(cAlias)
	If lTipMod
		dbSeek( xFilial("TQ1")+M->TQ0_DESENH+M->TQ0_TIPMOD)
		nCnt := 0
		While !Eof() .And. TQ1->TQ1_FILIAL == xFilial("TQ1") .And. TQ1->TQ1_DESENH == M->TQ0_DESENH .And. TQ1->TQ1_TIPMOD == M->TQ0_TIPMOD
			nCnt++
			dbSkip()
		End
	Else
		dbSeek( xFilial("TQ1")+M->TQ0_DESENH)
		nCnt := 0
		While !Eof() .And. TQ1->TQ1_FILIAL == xFilial("TQ1") .And.;
			TQ1->TQ1_DESENH == M->TQ0_DESENH
			nCnt++
			dbSkip()
		End
	Endif

	Private aCOLP[nCnt][nContI+1]

	aCOLS  := Aclone(aCOLP)
	cALIAS := "TQ1"

	dbSelectArea(cALIAS)
	dbSetOrder(1)

	If lTipMod
		dbSeek( xFilial("TQ1")+TQ0->TQ0_DESENH+TQ0->TQ0_TIPMOD)
		nCnt := 0
		While !Eof() .And. TQ1->TQ1_FILIAL == XFILIAL("TQ1") .And. TQ1->TQ1_DESENH == TQ0->TQ0_DESENH .And. TQ1->TQ1_TIPMOD == TQ0->TQ0_TIPMOD
			nCnt++
			nContI := 0

         //-------------------------------------------------------------
         // O controle nTamTot deve ter o tamanho -2 pois aqui o aHeader
         // contm nas 2 ltimas posies os campos de Alias e Recno
         //-------------------------------------------------------------
			nTamTot := Len(aHeader) - 2
			For nInd := 1 To nTamTot

				cCampo   := aHeader[nInd,2]
				nContI   += 1
				cContext := Posicione("SX3",2,cCampo,"X3_CONTEXT")

				If cContext # "V"
					aCOLS[nCnt][nContI] := &(cAlias + "->" + cCampo)
				ElseIf cContext == "V"
					aCOLS[nCnt][nContI] := CriaVar(AllTrim(cCampo))
				EndIf

			Next nInd

			nContI := nContI + 2

			aCols[nCnt][nContI-1] := "TQ1"
			aCols[nCnt][nContI]   := TQ1->(Recno())
			aCOLS[nCnt][nContI+1] := .F.
			dbSelectArea( cAlias )
			dbSkip()
		End
	Else
		dbSeek(xFilial("TQ1")+TQ0->TQ0_DESENH)
		nCnt := 0
		While !Eof() .And. TQ1->TQ1_FILIAL == XFILIAL("TQ1") .And. TQ1->TQ1_DESENH == TQ0->TQ0_DESENH

			nCnt++
			nContI  := 0
			nTamTot := Len(aHeader) - 2

			For nInd := 1 To nTamTot

				cCampo   := aHeader[nInd,2]
				nContI   += 1
				cContext := Posicione("SX3",2,cCampo,"X3_CONTEXT")

				If cContext # "V"
					aCOLS[nCnt][nContI] := &(cAlias + "->" + cCampo)
				ElseIf cContext == "V"
					aCOLS[nCnt][nContI] := CriaVar(AllTrim(cCampo))
				EndIf

			Next nInd

			nContI                := nContI + 2
			aCols[nCnt][nContI-1] := "TQ1"
			aCols[nCnt][nContI]   := TQ1->(Recno())
			aCOLS[nCnt][nContI+1] := .F.

			dbSelectArea( cAlias )
			dbSkip()
		End
	Endif

	MNTA220VHA()

	nQTDITEN := 0
	nQTDITEN := nCnt
	nOpca    := 0

	DEFINE MSDIALOG oDlg TITLE OemToAnsi(STR0017) From aSize[7],0 To aSize[6],aSize[5] OF oMainWnd PIXEL STYLE nOR(WS_VISIBLE,WS_POPUP) //"Cadastro do Esquema Padrao"

		//Cria Painel para adequao da tela.
		oPanelTot := TPanel():New(0,0,,oDlg,,,,,,0,0,.F.,.F.)
		oPanelTot:Align := CONTROL_ALIGN_ALLCLIENT

		oEnchoice := Msmget():New("TQ0", nReg, nOpcx,,,,aFields,aPosObj[1],,3,,,,oPanelTot)
		nCbxStepe := aScan(oEnchoice:AENTRYCTRLS,{|x| "TQ0_STEPE" $ x:cREADVAR})
		oEnchoice:AENTRYCTRLS[nCbxStepe]:aItems := {"N="+STR0104,"S="+STR0105,""} //"Nao"##"Sim" //Altera combo de Reserva

		oEnchoice:AENTRYCTRLS[nCbxStepe]:Refresh()
		M->TQ0_STEPES := TQ0->TQ0_STEPES
		oEnchoice:AENTRYCTRLS[nCbxStepe]:Refresh()

		oGet := MSGetDados():New(aPosObj[2,2],aPosObj[2,2],aPosObj[2,3],aPosObj[2,4],nOpcx,"MNTA220LIN","","",.F.,,,,nQTDITEN,,,,,oPanelTot)
		oGet:oBrowse:Align := CONTROL_ALIGN_ALLCLIENT

		NGPOPUP(asMenu,@oMenu)
		oPanelTot:bRClicked      := { |o,x,y| oMenu:Activate(x,y,oPanelTot)}
		oEnchoice:oBox:bRClicked := { |o,x,y| oMenu:Activate(x,y,oPanelTot)}

	ACTIVATE MSDIALOG oDLG ON INIT EnchoiceBar(oDLG,{||nOpca:=1,MNT220TPMOD(nOpcx),If(!MNTA220TOK(),nOpca := 0,oDLG:End())},{||oDLG:End()},;
							AlignObject(oDlg,{oEnchoice:oBox,oGet:oBrowse},1))
	If nOpcA == 1
		Begin Transaction
			lGravaOk := MNTA220GRA(cAlias,nOpcao)
			If !lGravaOk
				Help(" ",1,"NGFORNAOREG")
			Else
				EvalTrigger()
			EndIf
		End Transaction
	Endif
	dbSelectArea("TQ0")

Return .T.

/*/


Ŀ
Funo    MNTA220EX  Autor  Incio Luiz Kolling    Data 25/05/05  
Ĵ
Descrio  Programa de exclusao do Esquema Padrao                     
Ĵ
 Uso      MNTA220                                                     
ٱ


/*/
Function MNTA220EX(cAlias,nReg,nOpcx)
Local nX, cLoc, cCpo, cAllLoc := ""

If lGFrota
	dbSelectArea("TQ1")
	dbSetOrder(1)
	dbSeek(xFilial("TQ1")+TQ0->TQ0_DESENH+TQ0->TQ0_TIPMOD)
	While !Eof() .And. xFilial("TQ1") == TQ1->TQ1_FILIAL .And. TQ0->TQ0_DESENH+TQ0->TQ0_TIPMOD == TQ1->TQ1_DESENH+TQ1->TQ1_TIPMOD
		For nX := 0 To 9
			cCpo := "TQ1->TQ1_LOCPN"+cValToChar(nX)
			cLoc := &cCpo
			If !Empty(cLoc)
				cAllLoc += ValToSql(cLoc)+","
			EndIf
		Next nX
		dbSelectArea("TQ1")
		dbSkip()
	EndDo

	bNGGrava := {|| MNT221VDEL(TQ0->TQ0_DESENH,TQ0->TQ0_TIPMOD,Substr(cAllLoc,1,Len(cAllLoc)-1)) }
EndIf

NGCAD02(cAlias,nReg,nOpcx)

Return
/*/


Ŀ
Funo    MNTA220FPA Autor  Incio Luiz Kolling    Data 25/05/05  
Ĵ
Descrio Alimenta o arquivo temporario                               
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220FPA(cVFAMI,cVTIPM)

	Local cModelo := cVTIPM
	Local lTemPad := .T.

	Default cVTipM := Space( TamSX3( 'T9_TIPMOD' )[1] )

	aESTPADR := {}

	dbSelectArea( 'STC' )

	cVFAMI += Space(TAMSX3("T9_CODBEM")[1]-Len(cVFAMI))

	If lTipMod

		If lRel12133
			// Busca e posiciona na estrutura padro
			lTemPad := MNTSeekPad( 'STC', ;
									5, ; // TC_FILIAL+TC_CODBEM+TC_TIPMOD+TC_COMPONE+TC_TIPOEST+TC_LOCALIZ+TC_SEQRELA
									cVFAMI, ;
									cVTipM )

			cModelo := STC->TC_TIPMOD
		EndIf

		DbSetOrder(5)
		If lTemPad .And. DbSeek(xFilial("STC")+cVFAMI+cModelo)
			While !Eof() .And. stc->tc_filial = Xfilial('STC') .And.;
				stc->tc_codbem = cVFAMI .And. stc->tc_tipmod = cModelo
				If stc->tc_tipoest = 'F' .And. !Empty(stc->tc_localiz)
					Aadd(aESTPADR,{stc->tc_compone,stc->tc_localiz})
				Endif
				Dbskip()
			End
		Endif
	Else
		DbSetOrder(1)
		If DbSeek(xFilial("STC")+cVFAMI)
			While !Eof() .And. stc->tc_filial = Xfilial('STC') .And.;
				stc->tc_codbem = cVFAMI
				If stc->tc_tipoest = 'F' .And. !Empty(stc->tc_localiz)
					Aadd(aESTPADR,{stc->tc_compone,stc->tc_localiz})
				Endif
				Dbskip()
			End
		Endif
	Endif
Return .T.

/*/


Ŀ
Funo    MNTA220FLO Autor  Incio Luiz Kolling    Data 25/05/05  
Ĵ
Descrio Consistncia da familia do rodado e/ou familia padrao       
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220FLO(cVFAMIG,nFAMICOL)
cMENLOC2 := Space(1)

If !ExistCpo("ST6",cVFAMIG)
   Return .f.
Endif

If ALTERA .And. cVFAMIG != aCols[n][nFAMICOL]
	If !MNT221CHKLC(M->TQ0_DESENH,M->TQ0_TIPMOD,ValToSql(aCols[n][nFAMICOL-1]))
		MsgStop(STR0106+AllTrim(aCols[n][nFAMICOL-1]),STR0040) //"No  possvel alterar a Localizao e Famlia do Esquema Padro pois j existem Estruturas com pneus na localizao "
		Return .F.
	EndIf
EndIf

If Len(aESTPADR) > 0 .And. !Empty(cVFAMIG)
   nPOSF := ASCAN(aESTPADR,{|x| Substr(x[1],1,6)+x[2] == cVFAMIG+aCols[n][nFAMICOL-1]})
   If nPOSF = 0
      cMENLOC1 := STR0018+cVFAMIG+STR0019+aCols[n][nFAMICOL-1]+chr(13)+chr(10); //"Familia "###" com a localizacao "
                 +STR0020+chr(13)+chr(10)+m->tq0_desenh+"." //"nao foi cadastrada na estrutura padrao "
      cFILLOC := MNTA220FAS(nFAMICOL)
      If cFILLOC = 'FALSO'
         Return .f.
      Endif
      &(READVAR()) := Substr(cFILLOC,1,6)
   Else
      If aESTPADR[nPOSF][2] <> aCOLS[n][nFAMICOL-1]
         MsgInfo(STR0021+chr(13); //"Familia e/ou localizacao nao corresponde"
                +STR0022+chr(13); //"com a familia e locolizacao definada na"
                +STR0023+m->tq0_desenh+" / "+cVFAMIG,STR0024) //"estrutura padrao "###"NAO CONFORMIDADE"
         Return .f.
      Endif
   Endif
Endif
Return .T.

/*/


Ŀ
Funo    MNTA220FAS Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Monta filtra das localizacoes com a familia padrao          
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Static Function MNTA220FAS(nCOLU)
Local cRET
Local aESTPAUX := Aclone(aESTPADR)
Local aFILBOX1 := {},kx

For kx := 1 To Len(aESTPAUX)
   nPOSC := ASCAN(aESTPAUX,{|x| x[2] == aCols[n][nCOLU-1]})
   If nPOSC > 0
      DbSelectArea("ST6")
      DbSetOrder(1)
      DbSeek(xFilial('ST6')+aESTPAUX[nPOSC][1])
      Aadd(aFILBOX1,{Substr(aESTPAUX[nPOSC][1],1,6),ST6->T6_NOME})
      Adel(aESTPAUX,nPOSC)
      Asize(aESTPAUX,Len(aESTPAUX)-1)
   Endif
Next kx

If Len(aFILBOX1) = 0
   cMENLOC2 := STR0025+chr(13)+chr(10); //"E segundo definido na estrutura padrao"
              +STR0026 //"nao ha mais localizacoes disponiveis."
   Msginfo(cMENLOC1+chr(13)+chr(10)+cMENLOC2, STR0040)//'ATENCAO'
   Return 'FALSO'
Endif

cMENLOC2 := chr(13)+chr(13)+STR0027 //"Familia disponivel para a localizacao"
cCAMPO   := Space(6)
If Len(aFILBOX1) > 0
   cCAMPO := 0
Endif

cCONFIR := .F.
cTITULO := STR0028 //"Selecao de Familias Disponiveis"
cRET    := MNTA220SFL(aFILBOX1,cCAMPO,cTITULO)
cRET2   := If(cRET = NIL .Or. !cCONFIR,'FALSO',Substr(cRET,1,6))
Return cRET2

/*/


Ŀ
Funo    MNTA220SFL Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Selecao de familias  Localizacao                            
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Static Function MNTA220SFL(aItems,cValue,cTitle )
local oDlgx
Private oMenu
DEFINE DIALOG oDlgx FROM 15,60 TO 30,92 TITLE cTitle
   @0.2,0.5 say cMENLOC1+cMENLOC2
      @ 30.5,0.5 LISTBOX oSx2 FIELDS HEADER ;
      STR0029,STR0030; //"Codigo"###"Descricao"
      OF oDlgx;
      SIZE 125,80 PIXEL;
      ON DBLCLICK (cCONFIR := .T.,cValue:=oSx2:nAt,oDlgx:End())
   oSx2:SetArray(aItems )
   oSx2:bLine := { || { aItems[ oSx2:nAT,1 ],aItems[oSx2:nAT,2 ]} }

   NGPOPUP(asMenu,@oMenu)
	oDlgx:bRClicked:= { |o,x,y| oMenu:Activate(x,y,oDlgx)}

ACTIVATE DIALOG oDlgx
return If(cValue > 0,aITEMS[cValue,1],cCONFIR)

/*/


Ŀ
Funo    MNTA220LIN Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio  Critica se a linha digitada esta' Ok                       
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220LIN(o)
Return .T.

/*/


Ŀ
Funo    MNTA220TOK Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio  Critica se a nota toda esta' Ok                            
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220TOK(o)
Local nx := 0, xn,mm,kk,yy,vx,vy,xv,nIn
Local lPROBE := .F.
If !obrigatorio(aGets,aTela)
   Return .f.
Endif
cDESCEIX := STR0031 //"Nao foi informado a "

For nx := 1 To len(acols)
   lPROBE := .F.
   If Empty(aCOLS[nx][nQTDPNE])
      cDESCEIX := STR0032+chr(13); //"Nao foi informado a quantidade de rodado"
                 +STR0033+ aCols[nx][nEIXO] //"para o eixo "
      lPROBE := .T.
      Exit
   Endif
   If !lGFrota
      nCOLIN := 2 + (aCOLS[nx][nQTDPNE] * 2)
      For xn := 3 To nCOLIN
         lPROBE := .F.
         nRESTO := MOD(xn,2)
         cDESXA := If(nRESTO = 0,STR0077,STR0078) //" familia " # "localizacao"

         nCOLX  := 1
         If xn = 5 .or. xn = 6
            nCOLX := 2
         ElseIf xn = 7 .or. xn = 8
            nCOLX := 3
         ElseIf xn = 9 .or. xn = 10
            nCOLX := 4
         ElseIf xn = 11 .or. xn = 12
            nCOLX := 5
         ElseIf xn = 13 .or. xn = 14
            nCOLX := 6
         ElseIf xn = 15 .or. xn = 16
            nCOLX := 7
         ElseIf xn = 17 .or. xn = 18
            nCOLX := 8
         ElseIf xn = 19 .or. xn = 20
            nCOLX := 9
         ElseIf xn = 21 .or. xn = 22
            nCOLX := 10
         Endif

         If Empty(aCols[nx][xn])
            cDESCEIX := cDESCEIX + cDESXA+chr(13);
                       +STR0034+Str(nCOLX,3)+STR0035+ Alltrim(aCols[nx][1])+STR0036 //"Para o "###" rodado do "###" eixo"
            lPROBE := .T.
            Exit
         Endif
      Next xn
   Else
      nCOLIN := 3 + (aCOLS[nx][nQTDPNE] * 2)
      For xn := 4 To nCOLIN
         lPROBE := .F.
         nRESTO := MOD(xn,2)
         cDESXA := If(nRESTO <> 0,STR0077,STR0078) //" familia " # "localizacao"
         nCOLX  := 1
         If xn = 6 .or. xn = 7
            nCOLX := 2
         ElseIf xn = 8 .or. xn = 9
            nCOLX := 3
         ElseIf xn = 10 .or. xn = 11
            nCOLX := 4
         ElseIf xn = 12 .or. xn = 13
            nCOLX := 5
         ElseIf xn = 14 .or. xn = 15
            nCOLX := 6
         ElseIf xn = 16 .or. xn = 17
            nCOLX := 7
         ElseIf xn = 18 .or. xn = 19
            nCOLX := 8
         ElseIf xn = 20 .or. xn = 21
            nCOLX := 9
         ElseIf xn = 22 .or. xn = 23
            nCOLX := 10
         Endif

         If Empty(aCols[nx][xn])
            cDESCEIX := cDESCEIX + cDESXA+chr(13);
                       +STR0034+Str(nCOLX,3)+STR0035+ Alltrim(aCols[nx][1])+STR0036 //"Para o "###" rodado do "###" eixo"
            lPROBE := .T.
            Exit
         Endif
      Next xn
   Endif

   If lPROBE
      Exit
   Endif
Next nx

If !lPROBE
   For xv := 1 to len(acols)
      For yy := nLOCPN1 to nFAMIL0
         lSAIR := .F.
         cLOCA := aCols[xv][yy]
         If !Empty(cLOCA)
            For kk := 1 To Len(acols)
               For mm := nLOCPN1 to nFAMIL0
                  If !Empty(aCols[kk][mm])
                     If kk = xv .And. mm = yy
                     Else
                        If cLOCA = acols[kk][mm]

                           cDESCEIX := STR0037+Alltrim(cLOCA)+STR0079+Alltrim(acols[xv][1])+; //"Localizacao "# " duplicada no "
                                       If(Alltrim(acols[xv][1]) <> Alltrim(acols[kk][1]),;
                                       +STR0080+ Alltrim(acols[kk][1]),Space(1))+STR0036  // " e "# " eixo"
                           lSAIR := .T.
                           lPROBE := .T.
                           Exit
                        Endif
                     Endif
                  Endif
                  mm := mm + 1
               Next mm
               If lSAIR
                 Exit
               Endif
            Next kk
         Endif
         yy := yy + 1
         If lSAIR
            Exit
         Endif
      Next yy
      If lSAIR
         Exit
      Endif
   Next xy
Endif

If !lPROBE .And. Len(aESTPADR) > 0
	nIn := If(lGFrota,4,3)
   For vx := 1 to len(acols)
      For vy := nIn to nFAMIL0
         If vy <= 10
            cLOCA1 := Substr(aCols[vx][vy],1,6)
            cFAMIC := Substr(aCols[vx][vy+1],1,6)
            If !Empty(cLOCA1) .And. !Empty(cFAMIC)
               nPOSL := ASCAN(aESTPADR,{|x| Substr(x[1],1,6)+Substr(x[2],1,6) == cFAMIC+cLOCA1})
               If nPOSL = 0
                  cDESCEIX := STR0037+Alltrim(aCols[vx][vy])+STR0038+Alltrim(aCols[vx][vy+1]); //"Localizacao "###" com a familia "
                             +STR0039+Alltrim(aCols[vx][1])+STR0036+chr(13); //" do "###" eixo"
                             +STR0020+m->tq0_desenh //"nao foi cadastrada na estrutura padrao "
                  lPROBE := .T.
                  Exit
               Endif
            Endif
         Endif
         vy := vy + 1
      Next vy
      If lPROBE
         Exit
      Endif
   Next vx
Endif

If lPROBE
   msginfo(cDESCEIX,STR0040) //"ATENCAO"
   Return .F.
Endif

Return .T.

/*/


Ŀ
Funo    MNTA220GRA Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio  Grava os dados                                             
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220GRA(cAlias,nOpcao)
Local nx ,ny, nz
If altera
   DbSelectArea("TQ1")
   DbSetOrder(1)
   If lTipMod .And. !lTpModAlt
      If DbSeek(xFilial("TQ1")+M->TQ0_DESENH+M->TQ0_TIPMOD)
         While !Eof() .And. TQ1->TQ1_FILIAL == XFILIAL('TQ1') ;
            .And. TQ1->TQ1_DESENH == M->TQ0_DESENH .And. TQ1->TQ1_TIPMOD == M->TQ0_TIPMOD
            RecLock("TQ1",.F.)
            Dbdelete()
            TQ1->(MSUNLOCK())
            Dbskip()
         End
      Endif
   Else
      If DbSeek(xFilial("TQ1")+M->TQ0_DESENH)
         While !Eof() .And. TQ1->TQ1_FILIAL == XFILIAL('TQ1') ;
            .And. TQ1->TQ1_DESENH == M->TQ0_DESENH
            RecLock("TQ1",.F.)
            Dbdelete()
            TQ1->(MSUNLOCK())
            Dbskip()
         End
      Endif
   Endif
Endif

For nx = 1 to len(acols)
   If !Empty(aCOLS[nx][nEIXO])
      DbSelectArea("TQ1")
      DbSetOrder(1)
      RecLock("TQ1",.T.)
      TQ1->TQ1_FILIAL := XFILIAL('TQ1')
      TQ1->TQ1_DESENH := M->TQ0_DESENH

      If lTipMod
         TQ1->TQ1_TIPMOD := M->TQ0_TIPMOD
      Endif
      TQ1->TQ1_SEQREL := Str(nx,3)

      For nz := 1 To Fcount()
         xx := aSCAN(aHEADER,{|x| AllTrim(x[2]) == AllTrim(Fieldname(nz))})
         If xx > 0
            vv   := "TQ1->"+Fieldname(nz)
            &vv. := aCOLS[nx][xx]
         EndIf
      Next nz
      TQ1->(MSUNLOCK())
   EndIf

Next nx
DbSelectArea("TQ0")
If lTipMod
   DbSeek(xFilial("TQ0") + M->TQ0_DESENH+M->TQ0_TIPMOD)
Else
   DbSeek(xFilial("TQ0") + M->TQ0_DESENH)
Endif

If Inclui .And. !Found()
   RecLock("TQ0",.T.)
   TQ0->TQ0_FILIAL := XFILIAL('TQ0')
   TQ0->TQ0_DESENH := M->TQ0_DESENH
   If lTipMod
      TQ0->TQ0_TIPMOD := M->TQ0_TIPMOD
   Endif
   nQTDEIX1 := If (VALTYPE(M->TQ0_EIXOS) = 'C',VAL(M->TQ0_EIXOS),M->TQ0_EIXOS)
   TQ0->TQ0_EIXOS  := nQTDEIX1
   TQ0->TQ0_STEPES := M->TQ0_STEPES

   For ny := 1 To TQ0->(FCOUNT())
      If lTipMod
         If FieldName(ny) <> "TQ0_FILIAL" .And. FieldName(ny) <> "TQ0_DESENH" .And.;
            FieldName(ny) <> "TQ0_TIPMOD"  .And.;
            FieldName(ny) <> "TQ0_EIXOS"  .And. FieldName(ny) <> "TQ0_STEPES"
            nx := "m->" + FieldName(ny)
            FieldPut(ny, &nx.)
         EndIf
      Else
         If FieldName(ny) <> "TQ0_FILIAL" .And. FieldName(ny) <> "TQ0_DESENH" .And.;
            FieldName(ny) <> "TQ0_EIXOS"  .And. FieldName(ny) <> "TQ0_STEPES"
            nx := "m->" + FieldName(ny)
            FieldPut(ny, &nx.)
         EndIf
      Endif
   Next ny

   TQ0->(MSUNLOCK())
Else

   If lTipMod .And. !lTpModAlt
      DbSeek(xFilial("TQ0")+M->TQ0_DESENH+M->TQ0_TIPMOD)
   Else
      DbSeek(xFilial("TQ0")+M->TQ0_DESENH)
   Endif

   If Found()
      RecLock("TQ0",.F.)
      For ny := 1 To TQ0->(FCOUNT())
         nx := "m->" + FieldName(ny)
         FieldPut(ny, &nx.)
      Next ny
      TQ0->(MSUNLOCK())
   Endif
Endif

DbSelectArea("TQ0")
Return .T.

/*/


Ŀ
Funo    MNTA220DAD Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Remonta o getdados                                          
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220DAD()
Local xx := 0, yy, yz
If Empty(M->TQ0_EIXOS)
   return .t.
Endif

If cPrograma == 'MNTA221'
	Return .t.
EndIf

aXACOLS := ACLONE(aCOLS)
nSTEPES := If(M->TQ0_STEPES = 'S',1,0)

nQTDEIX  := If (VALTYPE(M->TQ0_EIXOS) = 'C',VAL(M->TQ0_EIXOS),M->TQ0_EIXOS)
nQTDITEN := nSTEPES+nQTDEIX
aCols := {}
aCols := Array(nQTDITEN,nContI+1)

For XX := 1 To nQTDEIX
   aCOLS[XX][1] := Str(xx,3)
   If lGFrota
      aCOLS[XX][nTIPEIX] := "1"
      aCOLS[XX][nQTDPNE] := 0
      If lUsaSusp
	      aCOLS[XX][nSUSPEN] := "2" //relacao do campo TQ1_SUSPEN
	  	EndIf
   Else
      aCOLS[XX][nQTDPNE] := 0
   Endif
   //Faz a inicializacao dos campos da acols
   MNT220CSX3(XX,.F.)
Next XX

If nSTEPES > 0
   aCOLS[nQTDITEN][1] := STR0010 //"RESERVA"
   If lGfrota
      aCOLS[nQTDITEN][nTIPEIX] := "1"
      aCOLS[nQTDITEN][nQTDPNE] := 0
      If lUsaSusp
	      aCOLS[XX][nSUSPEN] := "2" //relacao do campo TQ1_SUSPEN
	  	EndIf
   Else
      aCOLS[nQTDITEN][nQTDPNE] := 0
   Endif
   //Faz a inicializacao dos campos da acols
   MNT220CSX3(nQTDITEN,.F.)
Endif

For yy := 1 to LEN(aXACOLS)
   cEIXO := ALLTRIM(aXACOLS[YY][nEIXO])
   nPOS  := aSCAN(aCOLS,{|x| ALLTRIM(x[1]) == cEIXO})

   If nPOS > 0
      DbSelectArea("TQ1")
      For yz := 1 To Fcount()
          xy := aSCAN(aHEADER,{|x| AllTrim(x[2]) == AllTrim(Fieldname(yz))})
          If xy > 0 .And. AllTrim(Fieldname(yz)) <> "TQ1_EIXO"
             aCOLS[nPOS][xy] := aXACOLS[YY][xy]
          EndIf
      Next nz
   Endif
Next yy
oGet:FORCEREFRE()
Return .t.

/*/


Ŀ
Funo    MNTA220LOC Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Consistencia da localizacao dentro da Esquema Padrao        
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220LOC(cLOCALIZ,nPNEUX)
Local xy,yy,xp,vp,yp
aARRAPN := {nLOCPN1,nLOCPN2,nLOCPN3,nLOCPN4,nLOCPN5,nLOCPN6,nLOCPN7,nLOCPN8,;
            nLOCPN9,nLOCPN0}
nCOLFA  := aARRAPN[nPNEUX]+1
cLOCOLD := aCols[n][aARRAPN[nPNEUX]]
lSAILPL := .F.

If ALTERA .And. cLOCALIZ != cLOCOLD .And. !Empty(cLOCOLD)
	If !MNT221CHKLC(M->TQ0_DESENH,M->TQ0_TIPMOD,ValToSql(cLOCOLD))
		MsgStop(STR0106+AllTrim(cLOCOLD),STR0040) //"No  possvel alterar a localizao do Esquema Padro pois j existem Estruturas com pneus na localizao "
		Return .F.
	EndIf
EndIf

For xy := 1 to len(acols)
   For yy := 1 to len(aARRAPN)
      If yy = nPNEUX .And. xy = n
      Else
         If aCols[xy][aARRAPN[yy]] == cLOCALIZ
            MsgStop(STR0041+aCols[xy][1]+STR0042,STR0040) //"Localizacao ja informada no "###" eixo."
            &(READVAR()) := cLOCOLD
            aCols[n][aARRAPN[nPNEUX]] := cLOCOLD
            cCAMPO := cLOCOLD
            lRefresh := .t.
            Return .f.
         Endif
      Endif
   Next yy
   If lSAILPL
      Exit
   Endif
Next xy

If Len(aESTPADR) > 0 .And. !Empty(aCols[n][nCOLFA])
   nPOSL := ASCAN(aESTPADR,{|x| Substr(x[1],1,6)+Substr(x[2],1,6) == Substr(aCols[n][nCOLFA],1,6)+Substr(cLOCALIZ,1,6)})
   If nPOSL = 0
      cMENLOC1 := STR0037+cLOCALIZ+STR0044+aCols[n][nCOLFA]+chr(13)+chr(10); //"Localizacao "###"com a familia "
                 +STR0020+chr(13)+chr(10)+m->tq0_desenh //"nao foi cadastrada na estrutura padrao "
      cFILLOC := Substr(MNTA220LOS(cLOCALIZ,nCOLFA),1,6)
      If cFILLOC = 'FALSO'
         &(READVAR()) := cLOCOLD
         aCols[n][aARRAPN[nPNEUX]] := cLOCOLD
         cCAMPO := cLOCOLD
         lRefresh := .t.
         Return .f.
      Endif
      For xp := 1 to len(acols)
         For yp := 1 to len(aARRAPN)
            If yp = nPNEUX .And. xp = n
            Else
               If Acols[xp][aARRAPN[yp]] == cFILLOC
                  MsgStop(STR0041+acols[xp][1]+STR0042,STR0040) //"Localizacao ja informada no "###" eixo."
                  &(READVAR()) := cLOCOLD
                  aCols[n][aARRAPN[nPNEUX]] := cLOCOLD
                  cCAMPO := cLOCOLD
                  lRefresh := .t.
                  Return .f.
               Endif
            Endif
         Next yp
      Next xp
      &(READVAR()) := cFILLOC
   Endif
Endif
Return .t.

/*/


Ŀ
Funo    MNTA220LOS Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Monta filtra das localizacoes com a familia padrao          
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Static Function MNTA220LOS(cLOC,nVCOLFA)
Local cRET,aESTPAUX := Aclone(aESTPADR),aFILBOX1 := {},kk,kx

For kx := 1 To Len(aESTPAUX)
   nPOSC := ASCAN(aESTPAUX,{|x| Substr(x[1],1,6) == Substr(aCols[n][nVCOLFA],1,6)})
   If nPOSC > 0
      DbSelectArea("TPS")
      DbSetOrder(1)
      DbSeek(xFilial('TPS')+aESTPAUX[nPOSC][2])
      AADD(aFILBOX1,{Substr(aESTPAUX[nPOSC][2],1,6),TPS->TPS_NOME})
      Adel(aESTPAUX,nPOSC)
      Asize(aESTPAUX,Len(aESTPAUX)-1)
   Endif
Next kx

If Len(aFILBOX1) = 0
   cMENLOC2 := STR0025+chr(13)+chr(10); //"E segundo definido na estrutura padrao"
              +STR0045 //"nao ha mais localizacoes disponiveis"
   Msginfo(cMENLOC1+chr(13)+cMENLOC2,STR0040)//'ATENCAO'
   Return 'FALSO'
Endif

cMENLOC2 := chr(13)+chr(13)+STR0046 //"Localizacao disponivel para a familia"
cCAMPO := Space(6)
If Len(aFILBOX1) > 0
   cCAMPO := 0
Endif

cCONFIR := .F.
cTITULO := STR0047 //"Selecao de Localizacao Disponiveis"
cRET    := MNTA220SLF(aFILBOX1,cCAMPO,cTITULO)
cRET2   := If(cRET = NIL .Or. !cCONFIR,'FALSO',Substr(cRET,1,6))
Return cRET2

/*/


Ŀ
Funo    MNTA220SLF Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Selecao de Localizacoes familia                             
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Static Function MNTA220SLF(aItems,cValue,cTitle )
Local oDlgx
Private oMenu
DEFINE DIALOG oDlgx FROM 15,60 TO 30,92 TITLE cTitle
   @0.2,0.5 say cMENLOC1+Chr(13)+Chr(10)+cMENLOC2
   @ 30.5,0.5 LISTBOX oSx2 FIELDS HEADER ;
      STR0029,STR0030; //"Codigo"###"Descricao"
      OF oDlgx;
      SIZE 125,80 PIXEL;
      ON DBLCLICK (cCONFIR := .T.,cValue:=oSx2:nAt,oDlgx:End())
   oSx2:SetArray(aItems )
   oSx2:bLine := { || { aItems[ oSx2:nAT,1 ],aItems[oSx2:nAT,2 ]} }

   NGPOPUP(asMenu,@oMenu)
	oDlgx:bRClicked:= { |o,x,y| oMenu:Activate(x,y,oDlgx)}

ACTIVATE DIALOG oDlgx

Return If(cValue > 0,aITEMS[cValue,1],cCONFIR)

/*/


Ŀ
Funo    MNTA220DPN Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Consistencia da Quantidade de rodados por Eixo              
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220DPN()
Local vInDe := If(lGFrota,{6,8,10,12,14,16,18,20,22},;
                          {5,7,9,11,13,15,17,19,21}), nLD := 0
If M->TQ1_QTDPNE > 0 .And. M->TQ1_QTDPNE < 11
   If M->TQ1_QTDPNE < aCols[n][nQTDPNE]
      //Faz a inicializacao dos campos da acols
      For nLD := vInDe[M->TQ1_QTDPNE] To Len(ACOLS[n])-2
         ACOLS[n,nLD] := cSpaceFL
      Next
   Endif
Else
   msginfo(STR0048,STR0040) //"Quantidade de rodados devera estar no intervalo [1..10]
   Return .f.
Endif
Return .t.

/*/


Ŀ
Funo    MNTA220DES Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Seleciona por que tipo ser desenhado                       
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220DES(cDESENH,cTIPMOD)

	If Type("lGFrota") = "U"
		lGFrota := MNTA220FR()
	Endif

	If Type("lTipMod") = "U"
		lTipMod := lRel12133 .Or. lGFrota
	Endif

	nTGIOPC := 1
	tg_bOk  := tb_bCancel := nil
	tg_oDlg := oSend( MSDialog(), "New", 15, 0, 25, 70, STR0049,,,.F.,,,,,oMainWnd,.F.,,,.F.) //"Apresentar o Esquema Por:"
	oSEND(TRadMenu(),"New", 40, 100,{STR0050,STR0051},bSETGET(nTGIOPC),tg_oDlg,,,; //"Somente Localizacao"###"Somente Familia"###"Localizacao e Familia"
               ,,,,,70,12,,,.T., .T.)

	tg_bOk     := {||oSend(tg_oDlg,"End")}
	tg_bCancel := {||nTGIOPC:=0,oSend(tg_oDlg,"End")}
	tg_bInit   := {|| EnchoiceBar(tg_oDlg,tg_bOk,tg_bCancel) }

	oSend(tg_oDlg,STR0053,,,,.T.,,, tg_bInit ) //"Activate"

If nTGIOPC # 0
   If lTipMod
      MNTA220MOT(cDESENH,nTGIOPC,cTIPMOD)
   Else
      MNTA220MOT(cDESENH,nTGIOPC)
   Endif
   tg_lRet := .T.
Endif
Return .t.

/*/


Ŀ
Funo    MNTA220MOT Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Monta o Esquema Padrao                                      
Ĵ
 Uso      MNTA220                                                     
ٱ


/*/
Function MNTA220MOT(cDESENH,nVTIPO,cTIPMOD)
Local oBar,lOk,nOpce := 4,ocP1FAME1,xx,aCE := {}
Local nOpca := 0, i,lAllOk,cCampo, nX, nY, cCaption, cPict, cValid, cF3
Local cWhen, nLargSay, nLargGet, uConteudo, oSay, oGet,oScroll
Local cBlkGet,cBlkWhen,cBlkVld, oSaveGetdad := Nil, aSvRot := Nil
Local XI,LT,CT,XW,XP,XY,YX,YK,XK,M,ZZ,nCL,nLC
Local cDesMod

Private nTIPDES := If(nVTIPO = NIL,1,nVTIPO)
Private lVolta  :=.f. ,bSet15,bSet24,oGetse := {}

Private oMenu
If cDESENH == NIL
   msginfo(STR0054,STR0040) //"Esquema padrao nao cadastrado"###"ATENCAO"
   Return .f.
Endif

DbSelectArea("TQ0")
DbSetOrder(1)

If lTipMod
   DbSeek(xFilial('TQ0')+cDESENH+cTIPMOD)
Else
   DbSeek(xFilial('TQ0')+cDESENH)
Endif

If !Found()
   msginfo(STR0054,STR0040) //"Esquema padrao nao cadastrado"###"ATENCAO"
   Return .f.
Endif

DbSelectArea("TQ1")
DbSetOrder(1)
If lTipMod
   DbSeek( xFilial('TQ1')+TQ0->TQ0_DESENH+TQ0->TQ0_TIPMOD)
Else
   DbSeek( xFilial('TQ1')+TQ0->TQ0_DESENH)
Endif

If !Found()
   msginfo(STR0056+cDESENH,STR0040) //"Nao existe itens para o esquema padrao  "###"ATENCAO"
   Return .f.
Endif

cTIPODES := If(nTIPDES = 1,STR0057,STR0058)

aARRAYTQ1 := {}
If lTipMod
   While !Eof() .And. TQ1->TQ1_FILIAL == xFILIAL("TQ0");
      .And. TQ1->TQ1_DESENH == TQ0->TQ0_DESENH;
      .And. TQ1->TQ1_TIPMOD == TQ0->TQ0_TIPMOD

      Aadd(aARRAYTQ1,{TQ1->TQ1_QTDPNE,;
                      TQ1->TQ1_LOCPN1,TQ1->TQ1_LOCPN2,TQ1->TQ1_LOCPN3,;
                      TQ1->TQ1_LOCPN4,TQ1->TQ1_LOCPN5,TQ1->TQ1_LOCPN6,;
                      TQ1->TQ1_LOCPN7,TQ1->TQ1_LOCPN8,TQ1->TQ1_LOCPN9,;
                      TQ1->TQ1_LOCPN0,TQ1->TQ1_EIXO,;
                      TQ1->TQ1_FAMIL1,TQ1->TQ1_FAMIL2,TQ1->TQ1_FAMIL3,;
                      TQ1->TQ1_FAMIL4,TQ1->TQ1_FAMIL5,TQ1->TQ1_FAMIL6,;
                      TQ1->TQ1_FAMIL7,TQ1->TQ1_FAMIL8,TQ1->TQ1_FAMIL9,;
                      TQ1->TQ1_FAMIL0})
      DbSelectArea("TQ1")
      DbSkip()
   End
Else
   While !Eof() .And. TQ1->TQ1_FILIAL == xFILIAL("TQ0");
      .And. TQ1->TQ1_DESENH == TQ0->TQ0_DESENH

      Aadd(aARRAYTQ1,{TQ1->TQ1_QTDPNE,;
                      TQ1->TQ1_LOCPN1,TQ1->TQ1_LOCPN2,TQ1->TQ1_LOCPN3,;
                      TQ1->TQ1_LOCPN4,TQ1->TQ1_LOCPN5,TQ1->TQ1_LOCPN6,;
                      TQ1->TQ1_LOCPN7,TQ1->TQ1_LOCPN8,TQ1->TQ1_LOCPN9,;
                      TQ1->TQ1_LOCPN0,TQ1->TQ1_EIXO,;
                      TQ1->TQ1_FAMIL1,TQ1->TQ1_FAMIL2,TQ1->TQ1_FAMIL3,;
                      TQ1->TQ1_FAMIL4,TQ1->TQ1_FAMIL5,TQ1->TQ1_FAMIL6,;
                      TQ1->TQ1_FAMIL7,TQ1->TQ1_FAMIL8,TQ1->TQ1_FAMIL9,;
                      TQ1->TQ1_FAMIL0})
      DbSelectArea("TQ1")
      DbSkip()
   End
Endif

nAUXEIXO  := Len(aARRAYTQ1)
//             1   2   3   4  5  6  7  8  9  10
aARRAYCOL := {184,144,124,114,84,74,64,48,20,2}
nCOL      := If(nAUXEIXO <= 10,aARRAYCOL[nAUXEIXO],0)
aNOEVAR   := {}
aDESIGE   := {}
aCOLEIN   := {}

For xw := 1 to nAUXEIXO
   cEIE   := Alltrim(Str(xw,3))
   vELEMT := {}
   vDESIE := {}
   For zz := 1 To aARRAYTQ1[xw][1]
      cELEM := If(zz = 10,Str(zz,2),Str(zz,1))
      cVARP := Space(10)
      cVARP := Alltrim('E'+cELEM+'E'+cEIE)
      If nTIPDES = 1
         Public &(cVARP) := aARRAYTQ1[XW][zz+1]
      ElseIf nTIPDES = 2
         Public &(cVARP) := aARRAYTQ1[XW][zz+12]
      Endif
      Aadd(vELEMT,cVARP)
      Aadd(vDESIE,aARRAYTQ1[xw,zz+8])
   Next zz
   Aadd(aNOEVAR,vELEMT)
   Aadd(aDESIGE,vDESIE)
Next xw

// 1
l11 := 95

// 3

l31 := 80
l33 := 110

// 5
l51 := 65
l55 := 125

// 7
l71 := 50
l77 := 140

// 9
l91 := 35
l99 := 155

// misto
l01 := 22
l02 := 37
l03 := 52
l04 := 67
l05 := 82

l06 := 107
l07 := 122
l08 := 137
l09 := 152
l00 := 167

For xx := 1 to nAUXEIXO
   If aARRAYTQ1[xx][1] = 1
      Aadd(aCE,{aNOEVAR[xx][1] ,{l11 ,nCOL},aDESIGE[xx,1],"@!",,,,25})
      Aadd(aCOLEIN,{nCOL,l11})
   ElseIf aARRAYTQ1[xx][1] = 2
      Aadd(aCE,{aNOEVAR[xx][1] ,{l05 ,nCOL},aDESIGE[xx,1],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][2] ,{l06 ,nCOL},aDESIGE[xx,2],"@!",,,,25})
      Aadd(aCOLEIN,{nCOL,l05,l06})

   ElseIf aARRAYTQ1[xx][1] = 3
      Aadd(aCE,{aNOEVAR[xx][1] ,{l31 ,nCOL},aDESIGE[xx,1],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][2] ,{l11 ,nCOL},aDESIGE[xx,2],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][3] ,{l33 ,nCOL},aDESIGE[xx,3],"@!",,,,25})
      Aadd(aCOLEIN,{nCOL,l31,l11,l33})

   ElseIf aARRAYTQ1[xx][1] = 4
      Aadd(aCE,{aNOEVAR[xx][1] ,{l04 ,nCOL},aDESIGE[xx,1],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][2] ,{l05 ,nCOL},aDESIGE[xx,2],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][3] ,{l06 ,nCOL},aDESIGE[xx,3],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][4] ,{l07 ,nCOL},aDESIGE[xx,4],"@!",,,,25})
      Aadd(aCOLEIN,{nCOL,l04,l05,l06,l07})

   ElseIf aARRAYTQ1[xx][1] = 5
      Aadd(aCE,{aNOEVAR[xx][1] ,{l51 ,nCOL},aDESIGE[xx,1],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][2] ,{l31 ,nCOL},aDESIGE[xx,2],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][3] ,{l11 ,nCOL},aDESIGE[xx,3],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][4] ,{l33 ,nCOL},aDESIGE[xx,4],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][5] ,{l55 ,nCOL},aDESIGE[xx,5],"@!",,,,25})
      Aadd(aCOLEIN,{nCOL,l51,l31,l11,l33,l55})

   ElseIf aARRAYTQ1[xx][1] = 6
      Aadd(aCE,{aNOEVAR[xx][1] ,{l03 ,nCOL},aDESIGE[xx,1],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][2] ,{l04 ,nCOL},aDESIGE[xx,2],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][3] ,{l05 ,nCOL},aDESIGE[xx,3],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][4] ,{l06 ,nCOL},aDESIGE[xx,4],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][5] ,{l07 ,nCOL},aDESIGE[xx,5],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][6] ,{l08 ,nCOL},aDESIGE[xx,6],"@!",,,,25})
      Aadd(aCOLEIN,{nCOL,l03,l04,l05,l06,l07,l08})

   ElseIf aARRAYTQ1[xx][1] = 7
      Aadd(aCE,{aNOEVAR[xx][1] ,{l71 ,nCOL},aDESIGE[xx,1],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][2] ,{l51 ,nCOL},aDESIGE[xx,2],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][3] ,{l31 ,nCOL},aDESIGE[xx,3],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][4] ,{l11 ,nCOL},aDESIGE[xx,4],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][5] ,{l33 ,nCOL},aDESIGE[xx,5],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][6] ,{l55 ,nCOL},aDESIGE[xx,6],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][7] ,{l77 ,nCOL},aDESIGE[xx,7],"@!",,,,25})
      Aadd(aCOLEIN,{nCOL,l71,l51,l31,l11,l33,l55,l77})

   ElseIf aARRAYTQ1[xx][1] = 8
      Aadd(aCE,{aNOEVAR[xx][1] ,{l02 ,nCOL},aDESIGE[xx,1],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][2] ,{l03 ,nCOL},aDESIGE[xx,2],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][3] ,{l04 ,nCOL},aDESIGE[xx,3],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][4] ,{l05 ,nCOL},aDESIGE[xx,4],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][5] ,{l06 ,nCOL},aDESIGE[xx,5],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][6] ,{l07 ,nCOL},aDESIGE[xx,6],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][7] ,{l08 ,nCOL},aDESIGE[xx,7],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][8] ,{l09 ,nCOL},aDESIGE[xx,8],"@!",,,,25})
      Aadd(aCOLEIN,{nCOL,l02,l03,l04,l05,l06,l07,l08,l09})

   ElseIf aARRAYTQ1[xx][1] = 9
      Aadd(aCE,{aNOEVAR[xx][1] ,{l91 ,nCOL},aDESIGE[xx,1],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][2] ,{l71 ,nCOL},aDESIGE[xx,2],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][3] ,{l51 ,nCOL},aDESIGE[xx,3],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][4] ,{l31 ,nCOL},aDESIGE[xx,4],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][5] ,{l11 ,nCOL},aDESIGE[xx,5],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][6] ,{l33 ,nCOL},aDESIGE[xx,6],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][7] ,{l55 ,nCOL},aDESIGE[xx,7],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][8] ,{l77 ,nCOL},aDESIGE[xx,8],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][9] ,{l99 ,nCOL},aDESIGE[xx,9],"@!",,,,25})
      Aadd(aCOLEIN,{nCOL,l91,l71,l51,l31,l11,l33,l55,l77,l99})

   ElseIf aARRAYTQ1[xx][1] = 10
      Aadd(aCE,{aNOEVAR[xx][1]  ,{l01 ,nCOL},aDESIGE[xx,1],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][2]  ,{l02 ,nCOL},aDESIGE[xx,2],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][3]  ,{l03 ,nCOL},aDESIGE[xx,3],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][4]  ,{l04 ,nCOL},aDESIGE[xx,4],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][5]  ,{l05 ,nCOL},aDESIGE[xx,5],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][6]  ,{l06 ,nCOL},aDESIGE[xx,6],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][7]  ,{l07 ,nCOL},aDESIGE[xx,7],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][8]  ,{l08 ,nCOL},aDESIGE[xx,8],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][9]  ,{l09 ,nCOL},aDESIGE[xx,9],"@!",,,,25})
      Aadd(aCE,{aNOEVAR[xx][10] ,{l00 ,nCOL},aDESIGE[xx,10],"@!",,,,25})
      Aadd(aCOLEIN,{nCOL,l01,l02,l03,l04,l05,l06,l07,l08,l09,l00})
   Endif

   nCOL := nCOL + 40
Next xx

oFont10 := TFont():New("Arial",10,10,,.F.,,,,.T.,.F.)

If lTipMod
	cDesMod := IIf( lRel12133, MNTDesTpMd(TQ0->TQ0_TIPMOD), NGSEEK("TQR",TQ0->TQ0_TIPMOD,1,"Alltrim(TQR->TQR_DESMOD)") )
   cCABJA := STR0059+Alltrim(cDESENH)+" - "+NGSEEK("ST6",TQ0->TQ0_DESENH,1,"Alltrim(st6->t6_nome)");
             +Space(10)+STR0099+"  "+Alltrim(cTIPMOD)+"  -  ";
             +cDesMod
Else
   cCABJA := STR0059+Alltrim(cDESENH)+" - "+NGSEEK("ST6",TQ0->TQ0_DESENH,1,"Alltrim(st6->t6_nome)")
Endif

DEFINE MSDIALOG oDlg3 TITLE OemToAnsi(cCABJA) FROM 6,.5 To 34,100 OF oMainWnd
	oDlg3:lMaximized := .F.

   oScrollBox := TScrollBox():new(oDlg3,13,00,190,390,.T.,.T.,.T.)
   @ 1.2,1 MSGET cTIPODES Picture '@!' SIZE 45,7 WHEN .F.

   For nCL := 1 To Len(aCOLEIN)
      If aARRAYTQ1[nCL][1] > 1
         nINCOL := If(aARRAYTQ1[nCL][1] = 2,13,14)
         nINCLI := If(nTIPDES = 3,18,9)
         For nLC := 2 To Len(aCOLEIN[nCL])-1
            @ aCOLEIN[nCL,nLC]+nINCLI,aCOLEIN[nCL,1]+12 To aCOLEIN[nCL,nLC+1]+.5,aCOLEIN[nCL,1]+nINCOL Of oScrollbox pixel
         Next nLC
      Endif
   Next nCL

   For XP := 1 to Len(aCE)
      cCampo   := aCE[XP,1]
      nX       := aCE[XP,2,1]  // LINHA
      nY       := aCE[XP,2,2]  // COLUNA
      cCaption := Iif(Empty(aCE[XP,3])," ",aCE[XP,3])
      cPict    := Iif(Empty(aCE[XP,4]),Nil,aCE[XP,4])
      cValid   := Iif(Empty(aCE[XP,5]),".t.",aCE[XP,5])
      cF3      := Iif(Empty(aCE[XP,6]),NIL,aCE[XP,6])
      cWhen    := Iif(aCE[XP,7]==NIL,".t.",Iif(aCE[XP,7],".t.",".f."))
      cWhen    := Iif(!(Str(nOpce,1,0)$"346"),".f.",cWhen)
      nSIZE    := Iif(Empty(aCE[XP,8]),Nil,aCE[XP,8])

      If nTIPDES = 3
         @ nX+10,nY+.5 To nX+21,ny+23 Of oScrollbox pixel
         cBlKSay := "{|| OemToAnsi('"+cCaption+"')}"
         oSay := TSay():New( nX+13, nY+.9, &cBlkSay,oScrollBox,,, .F., .F., .F., .T.,CLR_HRED,,,, .F., .F., .F., .F., .F. )
         nLargSay := GetTextWidth(0,cCaption) / 1.8
         cCaption := oSay:cCaption
      Endif
      cBlkGet  := "{ | u | If( PCount() == 0, "+cCampo+","+cCampo+":= u ) }"
      cBlKVld  := "{|| "+cValid+"}"
      cBlKWhen := "{|| MNTA220WHE()}"
      oGet := TGet():New( nX, nY,&cBlKGet,oScrollBox,nSIZE,,cPict, &(cBlkVld),,,, .F.,, .T.,, .F., &(cBlkWhen), .F., .F.,, .F., .F. ,cF3,(cCampo))
      Aadd(oGetse,oGet)
   Next XP

   For nCL := 1 To Len(aARRAYTQ1)
      cCaption := If(aARRAYTQ1[nCL,12] = STR0093,aARRAYTQ1[nCL,12],;
                     Alltrim(aARRAYTQ1[nCL,12])+CHR(167)+" "+STR0094)
      cBlKSay1 := "{|| OemToAnsi('"+cCaption+"')}"
      oSay := TSay():New(aCOLEIN[nCL,2]-8,aCOLEIN[nCL,1]+2,&cBlkSay1,oScrollBox,,, .F., .F., .F., .T.,CLR_HBLUE,,,, .F., .F., .F., .F., .F. )
      nLargSay := GetTextWidth(0,cCaption) / 1.8
      cCaption := oSay:cCaption
   Next nCL

NGPOPUP(asMenu,@oMenu)
oDlg3:bRClicked:= { |o,x,y| oMenu:Activate(x,y,oDlg3)}

ACTIVATE MSDIALOG oDlg3 ON INIT MNTA220BAR(oDlg3,;
              {|| nOpca := 1,oDlg3:End()},{|| nOpca := 2,oDlg3:End()}) CENTERED
Return .t.

/*/


Ŀ
Funo    MNTA220TUD Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Consistncia tudo ok                                        
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220TUD()
Return .t.

/*/


Ŀ
Funo    MNTA220BAR Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Altera o menu de opes                                     
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220BAR(oDlg3,bOk,bCancel)
DEFINE BUTTONBAR oBar SIZE 25,25 3D TOP OF oDlg3
DEFINE BUTTON oBtnCalc RESOURCE "S4WB008N" OF oBar GROUP ACTION Calculadora() //TOOLTIP OemToAnsi(STR0032) //"Calculadora..."
oBtnCalc:cToolTip := OemToAnsi(STR0061)//"Calculadora..."
DEFINE BUTTON oBtnLeg RESOURCE "S4WB009N" OF oBar ACTION MNTA220LEG() //TOOLTIP OemToAnsi(STR0062) //"Legenda..."
oBtnLeg:cToolTip := OemToAnsi(STR0062)//"Legenda..."

If lTipMod
   DEFINE BUTTON oBtnImpres RESOURCE "S4WB010N" OF oBar ACTION MNTA220IMT(tq0->tq0_DESENH,nTIPDES,TQ0->TQ0_TIPMOD)// TOOLTIP OemToAnsi(STR0063) //"Impressao do Esquema Padrao..."
   oBtnImpres:cToolTip := OemToAnsi(STR0063)//"Impressao do Esquema Padrao..."
Else
   DEFINE BUTTON oBtnImpresP RESOURCE "S4WB010N" OF oBar ACTION MNTA220IMT(tq0->tq0_DESENH,nTIPDES)// TOOLTIP OemToAnsi(STR0063) //"Impressao do Esquema Padrao..."
   oBtnImpresP:cToolTip := OemToAnsi(STR0063)//"Impressao do Esquema Padrao..."
Endif

DEFINE BUTTON oBtnHelp RESOURCE "S4WB016N" OF oBar GROUP ACTION HelProg()// TOOLTIP OemToAnsi(STR0064) //"Help de Programa..."
oBtnHelp:cToolTip := OemToAnsi(STR0064)
DEFINE BUTTON oBtOk RESOURCE STR0065 OF oBar GROUP ACTION (lLoop:=lVolta,lOk:=Eval(bOk))// TOOLTIP STR0066 //"OK"###"Ok - <Ctrl-O>"
oBtOk:cToolTip := OemToAnsi(STR0065)
SetKEY(15,oBtOk:bAction)
DEFINE BUTTON oBtCan RESOURCE STR0067 OF oBar ACTION (lLoop:=.f.,Eval(bCancel),MNTA220BUT(bSet15,bSet24,.T.)) //TOOLTIP OemToAnsi(STR0068) //"CANCEL"###"Cancelar - <Ctrl-X>"
oBtCan:cToolTip := OemToAnsi(STR0067)

SetKEY(24,oBtCan:bAction)
oDlg3:bSet15 := oBtOk:bAction
oDlg3:bSet24 := oBtCan:bAction
oBar:bRClicked := {|| AllwaysTrue()}
Return .t.

/*/


Ŀ
Funo    MNTA220BUT Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Set o botes                                                
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220BUT(bSet15,bSet24,lOk)
DEFAULT lOk := .t.
If lOk
   SetKey(15,bSet15)
   SetKey(24,bSet24)
Endif
Return .T.

/*/


Ŀ
Funo    MNTA220IMT Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Selecao de impressao da legenda                             
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220IMT(cVDESENH,nVTIPDES,cTIPMOD)
nTGIOPL := 1
tg_bOk  := tb_bCancel := nil
tg_oDlg := oSend( MSDialog(), "New", 9, 0, 15, 45,;
           STR0069,,,.F.,,,,,oMainWnd,.F.,,,.F.) //"Quanto a Legenda ?"
  oSEND(TRadMenu(),"New",20,25,{STR0070,STR0071},bSETGET(nTGIOPL),tg_oDlg,,,; //"Nao Imprimir"###"Imprimir"
                   ,,,,,70,12,,,.T., .T.)

   tg_bOk     := {||oSend(tg_oDlg,"End")}
   tg_bCancel := {||nTGIOPL:=0,oSend(tg_oDlg,"End")}
   tg_bInit   := {|| EnchoiceBar(tg_oDlg,tg_bOk,tg_bCancel) }

oSend(tg_oDlg,"Activate",,,,.T.,,, tg_bInit )

If nTGIOPL # 0
   If lTipMod
      MNTA220IMP(cVDESENH,nVTIPDES,nTGIOPL,cTIPMOD)
   Else
      MNTA220IMP(cVDESENH,nVTIPDES,nTGIOPL)
   Endif
   tg_lRet := .T.
Endif
Return .t.

/*/


Ŀ
Funo    MNTA220IMP Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Impresso do Esquema Padrao                                 
Ĵ
 Uso       GENERICA                                                   
ٱ


/*/
Function MNTA220IMP(cVDESENH,nVTIPDES,nLEG,cTIPMOD)
Local oPrint, i := 1, lin := 0
Private nTIPIMP := If(nVTIPDES = NIL,1,nVTIPDES)
Private aARLEGL := {}, aARLEGF := {}

DbSelectArea("TQ0")
DbSetOrder(1)
If lTipMod
   DbSeek( xFilial('TQ0')+cVDESENH+cTIPMOD)
Else
   DbSeek( xFilial('TQ0')+cVDESENH)
Endif
If !Found()
    msginfo(STR0054,STR0040) //"Esquema padrao nao cadastrado"###"ATENCAO"
    Return .f.
Endif

DbSelectArea("TQ1")
DbSetOrder(1)

If lTipMod
   DbSeek( xFilial('TQ1')+TQ0->TQ0_DESENH+cTIPMOD)
Else
   DbSeek( xFilial('TQ1')+TQ0->TQ0_DESENH)
Endif
If !Found()
   msginfo(STR0072+cVDESENH,STR0040) //"Nao existe itens para esquema padrao  "###"ATENCAO"
   Return .f.
Endif

aARQTQ1 := {}
If lTipMod
   While !Eof() .And. TQ1->TQ1_FILIAL == xFILIAL("TQ0");
      .And. TQ1->TQ1_DESENH == TQ0->TQ0_DESENH;
      .And. TQ1->TQ1_TIPMOD == TQ0->TQ0_TIPMOD

      Aadd(aARQTQ1,{TQ1->TQ1_QTDPNE,TQ1->TQ1_LOCPN1,TQ1->TQ1_LOCPN2,;
                    TQ1->TQ1_LOCPN3,TQ1->TQ1_LOCPN4,TQ1->TQ1_LOCPN5,;
                    TQ1->TQ1_LOCPN6,TQ1->TQ1_LOCPN7,TQ1->TQ1_LOCPN8,;
                    TQ1->TQ1_LOCPN9,TQ1->TQ1_LOCPN0,TQ1->TQ1_EIXO,;
                    TQ1->TQ1_FAMIL1,TQ1->TQ1_FAMIL2,TQ1->TQ1_FAMIL3,;
                    TQ1->TQ1_FAMIL4,TQ1->TQ1_FAMIL5,TQ1->TQ1_FAMIL6,;
                    TQ1->TQ1_FAMIL7,TQ1->TQ1_FAMIL8,TQ1->TQ1_FAMIL9,;
                    TQ1->TQ1_FAMIL0})
      DbselectArea("TQ1")
      DbSkip()
   End
Else
   While !Eof() .And. TQ1->TQ1_FILIAL == xFILIAL("TQ0");
      .And. TQ1->TQ1_DESENH == TQ0->TQ0_DESENH
      Aadd(aARQTQ1,{TQ1->TQ1_QTDPNE,TQ1->TQ1_LOCPN1,TQ1->TQ1_LOCPN2,;
                    TQ1->TQ1_LOCPN3,TQ1->TQ1_LOCPN4,TQ1->TQ1_LOCPN5,;
                    TQ1->TQ1_LOCPN6,TQ1->TQ1_LOCPN7,TQ1->TQ1_LOCPN8,;
                    TQ1->TQ1_LOCPN9,TQ1->TQ1_LOCPN0,TQ1->TQ1_EIXO,;
                    TQ1->TQ1_FAMIL1,TQ1->TQ1_FAMIL2,TQ1->TQ1_FAMIL3,;
                    TQ1->TQ1_FAMIL4,TQ1->TQ1_FAMIL5,TQ1->TQ1_FAMIL6,;
                    TQ1->TQ1_FAMIL7,TQ1->TQ1_FAMIL8,TQ1->TQ1_FAMIL9,;
                    TQ1->TQ1_FAMIL0})
      DbselectArea("TQ1")
      DbSkip()
   End
Endif

oFont11 := TFont():New("Arial",11,11,,.F.,,,,.T.,.F.)
oFont14 := TFont():New("Arial",14,14,,.T.,,,,.T.,.F.)
oFont18 := TFont():New("Arial",18,18,,.T.,,,,.T.,.F.)

oPrint  := TMSPrinter():New( OemToAnsi(STR0073)) //"Impressao do Esquema Padrao"
oPrint:SetlandScape() // Paisagem
MNTA220IDE(oPrint,@i,@lin,nLEG)
Return

/*/


Ŀ
Funo    MNTA220IDE Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Impresso do Esquema Padrao                                 
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Static Function MNTA220IDE(oPrint,i,lin,nVLEG)
Local cCOR := CLR_HRED,h2,hh,hk,ll,lm,xl := 0,cCOR2 := CLR_HBLUE
Local cDesMod
cTIPODIM := STR0057 //"LOCALIZACAO"
If nTIPIMP = 2
   cTIPODIM := STR0058 //"FAMILIA"
ElseIf nTIPIMP = 3
   cTIPODFA := STR0058 //"FAMILIA"
Endif

DbSelectArea("ST6")
DbSetOrder(1)
DbSeek(xFilial('ST6')+tq0->tq0_DESENH)
cNOMFORI := Alltrim(st6->t6_nome)
nTAMARQ  := Len(aARQTQ1)
nCOLP2   := 30
nLINHA   := 710
nUTLIN   := 0
lPRINC   := .T.
nPAG     := 1
nLISOMA  := If(nTIPIMP = 3,68,0)

nESQ1    := If(nTIPIMP = 2,13,2)
nESQ2    := If(nTIPIMP = 2,14,3)
nESQ3    := If(nTIPIMP = 2,15,4)
nESQ4    := If(nTIPIMP = 2,16,5)
nESQ5    := If(nTIPIMP = 2,17,6)
nESQ6    := If(nTIPIMP = 2,18,7)
nESQ7    := If(nTIPIMP = 2,19,8)
nESQ8    := If(nTIPIMP = 2,20,9)
nESQ9    := If(nTIPIMP = 2,21,10)
nESQ0    := If(nTIPIMP = 2,22,11)

nL01     := 320
nL02     := 470
nL03     := 620
nL04     := 770
nL05     := 920
nL06     := 1070
nL07     := 1220
nL08     := 1370
nL09     := 1520
nL10     := 1670
nL11     := 1820

chora    := "         "+STR0098+" "+Dtoc(date())+"  "+Time()

For xl := 1 to nTAMARQ
   If lPRINC
      lPRINC := .F.
      oPrint:StartPage()

      If lTipMod
	  	cDesMod := IIf( lRel12133, MNTDesTpMd(TQ0->TQ0_TIPMOD), NGSEEK("TQR",TQ0->TQ0_TIPMOD,1,"Alltrim(TQR->TQR_DESMOD)") )
         oPrint:Say(020,0040,STR0074+Alltrim(tq0->tq0_DESENH)+" - "; //"Esquema Padrao...:  "
                +NGSEEK("ST6",TQ0->TQ0_DESENH,1,"Alltrim(st6->t6_nome)")+Space(10);
                +STR0099+" "+Alltrim(TQ0->TQ0_TIPMOD)+" - "+cDesMod,oFont14)
      Else
         oPrint:Say(020,0040,STR0074+Alltrim(tq0->tq0_DESENH)+" - "; //"Esquema Padrao...:  "
                +NGSEEK("ST6",TQ0->TQ0_DESENH,1,"Alltrim(st6->t6_nome)"),oFont14)
      Endif

      oPrint:Box(100,405,200,705)
      oPrint:Say(115,040,STR0075,oFont14) //"Apresentacao   "
      oPrint:Say(125,415,cTIPODIM,oFont11)
      cPAGI := STR0095+" "+Str(nPAG,2)+"    "+chora
      oPrint:Say(125,1700,cPAGI,oFont14)
   Endif

   If nCOLP2 > 2550
      nLINHA := 710
      nCOLP2 := 30
      nPAG   += 1
      nUTLIN := 0
      oPrint:EndPage()
      oPrint:StartPage()
      cPAGI := STR0095+" "+Str(nPAG,2)+"   "+chora
      oPrint:Say(125,1700,cPAGI,oFont14)
   Endif

   cNOEIXO := If(Alltrim(aARQTQ1[xl][12]) = STR0093,STR0093,;
                 Alltrim(aARQTQ1[xl][12])+" "+CHR(176)+" "+STR0094)

   If aARQTQ1[xl][1] = 1
      MNTA220BX(oPrint,@i,@lin,nL06-20,85,200,1)
      oPrint:Say(nL06-85      ,nCOLP2+5,cNOEIXO,oFont14)
      oPrint:Say(nL06,nCOLP2  ,aARQTQ1[xl,nESQ1],oFont11)
      nUTLIN := Max(nUTLIN,1050)

   ElseIf aARQTQ1[xl][1] = 2
      MNTA220BX(oPrint,@i,@lin,nL05-20,85,200,1)
      MNTA220BX(oPrint,@i,@lin,nL07-20,85,200,1)
      MNTA220EI1(oPrint,@i,@lin,nL05+65,nL05+280,1,1,90,nLISOMA)
      oPrint:Say(nL05-85      ,nCOLP2+5,cNOEIXO,oFont14)
      oPrint:Say(nL05,nCOLP2  ,aARQTQ1[xl,nESQ1],oFont11)
      oPrint:Say(nL07,nCOLP2  ,aARQTQ1[xl,nESQ2],oFont11)
      nUTLIN := Max(nUTLIN,1250)

   ElseIf aARQTQ1[xl][1] = 3
      MNTA220BX(oPrint,@i,@lin,nL05-20,85,200,2)
      MNTA220BX(oPrint,@i,@lin,nL07-20,85,200,1)
      MNTA220EI1(oPrint,@i,@lin,nL05+65,nL05+130,2,1,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL06+62,nL06+130,2,1,90,nLISOMA)
      oPrint:Say(nL05-85      ,nCOLP2+5,cNOEIXO,oFont14)
      oPrint:Say(nL05,nCOLP2  ,aARQTQ1[xl,nESQ1],oFont11)
      oPrint:Say(nL06,nCOLP2  ,aARQTQ1[xl,nESQ2],oFont11)
      oPrint:Say(nL07,nCOLP2  ,aARQTQ1[xl,nESQ3],oFont11)
      nUTLIN := Max(nUTLIN,1250)

   ElseIf aARQTQ1[xl][1] = 4
      MNTA220BX(oPrint,@i,@lin,nL04-20,85,200,2)
      MNTA220BX(oPrint,@i,@lin,nL07-20,85,200,2)
      MNTA220EI1(oPrint,@i,@lin,nL04+65,nL04+125,2,1,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL05+57,nL05+280,2,1,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL07+65,nL07+125,2,1,90,nLISOMA)
      oPrint:Say(nL04-85      ,nCOLP2+5,cNOEIXO,oFont14)
      oPrint:Say(nL04,nCOLP2  ,aARQTQ1[xl,nESQ1],oFont11)
      oPrint:Say(nL05,nCOLP2  ,aARQTQ1[xl,nESQ2],oFont11)
      oPrint:Say(nL07,nCOLP2  ,aARQTQ1[xl,nESQ3],oFont11)
      oPrint:Say(nL08,nCOLP2  ,aARQTQ1[xl,nESQ4],oFont11)
      nUTLIN := Max(nUTLIN,1455)

   ElseIf aARQTQ1[xl][1] = 5
      MNTA220BX(oPrint,@i,@lin,nL04-20,85,200,2)
      MNTA220BX(oPrint,@i,@lin,nL06-20,85,200,1)
      MNTA220BX(oPrint,@i,@lin,nL07-20,85,200,2)
      MNTA220EI1(oPrint,@i,@lin,nL04+65,nL04+130,2,1,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL05+58,nL05+130,2,1,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL06+65,nL06+130,2,2,90,nLISOMA)
      oPrint:Say(nL04-85      ,nCOLP2+5,cNOEIXO,oFont14)
      oPrint:Say(nL04,nCOLP2  ,aARQTQ1[xl,nESQ1],oFont11)
      oPrint:Say(nL05,nCOLP2  ,aARQTQ1[xl,nESQ2],oFont11)
      oPrint:Say(nL06,nCOLP2  ,aARQTQ1[xl,nESQ3],oFont11)
      oPrint:Say(nL07,nCOLP2  ,aARQTQ1[xl,nESQ4],oFont11)
      oPrint:Say(nL08,nCOLP2  ,aARQTQ1[xl,nESQ5],oFont11)
      nUTLIN := Max(nUTLIN,1450)

   ElseIf aARQTQ1[xl][1] = 6
      MNTA220BX(oPrint,@i,@lin,nL03-20,85,200,3)
      MNTA220BX(oPrint,@i,@lin,nL07-20,85,200,3)
      MNTA220EI1(oPrint,@i,@lin,nL03+65,nL03+130,2,2,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL05+50,nL05+280,2,1,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL07+65,nL07+130,2,2,90,nLISOMA)
      oPrint:Say(nL03-85      ,nCOLP2+5,cNOEIXO,oFont14)
      oPrint:Say(nL03,nCOLP2  ,aARQTQ1[xl,nESQ1],oFont11)
      oPrint:Say(nL04,nCOLP2  ,aARQTQ1[xl,nESQ2],oFont11)
      oPrint:Say(nL05,nCOLP2  ,aARQTQ1[xl,nESQ3],oFont11)
      oPrint:Say(nL07,nCOLP2  ,aARQTQ1[xl,nESQ4],oFont11)
      oPrint:Say(nL08,nCOLP2  ,aARQTQ1[xl,nESQ5],oFont11)
      oPrint:Say(nL09,nCOLP2  ,aARQTQ1[xl,nESQ6],oFont11)
      nUTLIN := Max(nUTLIN,1550)

   ElseIf aARQTQ1[xl][1] = 7
      MNTA220BX(oPrint,@i,@lin,nL03-20,85,200,3)
      MNTA220BX(oPrint,@i,@lin,nL06-20,85,200,1)
      MNTA220BX(oPrint,@i,@lin,nL07-20,85,200,3)
      MNTA220EI1(oPrint,@i,@lin,nL03+65,nL03+130,2,2,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL05+58,nL05+130,2,1,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL06+65,nL06+130,2,3,90,nLISOMA)
      oPrint:Say(nL03-85      ,nCOLP2+5,cNOEIXO,oFont14)
      oPrint:Say(nL03,nCOLP2  ,aARQTQ1[xl,nESQ1],oFont11)
      oPrint:Say(nL04,nCOLP2  ,aARQTQ1[xl,nESQ2],oFont11)
      oPrint:Say(nL05,nCOLP2  ,aARQTQ1[xl,nESQ3],oFont11)
      oPrint:Say(nL06,nCOLP2  ,aARQTQ1[xl,nESQ4],oFont11)
      oPrint:Say(nL07,nCOLP2  ,aARQTQ1[xl,nESQ5],oFont11)
      oPrint:Say(nL08,nCOLP2  ,aARQTQ1[xl,nESQ6],oFont11)
      oPrint:Say(nL09,nCOLP2  ,aARQTQ1[xl,nESQ7],oFont11)
      nUTLIN := Max(nUTLIN,1750)

   ElseIf aARQTQ1[xl][1] = 8
      MNTA220BX(oPrint,@i,@lin,nL02-20,85,200,4)
      MNTA220BX(oPrint,@i,@lin,nL07-20,85,200,4)
      MNTA220EI1(oPrint,@i,@lin,nL02+65,nL02+130,2,3,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL05+45,nL05+280,2,1,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL07+65,nL07+130,2,3,90,nLISOMA)
      oPrint:Say(nL02-85      ,nCOLP2+5,cNOEIXO,oFont14)
      oPrint:Say(nL02,nCOLP2  ,aARQTQ1[xl,nESQ1],oFont11)
      oPrint:Say(nL03,nCOLP2  ,aARQTQ1[xl,nESQ2],oFont11)
      oPrint:Say(nL04,nCOLP2  ,aARQTQ1[xl,nESQ3],oFont11)
      oPrint:Say(nL05,nCOLP2  ,aARQTQ1[xl,nESQ4],oFont11)
      oPrint:Say(nL07,nCOLP2  ,aARQTQ1[xl,nESQ5],oFont11)
      oPrint:Say(nL08,nCOLP2  ,aARQTQ1[xl,nESQ6],oFont11)
      oPrint:Say(nL09,nCOLP2  ,aARQTQ1[xl,nESQ7],oFont11)
      oPrint:Say(nL10,nCOLP2  ,aARQTQ1[xl,nESQ8],oFont11)
      nUTLIN := Max(nUTLIN,1950)

   ElseIf aARQTQ1[xl][1] = 9
      MNTA220BX(oPrint,@i,@lin,nL02-20,85,200,4)
      MNTA220BX(oPrint,@i,@lin,nL06-20,85,200,5)
      MNTA220EI1(oPrint,@i,@lin,nL02+65,nL02+130,2,4,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL05+65,nL05+130,2,5,90,nLISOMA)
      oPrint:Say(nL02-85      ,nCOLP2+5,cNOEIXO,oFont14)
      oPrint:Say(nL02,nCOLP2  ,aARQTQ1[xl,nESQ1],oFont11)
      oPrint:Say(nL03,nCOLP2  ,aARQTQ1[xl,nESQ2],oFont11)
      oPrint:Say(nL04,nCOLP2  ,aARQTQ1[xl,nESQ3],oFont11)
      oPrint:Say(nL05,nCOLP2  ,aARQTQ1[xl,nESQ4],oFont11)
      oPrint:Say(nL06,nCOLP2  ,aARQTQ1[xl,nESQ5],oFont11)
      oPrint:Say(nL07,nCOLP2  ,aARQTQ1[xl,nESQ6],oFont11)
      oPrint:Say(nL08,nCOLP2  ,aARQTQ1[xl,nESQ7],oFont11)
      oPrint:Say(nL09,nCOLP2  ,aARQTQ1[xl,nESQ8],oFont11)
      oPrint:Say(nL10,nCOLP2  ,aARQTQ1[xl,nESQ9],oFont11)
      nUTLIN := Max(nUTLIN,2150)

   ElseIf aARQTQ1[xl][1] = 10
      MNTA220BX(oPrint,@i,@lin,nL01-20,85,200,5)
      MNTA220EI1(oPrint,@i,@lin,nL01+65,nL01+130,2,4,90,nLISOMA)
      MNTA220EI1(oPrint,@i,@lin,nL05+45,nL05+280,2,1,90,nLISOMA)
      MNTA220BX(oPrint,@i,@lin,nL07-20,85,200,5)
      MNTA220EI1(oPrint,@i,@lin,nL07+65,nL07+130,2,4,90,nLISOMA)
      oPrint:Say(nL01-85      ,nCOLP2+5,cNOEIXO,oFont14)
      oPrint:Say(nL01,nCOLP2  ,aARQTQ1[xl,nESQ1],oFont11)
      oPrint:Say(nL02,nCOLP2  ,aARQTQ1[xl,nESQ2],oFont11)
      oPrint:Say(nL03,nCOLP2  ,aARQTQ1[xl,nESQ3],oFont11)
      oPrint:Say(nL04,nCOLP2  ,aARQTQ1[xl,nESQ4],oFont11)
      oPrint:Say(nL05,nCOLP2  ,aARQTQ1[xl,nESQ5],oFont11)
      oPrint:Say(nL07,nCOLP2  ,aARQTQ1[xl,nESQ6],oFont11)
      oPrint:Say(nL08,nCOLP2  ,aARQTQ1[xl,nESQ7],oFont11)
      oPrint:Say(nL09,nCOLP2  ,aARQTQ1[xl,nESQ8],oFont11)
      oPrint:Say(nL10,nCOLP2  ,aARQTQ1[xl,nESQ9],oFont11)
      oPrint:Say(nL11,nCOLP2  ,aARQTQ1[xl,nESQ0],oFont11)
      nUTLIN := Max(nUTLIN,2350)
   Endif
   nCOLP2 := nCOLP2 + 270
Next xl

If nVLEG = 2
   cDESIGF := If(nTIPIMP = 2,STR0083,STR0082)  //"FAMILIA","LOCALIZACAO"
   nLIN    := nUTLIN+70
   If nLIN > 2350
      nPAG   += 1
      nUTLIN := 0
      oPrint:EndPage()
      oPrint:StartPage()
      cPAGI := STR0095+" "+Str(nPAG,2)+"    "+chora
      oPrint:Say(125,1700,cPAGI,oFont14)
      nLIN := 60
   Endif

   oPrint:Say(nLIN,040,STR0081,oFont18) //"LEGENDA"

   nLIN := nLIN + 90

   oPrint:Say(nLIN,040,Upper(cDESIGF),oFont14)

   nLIN := nLIN + 50

   // GERAR UMA MATRIZ COM OS DESENHO

   aDESIG1 := {}
   aDESIG2 := {}
   For h2 := 1 To Len(aARQTQ1)
      ll := 0
      For ll := 1 To aARQTQ1[h2,1]
         Aadd(aDESIG1,{aARQTQ1[h2,ll+1]})
         If ASCAN(aDESIG2,{|x| x[1] == aARQTQ1[h2,ll+12]}) = 0
            Aadd(aDESIG2,{aARQTQ1[h2,ll+12]})
         Endif
      Next ll
   Next h2

   aDESIGF := If(nTIPIMP = 2,Aclone(aDESIG2),Aclone(aDESIG1))

   For hh := 1 To Len(aDESIGF)
      If nLIN > 2350
         nPAG   += 1
         oPrint:EndPage()
         oPrint:StartPage()
         cPAGI := STR0095+" "+Str(nPAG,2)+"    "+chora
         oPrint:Say(125,1700,cPAGI,oFont14)
         oPrint:Say(40,040,Upper(cDESIGF),oFont14)

         If nTIPIMP = 3 .And. hh <= Len(aDESIG2)
            oPrint:Say(40,1610,STR0083,oFont14,,cCOR)
         Endif
         nLIN := 90
      Endif

      cNOMDES1 := If(nTIPIMP = 2,NGSEEK("ST6",aDESIGF[hh,1],1,"T6_NOME"),;
                                 NGSEEK("TPS",aDESIGF[hh,1],1,"TPS_NOME"))

      oPrint:Say(nLIN,040,aDESIGF[hh,1],oFont11)
      oPrint:Say(nLIN,230,cNOMDES1,oFont11)
      If nTIPIMP = 3
         If hh <= Len(aDESIG2)
            oPrint:Say(nLIN,1610,aDESIG2[hh][1],oFont11,,cCOR)
            oPrint:Say(nLIN,1780,"- ";
                   +NGSEEK("ST6",aDESIG2[hh,1],1,"T6_NOME"),oFont11,,cCOR)
         Endif
      Endif
      nLIN := nLIN + 40
   Next hh
Endif

oPrint:EndPage()
oPrint:Preview()
Return Nil

/*/


Ŀ
Funo    MNTA220LEG Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Monta as legendas                                           
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Static Function MNTA220LEG()
Local aFAMIAU := {},aFILBOI := {},aFILBOL := {},aFILBFI := {}, aFILBOF := {}
Local nCOLIY  := If(nTIPDES <> 3,35,16.5),kw,yk,ym
Local nCOLFY  := If(nTIPDES <> 3,66,83)

For kw := 1 To Len(aARRAYTQ1)
   Aadd(aFILBOI,{aARRAYTQ1[kw,2],aARRAYTQ1[kw,3],aARRAYTQ1[kw,4],;
                 aARRAYTQ1[kw,5],aARRAYTQ1[kw,6],aARRAYTQ1[kw,7],;
                 aARRAYTQ1[kw,8],aARRAYTQ1[kw,9],aARRAYTQ1[kw,10],;
                 aARRAYTQ1[kw,11]})

   Aadd(aFILBFI,{aARRAYTQ1[kw,13],aARRAYTQ1[kw,14],aARRAYTQ1[kw,15],;
                 aARRAYTQ1[kw,16],aARRAYTQ1[kw,17],aARRAYTQ1[kw,18],;
                 aARRAYTQ1[kw,19],aARRAYTQ1[kw,20],aARRAYTQ1[kw,21],;
                 aARRAYTQ1[kw,22]})
Next kw
kw := 0
For kw := 1 To Len(aFILBOI)
   For ym := 1 To Len(aFILBOI[kw,ym])
      If !Empty(aFILBOI[kw,ym])
         Aadd(aFILBOL,{aFILBOI[kw][ym],;
                    Alltrim(NGSEEK("TPS",aFILBOI[kw,ym],1,"TPS_NOME"))})
      Endif
      If !Empty(aFILBFI[kw,ym])
         If ASCAN(aFILBOF,{|x| x[1] == aFILBFI[kw,ym]}) = 0
            Aadd(aFILBOF,{aFILBFI[kw][ym],;
                       Alltrim(NGSEEK("ST6",aFILBFI[kw,ym],1,"T6_NOME"))})
         Endif
      Endif
   Next ym
Next Kw

cCABTIT := STR0082+Space(73)+STR0083 //"LOCALIZACOES"#"FAMILIAS"
If nTIPDES <> 3
   cCABTIT := If(nTIPDES = 1,STR0082,STR0083)//"LOCALIZACOES"#"FAMILIAS"
Endif

nLININ  := 25.5
nCOLLIS := 56

MNTA220ZOO(aFILBOL,aFILBOF,nCOLIY,nCOLFY,nLININ)

Return .t.

/*/


Ŀ
Funo    MNTA220ZOO Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Monta o zoom                                                
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Static Function MNTA220ZOO(aFILBOL,aFILBOF,nCOLIY,nCOLFY,nLININ)
Local oLISTBOX,oBrw, oBrw1, n := 1, y := 1
Private oDlgx
Private oMenu

Define dialog odlgx from nLININ,nCOLIY to 33,nCOLFY+9 title cCABTIT
   If nTIPDES < 3
      aARLENG := If(nTIPDES = 1,Aclone(aFILBOL),Aclone(aFILBOF))
      @.20,0.5 listbox oBrw fields aARLENG[n][1],aARLENG[n][2];
         headers STR0076, STR0030; //"Codigo "###"Descricao"
         fieldsizes 25,100;
         of odlgx size 155,nCOLLIS

         oBrw:bGotop    := { || n := 1 }
         oBrw:bGoBottom := { || n := eval( oBrw:bLogicLen ) }
         oBrw:bSkip     := { | nwant, nold | nold := n , n += nwant,;
         n := max( 1, min( n, eval( oBrw:bLogicLen ))),;
         n - nOld }
         oBrw:bLogicLen := { || len(aARLENG) }
         oBrw:cAlias    := "Array"
   Else
      @.1,0.5 listbox oBrw fields aFILBOL[n][1],aFILBOL[n][2];
         headers STR0076, STR0030; //"Codigo "###"Descricao"
         fieldsizes 25,95;
         of odlgx size 150,nCOLLIS

         oBrw:bGotop    := { || n := 1 }
         oBrw:bGoBottom := { || n := eval( oBrw:bLogicLen ) }
         oBrw:bSkip     := { | nwant, nold | nold := n , n += nwant,;
         n := max( 1, min( n, eval( oBrw:bLogicLen ))),;
         n - nOld }
         oBrw:bLogicLen := { || len(aFILBOL) }
         oBrw:cAlias    := "Array"

      @.1,20 listbox oBrw1 fields aFILBOF[y][1],aFILBOF[y][2];
         headers STR0076, STR0030; //"Codigo "###"Descricao"
         fieldsizes 25,95;
         of odlgx size 140,nCOLLIS

         oBrw1:bGotop    := { || y := 1 }
         oBrw1:bGoBottom := { || y := eval( oBrw1:bLogicLen ) }
         oBrw1:bSkip     := { | nwant, nold | nold := y , y += nwant,;
         y := max( 1, min( y, eval( oBrw1:bLogicLen ))),;
         y - nOld }
         oBrw1:bLogicLen := { || len(aFILBOF) }
         oBrw1:cAlias    := "Array"
   Endif

NGPOPUP(asMenu,@oMenu)
oDlgx:bRClicked:= { |o,x,y| oMenu:Activate(x,y,oDlgx)}

activate dialog oDlgx
Return .t.

/*/


Ŀ
Funo    MNTA220WHE Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Leitura da campo                                            
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220WHE()
Return .f.

/*/


Ŀ
Funo    MNTA220BX  Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Monta box na impressao                                      
Ĵ
 Uso       MNTA230, MNTA220                                           
ٱ


/*/
Function MNTA220BX(oPrint,i,lin,nVLI,nLIS,nCOLF,nVZ,nCOLP)
	Local vx 	:= 0
	Local nLIL 	:= nVLI

	DEFAULT nCOLP := nCOLP2

	For vx := 1 To nVZ
		oPrint:Box(nLIL,nCOLP-10,nLIL+nLIS,nCOLP+nCOLF)
		nLIL += 145
	Next vx
Return .T.

/*/


Ŀ
Funo    MNTA220EI1 Autor  Incio Luiz Kolling    Data  25/05/05 
Ĵ
Descrio Monta eixos                                                 
Ĵ
 Uso       MNTA230, MNTA220                                           
ٱ


/*/
Function MNTA220EI1(oPrint,i,lin,nLII,nLIF,nTIP,nVEZ,nCOLS,nLINS,nColp)
	Local nVEZL := 0
	Local nLIZI := nLII
	Local nLIZF := nLIF
	Local nLIS 	:= If(nLINS = NIL,0,nLINS)

	DEFAULT nColp := nCOLP2

	For nVEZL := 1 To nVEZ
		oPrint:Line(nLIZI+nLIS,nColp+nCOLS,nLIZF,nColp+nCOLS)
		If nTIP = 2
			oPrint:Line(nLIZI+nLIS,nColp+nCOLS+10,nLIZF,nColp+nCOLS+10)
		Endif
		nLIZI += 145
		nLIZF += 145
	Next nVEZL
Return .T.

/*/


Ŀ
Funo    MNT220CSX3 Autor  Elisangela Costa       Data 18/08/2006
Ĵ
Descrio Inicializa os campos da alcols conforme SX3                 
Ĵ
 Uso      MNTA220                                                     
Ĵ
 Parametroxz    = Numero da linha na acols                            
          lINCL = Indica se e inclusao (.T. = Inclusao,               
                                        .F. = Nao e inclusao)         
ٱ


/*/
Static Function MNT220CSX3(xz,lINCL)

	Local nCSX3   := 0
	Local nTamTot := 0
	Local nInd    := 0
	Local nTam    := 0
	Local aStruct := {}
	Local cCampo  := ""
	Local cUso    := ""
	Local cX3NVL  := ""
	Local cTipo   := ""

	If !lINCL
		nCSX3 := If(lGFrota,3,2)
	EndIf

	dbSelectArea("TQ1")
	aStruct := DBSTRUCT()
	nTamTot := Len(aStruct)

	For nInd := 1 To nTamTot

		cCampo := aStruct[nInd,1]
		cUso   := Posicione("SX3",2,cCampo,"X3_USADO")
		cX3NVL := Posicione("SX3",2,cCampo,"X3_NIVEL")
		nTam   := TAMSX3(cCampo)[1]
		cTipo  := aStruct[nInd,2]

		If fLimpaCpo(cUso, cCampo, cX3NVL, lINCL)
			nCSX3++
			If cTipo == "C"
				aCOLS[xz][nCSX3] := Space(nTam)
			ElseIf cTipo == "N"
				aCOLS[xz][nCSX3] := 0
			ElseIf cTipo == "D"
				aCOLS[xz][nCSX3] := dDataBase
			ElseIf cTipo == "M"
				aCOLS[xz][nCSX3] := ""
			Else
				aCOLS[xz][nCSX3] := .F.
			EndIf
		Endif

		dbSkip()
	End

	nCSX3              := Len(aCols[xz])-2
	aCols[xz][nCSX3]   := "TQ1"
	aCols[xz][nCSX3+1] := TQ1->(Recno())
	aCOLS[xz][nCSX3+2] := .F.

Return .T.

/*/


Ŀ
Programa  MenuDef    Autor  Ricardo Dal Ponte      Data 29/11/2006
Ĵ
Descrio  Utilizacao de menu Funcional                               
                                                                      
                                                                      
Ĵ
Retorno   Array com opcoes da rotina.                                 
Ĵ
ParametrosParametros do array a Rotina:                               
          1. Nome a aparecer no cabecalho                             
          2. Nome da Rotina associada                                 
          3. Reservado                                                
          4. Tipo de Transao a ser efetuada:                        
              1 - Pesquisa e Posiciona em um Banco de Dados           
              2 - Simplesmente Mostra os Campos                       
              3 - Inclui registros no Bancos de Dados                 
              4 - Altera o registro corrente                          
              5 - Remove o registro corrente do Banco de Dados        
          5. Nivel de acesso                                          
          6. Habilita Menu Funcional                                  
Ĵ
   DATA    Programador   Manutencao efetuada                         
Ĵ
                                                                     
ٱ


/*/
Static Function MenuDef(lTipMod)
Local aRotina := {{STR0011 ,"AxPesqui"  , 0 , 1},; //"Pesquisar"
                  {STR0012 ,"NGCAD02"   , 0 , 2},; //"Visualizar"
                  {STR0013 ,"MNTA220IN" , 0 , 3},; //"Incluir"
                  {STR0014 ,"MNTA220AL" , 0 , 4},; //"Alterar"
                  {STR0015 ,"MNTA220EX"   , 0 , 5, 3}} //"Excluir"
If lTipMod
   Aadd(aRotina,{STR0016,"MNTA220DES(TQ0->TQ0_DESENH,TQ0->TQ0_TIPMOD)", 0 , 6})  //Mostrar Esquema
Else
   Aadd(aRotina,{STR0016,"MNTA220DES(TQ0->TQ0_DESENH)", 0 , 6}) //Mostrar Esquema
Endif

Return(aRotina)

/*/


Ŀ
Funo    MNTA220FR  Autor Incio Luiz Kolling     Data 13/02/2008
Ĵ
Descrio  Verifica se usa frota                                      
Ĵ
 Uso       MNTA220                                                    
ٱ


/*/
Function MNTA220FR()

	Local lFrotas := IIf(FindFunction('MNTFrotas'), MNTFrotas(), SuperGetMv("MV_NGMNTFR",.F.," ") == 'S') // Possui frotas

	Private oMenu

	If lFrotas .And. !lRel12133

		If Posicione("SX2",1,"TQ0","X2_UNICO") <> "TQ0_FILIAL+TQ0_DESENH+TQ0_TIPMOD"
			lFrotas := .F.
		EndIf

		If Posicione("SX2",1,"TQ1","X2_UNICO") <> "TQ1_FILIAL+TQ1_DESENH+TQ1_TIPMOD+TQ1_SEQREL"
			lFrotas := .F.
		EndIf

		If !lFrotas
			MsgInfo(STR0107 + Chr(13) + Chr(10) +; //"Foi identificado um problema no ndice nico das Tabela TQ0 ou TQ1."
			        STR0108 + Chr(13) + Chr(10) +; //"Dessa forma o parmetro MV_NGMNTFR (Utiliza frota) ser considerado como N-No utiliza."
					STR0109,;                      //"Favor entrar em contato com o administrador do sistema."
				    STR0040)                       //"Ateno"
		EndIf

	Endif

Return lFrotas

Function MNT220TPMOD(nOPCAO)
Local cTipMod := Space(10)
Local nOPGA2 := 0

If nOPCAO == 4
	If !lRel12133 .And. lGFrota
		If Empty(M->TQ0_TIPMOD)
			Define Msdialog oDlg1 From  000,000 To 155,400 Title STR0101 Pixel // "Tipo de Modelo"

		   @ 1.5,.5 To 3.5,25 LABEL STR0102 OF oDlg1 //"Para Esquema Padro e com integrao com Frotas, informe o Tipo de Modelo:"

		  	@ 30,008 Say Oemtoansi(STR0103) Size 47,07 Of oDlg1 Pixel Color CLR_HBLUE   //"Tipo Modelo"
		  	@ 30,040 MsGet cTipMod Size 38,08 Of oDlg1 Pixel Picture '@!' F3 "TQR" Valid EXISTCHAV('TQ0',M->TQ0_DESENH+cTipMod) .AND. EXISTCPO('TQR',cTipMod) .AND. MNTA220FPA(M->TQ0_DESENH,cTipMod)
			@ 30,100 MsGet oNomMod Var NGSEEK('TQR',cTipMod,1,'TQR_DESMOD') Of oDlg1 Pixel Picture '@!' When Size 90,08

			NGPOPUP(asMenu,@oMenu)
			oDlg1:bRClicked:= { |o,x,y| oMenu:Activate(x,y,oDlg1)}

		  	Activate Msdialog oDlg1 On Init EnchoiceBar(oDlg1,{||nOPGA2:=2,oDlg1:End()},{||nOPGA2:=1,oDlg1:End()}) Centered

			If nOPGA2 == 2
				M->TQ0_TIPMOD := cTipMod
				lTpModAlt := .t.
			EndIf
		EndIf
	EndIf
EndIf

Return .t.

//-------------------------------------------------------------------
/*/{Protheus.doc} fLimpaCpo
Retorna se o campo deve ser limpado, incializado com os valores
padres.

@author  Maicon Andr Pinheiro
@since   17/04/2018
@version P12
/*/
//-------------------------------------------------------------------
Static Function fLimpaCpo(cUso, cCampo, cX3NVL, lINCL)

	Local lRet := .T.

	If X3USO(cUso) .And. cNivel >= cX3NVL .And. Trim(cCampo) != "TQ1_DESENH" .And. Trim(cCampo) != "TQ1_TIPMOD" .And.;
	   Trim(cCampo) != "TQ1_SEQREL" .And. Trim(cCampo) <> "TQ1_SEQUEN"

		If !lGFrota
			If Trim(cCampo) == "TQ1_TIPEIX"
				lRet := .F.
			EndIf
		EndIf

		If lRet .And. !lUsaSusp .Or. (lUsaSusp .And. !lINCL)
			If Trim(cCampo) == "TQ1_SUSPEN"
				lRet := .F.
			EndIf
		EndIf

		If lRet .And. !lINCL
			If !(Trim(cCampo) != "TQ1_EIXO" .And. Trim(cCampo) != "TQ1_TIPEIX" .And. Trim(cCampo) != "TQ1_QTDPNE")
				lRet := .F.
			EndIf
		EndIf

	Else
		lRet := .F.
	EndIf

Return lRet

//----------------------------------------------------------------
/*/{Protheus.doc} MNTA220GAT()
Executa gatilhos especficos (SX7).

@author Wexlei Silveira
@since	06/04/2020

@param cCampo, Caractere, Campo em que o gatilho est sendo executado

@return Caractere, Contedo a ser gatilhado
/*/
//----------------------------------------------------------------
Function MNTA220GAT(cCampo)

	Local cDesc := ''

	If cCampo == 'TQ0_TIPMOD'

		cDesc := MNTDesTpMd(M->TQ0_TIPMOD)

	EndIf

Return cDesc

//----------------------------------------------------------------
/*/{Protheus.doc} MNTA220VLD()
Validao (X3_VALID) dos campos.

@author Wexlei Silveira
@since	13/04/2020

@param cCampo, Caractere, Campo a ser validado

@return Lgico, Se o contedo  valido
/*/
//----------------------------------------------------------------
Function MNTA220VLD(cCampo)

	Local lRet := .T.

	If cCampo == 'TQ0_TIPMOD'

		If !Empty(M->TQ0_TIPMOD)

			// A partir do release 12.1.33, o valor '*' torna-se vlido e indica que a regra aplica-se  todos os tipos modelos existentes
			If Trim(M->TQ0_TIPMOD) != "*" .And. !EXISTCPO('TQR', M->TQ0_TIPMOD)
				lRet := .F.

			ElseIf !Empty(M->TQ0_DESENH)

				If !EXISTCHAV( 'TQ0', M->TQ0_DESENH + M->TQ0_TIPMOD )
					lRet := .F.

				ElseIf !MNTA220FPA( M->TQ0_DESENH, M->TQ0_TIPMOD )
					lRet := .F.

				EndIf

			EndIf

		EndIf

	ElseIf cCampo == 'TQ0_DESENH'

		If !Empty(M->TQ0_DESENH)

			If !EXISTCPO( 'ST6', M->TQ0_DESENH )
				lRet := .F.

			ElseIf !Empty(M->TQ0_TIPMOD)

				If !EXISTCHAV( 'TQ0', M->TQ0_DESENH + M->TQ0_TIPMOD )
					lRet := .F.

				ElseIf !MNTA220FPA( M->TQ0_DESENH, M->TQ0_TIPMOD )
					lRet := .F.

				EndIf

			EndIf

		EndIf

	EndIf

Return lRet

//----------------------------------------------------------------
/*/{Protheus.doc} MNTA220INI()
Inicializador padro (X3_RELACAO) para a descrio de campos.

@author Wexlei Silveira
@since	13/04/2020

@param cCampo, Caractere, Campo a ser inicializado

@return Caractere, Contedo com que o campo ser inicializado
/*/
//----------------------------------------------------------------
Function MNTA220INI(cCampo)

	Local cDesc := ''

	If cCampo == 'TQ0_DESMOD'

		If !Inclui
			cDesc := MNTDesTpMd(TQ0->TQ0_TIPMOD)
		EndIf

	EndIf

Return cDesc
