#include "tlpp-core.th"

namespace pgc.historicalsService
using namespace pgc.historicalsRepository


CLASS pgcHistoricalsService
    public Data oJsonResponse As Object
    public Data lOk As Logical
    public Data nCode    As Numeric
    public Data cMessage As Character

    public Method New()
    public Method getQueryResponse()
EndClass


/*/{Protheus.doc} New
	Método construtor
@author renan.martins
@since 02/2024
/*/
Method New() CLASS pgcHistoricalsService
    Self:oJsonResponse := JsonObject():new()
    Self:lOk := .F.
    Self:nCode := 0
    Self:cMessage := ""
Return Nil


/*/{Protheus.doc} getQueryResponse
	Metodo responsavel por validar regras de consulta ao banco de dados.
@author renan.martins
@since 02/2024
@param nPage, numeric, número da pagina.
@param nPageSize, numeric, tamanho da página.
@param nQuery, numeric, 1=Lista geral dos mais comprados, 2=Lista geral dos mais comprados com filtro, 3=Últimas compras, 4=Últimos preços, 5=Saldo em Estoque,
                        6=Pedidos em Aberto, 7=SCs em Aberto, 8=Produtos Fornecidos, 9=Últimos fornecimentos, 10=Pedidos em Atraso
@return oJsonResponse, object, objeto json com os dados das solicitações.
@return oJsonQryParam, object, objeto json com query params.
@return oJsonResponse, object, objeto json com path params.
/*/
Method getQueryResponse(nPage, nPageSize, nQuery, oJsonQryParam, oJsonPathParam) Class pgcHistoricalsService
    Local oHistoricalsRepository As Object
    Default nPage     := 1
	Default nPageSize := 10
    Default nQuery  := 1
    Default oJsonPathParam := Nil
    Default oJsonQryParam := Nil

    oHistoricalsRepository := pgcHistoricalsRepository():New("GET")
    oHistoricalsRepository:Get(nPage, nPageSize, nQuery, oJsonQryParam, oJsonPathParam)

    Self:lOk := oHistoricalsRepository:lOk
    Self:nCode := oHistoricalsRepository:GetCode()
    Self:cMessage := oHistoricalsRepository:GetMessage()
    Self:oJsonResponse := oHistoricalsRepository:getJSONResponse()

    oHistoricalsRepository:DeActivate()
    FreeObj(oHistoricalsRepository)
Return Self:oJsonResponse 
