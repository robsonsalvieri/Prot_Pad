/* 
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿±±
±±³ DATA   ³ BOPS ³Prograd.³ALTERACAO                                      ³±±
±±ÃÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³10.09.98³16471A³Eduardo ³Acerto na Enchoice e Getdados do windows.      ³±±
±±³11.09.98³17856A³Fernando³Inclus„o do Ponto de Entrada MTA550G.          ³±±
±±³21.09.98³XXXXXX³Edson   ³Inclus„o do Ponto de Entrada MTA550A.          ³±±
±±³29.04.99³21552 ³Aline   ³Tratamento de Campos incluidos pelo usuario.   ³±±
±±³16.06.99³Wagner³Edson   ³Inclus„o do Ponto de Entrada MTA550E.          ³±±
±±ÀÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
#INCLUDE "MATA550.CH"
#INCLUDE "PROTHEUS.CH"

Static _lIntMrp := Nil

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MATA550   ³ Autor ³ Rosane L. Chene       ³ Data ³ 03/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Manutencao de Grade de Produtos                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ Generico                                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function MATA550(void)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define Variaveis                                             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local cMascara := GetMv("MV_MASCGRD")

dbSelectArea("SBV")

Private nOpcA  := 0

Private aSize    :=MsAdvSize()
Private aInfo    :={aSize[1],aSize[2],aSize[3],aSize[4],3,3}
Private aObjects :={}
Private aPosObj  :={}

Private cCadastro := OemToAnsi(STR0001)		//"Grade de Produtos "
Private aCampos := {}
Private nTamRef := Val(Substr(cMascara,1,2))
Private nTamLin := Val(Substr(cMascara,4,2))
Private nTamCol := Val(Substr(cMascara,7,2))
Private aAlter  := {}
Private aCols   := {}

Private nTamCod := TamSX3('B1_COD')[1] // para obter corretamente o tamanho do codigo do produto no dicionario

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Armazena os produtos para serem deletados                    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Private aDeleta := {}
Private aRotina := MenuDef()

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Endereca a funcao de BROWSE                                  ³
//³ Obs.: O parametro aFixe nao e' obrigatorio e pode ser omitido³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

mBrowse( 6, 1,22,75,"SB4")

Return Nil

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Visual³ Autor ³ Rosane Luciane Chene  ³ Data ³ 08/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa de visualizacao p/ Grade de Produtos              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ A550Visual(ExpC1,ExpN1,ExpN2)                              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Alias do arquivo                                   ³±±
±±³          ³ ExpN1 = Numero do registro                                 ³±±
±±³          ³ ExpN2 = Numero da opcao selecionada                        ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MAT550                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function A550Visual( cAlias, nReg, nOpc)
Local lComplECom:= SuperGetMV("MV_LJGRMHH",.F.,.F.) .And. TableInDic("MHH") 
Local aArea    := GetArea()
Local nOpcA    := 3
Local cMemo    := ""
Local nX	   := 0
Local oDlg
Local nTop
Local nLeft
Local nBottom
Local nRight
Local nRegMHH  := 0

Local oGet1
Local aObjects    := {}
Local aSize       := {} 
Local aInfo       := {}
Local aPosObj     := {}
Local aSB4Enc	  := {}
Local aMHHEnc	  := {}
Local bGetSx3	  := { | x,y | GetSx3Cache( x, y ) }
Local aMHHCpos 	  := ESTFwSX3Util():xGetAllFields( "MHH" , .T. )
Local aSB4Cpos 	  := ESTFwSX3Util():xGetAllFields( "SB4" , .T. )

Private caTela, caTela1
Private oFolder
Private oEnc01
Private oEnc02
Private Altera :=.F.
Private Inclui :=.F.
Private aTELA[0][0], aGETS[0], aHeader[0], Continua:=.F., nUsado:=0, aCols:={}

DEFAULT cAlias	:= Alias()
DEFAULT nReg 	:= SB4->(Recno())
DEFAULT nOpc	:= 2

dbSelectArea( "MHH" )
MHH->( dbSetOrder( 1 ) )

//????????????????????????????????????????????????????????????????
//? Verifica se existe algum dado no arquivo                     ?
//????????????????????????????????????????????????????????????????
dbSelectArea(cAlias)
If LastRec() == 0
	Return .T.
EndIf


//?????????????????????????????????????????????????????????
//? Montagem do aHeader e aCols                           ?
//?????????????????????????????????????????????????????????
dbSelectArea("SB4")
FillGetDados(nOpc, cAlias, 1,/*cSeek*/,/*{|| &cWhile }*/,{|| .T. },/*aNoFields*/,/*aYesFields*/,/*lOnlyYes*/,/*cQuery*/,{|| MontaCols() })

//???????????????????????????????????????????????????
//? Ajusta a largura para o tamanho padrao Protheus ?
//???????????????????????????????????????????????????
aSize := MsAdvSize()       
aObjects := {}                                            

AAdd( aObjects, { 010,400,.T.,.T.})
AAdd( aObjects, { 070,050,.T.,.T.})		

aInfo  := {aSize[1],aSize[2],aSize[3],aSize[4],2,2 } 
aPosObj:=MsObjSize(aInfo,aObjects)


//????????????????????????????????????????????????????????????????????????
//? Inicializa variaveis para campos Memos Virtuais						 ?
//????????????????????????????????????????????????????????????????????????
If Type("aMemos")=="A"
	For nX := 1 To Len(aMemos)
		cMemo := aMemos[nX][2]
		If ExistIni(cMemo)
			&cMemo := InitPad(SX3->X3_RELACAO)
		Else
			&cMemo := ""
		EndIf
	Next nX
EndIf

If SetMDIChild()
	oMainWnd:ReadClientCoors()
	nTop := 40
	nLeft := 30
	nBottom := oMainWnd:nBottom-80
	nRight := oMainWnd:nRight-70
Else
	nTop := 135
	nLeft := 0
	nBottom := TranslateBottom(.T.,28)
	nRight := 632
EndIf

DEFINE MSDIALOG oDlg TITLE cCadastro FROM aSize[7],0 TO aSize[6],aSize[5] OF oMainWnd PIXEL
oFolder := TFolder():New( 3,,{STR0032,STR0033},{STR0032,STR0033},oDlg,,,,.t.,.F.,oDlg:nWidth,oDlg:nHeight,)	 // "Grade"###"E-Commerce"###"Grade"###"E-Commerce"
oFolder:align := CONTROL_ALIGN_ALLCLIENT

RegToMemory( "SB4",.F.,.F., .F. ,ProcName( 7 ) )
AEval( aSB4Cpos, { | x | IIf( ( X3Uso( Eval( bGetSx3, x , "X3_USADO" ) ) ) .And. ( Eval( bGetSx3, x , "X3_NIVEL" ) <= cNivel ) , Aadd( aSB4Enc, x ) , Nil ) } )

oEnc01 := MsmGet():New( "SB4", nReg, 2,/*aCRA*/,/*cLetras*/,/*cTexto*/, aSB4Enc/*aCpoEnch*/, aPosObj[ 1 ],/*aAlterEnch*/,/*nModelo*/,/*nColMens*/,/*cMensagem*/, /*cTudoOk*/,  oFolder:aDialogs[1] ,/*lF3*/, .F./*lMemoria*/,/*lColumn*/, caTela/*caTela*/,/*lNoFolder*/,/*lProperty*/,  /*aField*/, , /*lCreate*/,/*lNoMDIStretch*/) 
oGet1  := MsNewGetDados():New( aPosObj[2,1]	,aPosObj[2,2]	,aPosObj[2,3]	,aPosObj[2,4]	, 2 , "A550LinOK" , "A550TUDOK"	 ,, aAlter, 000, Len( aCols ),,,,  oFolder:aDialogs[1] , aHeader, aCols )

If lComplECom
	aGETS := {}
	aTELA := {}
	lFound := MHH->( dbSeek( FWxFilial( "MHH" ) + SB4->B4_COD ) )
	nRegMHH:= IIf( lFound, MHH->( Recno() ), 0 )
	
	RegToMemory( "MHH", !lFound, .F., .F., ProcName() )
	AEval( aMHHCpos, { | x | IIf( ( X3Uso( Eval( bGetSx3, x , "X3_USADO" ) ) ) .And. ( Eval( bGetSx3, x , "X3_NIVEL" ) <= cNivel ) , Aadd( aMHHEnc, x ) , Nil ) } )

	oEnc02 := MsmGet():New( "MHH",nRegMHH, 2,/*aCRA*/,/*cLetras*/,/*cTexto*/, aMHHEnc/*aCpoEnch*/, aPosObj[ 1 ] ,/*aAlterEnch*/,/*nModelo*/,/*nColMens*/,/*cMensagem*/, /*cTudoOk*/,  oFolder:aDialogs[2] ,/*lF3*/, .F./*lMemoria*/,/*lColumn*/, caTela1 /*caTela*/,/*lNoFolder*/,/*lProperty*/,  /*aField*/, , /*lCreate*/,/*lNoMDIStretch*/ ) 
EndIf

ACTIVATE MSDIALOG oDlg CENTERED ON INIT ( EnchoiceBar(oDlg,{|| nOpca := 1,oDlg:End()},{||oDlg:End()}) , AlignObject( oDlg, { oEnc01:oBox, oGet1:oBrowse }, 1 ) )

RestArea(aArea)
Return nOpca

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Inclui³ Autor ³ Andy Pudja | Varejo   ³ Data ³ 15/02/17 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa de inclusao de Grade de Produtos                  ³±±
±±³          ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ Void A550Inclui(ExpC1,ExpN1,ExpN2)                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Alias do arquivo                                   ³±±
±±³          ³ ExpN1 = Numero do registro                                 ³±±
±±³          ³ ExpN2 = Opcao selecionada                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

FUNCTION A550Inclui(cAlias, nReg, nOpc)
Local lECommerce:= SuperGetMV("MV_LJECOMM",.F.,.F.) 
Local lComplECom:= SuperGetMV("MV_LJGRMHH",.F.,.F.) .And. TableInDic("MHH") 
Local aArea    := GetArea(cAlias)
Local aSvRot   := Nil
Local cMemo    := ""
Local nX       := 0
Local nOpcA    := 0
Local bCampo   := {|nCPO| Field(nCPO) }
Local bOk2     := {|| .T.}
Local bOk3     := {|| a550Refresh(oFolder)}
Local oDlg     
Local aObjects    := {}
Local aSize       := {} 
Local aInfo       := {}
Local aPosObj     := {}  
Local i
Local oFolder

Private oEnc01
Private oEnc02
Private aTELA:=Nil,aGets:= Nil

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Array utilizado para salvar o aRotina original.              ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Private aBackRotina := aClone(aRotina)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta a entrada de dados do arquivo                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Private cLinha
Private cColuna

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta a entrada de dados do arquivo                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Private aHeader[0] 

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Muda o valor do aRotina para nao incluir linha na GetDados   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aRotina[4]:={ OemToAnsi(STR0005),"A550Altera",0,6}	//"Alterar"

DEFAULT nOpc   := If (nOpc == Nil,3,nOpc)
DEFAULT nReg    := (cAlias)->(RecNO())

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Inicializando variaveis para a enchoice                      ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
bCampo := { |nCPO| Field(nCPO) }
dbSelectArea("SB4")

FOR i := 1 TO FCount()
	M->&(EVAL(bCampo,i)) := FieldGet(i)
	If ExistIni(Eval(bCampo,i))
		If Trim(Eval(bcampo,i)) == "B4_LINHA" .Or. Trim(Eval(bcampo,i)) == "B4_COLUNA"
			M->&(EVAL(bCampo,i)) := InitPad(SX3->X3_RELACAO)
			If ValType(M->&(EVAL(bCampo,i))) = "C"
				M->&(EVAL(bCampo,i)) := PADR(M->&(EVAL(bCampo,i)),SX3->X3_TAMANHO)
			Endif
		Else
			M->&(EVAL(bCampo,i)) := InitPad(SX3->X3_RELACAO)
		Endif
	Else
		If ValType(M->&(EVAL(bCampo,i))) == "C"
			If Trim(Eval(bCampo,i)) == "B4_COD"
				M->&(EVAL(bCampo,i)) := SPACE(nTamRef)
			Else
				M->&(EVAL(bCampo,i)) := SPACE(LEN(M->&(EVAL(bCampo,i))))
			Endif
		ElseIf ValType(M->&(EVAL(bCampo,i))) == "N"
			M->&(EVAL(bCampo,i)) := 0
		ElseIf ValType(M->&(EVAL(bCampo,i))) == "D"
			M->&(EVAL(bCampo,i)) := cTod("  /  /  ")
		ElseIf ValType(M->&(EVAL(bCampo,i))) == "L"
			M->&(EVAL(bCampo,i)) := .F.
		EndIf
	EndIf
	AADD(aCampos,Substr(FieldName(i),3))
Next i

dbSelectArea("SB4")
dbSetOrder(1)

lRetorna:=a550Masc()
If !lRetorna
	Return .f.
Endif

// Monta a entrada de dados do arquivo							 
If nOpc == Nil
	nOpc := 3
	If Type("aRotina") == "A"
		aSvRot := aClone(aRotina)
	EndIf
	Private aRotina := { { " "," ",0,1 } ,{ " "," ",0,2 },{ " "," ",0,3 } }
EndIf

RegToMemory(cAlias, .T. , .F. )
If lComplECom
	RegToMemory("MHH" , .T. , .F. )
EndIf

If Type("aMemos")=="A"
	For nX :=1 To Len(aMemos)
		cMemo := aMemos[nX][2]
		If ExistIni(cMemo)
			&cMemo := InitPad(SX3->X3_RELACAO)
		Else
			&cMemo := ""
		EndIf
	Next nX
EndIf

aSize := MsAdvSize()       
		
aObjects := {}
AAdd( aObjects, { 100, 100, .T., .T. } )
aInfo    := { aSize[1], aSize[2], aSize[3], aSize[4], 2, 2 } 

aPosObj := MsObjSize(aInfo,aObjects,.T.)

DEFINE MSDIALOG oDlg TITLE cCadastro FROM aSize[7],0 TO aSize[6],aSize[5] OF oMainWnd PIXEL
If lComplECom
	oFolder := TFolder():New(13,,{STR0032,STR0033},{STR0032,STR0033},oDlg,,,,.t.,.F.,oDlg:nWidth,oDlg:nHeight,)	 // "Grade"###"E-Commerce"###"Grade"###"E-Commerce"
	oFolder:bSetOption := {|nAtu| A550_MudaEnc(nAtu,oFolder:nOption)}
	oFolder:align:= CONTROL_ALIGN_ALLCLIENT
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Enchoice 01                                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aPos:={}
dbSelectArea("SB4")
oEnc01:= MsMGet():New("SB4" ,nReg,nOpc,,,,,aPosObj[1],,,,,.T.,If(!lComplECom,oDlg,oFolder:aDialogs[1]),,.F.)
oEnc01:oBox:align:= CONTROL_ALIGN_ALLCLIENT

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Enchoice 02                                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lComplECom
	dbSelectArea("MHH")
	oEnc02:=MsMGet():New("MHH" ,nReg,nOpc,,,,,aPosObj[1],,,,,.T.,oFolder:aDialogs[2],,.F.)
	nPosCodMHH := AsCan(oEnc02:aENTRYCTRLS,{|x| UPPER(TRIM(x:cReadVar))=="M->MHH_COD"})
	If !Empty(nPosCodMHH)
		oEnc02:AENTRYCTRLS[nPosCodMHH]:bWhen	:= {|| .F.}
	EndIf
	oEnc02:oBox:align:= CONTROL_ALIGN_ALLCLIENT

	aTela := aClone(oEnc02:aTela)
	aGets := aClone(oEnc02:aGets)
EndIf

dbSelectArea("SB4")

ACTIVATE MSDIALOG oDlg ON INIT (EnchoiceBar(oDlg, {|| nOpcA := 1, !lComplECom .Or. Eval(bOk3),;
	 Iif( Obrigatorio(oEnc01:aGets,oEnc01:aTela) .And. (!lComplECom .Or. Obrigatorio(oEnc02:aGets,oEnc02:aTela)) .And.;
	Eval(bOk2,nOpc) .And. Iif(Existblock('MTA550Val'),ExecBlock('MTA550Val', .F., .F.),.T.) , (a550GetInc(nOpc,cAlias), oDlg:End() ), (nOpcA:=3,.F.) ) },;
	{|| nOpcA := 3,oDlg:End()}   ,,)) CENTERED 
	
If aSvRot != Nil
	aRotina := aClone(aSvRot)
EndIf

RestArea(aArea)
Return nOpca


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Altera³ Autor ³ Andy Pudja | Varejo   ³ Data ³ 15/02/17 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa de alteracao de Grade de Produtos                 ³±±
±±³          ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ Void A550Altera(ExpC1,ExpN1,ExpN2)                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Alias do arquivo                                   ³±±
±±³          ³ ExpN1 = Numero do registro                                 ³±±
±±³          ³ ExpN2 = Opcao selecionada no menu                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
FUNCTION A550Altera(cAlias,nReg,nOpc)
Local lECommerce:= SuperGetMV("MV_LJECOMM",.F.,.F.) 
Local lComplECom:= SuperGetMV("MV_LJGRMHH",.F.,.F.) .And. TableInDic("MHH") 
Local aCampos    	:= {}
Local nRegMHH			:= 0
Local nX         	:= 0
Local aArea			:= GetArea()
Local bCampo   		:= {|nCPO| Field(nCPO) }
Local bOk2     		:= {|| .T.}
Local cCpoFil  		:= PrefixoCpo(cAlias)+"_FILIAL"
Local cMemo    		:= ""
Local nOpcA    		:= 0
Local oDlg
Local aObjects    := {}
Local aSize       := {} 
Local aInfo       := {}
Local aPosObj     := {}  
Local nG
Local oFolder
Local cSaveMenuh,nCnt,nColunas:=1,nLinhas:=0,cCampo2:=""
Local lRetorna := .T.

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Array utilizado para salvar o aRotina original.              ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local aBackRotina:=aClone(aRotina)
Local oDlg,oGet
Local i        := 0 

Private aHeader[0] 
Private cLinha
Private cColuna
Private oEnc01
Private oEnc02
Private aTELA:= NIL,aGets:=NIL
Private aProdDel:= {}

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Muda o valor do aRotina para nao incluir linha na GetDados   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aRotina[3]:={OemToAnsi(STR0004),"A550ECI",0,6}	//"Incluir"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se existe algum dado no arquivo                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)
If LastRec() == 0
	Return .T.
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se esta' na filial correta                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If FWxFilial("SB4") != B4_FILIAL
	Help(" ",1,"A000FI")
	Return .T.
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta a entrada de dados do arquivo                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//Private aTELA[0][0],aGETS[0],aHeader[0],Continua:=.F.,nUsado:=0

If ExistBlock('MTA550A')
	ExecBlock('MTA550A', .F., .F.)
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta dados Enchoice                                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SB4")
M->B4_COD   :=Substr(B4_COD,1,nTamRef)
M->B4_LINHA :=B4_LINHA
M->B4_COLUNA:=B4_COLUNA
M->B4_PRV2  :=B4_PRV2
M->B4_PRV3  :=B4_PRV3
M->B4_PRV4  :=B4_PRV4
M->B4_PRV5  :=B4_PRV5
M->B4_PRV6  :=B4_PRV6
M->B4_PRV7  :=B4_PRV7

SX3->(dbSetOrder(2))
FOR i := 1 TO FCount()
	If  !Substr(FieldName(i),3) $ "_COD/_PRV2/_PRV3/_PRV4/_PRV5/_FILIAL/_PRV6/_PRV7/_LINHA/_COLUNA"
		cCampo2 := "M->B4" +Substr(FieldName(i),3)
		AADD(aCampos,Substr(FieldName(i),3))
		&cCampo2 := &("B4" + Substr(FieldName(i),3))
	Endif
Next i
M->B4_DESC  :=SB4->B4_DESC
SX3->(dbSetOrder(1))


//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se a Mascara esta correta                   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
cLinha  := M->B4_LINHA
cColuna := M->B4_COLUNA
lRetorna:=a550Masc()
If !lRetorna
	Return .f.
Endif

bCampo := {|nCPO| Field(nCPO) }

INCLUI := .F.
ALTERA := .T.

If lComplECom
	MHH->(DbSetOrder(1))
	If MHH->(DbSeek(xFilial("MHH")+SB4->B4_COD))
		nRegMHH := MHH->(Recno())
	EndIf
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ajusta a largura para o tamanho padrao Protheus ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aSize := MsAdvSize()       
		
aObjects := {}
AAdd( aObjects, { 100, 100, .T., .T. } )
aInfo    := { aSize[1], aSize[2], aSize[3], aSize[4], 2, 2 } 

aPosObj := MsObjSize(aInfo,aObjects,.T.)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³VerIfica se esta' alterando um registro da mesma filial               ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
DbSelectArea(cAlias)
If (cAlias)->(FieldPos(cCpoFil))==0 .Or. (cAlias)->(FieldGet(FieldPos(cCpoFil))) == xFilial(cAlias)
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Monta a entrada de dados do arquivo						     ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If SoftLock(cAlias) .AND. Iif(!Empty(nRegMHH),SoftLock("MHH"),.T.)
		RegToMemory(cAlias,.F.,.F.)
		If !Empty(nRegMHH)
			RegToMemory("MHH",.F.,.F.)
		Else
			RegToMemory("MHH",.T.,.T., .T.)
		EndIf

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Inicializa variaveis para campos Memos Virtuais		 			  ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If Type("aMemos")=="A"
			For nX:=1 to Len(aMemos)
				cMemo := aMemos[nX][2]
				If ExistIni(cMemo)
					&cMemo := InitPad(SX3->X3_RELACAO)
				Else
					&cMemo := ""
				EndIf
			Next nX
		EndIf
		
		DEFINE MSDIALOG oDlg TITLE cCadastro FROM aSize[7],0 TO aSize[6],aSize[5] OF oMainWnd PIXEL
		If lComplECom
			oFolder := TFolder():New(13,,{STR0032,STR0033},{STR0032,STR0033},oDlg,,,,.t.,.F.,oDlg:nWidth,oDlg:nHeight,) // "Dados padrões"###"E-Commerce"
			oFolder:bSetOption := {|nAtu| A550_MudaEnc(nAtu,oFolder:nOption)}
			oFolder:align:= CONTROL_ALIGN_ALLCLIENT
		EndIf
		
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Enchoice 01                                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		aPos:={}
		dbSelectArea("SB4")
		oEnc01:= MsMGet():New("SB4",nReg,nOpc,,,,,aPosObj[1],,,,,,If(!lComplECom,oDlg,oFolder:aDialogs[1]))
		oEnc01:oBox:align:= CONTROL_ALIGN_ALLCLIENT

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Enchoice 02                                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If lComplECom
			dbSelectArea("MHH")
			oEnc02:=MsMGet():New("MHH",nReg,nOpc,,,,,aPosObj[1],,,,,,oFolder:aDialogs[2])
			nPosCodMHH  := AsCan(oEnc02:aENTRYCTRLS,{|x| UPPER(TRIM(x:cReadVar))=="M->MHH_COD"})
			If !Empty(nPosCodMHH)
				oEnc02:AENTRYCTRLS[nPosCodMHH]:bWhen	:= {|| .F.}
			EndIf                                              
			oEnc02:oBox:align:= CONTROL_ALIGN_ALLCLIENT
			aTela := aClone(oEnc02:aTela)
			aGets := aClone(oEnc02:aGets)
			For nG := 1 TO Len(oEnc02:aGets)
				aADD(aGets,oEnc02:aGets[nG])
			Next nG
		EndIf
		
		ACTIVATE MSDIALOG oDlg ON INIT (EnchoiceBar(oDlg,{|| nOpcA := 1,;
			If(Obrigatorio(oEnc01:aGets,oEnc01:aTela) .And. (!lComplECom .Or. Obrigatorio(oEnc02:aGets,oEnc02:aTela)) .And.;
			Eval(bOk2,nOpc),  (a550GetAlt(cAlias),oDlg:End()),   (nOpcA:=3,.f.))},;
			{|| nOpcA := 3,oDlg:End()},,,nReg,cAlias))

	Else
		nOpcA := 3
	EndIf
Else
	Help(" ",1,"A000FI")
	nOpcA := 3
EndIf


//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Restaura aRotina Original                                    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aRotina:=aClone(aBackRotina)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Restaura a integridade da janela                             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Restaura a integridade dos dados                                  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
MsUnLockAll()
RestArea(aArea)

Return nOpca

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Deleta³ Autor ³ Rosane Luciane Chene  ³ Data ³ 08/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa de delecao de Grade de Produtos                   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ A550Deleta(ExpC1,ExpN1,ExpN2)                              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Alias do arquivo                                   ³±±
±±³          ³ ExpN1 = Numero do registro                                 ³±±
±±³          ³ ExpN2 = Numero da opcao selecionada                        ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MAT550                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
FUNCTION A550Deleta(cAlias,nReg,nOpc)
Local lECommerce:= SuperGetMV("MV_LJECOMM",.F.,.F.) 
Local lComplECom:= SuperGetMV("MV_LJGRMHH",.F.,.F.) .And. TableInDic("MHH") 
Local aHeaderOri := {}
Local aColsOri   := {}
Local cSaveMenuh,nCnt,nColunas:=1,nLinhas:=0,cProduto:=""
Local lRet:=.T.,aDeleAux:={},lRetorna:=.T.
Local oDlg,oGet
Local aPos   := {15,1,70,315}
Local i      := 0
Local nCont  := 0
Local nBusca := 0
Local nRecnoSM0 := SM0->(RecNo())
Local aSM0CodFil:= {}
Local aObjects  := {}
Local aSize     := {} 
Local aInfo     := {}
Local aPosObj   := {}
Local lPEVex	:= .T.
Local lMTA550E 	:= ExistBlock('MTA550E')
Local lIntegDef	:= FWHasEAI("MATA550",.T.,,.T.)

Local aArea    := GetArea()
Local nOpcA    := 3
Local cCpoFil  := PrefixoCpo(cAlias)+"_FILIAL"
Local cMemo    := ""
LOcal nX       := 0
Local oDlg
Local nTop
Local nLeft
Local nBottom
Local nRight
Local nRegMHH		:= 0

Local oFolder
Private oEnc01
Private oEnc02
Private aTELA:=NIL,aGets:=NIL

Private Altera :=.F.
Private Inclui :=.F.

DEFAULT cAlias	:= Alias()
DEFAULT nReg 	:= SB4->(Recno())
DEFAULT nOpc	:= 2

dbSelectArea("SM0")
dbGoTop()
do While ! Eof()
	If SM0->M0_CODIGO == cEmpAnt
		Aadd(aSM0CodFil, xFilial("SM0"))
	Endif
	dbSkip()
Enddo
dbGoto(nRecnoSM0)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se existe algum dado no arquivo                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)
If LastRec() == 0
	Return .T.
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se esta' na filial correta                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If FWxFilial("SB4") != B4_FILIAL
	Help(" ",1,"A000FI")
	Return .T.
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Montagem do aHeader e aCols                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SB4")
FillGetDados(4,cAlias,1,/*cSeek*/,/*{|| &cWhile }*/,{|| .T. },/*aNoFields*/,/*aYesFields*/,/*lOnlyYes*/,/*cQuery*/,{|| MontaCols() })

If lComplECom
	MHH->(DbSetOrder(1))
	If MHH->(DbSeek(xFilial("MHH")+SB4->B4_COD))
		nRegMHH := MHH->(RecNo())
	EndIf
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ajusta a largura para o tamanho padrao Protheus ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aSize := MsAdvSize()       	
aObjects := {}                                            
AADD(aObjects,{100,050,.T.,.F.,.F.})
AADD(aObjects,{100,100,.T.,.T.,.F.})
aInfo    := {aSize[1],aSize[2],aSize[3],aSize[4],2,2 } 

aPosObj:=MsObjSize(aInfo,aObjects)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta a entrada de dados do arquivo						     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
RegToMemory(cAlias, .F., .F. )
If !Empty(nRegMHH)
	RegToMemory("MHH",.F. , .F. )
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Inicializa variaveis para campos Memos Virtuais						 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If Type("aMemos")=="A"
	For nX := 1 To Len(aMemos)
		cMemo := aMemos[nX][2]
		If ExistIni(cMemo)
			&cMemo := InitPad(SX3->X3_RELACAO)
		Else
			&cMemo := ""
		EndIf
	Next nX
EndIf

If SetMDIChild()
	oMainWnd:ReadClientCoors()
	nTop := 40
	nLeft := 30
	nBottom := oMainWnd:nBottom-80
	nRight := oMainWnd:nRight-70
Else
	nTop := 135
	nLeft := 0
	nBottom := TranslateBottom(.T.,28)
	nRight := 632
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Posiciona ponteiro do arquivo cabeca e inicializa variaveis  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ExistBlock( "A550EXC" )
	aHeaderOri := aClone(aHeader)
	aColsOri   := aClone(aCols)
	ExecBlock( "A550EXC", .F., .F. , { aHeader,aCols })
EndIf

DEFINE MSDIALOG oDlg TITLE cCadastro FROM aSize[7],0 TO aSize[6],aSize[5] OF oMainWnd PIXEL
If lComplECom
	oFolder := TFolder():New(13,,{STR0032,STR0033},{STR0032,STR0033},oDlg,,,,.t.,.F.,oDlg:nWidth,oDlg:nHeight,)	 // "Grade"###"E-Commerce"###"Grade"###"E-Commerce"
	oFolder:align:= CONTROL_ALIGN_ALLCLIENT
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Enchoice 01                                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SB4")
oEnc01:=MsMGet():New("SB4",nReg  ,nOpc,,,,/*aAcho*/,aPosObj[1],,,,,,If(!lComplECom,oDlg,oFolder:aDialogs[1]))
oEnc01:oBox:align:= CONTROL_ALIGN_ALLCLIENT

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Enchoice 02                                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lComplECom
	dbSelectArea("MHH")
	oEnc02:=MsMGet():New("MHH",nRegMHH,nOpc,,,,/*aAcho*/,aPosObj[1],,,,,,oFolder:aDialogs[2])
	oEnc02:oBox:align:= CONTROL_ALIGN_ALLCLIENT
EndIf

dbSelectArea("SB4")
ACTIVATE MSDIALOG oDlg ON INIT EnchoiceBar(oDlg,{|| nOpcA := 1,oDlg:End()},{|| nOpcA := 2,oDlg:End()},,)	


If nOpcA == 1
	If ExistBlock( "A550EXC" )
		aHeader := aClone(aHeaderOri)
		aCols   := aClone(aColsOri)
	EndIf

	For nLinhas:=1 to Len(Acols)
		For nColunas:=1 to Len(aHeader)-2
			If aCols[nLinhas][nColunas] == "X"
				cProduto := Substr(SB4->B4_COD,1,nTamRef) + Substr(aCols[nLinhas][1],2,nTamLin) + Substr(aHeader[nColunas][1],2,nTamCol)
				cProduto := cProduto + Space(nTamCod - Len(cProduto) )
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ verifica se algum produto nao pode ser deletado        ³
				//³ por estar sendo usado em outro arquivo do sistema      ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				lRet:=a550Prod(cProduto)
				If !lRet
					Exit
				Else
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³ Armazena os produtos que serao deletados ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					AADD(aDeleAux,cProduto)
				Endif
			Endif
		Next nColunas
		If !lRet
			Exit
		Endif
	Next nLinhas
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Se todos os produtos desta referencia podem ser        ³
	//³ deletados, entao sera apagado os registros do arquivo  ³
	//³ SB1(Cadastro de Produtos) e SB4(Cadastro de Referencias³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Ponto de Entrada para validar a exclusao da grade de   ³
	//³ produtos                                               |
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

	If lRet .And. ExistBlock("MT550VEX")
		If ValType(lPEVex:=ExecBlock("MT550VEX",.F.,.F.))<>"L"
			lPEVex:=.T.
		EndIf
		lRet := lPEVex 
	EndIf

	Begin Transaction
		If lRet .And. lIntegDef
			aRetInt := FwIntegDef("MATA550",,,,"MATA550")
			If Valtype(aRetInt) == "A" .And. Len(aRetInt) == 2 .And. !aRetInt[1]
				If Empty(AllTrim(aRetInt[2]))
					cMsgRet := STR0034 //-- Verificar problema no Monitor EAI.
				Else
					cMsgRet := AllTrim(aRetInt[2])
				EndIf
				Help(,,"EAIERR",,cMsgRet)
				lRet := .F.
			EndIf
		
		EndIf
		
		If lRet
			dbSelectArea("SB4")
			RecLock("SB4",.F.,.T.)
			dbDelete()
	
			If lComplECom
				dbSelectArea("MHH")
				RecLock("MHH",.F.,.T.)
				dbDelete()
			EndIf
			
			For nCont:=1 to Len(aDeleAux)
				//-- Apaga registros de saldo
				dbSelectArea("SB2")
				dbSetOrder(1)
				aFiliais := If(! Empty(xFilial("SB2")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SB2")})
				For nBusca := 1 to Len(aFiliais)
					dbSeek(aFiliais[nBusca]+aDeleAux[nCont])
					While !EOF() .And. aFiliais[nBusca]+aDeleAux[nCont] == B2_FILIAL+B2_COD
						RecLock("SB2",.F.,.T.)
						dbDelete()
						dbSkip()
					EndDo
				Next
				
				//-- Apaga registro de demandas
				dbSelectArea("SB3")
				dbSetOrder(1)
				aFiliais := If(!Empty(xFilial("SB3")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SB3")})
				For nBusca := 1 to Len(aFiliais)
					dbSeek(aFiliais[nBusca]+aDeleAux[nCont])
					If Found()
						RecLock("SB3",.F.,.T.)
						dbDelete()
					EndIf
				Next
	            
				//-- Apaga complemento de produto
				dbSelectArea("SB5")
				dbSetOrder(1)
				aFiliais := If(! Empty(xFilial("SB5")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SB5")})
				For nBusca := 1 to Len(aFiliais)
					dbSeek(aFiliais[nBusca]+aDeleAux[nCont])
					If Found()
						RecLock("SB5",.F.,.T.)
						dbDelete()
					EndIf
				Next
				
				//-- Apaga produto X fornecedor
				dbSelectArea("SA5")
				dbSetOrder(2)
				aFiliais := If(! Empty(xFilial("SA5")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SA5")})
				For nBusca := 1 to Len(aFiliais)
					dbSeek(aFiliais[nBusca]+aDeleAux[nCont])
					While !EOF() .And. aFiliais[nBusca] == A5_FILIAL .and. aDeleAux[nCont] == A5_PRODUTO
						RecLock("SA5",.F.,.T.)
						dbDelete()
						dbSkip()
					EndDo
				Next
				dbSetOrder(1)
				
				dbSelectArea("SB9")
				aFiliais := If(! Empty(xFilial("SB9")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SB9")})
				For nBusca := 1 to Len(aFiliais)
					dbSeek(aFiliais[nBusca]+aDeleAux[nCont])
					While !Eof() .And. aFiliais[nBusca]+aDeleAux[nCont]==B9_FILIAL+B9_COD
						If B9_QINI == 0
							RecLock("SB9",.F.,.T.)
							dbDelete()
						Endif
						dbSkip()
					End
				Next

				// Integração com o MRP Memória
				If integraMRP() 
					mrpIntGrd(Nil, Nil, aDeleAux[nCont])
				EndIf
				
				//-- Apaga produto
				dbSelectArea("SB1")
				dbSetOrder(1)
				dbSeek(xFilial("SB1")+aDeleAux[nCont])
				If Found()
					RecLock("SB1",.F.,.T.)
					dbDelete()
					aRetInt := FwIntegDef("MATA010",,,,"MATA010")
				
					If Valtype(aRetInt) == "A"
						If Len(aRetInt) == 2
							If !aRetInt[1]
								If Empty(AllTrim(aRetInt[2]))
									cMsgRet := "Verificar problema no Monitor EAI"
								Else
									cMsgRet := AllTrim(aRetInt[2])
								EndIf
								Aviso("Atenção",cMsgRet,{"Ok"},3)
								
								lRet := .F.
								Exit
							EndIf
						EndIf
					EndIf
				Endif
	
				If nModulo == 12 .OR. nModulo == 72 // SIGALOJA OU SIGAPHOTO
					dbSelectArea("SB0")
					dbSeek(xFilial("SB0")+aDeleAux[nCont])
					If Found()
						RecLock("SB0",.F.,.T.)
						dbDelete()
					Endif
				Endif
				If lMTA550E 
					ExecBlock('MTA550E', .F., .F.)
				EndIf
			Next
		Endif
		If !lRet
			DisarmTransaction()
		EndIf
	End Transaction
Endif
dbSelectArea(cAlias)
Return nOpca
/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550GetInc³ Autor ³ Rosane Luciane Chene  ³ Data ³ 08/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa da getdados da inclusao                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ A550GetInc(ExpC1,ExpC2)                                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = tipo de opcao                                      ³±±
±±³          ³ ExpC2 = nome do arquivo                                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MAT550                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function a550GetInc(nOpc,cAlias)
Local aHeaderOri := {}
Local aColsOri := {}
Local nColunas :=1
Local nPosHead := 0
Local nPosCols := 0
Local nX       := 0
Local nY       := 0
Local oDlg,oGet
Local i:=0 
Local aButtons := {}
Local lRet		:= .T. //Retorno da rotina

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Restaura o aRotina alterado por consultas padrao      ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aRotina := aClone(aBackRotina)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Controla se o numero da linha ou da tabela foram alterados pelo usua -³
//³rio para refazer a getdados com novas linhas e novas colunas          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
cLinha  := M->B4_LINHA
cColuna := M->B4_COLUNA

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Montagem do aHeader e aCols                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SB4")
FillGetDados(nOpc,cAlias,1,/*cSeek*/,/*{|| &cWhile }*/,{|| .T. },/*aNoFields*/,/*aYesFields*/,/*lOnlyYes*/,/*cQuery*/,{|| MontaCols() })

If ExistBlock( "A550INC" )
	aHeaderOri := aClone(aHeader)
	aColsOri   := aClone(aCols)
	ExecBlock( "A550INC", .F., .F. , { aHeader,aCols })
EndIf

nColunas:= 1
DEFINE MSDIALOG oDlg TITLE cCadastro FROM 9,0 TO 28,80 OF oMainWnd
@ 1.4 ,.8  SAY OemToAnsi(STR0007) 		//"C¢digo: "
@ 1.4 ,4   SAY M->B4_COD
oGet  := MSGetDados():New(32,1,133,315,4,"a550LinOk","a550TudOk","",.T.,aAlter)
nOpca := 0

If ExistBlock( "A550BUT" )
	aButtons := ExecBlock("A550BUT",.F.,.F.,{oDlg, oGet })
	If ValType(aButtons) <> "A"
		aButtons := {}
	EndIf
EndIf

ACTIVATE MSDIALOG oDlg ON INIT EnchoiceBar(oDlg,{||nOpca:=1,if(oGet:TudoOk(),oDlg:End(),nOpca := 0)},{||oDlg:End()},,aButtons)


If nOpcA == 1
	If ExistBlock( "A550INC" )
		For nY := 1 to Len(aCols)
			nPosCols := Ascan(aColsOri,{|x| x[1] == aCols[nY][1]})
			If nPosCols > 0
				For nX := 1 to Len(aHeader)
					nPosHead := Ascan(aHeaderOri,{|x| x[1] == aHeader[nX][1]})
					If nPosHead <> 0
						aColsOri[nPosCols][nPosHead] := aCols[nY][nX]
					Endif
				Next
			Endif
		Next
		aCols   := aClone(aColsOri)
		aHeader := aClone(aHeaderOri)
	Endif

	lRet:=a550Digit()
	If !lRet
		Return nOpca
	Endif

	Begin Transaction
		lRet := A550Grava(cAlias,.T.)
		If !lRet
			DisarmTransaction()
			Break
		Else	
			//Processa Gatilhos
			EvalTrigger()
		EndIf
		
		
	End Transaction
Endif

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550GetAlt³ Autor ³ Rosane Luciane Chene  ³ Data ³ 08/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa da getdados da alteracao                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ A550GetAlt(ExpC1)                                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³          ³ ExpC1 = nome do arquivo                                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MAT550                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550GetAlt(cAlias)

Local aHeaderOri := {}
Local aColsOri   := {}  
Local aAuxDel    := {}
Local aButtons   := {}
Local cProduto   := ""
Local i          := 0	
Local nPosHead   := 0
Local nPosCols   := 0
Local nY         := 0
Local nX         := 0
Local nLinhas    := 0
Local nColunas   := 0
Local oDlg, oGet

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Exclui os produtos da tabela antiga                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If Type("aProdDel") <> "U" .And. Len( aProdDel ) > 0
	For nX := 1 to Len( aProdDel )
		If !Empty(aProdDel[nX])
			a550Del(aProdDel[nX])
		Endif
	Next nX
Endif

dbSelectArea("SX2")
dbSeek(cAlias)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta o AHEADER.                                             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If cLinha != M->B4_LINHA .Or. cColuna != M->B4_COLUNA .Or. Empty(aHeader)

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Montagem do aHeader e aCols                           ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	dbSelectArea("SB4")
	FillGetDados(4,cAlias,1,/*cSeek*/,/*{|| &cWhile }*/,{|| .T. },/*aNoFields*/,/*aYesFields*/,/*lOnlyYes*/,/*cQuery*/,{|| MontaCols() })

	If ExistBlock( "A550ALT" )
		aHeaderOri := aClone(aHeader)
		aColsOri   := aClone(aCols)
		ExecBlock( "A550ALT", .F., .F. , { aHeader,aCols })
	EndIf

Endif
nOpca := 0
DEFINE MSDIALOG oDlg TITLE cCadastro FROM 9,0 TO 28,80 OF oMainWnd
@ 1.4 ,.8  SAY OemToAnsi(STR0007) 		//"C¢digo: "
@ 1.4 ,4   SAY M->B4_COD
oGet := MSGetDados():New(32,1,133,300,3,"a550LinOk","a550TudOk","",.T.,aAlter)

If ExistBlock( "A550BUT" )
	aButtons := ExecBlock("A550BUT",.F.,.F.,{ oDlg, oGet } )
	If ValType(aButtons) <> "A"
		aButtons := {}
	EndIf
EndIf

ACTIVATE MSDIALOG oDlg ON INIT EnchoiceBar(oDlg,{||iif(oGet:TudoOk() ,(nOpca := 1, oDlg:End()),)},{||oDlg:End()},,aButtons)												   																												  															
If nOpcA == 1   
	If ExistBlock( "A550ALT" )
		For nY := 1 to Len(aCols)
			nPosCols := Ascan(aColsOri,{|x| x[1] == aCols[nY][1]})
			If nPosCols > 0
				For nX := 1 to Len(aHeader)
					nPosHead := Ascan(aHeaderOri,{|x| x[1] == aHeader[nX][1]})
					If nPosHead <> 0
						aColsOri[nPosCols][nPosHead] := aCols[nY][nX]
					Endif
				Next
			Endif
		Next
		aCols   := aClone(aColsOri)
		aHeader := aClone(aHeaderOri)
	Endif

	lRet:=a550Digit()

	// Somente fara esta verificacao se for ALTERACAO do codigo de referencia de grade.
	If lRet .And. ALTERA .And. Substr(SB4->B4_COD,1,nTamRef) # Substr(M->B4_COD,1,nTamRef)
	
		// Evita que os produtos ja cadastrados permanecam na base quando o 
		// codigo de referencia de grade for alterado.	
		For nLinhas:=1 to Len(aCols)
			For nColunas:=2 to Len(aHeader)-2
				cProduto := Substr(SB4->B4_COD,1,nTamRef) + Substr(aCols[nLinhas][1],2,nTamLin) + Substr(aHeader[nColunas][1],2,nTamCol)
				cProduto := cProduto + Space(nTamCod - Len(cProduto) )
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ verifica se algum produto nao pode ser deletado        ³
				//³ por estar sendo usado em outro arquivo do sistema      ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				lRet:=a550Prod(cProduto)
				If !lRet
					Exit
				Else
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³ Armazena os produtos que serao deletados ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					AADD(aAuxDel,cProduto)
				Endif
			Next nColunas
			If !lRet
				Exit
			Endif
		Next nLinhas
		
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Atualiza o array que controla os produtos a serem  excluidos   ³
		//³ apos a confirmacao dos dados                                   ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		For nX := 1 to Len(aAuxDel)
			AADD(aDeleta,aAuxDel[nX])
		Next
	EndIf



	If lRet
		Begin Transaction
			lRet := A550Grava(cAlias,.F.)
		//Processa Gatilhos
			If !lRet
				DisarmTransction()
				Break
			Else
				//Processa Gatilhos
				EvalTrigger()
			EndIf
		End Transaction
	EndIf
Endif
Return

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550LinOk ³ Autor ³ Rosane L. Chene       ³ Data ³ 09/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Critica se a linha digitada esta' Ok                       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Objeto a ser verificado.                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550LinOk(o)
Local lRet := .T.
Local aAuxDel := {}
Local nColunas :=0
Local i := 0 

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se a linha foi deletada   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If aCols[n][Len(Acols[n])]
	For nColunas:=2 to (Len(aHeader)-2)
		cProduto := Substr(M->B4_COD,1,nTamRef) + Substr(aCols[n][1],2,nTamLin) + Substr(aHeader[nColunas][1],2, nTamCol)
		cProduto := cProduto + Space(nTamCod - Len(cProduto) )
		If aCols[n][nColunas] == "X"
			lRet:=a550Prod(cProduto)
			If !lRet
				Exit
			Else
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ Armazena os produtos desta linha que pode ser excluidos        ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				AADD(aAuxDel,cProduto)
			Endif
		Endif
	Next
	If !lRet
		aCols[n][Len(aCols[n])] := .F.
	Else
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Se todos os produtos desta linha podem ser excluidos, entao    ³
		//³ sao armazenados no array que controla os produtos a serem      ³
		//³ excluidos apos a confirmacao dos dados                         ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		For i:=1 to Len(aAuxDel)
			AADD(aDeleta,aAuxDel[i])
		Next
	Endif
Endif

Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550TudOk ³ Autor ³ Rosane L. Chene       ³ Data ³ 07/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Critica se todo o GetDados esta OK                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Objeto a ser verificado.                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550TudOk(o)
Local lRet := a550Digit()
If !lRet
	Aviso(STR0009,STR0010,{"Ok"}) //"Aviso"###"Alguns campos de preenchimento obrigatorio estao em branco. Verifique o preenchimento correto do cadastro."
EndIf
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Digit ³ Autor ³ Rosane L. Chene       ³ Data ³ 07/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Verifica se tem algum ponto de grade preenchido            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Objeto a ser verificado.                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550Digit()
Local nLinhas:=0,nColunas:=0,lRet:=.F.
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se existe pelo menos um campo preenchido  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
For nColunas := 2 to Len(aHeader)
	If	aHeader[nColunas,10]<>"V" //-- Nao verfica Campos Virtuais
		For nLinhas:=1 to Len(aCols)		
			If	(!Empty(aCols[nLinhas][nColunas]) .And. ! GDDeleted( nLinhas ))
				lRet:=.T.
				Exit
			Endif
		Next nLinhas
	EndIf
	If	lRet
		Exit
	Endif
Next nColunas

If !lRet .And. Empty(M->B4_COD)
	lRet:=.T.
Endif

If !lRet
	Help(" ",1,"EXCTODREF")
Endif

Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Grava ³ Autor ³ Rosane Luciane Chene  ³ Data ³ 04/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Grava o Arquivo de Grades de Produtos                      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function A550Grava(cAlias,lInclui)
Local bCampo   := {|nCPO| Field(nCPO) }
Local nx        := 0
Local nAchou    := 0
Local nMaxArray := 0
Local cCampo1   := ''
Local cCampo2   := ''
Local cProduto  := ''
Local aDescLin  := {} //Grade
Local aDescCol  := {} //Grade
Local lAtuRef   := .T.
Local lNovoSb0 	:= .F.
Local lLock 	:= .T.    
Local nColunas  := 0 
Local nLinhas   := 0 
Local lAltSB1	:= .T.
Local lA550ALTB1:= ExistBlock("A550ALTB1")
Local lOrdena   := SuperGetMv("MV_ORDGRDP",.F.,.T.)
Local aTemp     := {} 
Local aProdutos := {}
Local aProdAlt  := {}
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Tratamento para e-Commerce      ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local lECommerce:= SuperGetMV("MV_LJECOMM",.F.,.F.) 
Local lComplECom:= SuperGetMV("MV_LJGRMHH",.F.,.F.) .And. TableInDic("MHH") 
Local lAtuECFld := SB0->(FieldPos("B0_ECDTEX")) > 0 .AND. SB0->(FieldPos("B0_ECSEQ")) > 0 
Local cProdPai	:= "" 
Local lTemSB1   := .T.
Local lAltera 	:= Type("ALTERA") == "L" .And. ALTERA
Local lMTA550G 	:= ExistBlock('MTA550G')
Local lAltComp  := lComplECom .And. MHH->(ColumnPos( "MHH_ECFLAG" )) > 0 //Atualiza complemento produtos
Local lIntegDef	:= FWHasEAI("MATA010",.T.,,.T.)
Local aRetInt		:= {}	
Local lInteg550	:= FWHasEAI("MATA550",.T.,,.T.)
Local lRet		:= .T.

// Grade pegando descricoes
dbSelectArea("SBV")
dbSetOrder(1)
dbSeek(xFilial("SBV")+M->B4_LINHA)
aDescLin:={}
While !Eof() .And. (SBV->BV_TABELA == M->B4_LINHA)
	Aadd(aDescLin,{Alltrim(SBV->BV_DESCRI),SBV->(Recno())})
	dbSkip()
End

dbSeek(xFilial("SBV")+M->B4_COLUNA)
aDescCol:={}
While !Eof() .And. (SBV->BV_TABELA == M->B4_COLUNA)
	Aadd(aDescCol,{Alltrim(SBV->BV_DESCRI),SBV->(Recno())})
	dbSkip()
End

If !lOrdena
	aSort(aDescLin,,,{|x,y| x[2] < y[2]})
	aSort(aDescCol,,,{|x,y| x[2] < y[2]})
Endif

//-- Retorna arrays para 1 dimensao
aEval(aDescLin,{|x| aAdd(aTemp,x[1])})
aDescLin := aClone(aTemp)
aTemp := {}
aEval(aDescCol,{|x| aAdd(aTemp,x[1])})
aDescCol := aClone(aTemp)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Atualiza dados SB4    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)
RecLock('SB4',lInclui)
For nX := 1 to fCount()
	If FieldName(nX) # 'B4_FILIAL'
		FieldPut(nX, &('M->' + FieldName(nX)))
	EndIf
Next nX
SB4->B4_FILIAL := xFilial('SB4')

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Atualiza dados MHH    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lComplECom
	If INCLUI
		M->MHH_COD:=M->B4_COD
		dbSelectArea("MHH")
		dbSetOrder(1)
		If dbSeek(xFilial("MHH")+M->B4_COD)
			RecLock("MHH",.F.)
		Else
			RecLock("MHH",.T.)
		EndIf
	Else
		DBSelectArea("MHH")
		RecLock("MHH",MHH->(Eof()))
		If MHH->(Eof())
			M->MHH_COD:=M->B4_COD
		EndIf
	EndIf
	For nX := 1 TO FCount()
		If MHH->(FieldName(nX)) =="MHH_FILIAL"
			MHH->MHH_FILIAL:= xFilial("MHH")
		Else
			FieldPut(nX,M->&(EVAL(bCampo,nX)))
		EndIf
	Next nX
EndIf

dbSelectArea(cAlias)

If nModulo == 12 .OR. nModulo == 72  .OR. (lECommerce .AND. lAtuECFld )// SIGALOJA OU SIGAPHOTO
	If !(lInclui)
		lAtuRef := MsgYesNo( STR0008 )	// "Atualiza referencia (SB0) ? "
	Endif
Endif

If lAltComp
	lAltComp := MsgYesNo( STR0035 )	// "Atualiza Complemento de produtos (SB5) ?"
EndIf	

If !lInclui .And. lA550ALTB1
	lAltSB1:=ExecBlock("A550ALTB1",.f.,.f.)			
	If ValType(lAltSB1) # "L"
		lAltSB1:=.T.				
	EndIf	
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//Tratamento mensagem unica grade de produto
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lInteg550
	aRetInt := FwIntegDef("MATA550",,,,"MATA550")
	If Valtype(aRetInt) == "A" .And. Len(aRetInt) == 2 .And. !aRetInt[1]
		If Empty(AllTrim(aRetInt[2]))
			cMsgRet := STR0034 //-- Verificar problema no Monitor EAI.
		Else
			cMsgRet := AllTrim(aRetInt[2])
		EndIf
		Help(,,"EAIERR",,cMsgRet)
		
		lRet := .F.
	EndIf
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Atualiza dados SB1    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lRet
	For nLinhas := 1 to Len(aCols)
		For nColunas := 2 to Len(aHeader)-2
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ verifica se esta com X e se a linha na esta deletada   ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If Upper(aCols[nLinhas, nColunas]) == 'X' .And. !(aCols[nLinhas, Len(Acols[nLinhas])])
				lTemSB1 := .T.
				cProduto := Substr(M->B4_COD, 1, nTamRef) + Substr(aCols[nLinhas, 1], 2, nTamLin) + Substr(aHeader[nColunas, 1], 2, nTamCol)
				cProduto := cProduto + Space(nTamCod - Len(cProduto) )
				dbSelectArea('SB1')
				SB1->(dbSetOrder(1))
				If !SB1->(dbSeek(xFilial("SB1") + cProduto, .F.))
					If (lLock := RecLock('SB1', .T.))
						REPLACE B1_COD With cProduto
						REPLACE B1_FILIAL With xFilial("SB1")
						REPLACE B1_GRADE  With 'S'
						AADD(aProdutos,{cProduto})
						lTemSB1 := .F.
					Endif
				Else
			   		AADD(aProdAlt,{cProduto}) // Array para ser utilizado no ponto de entrada qdo for alteracao
					lLock := RecLock('SB1',.F.)
				Endif
	
				If ! lLock
					Help(" ",1,"NAOLOCK")
					Exit
				Endif
	
				If lInclui .Or. (!lInclui .And. lAltSB1)            
				    
					For nX := 1 to FCount()    
				  		cField := StrTran(FieldName(nx), "B1_", "B4_")
						If StrTran(cField, "B4_", "") $ '_COD/_FILIAL/_GRADE/'
							Loop
						Else
							If (nPos := SB4->(FieldPos(cField))) > 0
								&("M->" + cField ) := SB4->(FieldGet(nPos)) 
								cCampo1 := FieldName(nx)
								cCampo2 := 'M->' + cField  
								Replace &cCampo1 With &cCampo2       
								If cCampo1 == "B1_DESC"
									Replace &cCampo1 with Alltrim(&cCampo1) +" "+ aDescLin[nLinhas]+"/"+aDescCol[nColunas-1]
						   		Endif
							Else
								If (lInclui .Or. lAltera) .and. !lTemSB1
									cCampo1 := FieldName(nx)
									If cCampo1 == "B1_PRODPAI" .And. Empty(cProdPai)
										cProdPai := FieldGet(FieldPos(cCampo1))
									EndIf
									&(cCampo1 ) := CriaVar(cCampo1)  
									Replace &cCampo1 With &cCampo1
								EndIf
							Endif    			
	
						Endif
					Next nX		
					
					
				EndIf
			
				*** Grade
				lNovoSb0 := .F.
				If nModulo ==  12 .OR. nModulo == 72 // SIGALOJA OU SIGAPHOTO
					dbSelectArea("SB0")
					SB0->(dbSetOrder(1))
					SB0->(dbSeek(xFilial("SB0")+cProduto))
					If SB0->(Eof())
						RecLock("SB0",.T.)
						Replace B0_COD With cProduto
						Replace B0_FILIAL With xFilial("SB0")
						lNovoSb0 := .T.
					Elseif lAtuRef
						RecLock("SB0",.F.)
					Endif
	
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³ somente atualiza referencia se a grade for alterada e  ³
					//³ quando se deseja transferir este valor para a referen- ³
					//³ cia do produto.                                        ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					If lAtuRef .or. lNovoSb0
						Replace B0_PRV1  With M->B4_PRV1
						Replace B0_PRV2  With M->B4_PRV2
						Replace B0_PRV3  With M->B4_PRV3
						Replace B0_PRV4  With M->B4_PRV4
						Replace B0_PRV5  With M->B4_PRV5
						Replace B0_PRV6  With M->B4_PRV6
						Replace B0_PRV7  With M->B4_PRV7 
						If lECommerce .And. lAtuECFld //Sinaliza os campos de e-commerce para envio da integração
							Replace B0_ECDTEX With ""
							Replace B0_ECSEQ  With ""
						EndIf
						SB0->(MsUnlock())
					Endif
				ElseIf lAtuRef .And. lAtuECFld //Atualizações Campo e-commerce
					dbSelectArea("SB0")
					SB0->(dbSetOrder(1))
					If SB0->(dbSeek(xFilial("SB0")+cProduto))
						RecLock("SB0",.F.)   
						Replace B0_ECDTEX With ""
						Replace B0_ECSEQ  With ""
						SB0->(MsUnlock())
					EndIf
				Endif
	
				//Atualização de complemento de produtos	
				If lAltComp
					SB5->(dbSetOrder(1))//B5_FILIAL+B5_COD
					If SB5->(dbSeek(xFilial("SB5")+cProduto))
						RecLock("SB5",.F.)
					Else
						RecLock("SB5",.T.)					
						Replace SB5->B5_FILIAL With xFilial("SB5")
						Replace SB5->B5_COD    With cProduto	
						Replace SB5->B5_CEME   With SB1->B1_DESC
					EndIf
					If lComplECom
						Replace SB5->B5_ECTITU  	With M->MHH_ECTITU
						Replace SB5->B5_ECDESCR 	With M->MHH_ECDESC
						Replace SB5->B5_ECCARAC  	With M->MHH_ECCARA
						Replace SB5->B5_ECFLAG  	With M->MHH_ECFLAG
						Replace SB5->B5_ECCUBAG  	With M->MHH_ECCUBA
						Replace SB5->B5_ECPROFU  	With M->MHH_ECPROF
						Replace SB5->B5_ECCOMP  	With M->MHH_ECCOMP 
						Replace SB5->B5_ECLARGU  	With M->MHH_ECLARG
					EndIf
					SB5->(MsUnlock())
				EndIf
	
				If lIntegDef .AND. (lInclui .Or. (!lInclui .And. lAltSB1))  .OR.  ( lAltComp .AND. lComplECom)

					If lIntegDef
						aRetInt := FwIntegDef("MATA010",,,,"MATA010")
		
						If Valtype(aRetInt) == "A"
							If Len(aRetInt) == 2
								If !aRetInt[1]
									If Empty(AllTrim(aRetInt[2]))
										cMsgRet := "Verificar problema no Monitor EAI"
									Else
										cMsgRet := AllTrim(aRetInt[2])
									EndIf
									Aviso("Atenção",cMsgRet,{"Ok"},3)
									lRet := .F.
									Exit
								EndIf
							EndIf
						EndIf
					EndIf				
				EndIf
				
				If lRet
					nAchou := aScan(aDeleta, cProduto)
					If nAchou > 0
						aDel(aDeleta, nAchou)
					Endif
				EndIf
			Endif
	
			//-- Executa Ponto de Entrada
			If lMTA550G
				ExecBlock('MTA550G', .F., .F.)
			EndIf
	
		Next nColunas
		If ! lLock
			lRet := .F.
			Exit
		Endif
		If !lRet
			Exit
		EndIf
	Next nLinhas
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Verifica se existe produtos para serem deletados (conforme    ³
//³array aDeleta), ou porque estavam com "X" e agora estao " "   ³
//³ou porque o usuario deletou a linha toda                      ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
For nX := 1 to Len(aDeleta)
	If !Empty(aDeleta[nX])
		a550Del(aDeleta[nX])
	Endif
Next nX

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Ponto de Entrada MT550PG com o código de todos os produtos gravados na Tabela SB1³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ExistBlock('MT550PG')
	ExecBlock('MT550PG', .F., .F.,{aProdutos,aProdAlt})
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Mostra para o usuario os produtos gerados, para o mesmo determinar qual é o      ³
//³ Produto Pai e os Produtos Filhos.(Alteração realizada para integração E-commerce)³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lECommerce
	MT550Sel(cProdPai)
EndIf              

//Integracao Shopify - Adicionado integração com Shopify SHPXFUN.PRW
If cPaisLoc == 'EUA' .AND. SuperGetMv("MV_SHOPIFY",.F.,.F.) .AND. FindFunction("SPYIMAT550")
	SPYIMAT550(aProdutos,aProdAlt)
EndIf

// Integração com o MRP Memória
If integraMRP()
	mrpIntGrd(aProdutos, aProdAlt, Nil)
EndIf

Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Valid ³ Autor ³ Rosane L. Chene       ³ Data ³ 07/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Verifica se Pode desativar o produto                       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550Valid()
Local lRet:=.T.,cAlias:=Alias()
Local cProduto:=""
Local cConteudo:=&(ReadVar()),cVar:=ReadVar()
Local i:=0
Local lRetPE := .T.

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Posiciona na Coluna Correta ³
//³ para verificar conteudo     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
For i:=1 to Len(aHeader)
	If Alltrim(aHeader[i][2]) == Alltrim(Substr(Readvar(),4) )
		Exit
	Endif
Next i

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Caso o usuario digite um caracter != "X", troca para X   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If !Empty(cConteudo) .And. cConteudo != "X"
	aCols[n][i]:="X"
	&cvar:="X"
Endif

If ExistBlock("MA550VCPO")
	lRetPE := ExecBlock("MA550VCPO",.F.,.F.,{i, cConteudo})
	If ValType(lRetPE) == "L"
		lRet := lRetPE
	EndIf
EndIf

If lRet .And. !Inclui
	If aCols[n][i] == "X" .And. (cConteudo == " " .Or. Empty(cConteudo) )
		cProduto := Substr(M->B4_COD,1,nTamRef) + Substr(aCols[n][1],2,nTamLin) + Substr(aHeader[i][1],2,nTamCol)
		cProduto := cProduto + Space(nTamCod - Len(cproduto) )
		dbSelectArea("SB1")
		dbSetOrder(1)
		dbSeek(xFilial("SB1")+cProduto)
		If Found()
			lRet:=a550Prod(cProduto)
			If lRet
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ Armazena os produtos que devem ser excluidos apos a confirmacao³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				AADD(aDeleta,cProduto)
			Endif
		Endif                                                                  
	Endif
Endif
dbSelectArea(cAlias)
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Prod  ³ Autor ³ Rosane L. Chene       ³ Data ³ 07/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Verifica se Pode excluir o produto                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ Codigo do produto a ser excluido                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function a550Prod(cCod)
Local aArea		:= GetArea()
Local cAliasAA3  := ""
Local cAliasAA4  := ""
Local cAliasADB  := ""
Local lErro 	 := .F.
Local lFantasma := .F.
Local nRecnoSM0 := SM0->(RecNo())
Local aSM0CodFil:= {}
Local aFiliais  := {}
Local nBusca	:= 0
Local lRet := .T.
Local cAliasDTC  := ""
Local cAliasDE5  := ""
Local cAliasCNB  := ""

// Preenche um array com as filiais
dbSelectArea("SM0")
dbGoTop()
do While ! Eof()
	If SM0->M0_CODIGO == cEmpAnt
		Aadd(aSM0CodFil, FWGETCODFILIAL)
	Endif
	dbSkip()
Enddo
dbGoto(nRecnoSM0)

dbSelectArea("SB2")      // saldos fisico e financeiro
//dbSetOrder(1)
aFiliais := If(! Empty(xFilial("SB2")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SB2")})
For nBusca := 1 to Len(aFiliais)
	dbSeek(aFiliais[nBusca]+cCod)
	While !EOF() .And. aFiliais[nBusca]+cCod == B2_FILIAL+B2_COD
		If B2_QATU != 0
			lErro := .T.
			Exit
		EndIf
		dbSkip()
	EndDo
Next

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Funcao Especifica SIGAEIC - AVERAGE                        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
lErro := If(!lErro,!MTA010OK(),lErro)
If lErro
	lRet := .F.
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Funcao Especifica SIGAMDT - NG INFORMATICA                 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lRet
	lErro := MdtValESb1(cCod)
	If lErro
		lRet := .F.
	EndIf
EndIf

If lRet
	dbSelectArea("SB9")      // Saldos Iniciais
	dbSetOrder(1)
	aFiliais := If(! Empty(xFilial("SB9")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SB9")})
	For nBusca := 1 to Len(aFiliais)
		If dbSeek(aFiliais[nBusca]+cCod)
			If (lFantasma := (RetFldProd(SB1->B1_COD,"B1_FANTASM") == "S")) // Projeto Implementeacao de campos MRP e FANTASM no SBZ
				lErro := .F.
				While !Eof() .And. !lErro .And. aFiliais[nBusca]+cCod==B9_FILIAL+B9_COD
					lErro := (B9_QINI # 0)
					dbSkip()
				End
				If lErro
					Exit
				Endif
			EndIf
		Endif
	Next
	If lErro
		lRet := .F.
	Endif
EndIf

If lRet
	dbSelectArea("SC1")      // solicitacoes de compra
	aFiliais := If(! Empty(xFilial("SC1")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SC1")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(2)  // seleciona o indice por produto
		dbSeek(aFiliais[nBusca]+cCod)
		dbSetOrder(1)  // retorna ao indice principal do arquivo
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SC2")      // ordens de producao
	aFiliais := If(! Empty(xFilial("SC2")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SC2")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(2)  // seleciona o indice por produto
		dbSeek(aFiliais[nBusca]+cCod)
		dbSetOrder(1)  // retorna ao indice principal do arquivo
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SC4")      // previsoes de vendas
	aFiliais := If(! Empty(xFilial("SC4")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SC4")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(1)
		dbSeek(aFiliais[nBusca]+cCod)
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SC6")      // itens dos pedidos de vendas
	aFiliais := If(! Empty(xFilial("SC6")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SC6")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(2)  // seleciona o indice por produto
		dbSeek(aFiliais[nBusca]+cCod)
		dbSetOrder(1)  // retorna ao indice principal do arquivo
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SC7")      // pedido de compra
	aFiliais := If(! Empty(xFilial("SC7")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SC7")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(2)  // seleciona o indice por produto
		dbSeek(aFiliais[nBusca]+cCod)
		dbSetOrder(1)  // retorna ao indice principal do arquivo
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SC3")      	// Autorizacao de Entrega
	aFiliais := If(! Empty(xFilial("SC3")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SC3")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(3)  				// seleciona o indice por produto
		dbSeek(aFiliais[nBusca]+cCod)
		dbSetOrder(1)  				// retorna ao indice principal do arquivo
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SD1")      // itens das notas fiscais de entrada
	aFiliais := If(! Empty(xFilial("SD1")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SD1")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(2)  // seleciona o indice por produto
		dbSeek(aFiliais[nBusca]+cCod)
		dbSetOrder(1)  // retorna ao indice principal do arquivo
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SD2")      // itens das notas fiscais de saida
	aFiliais := If(! Empty(xFilial("SD2")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SD2")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(1)
		dbSeek(aFiliais[nBusca]+cCod)
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SD3")      // movimentacoes internas
	aFiliais := If(! Empty(xFilial("SD3")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SD3")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(3)  // seleciona o indice por produto
		dbSeek(aFiliais[nBusca]+cCod)
		dbSetOrder(1)  // retorna ao indice principal do arquivo
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SG1")      // estruturas dos produtos
	aFiliais := If(! Empty(xFilial("SG1")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SG1")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(1)
		dbSeek(aFiliais[nBusca]+cCod)
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	// Uso o mesmo aFiliais pois se trata (ainda) do mesmo arquivo
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(2)  // seleciona o indice por componente
		dbSeek(aFiliais[nBusca]+cCod)
		dbSetOrder(1)  // retorna ao indice principal do arquivo
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SG2")      // roteiro de fabricacao
	aFiliais := If(! Empty(xFilial("SG2")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SG2")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(1)
		dbSeek(aFiliais[nBusca]+cCod)
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SBG")      // Sugestao de Or‡amento
	dbSetOrder(1)
	aFiliais := If(! Empty(xFilial("SBG")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SBG")})
	For nBusca := 1 to Len(aFiliais)
		dbSeek(aFiliais[nBusca]+cCod)
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SBH")      // Sugestao de Or‡amento
	dbSetOrder(1)
	aFiliais := If(! Empty(xFilial("SBH")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SBH")})
	For nBusca := 1 to Len(aFiliais)
		dbSeek(aFiliais[nBusca]+cCod)
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SCK")      // Sugestao de Or‡amento
	aFiliais := If(! Empty(xFilial("SCK")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SCK")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(3)
		dbSeek(aFiliais[nBusca]+cCod)
		dbSetOrder(1)
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	dbSelectArea("SCP")      // Solicitacao ao Armazem
	dbSetOrder(2)
	aFiliais := If(! Empty(xFilial("SCP")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SCP")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(1)
		If dbSeek(aFiliais[nBusca]+cCod)
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Verifica se existe algum contrato de direito autoral com o produto selecionado.³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	dbSelectArea("AH1")      // Contrato de Direito Autoral
	aFiliais := If(! Empty(xFilial("AH1")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("AH1")})
	For nBusca := 1 to Len(aFiliais)
		dbSetOrder(1)
		dbSeek(aFiliais[nBusca]+cCod)
		If Found()
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Verifica se existe algum indicador do produto cadastrado                       ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	dbSelectArea("SBZ")      // Indicador de Produtos
	dbSetOrder(1)
	aFiliais := If(! Empty(xFilial("SBZ")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("SBZ")})
	For nBusca := 1 to Len(aFiliais)
		If dbSeek(aFiliais[nBusca]+cCod)
			lRet := .F.
			Exit
		EndIf
	Next
EndIf

If lRet	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica se existe Base Instalada                         ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	cAliasAA3 := GetNextAlias()
	cQuery    := ""

	cQuery += "SELECT COUNT(*) QTDBASE FROM " + RetSqlName( "AA3" ) + " "
	cQuery += "WHERE "
	cQuery += "AA3_FILIAL='" + xFilial( "AA3" ) + "' AND "
	cQuery += "AA3_CODPRO='" + cCod             + "' AND "
	cQuery += "D_E_L_E_T_=' '"

	cQuery := ChangeQuery( cQuery )
	dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasAA3,.F.,.T. )

	If (cAliasAA3)->QTDBASE > 0
		lRet := .F.
	Endif

	dbSelectArea(cAliasAA3)
	dbCloseArea()
	dbSelectArea("AA3")
EndIf

If lRet
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica se existe Acessorio da Base Instalada            ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	cAliasAA4 := GetNextAlias()
	cQuery    := ""

	cQuery += "SELECT COUNT(*) QTDBASE FROM " + RetSqlName( "AA4" ) + " "
	cQuery += "WHERE "
	cQuery += "AA4_FILIAL='" + xFilial( "AA4" ) + "' AND "
	cQuery += "AA4_PRODAC='" + cCod             + "' AND "
	cQuery += "D_E_L_E_T_=' '"

	cQuery := ChangeQuery( cQuery )
	dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasAA4,.F.,.T. )

	If (cAliasAA4)->QTDBASE > 0
		lRet := .F.
	EndIf

	dbSelectArea(cAliasAA4)
	dbCloseArea()
	dbSelectArea("AA4")
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se existe Tabela de precos                       ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lRet
	DA1->(dbSetOrder(2))
	If DA1->(MsSeek(xFilial("DA1")+cCod))
		lRet := .F.				
	Endif
EndIf

If lRet
	dbSelectArea("ADB")
	aFiliais := If(! Empty(xFilial("ADB")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("ADB")})
	For nBusca := 1 to Len(aFiliais)
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Verifica se existe contrato de parceria ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		cAliasADB := GetNextAlias()
		cQuery    := ""

		cQuery += "SELECT COUNT(*) QTDBASE FROM " + RetSqlName( "ADB" ) + " "
		cQuery += "WHERE "
		cQuery += "ADB_FILIAL='" + aFiliais[nBusca] + "' AND "
		cQuery += "ADB_CODPRO='" + cCod             + "' AND "
		cQuery += "D_E_L_E_T_=' '"

		cQuery := ChangeQuery( cQuery )
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasADB,.F.,.T. )

		If (cAliasADB)->QTDBASE > 0
			lRet := .F.
		Endif

		dbSelectArea(cAliasADB)
		dbCloseArea()
	Next nBusca
EndIf

If lRet
	dbSelectArea("CNB")
	aFiliais := If(! Empty(xFilial("CNB")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("CNB")})
	For nBusca := 1 to Len(aFiliais)
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Verifica se existe planilha de contrato - Gestao de Contratos ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

		cAliasCNB := GetNextAlias()
		cQuery    := ""

		cQuery += "SELECT COUNT(*) QTDBASE FROM " + RetSqlName( "CNB" ) + " CNB "
		cQuery += "WHERE "
		cQuery += "CNB_FILIAL='" + aFiliais[nBusca] + "' AND "
		cQuery += "CNB_PRODUT='" + cCod             + "' AND "
		cQuery += "D_E_L_E_T_=' '"

		cQuery := ChangeQuery( cQuery )
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasCNB,.F.,.T. )

		If (cAliasCNB)->QTDBASE > 0
			lRet := .F.
		Endif

		dbSelectArea(cAliasCNB)
		dbCloseArea()
	Next nBusca
EndIf

If lRet
	If IntTMS() //Validacao de exclusao do produto - ambiente SIGATMS
		dbSelectArea("DTC")
		aFiliais := Iif(! Empty(xFilial("DTC")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("DTC")})
		For nBusca := 1 To Len(aFiliais)
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Verifica se existe nota fiscal          ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			cAliasDTC := GetNextAlias()
			cQuery    := ""

			cQuery += "SELECT COUNT(*) QTDBASE FROM " + RetSqlName( "DTC" ) + " "
			cQuery += "WHERE "
			cQuery += "DTC_FILIAL='" + aFiliais[nBusca] + "' AND "
			cQuery += "DTC_CODPRO='" + cCod             + "' AND "
			cQuery += "D_E_L_E_T_=' '"

			cQuery := ChangeQuery( cQuery )
			dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasDTC,.F.,.T. )

			If (cAliasDTC)->QTDBASE > 0
				lRet := .F.
			EndIf

			dbSelectArea(cAliasDTC)
			dbCloseArea()

			If !lRet
				Exit
			EndIf

		Next nBusca

		If lRet
			dbSelectArea("DE5")
			aFiliais := Iif(! Empty(xFilial("DE5")) .and. Empty(xFilial("SB1")), aClone(aSM0CodFil), {xFilial("DE5")})
			For nBusca := 1 To Len(aFiliais)
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ Verifica se existe nota fiscal de EDI   ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				cAliasDE5 := GetNextAlias()
				cQuery    := ""

				cQuery += "SELECT COUNT(*) QTDBASE FROM " + RetSqlName( "DE5" ) + " "
				cQuery += "WHERE "
				cQuery += "DE5_FILIAL='" + aFiliais[nBusca] + "' AND "
				cQuery += "DE5_CODPRO='" + cCod             + "' AND "
				cQuery += "D_E_L_E_T_=' '"

				cQuery := ChangeQuery( cQuery )
				dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasDE5,.F.,.T. )

				If (cAliasDE5)->QTDBASE > 0
					lRet := .F.
				Endif

				dbSelectArea(cAliasDE5)
				dbCloseArea()

				If !lRet
					Exit
				EndIf

			Next nBusca
	    Endif
	EndIf
EndIf

//Integracao Shopify - Adicionado integração com Shopify SHPXFUN.PRW
If cPaisLoc == 'EUA' .AND. SuperGetMv("MV_SHOPIFY",.F.,.F.) .AND. FindFunction("SPYDMAT550")
		lRet := SPYDMAT550(cCod)
EndIf

If !lRet
	Help(" ",1,"A550NODEL")
EndIf

RestArea( aArea )

Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Del   ³ Autor ³ Rosane L. Chene       ³ Data ³ 07/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Exclui o produto                                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ Codigo do produto a ser excluido                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550Del(cProduto)
Local cAlias:=Alias(),nOrdem:=IndexOrd(),nReg:=Recno()

Begin Transaction

// Integração com o MRP Memória
If integraMRP()
	mrpIntGrd(Nil, Nil, cProduto)
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Deleta codigo do arquivo de Produtos    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SB1")
dbSetOrder(1)
dbSeek(xFilial("SB1")+cProduto)
If Found()
	RecLock("SB1",.F.,.T.)
	dbDelete()
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Deleta movimentacoes do arquivo de Saldos Fisicos e Financeiros³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SB2")
dbSetOrder(1)
dbSeek(xFilial("SB2")+cProduto)
While !EOF() .And. xFilial("SB2")+cProduto == B2_FILIAL+B2_COD
	RecLock("SB2",.F.,.T.)
	dbDelete()
	dbSkip()
EndDo

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Deleta movimentacoes do arquivo de Demandas   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SB3")
dbSetOrder(1)
dbSeek(xFilial("SB3")+cProduto)
If Found()
	RecLock("SB3",.F.,.T.)
	dbDelete()
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Deleta dados do produto do arquivo de Dados Adicionais     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SB5")
dbSetOrder(1)
dbSeek(xFilial("SB5")+cProduto)
If Found()
	RecLock("SB5",.F.,.T.)
	dbDelete()
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Deleta movimentacoes da Amarracao de Produto x Fornecedor   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SA5")
dbSetOrder(2)
dbSeek(xFilial("SA5")+cProduto)
While !EOF() .And. cProduto == A5_PRODUTO
	RecLock("SA5",.F.,.T.)
	dbDelete()
	dbSkip()
EndDo
dbSetOrder(1)

End Transaction

dbSelectArea(cAlias)
dbSetOrder(nOrdem)
dbGoTo(nReg)
Return .T.

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Masc  ³ Autor ³ Rosane L. Chene       ³ Data ³ 07/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Validacao da Mascara                                       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550Masc()
Local lRet:=.T.
Local cMascara := GetMv("MV_MASCGRD")
Private nTamRef := Val(Substr(cMascara,1,2))
Private nTamLin := Val(Substr(cMascara,4,2))
Private nTamCol := Val(Substr(cMascara,7,2))


//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se o tamanho total da mascara e' maior que o   ³
//³ tamanho maximo do codigo do produto                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If nTamRef+nTamLin+nTamCol > Len(SB1->B1_COD)
	Help(" ",1,"AMASCINV")
	lRet := .F.
Endif
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Verif ³ Autor ³ Rosane L. Chene       ³ Data ³ 07/08/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Validacao na alteracao, caso o usuario troque o numero     ³±±
±±³          ³ da tabela que indica linha ou coluna, verifica se ja nao   ³±±
±±³          ³ existe movimentacoes com a tabela antiga                   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550Verif()
Local cProduto 	:=""
Local cAlias 	:=Alias()
Local nOrdem 	:=IndexOrd()
Local aColunas 	:={}
Local lRet 		:=.T.
Local i 		:=0 
Local cTypeVar 	:= ""

Local cReadVar:= ReadVar()

If cReadVar == "M->B4_LINHA"
	cTipo := "1"
ElseIf cReadVar == "M->B4_COLUNA"
	cTipo := "2"
Else
	cTipo := " "
Endif

If ! A551VldTab(&cReadVar, cTipo)
	Return(.F.)
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Esta funcao so e' valida no caso de alteracao           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If Altera
	dbSelectArea("SB4")
	dbSetOrder(1)
	dbSeek(xFilial("SB4")+M->B4_COD)
	If Found()
		dbSelectArea("SBV")
		dbSetOrder(1)
		dbSeek(xFilial("SBV")+SB4->B4_COLUNA)
		aColunas:={}
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Armazena todas as colunas no array,do codigo da tabela  ³
		//³ referente a coluna que ja esta gravado                  ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		While !EOF() .And. (bv_tabela == SB4->B4_COLUNA)
			AADD(aColunas,Substr(bv_chave,1,nTamCol))
			dbSkip()
		End
		
		cTypeVar := Type("aProdDel")

		For i:=1 to Len(aColunas)
			dbSelectArea("SBV")
			dbSeek(xFilial("SBV")+SB4->B4_LINHA)
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Verifica se o produto (referencia + coluna +linha) ja   ³
			//³ foi movimentado,se positivo nao deixa alterar o codigo  ³
			//³ da tabela ou da coluna                                  ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			While SBV->(!EOF()) .And. (SBV->BV_TABELA == SB4->B4_LINHA)
				cProduto := Substr(SB4->B4_COD,1,nTamRef) +Substr(SBV->BV_CHAVE,1,nTamLin)+ aColunas[i]
				cProduto := cProduto + Space(nTamCod - Len(cProduto) )
				lRet     := a550Prod(cProduto)
				If !lRet
					Exit
				Else
					If cTypeVar <> "U"
						If ( M->B4_LINHA <> SB4->B4_LINHA ) .Or. ( M->B4_COLUNA <> SB4->B4_COLUNA )
							If Ascan(aProdDel,cProduto) == 0
								AADD(aProdDel,cProduto)	
							Endif
						Endif
					Endif
				Endif
				SBV->(dbSkip())
			End
			If !lRet
				Exit
			Endif
		Next
	Endif
Endif

If !lRet .And. ( Type("aProdDel") <> "U" .And. Len( aProdDel ) > 0 )
	aProdDel := {}
Endif

dbSelectArea(cAlias)
dbSetOrder(nOrdem)
GetdRefresh()

Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550ProdB1³ Autor ³ Rosane L. Chene       ³ Data ³ 23/10/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Verifica se a referencia que esta sendo cadastrada         ³±±
±±³          ³ ja existe como produto normal                              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550ProdB1()
Local cRef       := &(ReadVar())
Local cFiltroSBP := "BP_FILIAL = '" + xFilial("SBP") +"' .And. AllTrim(BP_BASE) $ '" + AllTrim(M->B4_COD) +"'"
Local lRet		 :=.T.

dbSelectArea("SB1")
dbSetOrder(1)
dbSeek(xFilial("SB1")+cRef)
If Found()
	Help(" ",1,"A550PRODB1")
	lRet := .F.
Endif

If lRet
	//Verifica se ha familia de produto com cod similar
	SBP->(dbSetFilter({|| &cFiltroSBP},cFiltroSBP))
	SBP->(dbGoTop())
	If !SBP->(EOF())
		Help(" ",1,"A550REFER")
		lRet := .F.
	EndIf
	SBP->(dbClearFilter())
EndIf

// Validação de produtos para o E-Commerce Ciashop
If lRet 
	lRet := A550ProdEC(cRef)
EndIf
	
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550RemoveSinal³ Autor ³ Marcelo Iuspa    ³ Data ³ 10/03/05 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Remove sinais da string fornecida                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ cTexto - String a ser tratada                              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550RemoveSinal(cTexto)
Local nLenOri := Len(cTexto)
aEval({"/","*","+","-"}, {|z| cTexto := StrTran(cTexto, z, "")})
Return(Pad(cTexto, nLenOri)) 


/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Programa  ³MenuDef   ³ Autor ³ Fabio Alves Silva     ³ Data ³05/10/2006³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Utilizacao de menu Funcional                               ³±±
±±³          ³                                                            ³±±
±±³          ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³Array com opcoes da rotina.                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³Parametros do array a Rotina:                               ³±±
±±³          ³1. Nome a aparecer no cabecalho                             ³±±
±±³          ³2. Nome da Rotina associada                                 ³±±
±±³          ³3. Reservado                                                ³±±
±±³          ³4. Tipo de Transa‡„o a ser efetuada:                        ³±±
±±³          ³    1 - Pesquisa e Posiciona em um Banco de Dados           ³±±
±±³          ³    2 - Simplesmente Mostra os Campos                       ³±±
±±³          ³    3 - Inclui registros no Bancos de Dados                 ³±±
±±³          ³    4 - Altera o registro corrente                          ³±±
±±³          ³    5 - Remove o registro corrente do Banco de Dados        ³±±
±±³          ³5. Nivel de acesso                                          ³±±
±±³          ³6. Habilita Menu Funcional                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³   DATA   ³ Programador   ³Manutencao efetuada                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³          ³               ³                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function MenuDef()
Private aRotina	:={	{STR0002,"AxPesqui"  	,0,1,0,.F.},; //"Pesquisar"
					{STR0003,"A550Visual"	,0,2,0,nil},; //"Visualizar"
					{STR0004,"A550Inclui"   ,0,3,0,nil},; //"Incluir"
					{STR0005,"A550Altera"   ,0,4,0,nil},; //"Alterar" 
					{STR0006,"A550Deleta"	,0,5,0,nil}}  //"Excluir"
If ExistBlock("MTA550MNU")
	ExecBlock ("MTA550MNU",.F.,.F.)
Endif
return (aRotina)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³MontaCols ³ Autor ³ Marco Bianchi         ³ Data ³ 12/12/06 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³Montagem do aCols (a montagem do aHeader e feita automatica-³±±
±±³          ³mente pela funcao FILLGETDADOS) na alteracao.               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³MontaCols()                                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametro ³                                                            ³±±
±±³          ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso       ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function MontaCols()

Local nColunas := 1
Local nLinhas  := 0
Local nCont    := 0
Local cProduto := ''
Local i        := 0
Local cColuna  := If(Inclui,M->B4_COLUNA,If(Altera,M->B4_COLUNA,SB4->B4_COLUNA))
Local cLinha   := If(Inclui,M->B4_LINHA,If(Altera,M->B4_LINHA,SB4->B4_LINHA))
Local cProds   := If(!Inclui,A550PesqProd(SB4->B4_COD),"")
Local cArqSBV  := "SBV"
Local cQuery   := ""
Local lOrdena  := SuperGetMv("MV_ORDGRDP",.F.,.T.)
Local aAreaSBV := SBV->(GetArea())
Local cIndSBV := ""

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta aHeader                                        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aHeader:={}
AADD(aHeader,{AllTrim(GetTitTab(cLinha,.T.))+"\"+AllTrim(GetTitTab(cColuna,.T.)),"R","@!",1,0,".F. ","û", "C"," "," " } )

cArqSBV := GetNextAlias()
cQuery  := "SELECT BV_FILIAL, BV_TABELA, BV_CHAVE, BV_DESCRI FROM " +RetSQLName("SBV") + " WHERE "
cQuery  += "BV_FILIAL = '" +xFilial("SBV") +"' AND BV_TABELA = '" +cColuna +"' AND D_E_L_E_T_ = '' " 
If lOrdena
	cQuery += "ORDER BY BV_CHAVE"
Else
	cQuery += "ORDER BY R_E_C_N_O_"
EndIf
cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cArqSBV,.T.,.T.)

While !EOF() .And. (cArqSBV)->(BV_FILIAL+BV_TABELA) == xFilial("SBV")+cColuna
	nColunas++
	AADD(aHeader,{"["+Substr((cArqSBV)->bv_chave,1,nTamCol)+"] "+AllTrim((cArqSBV)->bv_descri),;
					"_"+Substr(A550RemoveSinal((cArqSBV)->bv_chave),1,nTamCol),"@!",;
					1, 0,"A550VALID()","û", "C"," "," "} )
	AADD(aAlter,"_"+Substr(A550RemoveSinal((cArqSBV)->bv_chave),1,nTamCol))
	dbSkip()
End
AADD(aHeader,{"Alias WT","BV_ALI_WT","",3,0,NIL,"û", "C","SBV","V" } )
AADD(aHeader,{"Recno WT","BV_REC_WT","",10,0,NIL,"û", "N","SBV","V" } )
nColunas+=2

dbSelectArea("SBV")
RetIndex("SBV")
dbClearFilter()
FErase(cIndSBV+OrdBagExt())

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta aCols                                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
nLinhas:=0
nCont:=0
aCols:={}               

cArqSBV := GetNextAlias()
cQuery  := "SELECT BV_FILIAL, BV_TABELA, BV_CHAVE, BV_DESCRI FROM " +RetSQLName("SBV") + " WHERE "
cQuery  += "BV_FILIAL = '" +xFilial("SBV") +"' AND BV_TABELA = '" +cLinha +"' AND D_E_L_E_T_ = '' " 
If lOrdena
	cQuery += "ORDER BY BV_CHAVE"
Else
	cQuery += "ORDER BY R_E_C_N_O_"
EndIf
cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cArqSBV,.T.,.T.)

While !EOF() .And. (cArqSBV)->(BV_FILIAL+BV_TABELA) == xFilial("SBV")+cLinha
	nCont++
	For i:=1 to nColunas
		nLinhas++
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Monta Array de 1 elemento ³
		//³ vazio. Se inclus†o.       ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If nLinhas == 1
			AADD(aCols,{})
			AADD(aCols[nCont],"["+Substr((cArqSBV)->BV_CHAVE,1,nTamLin)+"] "+AllTrim((cArqSBV)->BV_DESCRI))
		Else
			If Inclui
				If AllTrim(aHeader[i,2]) == "BV_ALI_WT"
					AADD(aCols[nCont],"SBV")
				ElseIf AllTrim(aHeader[i,2]) == "BV_REC_WT"
					AADD(aCols[nCont],0)
				Else
					AADD(aCols[nCont]," ")
				EndIf
			Else
				If AllTrim(aHeader[i,2]) == "BV_ALI_WT"
					AADD(aCols[nCont],"SBV")
				ElseIf AllTrim(aHeader[i,2]) == "BV_REC_WT"
					AADD(aCols[nCont],Recno())
				Else
					cProduto := Substr(aCols[nCont][1],2,nTamLin) + Substr(aHeader[i][1],2,nTamCol)
					AADD(aCols[nCont],If(cProduto$cProds,"X"," "))
				EndIf
			EndIf
		Endif
	Next
	nLinhas:=0
	AADD(aCOLS[nCont],.F.)   // Flag que indica se o reg. foi apagado
	dbSkip()
End

dbSelectArea("SBV")
RetIndex("SBV")
dbClearFilter()
FErase(cIndSBV+OrdBagExt())

RestArea(aAreaSBV)
Return()

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550PesqProd	  ³ Autor ³ Andre Anjos     ³ Data ³ 28/03/08 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Remove sinais da string fornecida                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ cRef - Referencia da grade de produtos (B4_COD)            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A550PesqProd(cRef)
Local aArea	:= GetArea()
Local cTrab	:= ""
Local cQuery:= ""
Local cProds:= ""

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Protecao caso o campo B4_COD nao tenha sido alterado corretamente     ³
//³no configurador. Este campo deve estar com o tamanho exatamente igual ³
//³ao primeiro nivel do parametro MV_MASCGRD                             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If TamSX3("B4_COD")[1] != nTamRef
	cRef := Substr(cRef, 1, nTamRef)
EndIf

cTrab := GetNextAlias()
cQuery := "SELECT B1_COD FROM " +RetSQLName("SB1") +" WHERE "
cQuery += "SUBSTRING(B1_COD,1," +Str(nTamRef) +") = '" + cRef + "' AND B1_GRADE = 'S' AND "
cQuery += "D_E_L_E_T_ = '' AND B1_FILIAL = '" +xFilial("SB1") +"'"
cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cTrab,.T.,.T.)
dbSelectArea(cTrab)

While !EOF()
	cProds += Substr((cTrab)->B1_COD,(nTamRef+1),(nTamLin+nTamCol))+"*"
	(cTrab)->(dbSkip())
End                 


(cTrab)->(dbCloseArea())

RestArea(aArea)

Return cProds

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550Monta ³ Autor ³ Rosane L. Chene       ³ Data ³ 23/10/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Apenas valida se a mascara de grade esta correta           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A550Monta()
Local lRet

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se a Mascara esta correta                   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
lRet := a550Masc()

Return lRet

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Funcao    ³GetTitTab ³ Autor ³Andre Anjos		    ³ Data ³20.08.08  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Retorna a descricao da tabela de grade					  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ExpC1: Codigo da tabela da grade                            ³±±  
±±|			 ³ExpL1: Indica se retorna cod da tabela caso nao exista desc.³±±  
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³ExpC1: Descricao da tabela da grade                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso       ³Generico grade                                              ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function GetTitTab(cCodTabela,lDef)
Local aArea := GetArea() 
Local cRet	:= If(lDef,cCodTabela,Space(TamSX3("BV_DESCTAB")[1]))
Local cFilt := "BV_FILIAL=='"+xFilial("SBV")+"'.And.BV_TABELA=='"+cCodTabela+"'.And.!Empty(BV_DESCTAB)"

dbSelectArea("SBV")
DbSetOrder(1)
SBV->(dbSetFilter({|| &cFilt}, cFilt))
dbGoTop()
If !EOF()
	cRet := SBV->BV_DESCTAB
EndIf
SBV->(dbClearFilter())

RestArea(aArea)
Return cRet

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MT550SEL  ºAutor  ³Robson Melo         º Data ³  21/01/13   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Funcao desenvolvida para determinar qual sera o produto pai º±±
±±º          ³apos a gravacao da grade de produtos no e-commerce          º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function MT550Sel(cProdPai, cCodigo)
Local oDlg		:= NIL
Local oLbx		:= NIL			// Objeto do Dialogo
Local cTitulo	:= STR0011  	// Define Produto Pai
Local oOk		:= LoadBitmap(GetResources(),"CHECKED")
Local oNo		:= LoadBitmap(GetResources(),"UNCHECKED")

Local aVetor   	:= {}   		//Matriz com os codigos dos produtos da grade para selecionar qual sera o produto pai.
Local cQuery	:= ""			//Instrucao SQL
Local TMPSB1    := ""           //Area temporaria 
Local nPosPai	:= 0			//Posicao do Produto-Pai   

Default cProdPai := ""
Default cCodigo	:= M->B4_COD 

#IFDEF TOP
   cQuery := " SELECT B1_COD, B1_DESC, B1_PRODPAI "
   cQuery += " FROM " + RetSQLName("SB1") + " SB1 "
   cQuery += " WHERE SUBSTRING(SB1.B1_COD,1," + Alltrim(Str(nTamRef)) + ")  = '" + cCodigo + "'"       
   cQuery += " AND  SB1.B1_GRADE = 'S' AND SB1.B1_FILIAL  =  " + ValToSQL(xFilial("SB1"))
   cQuery += " AND   SB1.D_E_L_E_T_ =  '' " 
	
	If  (Select("TMPSB1") > 0)
	    TMPSB1->( DbCloseArea() )
	EndIf	      

	cQuery := ChangeQuery( cQuery )

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Obtem os dados executando a query.                                        ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	DbUseArea(.T., "TOPCONN", TcGenQry(Nil, Nil, cQuery), "TMPSB1", .F., .T.)
	
	dbSelectArea("TMPSB1")
	//Monta array com as informacoes dos produtos a serem apresentados em tela.
	Do While !(EoF())
		If Len(AllTrim(TMPSB1->B1_COD)) >= (nTamRef + nTamLin + nTamCol) 
			aAdd(aVetor,{.F.,TMPSB1->B1_COD,TMPSB1->B1_DESC})	
			If Empty(cProdPai) .AND. !Empty(TMPSB1->B1_PRODPAI)
				cProdPai := TMPSB1->B1_PRODPAI
			EndIf
		EndIf	
		dbSkip() 	
	Enddo
	
	TMPSB1->( DbCloseArea() ) 
		
	//Sinaliza o Produto-Pai já cadastrado

   
#ELSE
	SB1->(dbSetOrder(1))
	SB1->(dbSeek(xFilial("SB1")+cCodigo))
 
	//Monta array com as informacoes dos produtos a serem apresentados em tela.
	While SB1->(!EOF() .And. B1_FILIAL == xFilial("SB1") .And. Left(B1_COD,nTamRef) == cCodigo)
		If SB1->B1_GRADE = 'S' .AND. Len(AllTrim(SB1->B1_COD)) >= (nTamRef + nTamLin + nTamCol) 
			aAdd(aVetor,{.F.,SB1->B1_COD,SB1->B1_DESC})	
			If Empty(cProdPai) .AND. !Empty(SB1->B1_PRODPAI)
				cProdPai := SB1->B1_PRODPAI
			EndIf	
		EndIf		
		SB1->(dbSkip())
	End
 #ENDIF 
 
If !Empty(cProdPai) .AND. ;
	(nPosPai := aScan(aVetor, { |a| RTrim(a[2]) == RTrim(cProdPai) }) ) > 0
	
	aVetor[nPosPai, 1] := .T.
	
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta a tela para usuario visualizar consulta³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If Len(aVetor) == 0
   Aviso(cTitulo,STR0012,{"Ok"})   //"Nao existe bancos a consultar"
   lRet := .F.
Else
	DEFINE MSDIALOG oDlg TITLE cTitulo FROM 0,0 TO 240,500 PIXEL
	   
	@ 10,10 LISTBOX oLbx FIELDS HEADER " ",STR0013,STR0014 SIZE 230,095 OF oDlg PIXEL ON dblClick(MT550Mark(@oLbx,@aVetor)) //"Codigo"##"Descricao"
	oLbx:SetArray(aVetor)
	oLbx:bLine := {|| {Iif(aVetor[oLbx:nAt,1],oOk,oNo),aVetor[oLbx:nAt,2],Posicione("SB1",1,xFilial("SB1")+aVetor[oLbx:nAt,2],"B1_DESC" )}} 
	@ 110,10 SAY STR0015 SIZE 160,7 PIXEL OF oDlg   //"Somente será possível marcar um registro."
	
	DEFINE SBUTTON FROM 107,213 TYPE 1 ACTION If(MT550Val(aVetor), oDlg:End(), .F.) ENABLE OF oDlg
	DEFINE SBUTTON FROM 107,185 TYPE 2 ACTION oDlg:End() ENABLE OF oDlg
	
	ACTIVATE MSDIALOG oDlg CENTER
EndIf

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MT550Val  ºAutor  ³Robson B. Melo      º Data ³  21/01/13   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Valida se existe algum produto selecionado como produto Pai º±±
±±º          ³no e-commerce.                                              º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MT550Sel                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function MT550Val(aVetor)
Local nX		:= 0
Local lCheckOK	:= .F.
Local cProduto	:= "" 
Local lZerLnPai := .F.			//Pai possui linha zerada
Local lZerClPai := .F.			//Pai possui coluna zerada
Local lNoZerFil	:= .F.			//Filhos possui variação diferente do pai?
Local aMascRaiz  := &("{"+SuperGetMV("MV_MASCGRD",,"11,2,2")+"}")  //Cria vetor com os dados da Mascara da grade
Local cZerosLin  := Replicate("0",aMascRaiz[2])   //Codigo zerado no tamanho da linha da grade para ser utilizado em condicao na MF2.
Local cZerosCol  := Replicate("0",aMascRaiz[3])   //Codigo zerado no tamanho da coluna da grade para ser utilizado em condicao na MF2.
Local cLinha	:= ""         //Linha do produto
Local cColuna	:= ""         //coluna do produto   
Local cVar		:= ""         //Variação
Local cVarFilh	:= ""			//Variação do filho
Local lFunRec 	:= ExistFunc("Lj900XRL")
Local lLock 	:= .f.
Local cMascara 	:= GetMv("MV_MASCGRD")   

If ValType(nTamRef) = "U"
	Private nTamRef := Val(Substr(cMascara,1,2))
EndIf

If ValType(nTamLin) = "U"
	Private nTamLin := Val(Substr(cMascara,4,2))
EndIf

If ValType(nTamCol) = "U"
	Private nTamCol := Val(Substr(cMascara,7,2))
EndIf

//-- Verifica se ha algum item marcado.
For nX := 1 To Len(aVetor)
	If aVetor[nX,1]
		cProduto := aVetor[nX,2]
		lCheckOK := .T.
		Exit
	EndIf
Next nX 

If  lCheckOK   
	cLinha := Substr(cProduto,aMascRaiz[1]+1, aMascRaiz[2] )
	cColuna := Substr(cProduto,aMascRaiz[1]+aMascRaiz[2]+1, aMascRaiz[3])
    lZerLnPai := cLinha == cZerosLin
    lZerClPai := cColuna == cZerosCol 
      //Existe linha ou coluna zerada, então varre os filhos para ver se existem filhos com variações
      If lZerLnPai
      	cVar := STR0017 + "[" + cZerosLin + "]"  //" linha " 
      	If lZerClPai
      		cVar += STR0018  //" e"
      	EndIf
      EndIf
      If lZerClPai 
      	cVar += STR0019 + "[" + cZerosCol  + "]"  //" coluna "
      EndIf
      
      If lZerLnPai .OR. lZerClPai 
      		nX := 1
			Do While !lNoZerFil  .AND. nx <= Len(aVetor)

				If !aVetor[nX,1] //Não é  o Pai 
					cLinha := Substr(aVetor[nX,2],aMascRaiz[1]+1, aMascRaiz[2] )
					cColuna := Substr(aVetor[nX,2],aMascRaiz[1]+aMascRaiz[2]+1, aMascRaiz[3]) 
					//Tem filhos sem ser zerado
					lNoZerFil :=  ( ( lZerLnPai .AND. (cLinha <> cZerosLin) ) .OR. ;
									    ( lZerClPai .AND. (cColuna <> cZerosCol) )   )
					If  lNoZerFil 
					      If lZerLnPai
					      	cVarFilh := STR0017 +"[" + cLinha + "]" //" linha "
					      	If lZerClPai
					      		cVarFilh += STR0018 // " e"
					      	EndIf
					      EndIf
					      If lZerClPai 
					      	cVarFilh += STR0019 +"["  + cColuna  + "]" //" coluna "+
					      EndIf
					EndIf

				EndIf
				nX++
			EndDo       		 
      EndIf
      If lNoZerFil  
      	nX--
      	lCheckOk := MsgNoYes(STR0020 + cProduto + STR0021 + cVar + STR0022 +;   //"O produto pai " # " possui variação(ões) de " # " zerada(s), ao contrário do seu filho "
      				 aVetor[nX,2] + STR0023 + cVarFilh + STR0024 +CRLF +;   //" que não possui variação(ões) de " # ", o que fará com que este produto-filho não seja integrado para o e-commerce. "
      				 STR0025 + cProduto + STR0026) // "Deseja manter o produto "# " como pai?"
      EndIf

Else 
		Aviso(STR0009,STR0016,{"OK"})	//-- Selecione ao menos um registro.
EndIf 


If lCheckOK
	//-- Grava produto marcado como produto Pai.
	SB1->(dbSetOrder(1))
	SB1->(dbSeek(xFilial("SB1")+Left(cProduto,nTamRef)))
	While SB1->(!EOF() .And. B1_FILIAL == xFilial("SB1") .And. Left(SB1->B1_COD,nTamRef) == Left(cProduto,nTamRef)) 
	
		If Len(Alltrim(SB1->B1_COD)) >= (nTamRef + nTamLin + nTamCol)
			lLock := .F. 
			If lFunRec	
				lLock := 	Lj900XRL("SB1",.F.,  "MATA550")
					
			Else
				lLock :=  RecLock("SB1",.F.)
			EndIf
			
			If lLock 
				SB1->B1_PRODPAI := cProduto
				SB1->(MsUnLock())
			EndIf
		EndIf
		SB1->(dbSkip())
	End
EndIf  

//Verifica se existe variação nos filhos
Return lCheckOK

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MT550MARK ºAutor  ³Robson B. Melo      º Data ³  21/01/13   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Funcao que marca ou desmarca todos os objetos              º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MT550Sel                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function MT550Mark(oLbx,aVetor)
Local i 	:= 0
Local nPos 	:= 0

// Verificar se há algum item marcado
// Há item marcado?
// 	Não, então marque.
// 	Sim, o item marcado é o mesmo que já está marcado?
//			Sim, então inverta a marca.
//			Não, então desmaque o item marcado e marque o item desejado.
nPos := aScan(aVetor,{|x| x[1] == .T.})

If At(" ",AllTrim(aVetor[oLbx:nAt,2])) > 0 
	MsgAlert( STR0030 + AllTrim(aVetor[oLbx:nAt,2]) + STR0031 ) // "O produto " / " Possui espaços no Codigo e não pode ser usado"
Else
	If Empty(nPos)
		aVetor[oLbx:nAt,1] := .T.
	Else
		If nPos == oLbx:nAt
			aVetor[nPos,1] := !aVetor[nPos,1]
		Else
			aVetor[nPos,1] := .F.
			aVetor[oLbx:nAt,1] := .T.
		Endif
	Endif
EndIf

oLbx:Refresh()            

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MT550Sl ºAutor    ³Varejo      º Data ³  16/07/2015         º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Funcao que atualiza campos e-commerce                      º±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ExpC1: Codigo do Produto-Pai                                ³±±  
±±|			   ³ExpC2: Codigo da Tabela de Grade                           ³±±  
±±|			   ³ExpN1: Tamanho da Raiz/Referencia                          ³±±  
±±|			   ³ExpN2: Tamanho da Linha                                    ³±±  
±±|			   ³ExpN3: Tamanho da Coluna                                   ³±±  
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso       ³Chama externa de atualização dos dados e-commerce           ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MT550Sel                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Function MT550Sl(cProdPai, cCodigo, nRaiz, nLinha, nColuna)
Local cMascara := GetMv("MV_MASCGRD")  //Máscara do campo

Default cProdPai := ""
Default cCodigo := ""
Default nRaiz :=  Val(Substr(cMascara,1,2))
Default nLinha := Val(Substr(cMascara,4,2))
Default nColuna :=  Val(Substr(cMascara,7,2))


If Type("nTamRef") = "U"
	Private nTamRef := nRaiz
EndIf

If Type("nTamLin") = "U"
	Private nTamLin := nLinha
EndIf

If Type("nTamCol") = "U"
	Private nTamCol := nColuna
EndIf

//Chamada da função estática
MT550Sel(cProdPai, cCodigo)

REturn

//-------------------------------------------------------------------
/*/{Protheus.doc} A550ProdEC
@description Funcao para verificar os codigos de produtos para o e-commerce Ciashop
			 os codigos de produto não podem possuir espaços no meio do codigo, isso
			 gera erro na integração.
@author Rene Julian
@since 06/02/2017
@version 11.80
/*/
//-------------------------------------------------------------------
Function A550ProdEC(cRef)
Local lRet 		 := .T.
Local lECommerce := SuperGetMV("MV_LJECOMM",.F.,.F.) //E-commerce ativo
Local lECCia 	 := SuperGetMV("MV_LJECOMO",,.F.) //E-commerce ciashop
Local cMensag    :=  STR0027	//"Para a Integração E-Commerce o codigo do Produto não pode conter espaço e não pode ser inferior ao tamanho do campo" + CRLF
Local cTitulo    :=  STR0028	//"Validação E-Commerce"

Default cRef := ""

cMensag += STR0029	//"Deseja manter esse codigo de produto e continuar o cadastro"

If lECommerce .And. lECCia .And. !Empty(cRef) 
	If Len(Alltrim(cRef)) < nTamRef .Or. ( At(" ",cRef) > 0 )
		lRet := MsgYesNo(cMensag,cTitulo)
	EndIf	
EndIf

Return(lRet)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A550_MudaEnc³ Autor ³ Andy Pudja | Varejo ³ Data ³ 08/02/18 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa de Alteraçao de Folder                            ³±±
±±³          ³ Normalizada à Tabela MHH                                   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ A550_MudaEnc(nAtu,oFolder) | oFolder:bSetOption            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ nAtu    = Número do Folder                                 ³±±
±±³          ³ oFolder = Objeto do Folder (Grade ou Complemento           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA550                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function A550_MudaEnc(nAtu,oFolder)
If nAtu== 1
	dbSelectArea("SB4")
	oEnc01:oBox:align:= CONTROL_ALIGN_ALLCLIENT
	oEnc01:Refresh()
Else
	dbSelectArea("MHH")
	M->MHH_COD:=M->B4_COD 
	oEnc02:oBox:align:= CONTROL_ALIGN_ALLCLIENT
	oEnc02:Refresh()
EndIf	
Return Nil


/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³a550Refresh³ Autor ³ Andy Pudja | Varejo  ³ Data ³08/06/2006³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Funcao executada pela TudoOk();Carrega as Variaveis de memo ³±±
±±³          ³ria e efetua o refresh da pasta em que nao esta posicionado.³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ Objeto Folder                                              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³ .T.    	                                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA050                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function a550Refresh(oFolder)
Local nPasta1 := oFolder:nOption     //-- Pasta em que esta posionado
Local nPasta2 := IIf(nPasta1==1,2,1) 
A550_MudaEnc(nPasta2) //-- Efetua a atualizacao das variaveis e Refresh da outra pasta
Return .T.

/*/{Protheus.doc} IntegDef
Funcao para processamento de mensagem unica.
@author Danilo Dias
@since 02/04/2012
@version 1.0
@Alterado por Roberto R. Mezzalira - incluso tratamento para Json
@data :  13/07/18 
@param xEnt, caracter/Object, Variavel com conteudo xml/obj para envio/recebimento.
@param nTypeTrans, numeric, Tipo de transacao. (Envio/Recebimento)
@param cTypeMessage, caracter, Tipo de mensagem. (Business Type, WhoIs, etc)
@param cVersion, caracter, Versão da Mensagem Única TOTVS
@param cTransac, caracter, Nome da mensagem iniciada no adapter
@param lEAIObj, Logical Recebe XML ou Objeto EAI
@return ${return}, ${return_description}
/*/
Static Function IntegDef( xEnt, nTypeTrans, cTypeMessage, cVersion, cTransac, lEAIObj )
Local aRet := {} //Retorno da rotina
Default xEnt := ""
Default nTypeTrans := ""
Default cTypeMessage := ""
Default cVersion := ""
Default cTransac := ""
Default lEAIObj := .F.

aRet := MATI550(xEnt,nTypeTrans,cTypeMessage, cVersion, cTransac, lEAIObj )

Return aRet

/*/{Protheus.doc} integraMRP
Verifica se realiza a integração com o MRP Memória.
@type  Static Function
@author lucas.fagundes
@since 21/03/2023
@version P12
@return _lIntMrp, Logico, Indica se pode realizar a integração com o MRP Memória
/*/
Static Function integraMRP()
	
If _lIntMrp == Nil
	_lIntMrp := FindFunction("mrpIntGrd")
EndIf

Return _lIntMrp
