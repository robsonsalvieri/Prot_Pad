#include 'tlpp-core.th'
#include 'tlpp-rest.th'
#include 'TOTVS.CH'

#define PATH_URL '/api/agd/v1/tco'
#define PATH_URL_STATUS '/api/agd/v1/tco/status'
#DEFINE PATH_URL_FILIAL '/api/agd/v1/tco/filiais-modulo'
#DEFINE PATH_URL_FEATURES '/api/agd/v1/tco/features-disponiveis'

namespace agd.tcoAPI 
using namespace agd.restUtils
using namespace agd.TCOservice
using namespace agd.wizardTCOService /*shortCurt de funcao*/

/*/{Protheus.doc} agdTCOapi
Controller TCO
@type class
@version 12
@author jc.maldonado
@since 23/09/2025
/*/
class agdTCOapi

	public Data nPage     As Integer
	public Data nPageSize As Integer
	
	public method new()

	@Get(PATH_URL)
  	public method listar() as logical

	@Get(PATH_URL_STATUS)
	public method getStatus() as logical

	@Get(PATH_URL_FEATURES)
	public method getFeaturesDisponiveis() as logical

	@Post(PATH_URL)
  	public method registrarFeature() as logical

	@Post(PATH_URL_FILIAL)
  	public method informarFilial() as logical


endClass

/*/{Protheus.doc} new
Constructor
@type method
@version 12
@author jc.maldonado
@since 23/09/2025
@return object, Instancia da classe
/*/
method new() class agdTCOapi
return self

/*/{Protheus.doc} getStatus
Retorna o status da configuração do TCO
@type method
@version 12
@author jc.maldonado
@since 23/09/2025
@return logical, always true
/*/
method getStatus() class agdTCOapi as logical
	local oAGDRestUtils as object
    local oTCOservice   as object
	
	oAGDrestUtils := agdRestUtils():New()
	oTCOservice := agdTCOservice():New()
	
	oTCOservice:getStatus()

	oAGDRestUtils:setAPIResponse(oRest, oTCOservice)

	FWFreeObj(oTCOservice)
	FWFreeObj(oAGDRestUtils)

return .t.

/*/{Protheus.doc} listar
Recurso REST para listar as Features Selecionadas do Módulo
@type method
@version 12
@author jean.schulze
@since 13/01/2025
@return logical, true
/*/
method listar() as logical class agdTCOapi
	Local oService As Object
	Local oRestService As Object
	Local oJsonQryParam := Nil

	oRestService := agdRestUtils():New()
	oService := agdTCOservice():New()

	oRestService:getPageAndPageSize(@Self:nPage, @Self:nPageSize)
	oJsonQryParam := oRestService:getQueryParams()

	oService:getFeatures(Self:nPage, Self:nPageSize, oJsonQryParam)

	oRestService:setAPIResponse(oRest, oService)

	FreeObj(oService)
	FreeObj(oRestService)
return .T.


/*/{Protheus.doc} registrarFeature
Registra uma Feature
@type method
@version 12
@author jean.schulze
@since 26/09/2025
@return logical, retorno
/*/
method registrarFeature() as logical class agdTCOApi
    Local oTCOservice As Object
    Local oRestService      As Object
    Local jCmdRegistrar     as Json     

    oRestService := agdRestUtils():New()
    oTCOservice := agdTCOservice():New()
        
    jCmdRegistrar := oRestService:getRequestBody() 

    oTCOservice:registrarFeature(jCmdRegistrar)
    
    oRestService:setAPIResponse(oRest, oTCOservice)

    FreeObj(oTCOservice)
    FreeObj(oRestService)
    FreeObj(jCmdRegistrar)
return .T.

/*/{Protheus.doc} informarFilial
Recurso REST para inserir Venda Perdida de Negócios Barter
@type method
@version 12
@author jean.schulze
@since 13/01/2025
@return logical, true
/*/
method informarFilial() as logical class agdTCOApi
    Local oWizardTCOService As Object
    Local oRestService      As Object
    Local jCmdRegistrar     as Json     

    oRestService := agdRestUtils():New()
    oWizardTCOService := agdWizardTCOService():New()
        
    jCmdRegistrar := oRestService:getRequestBody() 

    oWizardTCOService:informarFiliais(jCmdRegistrar['compartilhaFilial'], jCmdRegistrar['filiaisSelecionadas'] )
    
    oRestService:setAPIResponse(oRest, oWizardTCOService)

    FreeObj(oWizardTCOService)
    FreeObj(oRestService)
    FreeObj(jCmdRegistrar)
return .T.

/*/{Protheus.doc} getFeaturesDisponiveis
Retorna as features disponiveis
@type method
@version 12
@author jean.schulze
@since 26/09/2025
@return variant, retorno
/*/
method getFeaturesDisponiveis() class agdTCOapi as logical
	local oAGDRestUtils as object
    local oTCOservice   as object

	oAGDrestUtils := agdRestUtils():New()
	oTCOservice := agdTCOservice():New()
	
	oTCOservice:getFeaturesDisponiveis()

	oAGDRestUtils:setAPIResponse(oRest, oTCOservice)

	FWFreeObj(oTCOservice)
	FWFreeObj(oAGDRestUtils)

return .t.

