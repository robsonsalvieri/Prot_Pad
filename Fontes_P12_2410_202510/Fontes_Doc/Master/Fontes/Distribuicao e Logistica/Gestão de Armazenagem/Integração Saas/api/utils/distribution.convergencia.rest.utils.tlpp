#include "tlpp-core.th"

/*/{Protheus.doc} WMSSaasParseBodyFromRest
    (long_description)
    @type  Static Function
    @author user
    @since 22/04/2024
    @version version
    @param oRest, object, objeto do rest
    @return oJsonBody, json, corpo da requisicao no formato json
    @example
    (examples)
    @see (links_or_references)
/*/
Function WMSSaasParseBodyFromRest(oRest as object) as json
Local oJsonBody := JsonObject():new()
Local oError    := WMSSaasRestError():new()

    If !Empty(oJsonBody:fromJson(oRest:getBodyRequest()))
        oError:setDescription("Erro na conversão do corpo da requisição")
        oError:setStatus(500)
        BREAK(oError)
    EndIf
Return oJsonBody

/*/{Protheus.doc} WMSSaasGetPathParamsFromRest
    (long_description)
    @type  Static Function
    @author user
    @since 22/04/2024
    @version version
    @param param_name, param_type, param_descr
    @return return_var, return_type, return_description
    @example
    (examples)
    @see (links_or_references)
/*/
Function WMSSaasGetPathParamsFromRest(oRest as object) as json
Return oRest:getPathParamsRequest()


/*/{Protheus.doc} WMSSaasGetQueryParamsFromRest
    (long_description)
    @type  Static Function
    @author user
    @since 22/04/2024
    @version version
    @param param_name, param_type, param_descr
    @return return_var, return_type, return_description
    @example
    (examples)
    @see (links_or_references)
/*/
Function WMSSaasGetQueryParamsFromRest(oRest as object) as json
Local jParams := JsonObject():new()
  
    jParams := oRest:getQueryRequest()
Return jParams

/*/{Protheus.doc} WMSSaasErrorBlock
    (long_description)
    @type  Static Function
    @author user
    @since 22/04/2024
    @version version
    @param param_name, param_type, param_descr
    @return return_var, return_type, return_description
    @example
    (examples)
    @see (links_or_references)
/*/
Function WMSSaasErrorBlock( oError as object)
Local cErr := oError:Description
Local cStack := oError:ERRORSTACK
Local oErrorWMS := WMSSaasRestError():new()

    oErrorWMS:setDescription(cErr)
    oErrorWMS:setDetailedMessage({cStack})
    oErrorWMS:setStatus(500)
    
    Break(oErrorWMS)
Return

/*/{Protheus.doc} WMSSaasErrorBlockAdapter
    (long_description)
    @type  Function
    @author user
    @since 17/03/2025
    @version version
    @param param_name, param_type, param_descr
    @return return_var, return_type, return_description
    @example
    (examples)
    @see (links_or_references)
/*/
Function WMSSaasErrorBlockAdapter( oErrorWMS as object, oErrorAdapter as object)
Local cErr := oErrorWMS:Description
Local cStack := oErrorWMS:ERRORSTACK

Private oError := WMSSaasRestError():new()

   oErrorAdapter:setDescription(cErr)
   oErrorAdapter:setDetailedMessage({cStack})
   oErrorAdapter:setStatus(500)

   DisarmTransaction()
   Break(oErrorAdapter)
Return oErrorAdapter
