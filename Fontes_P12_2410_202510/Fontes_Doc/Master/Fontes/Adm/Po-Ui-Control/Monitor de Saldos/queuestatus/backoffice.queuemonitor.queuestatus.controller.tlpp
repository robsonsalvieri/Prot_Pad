#include "tlpp-core.th"
#include "backoffice.queuemonitor.queuestatus.controller.ch"

namespace totvs.protheus.backoffice.queuemonitor.queuestatus

//-------------------------------------------------------------------
/*/{Protheus.doc} QueueStatus
Classe principal de controle, onde é inicializado o EndPoint
@author Totvs
/*/
//-------------------------------------------------------------------
class QueueStatus
    public method new()
    @Get("/api/qm/queuestatus/")
    public method getAllQueueStatus()
    public method QueueResponse()
endclass

//-------------------------------------------------------------------
/*/{Protheus.doc} QueueStatus
Metodo construtor

@author Totvs
/*/
//-------------------------------------------------------------------
method new() class QueueStatus
return

//-------------------------------------------------------------------
/*/{Protheus.doc} getAllQueueStatuss
Metodo que inicia a chamada das configuracoes de match do conciliador

@author Totvs
/*/
//-------------------------------------------------------------------
method getAllQueueStatus() class QueueStatus
    Local oService := QueueStatusService():getInstance() As Json
    Local cReturn   := "" as Character
    Local lReturn   := .F. as Logical
    Local cChaveRes := "message" As Character
    Local cResponse := "" As Character

    //Inicializa variaveis
    cResponse := STR0001 // Responsta Inválida.

    cReturn := oService:getAllQueueStatus()

    lReturn := !Empty(cReturn)

    If lReturn
        cChaveRes := "data"
        cResponse := cReturn
    EndIf

    ::QueueResponse(lReturn ,cChaveRes, cResponse)

return

//-------------------------------------------------------------------
/*/{Protheus.doc} QueueResponse
Padroniza a resposta da API

@author Totvs
/*/
//-------------------------------------------------------------------
method QueueResponse(lResponse As Logical, cChaveRes As Character, cResponse As Character) class QueueStatus
    Local cReturn := "" As Character

    If ValType(oRest) == "O"
        If ValType(lResponse) == "L" .And. ValType(cChaveRes) == "C" .And. ValType(cResponse) == "C"
            oRest:setKeyHeaderResponse("Content-Type", "application/json")
            cReturn := cResponse
            oRest:setResponse(cReturn)
        EndIf
    EndIf
return
