#include 'tlpp-core.th'

NAMESPACE totvs.protheus.backoffice.fin.queryutil

/*/{Protheus.doc} FinExecSql
	Executa uma instrução ADVPL diretamente no banco de dados 
	e realiza o tratamento do erro
	@type  Function
	@author Vitor Duca
	@since 27/05/2024
	@version 1.0
	@param cSql, Character, Comando SQL que será executado
	@param bPosValid, CodeBlock, Bloco de codigo que será executado após o tratamento de erro
	@param lExibeMsg, Logical, Define se exibe a tela com o erro de SQL
	@return return_var, return_type, return_description
	@example
	totvs.protheus.backoffice.fin.queryutil.FinExecSql("DELETE FROM TABELA", {|| MINHAFUNCAO()})
	@see (links_or_references)
/*/
Function FinExecSql(cSql As Character, bPosValid As CodeBlock, lExibeMsg As Logical)
	Local cError As Character

	Default cSql := ""
	Default bPosValid := NIL
	Default lExibeMsg := .F.

	If TcSqlExec(cSql) < 0
		cError := TcSqlError()
		FwLogMsg("ERROR", /*cTransactionId*/, FunName(), "FINEXECSQL", "", FunName(), cError)

		If lExibeMsg
			FinxMsgE(cError)
		Endif
		
		If bPosValid <> NIL
			Eval(bPosValid)
		Endif
	Endif
Return
