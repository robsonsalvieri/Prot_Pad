#INCLUDE "PROTHEUS.CH"
#INCLUDE "APDA020.CH"

Static lAPD20REL 	:= ExistBlock( "APD20REL" )
Static lAPD20ROT 	:= ExistBlock( "APD20ROT" )
Static lChkRdzRel	:= ExistBlock( "ChkRdzRel" )
Static lAPDGRV01 	:= ExistBlock("APDGRV01")
Static lIntegDef 	:= FindFunction("GETROTINTEG") .And. FindFunction("FWHASEAI")
Static cIdiom		:= FWRetIdiom()
Static lRd0CPO		
Static lLastPwd  	
Static aBkpCols		:= {}

/*/
зддддддддддбддддддддддбдддддбдддддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤└o    ЁAPDA020   ЁAutorЁMarinaldo de Jesus       Ё Data Ё16/07/2003Ё
цддддддддддеддддддддддадддддадддддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁCadastro de Participantes/Pessoas                           Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁGenerico                                                    Ё
цддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё            ATUALIZACOES SOFRIDAS DESDE A CONSTRU─AO INICIAL           Ё
цддддддддддддбддддддддддбдддддддддддбддддддддддддддддддддддддддддддддддд╢
ЁProgramador ЁData      ЁBOPS       ЁMotivo da Alteracao                Ё
цддддддддддддеддддддддддедддддддддддеддддддддддддддддддддддддддддддддддд╢
ЁCecilia Car.Ё03/07/2014ЁTPZWBQ     ЁIncluido o fonte da 11 para a 12 e Ё
Ё            Ё          Ё           Ёefetuada a limpeza.                Ё
ЁEmerson CampЁ29/08/14Ё       TQJPMVЁQuando altera a senha da Pessoa    Ё
Ё            Ё        Ё             ЁtambИm altera a do funcionАrio     Ё
ЁSidney O.   Ё01/09/14Ё       TQGRY3ЁAlterada legenda dos participantes Ё
Ё            Ё        Ё             ЁExibicao do nome do participante naЁ
Ё            Ё        Ё             Ёna tela de relacionamento          Ё
ЁEmerson CampЁ03/09/14Ё       TQJPMVЁQuando altera a senha da Pessoa    Ё
Ё            Ё        Ё             ЁtambИm altera todas do funcionАrio Ё
ЁGustavo M.  Ё19/09/14Ё       TQPKPIЁAjuste na tela de relacionamento doЁ
Ё            Ё        Ё             Ёparticipante.						Ё
ЁRenan BorgesЁ27/04/15Ё       TRHXHPЁAjuste no relacionamento de particiЁ
Ё            Ё        Ё             Ёpantes, para realizar o relaciona- Ё
Ё            Ё        Ё             Ёmento corretamente, pois estava re-Ё
Ё            Ё        Ё             Ёlacionando varios participantes pa-Ё
Ё            Ё        Ё             Ёra um Зnico CPF.                   Ё
ЁRenan BorgesЁ14/07/15Ё       TSRMGQЁAjuste na validacao do campo do CPFЁ
Ё            Ё        Ё             ЁRD0_CIC para permitir mais de um   Ё
Ё            Ё        Ё             Ёparticipante com CPF em branco.    Ё
ЁMatheus M.  Ё17/12/15Ё       TYOAYAЁAjuste para que ao relacioanr fun- Ё
Ё            Ё        Ё             ЁcionАrios p/ participantes, os     Ё
Ё            Ё        Ё             Ёmesmos sejam relacionados com a suaЁ
Ё            Ё        Ё             ЁsituaГЦo corretamente na folha.    Ё
ЁClaudinei S.Ё06/07/16ЁTUQEO7/TUHOIBЁAjuste p/ validar a existencia das Ё
Ё            Ё        Ё             Ёfuncoes de integracao Totvs Reserv.Ё
ЁMatheus M.  Ё31/08/16Ё       TVUTVUЁAjuste para permitir incluir regis-Ё
Ё            Ё        Ё             Ёtro corretamente no campo          Ё
Ё            Ё        Ё             ЁSub.Prsta.Cta.				        Ё
ЁMatheus M.  Ё17/11/16Ё       TWLBEKЁAjuste para alterar os registros   Ё
Ё            Ё        Ё             Ёcorretamente.			            Ё
ЁEduardo K.  Ё06/04/17ЁMPRIMESP-9587ЁAjuste na execuГЦo do P.E. APD20RELЁ
ЁOswaldo L.  |18/04/17|DRHPONTP-334 |Tratar mascara senha RD0_SENHA     Ё
ЁWillian U.  Ё08/06/17ЁDRHPONTP-59  ЁTratamento da mАscara transferido  Ё
Ё            Ё        Ё             Ёpara o fonte AjSXAPD.PRW por se    Ё
Ё            Ё        Ё             Ёtratar de alteraГЦo do dicionАrio  Ё
ЁM. Silveira Ё22/06/17ЁDRHPONTP-986 ЁAjuste na chamada da RetSituacao() Ё
Ё            Ё        Ё             Ёpara melhoria de performance.      Ё
ЁJulio Silva Ё13/03/18ЁMPRIMESP-    ЁAjuste para alterar o RA_SENHA,    Ё
Ё            Ё        Ё14265        Ёquando estА logado em filial difer_Ё
Ё            Ё        Ё             Ёente do cadastro do funcionario,   Ё
Ё            Ё        Ё             Ёpois editava apenas o RD0_SENHA.   Ё
ЁWesley AlvesЁ08/04/19ЁDRHGCH-18660 ЁCriaГЦo de pontos de chamada para  Ё
ЁPereira                             envio de dados por API nos proce-  Ё
									 ssos de inclusЦo/alteraГЦo/deleГЦo Ё
									 de dependentes.                    Ё
юддддддддддддаддддддддадддддддддддддаддддддддддддддддддддддддддддддддддды/*/

Function APDA020( cAlias , nReg , nOpc , lExecAuto, aAuto )

Local aArea		:= GetArea()
Local aAreaRd0	:= RD0->( GetArea() )
Local aAreaRdz	:= RDZ->( GetArea() )
Local aAreaSra	:= SRA->( GetArea() )
Local cSvFilAnt	:= cFilAnt
Local lExistOpc	:= ( ValType( nOpc ) == "N" )

Local bBlock
Local nPos
Local aIndexRD0		:= {} 	//Array para os indices da tabela RD0

Local aColors	:=	{	                                    	 	 ;
					{ "RD0->RD0_MSBLQL=='1'" , 'BR_VERMELHO'	}	,;
					{ "RD0->RD0_MSBLQL=='2'" , 'BR_VERDE'	}	;
				   }

Default lAPD20REL := ExistBlock( "APD20REL" )
Default lAPD20ROT 	:= ExistBlock( "APD20ROT" )
Default lChkRdzRel	:= ExistBlock( "ChkRdzRel" )

Private lApd020Auto 	:=	(aAuto<>Nil)

Private lAlterApi := .F.

Private cAuxFil		:= cFilAnt

Begin Sequence

	If Apda020PFS() // Se a integraГЦo com escritСrios de advocacia (mСdulo 77 - SIGAPFS) estiver habilitada
		JURA159() // Executa a rotina de participantes do mСdulo SIGAPFS
		Break
	EndIf

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁSo Executa se o Modo de Acesso dos Arquivos do Modulo APD estiЁ
	Ёverem OK													   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF ( cModulo == "APD" )
		IF !( ApdRelationFile() )
			Break
		EndIF
	Else
		/*/
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		ЁVerifica o Modo de Acesso do RD0 e RDZ. Deverao ser , ObrigatoЁ
		Ёriamente, Compartilhado.                                      Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
		IF !( Rd0ChkModo() .or. !RdzChkModo() )
			Break
		EndIF
	EndIF

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁRedefine o Alias                                              Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	cAlias	:= "RD0"

	Private aRotina := MenuDef() // ajuste para versao 9.12 - chamada da funcao MenuDef() que contem aRotina

	Private cCadastro

	IF ( cModulo == "APD" )
		cCadastro   := OemToAnsi( STR0007 )	//"Cadastro de Participantes"
	Else
		cCadastro   := OemToAnsi( STR0024 )	//"Cadastro de Pessoas"
	EndIF

	IF ( lExistOpc )
		If aAuto == Nil .OR. Len(aAuto) == 0
			/*/
			здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
			ЁGarante o Posicinamento do Recno                              Ё
			юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
			DEFAULT nReg	:= ( cAlias )->( Recno() )
			IF !Empty( nReg )
				( cAlias )->( MsGoto( nReg ) )
			EndIF

			DEFAULT lExecAuto := .F.
			IF ( lExecAuto )

				nPos := aScan( aRotina , { |x| x[4] == nOpc } )
				IF ( nPos == 0 )
					Break
				EndIF
				bBlock := &( "{ |a,b,c,d| " + aRotina[ nPos , 2 ] + "(a,b,c,d) }" )
				Eval( bBlock , cAlias , nReg , nPos )

			Else

				Apda020Mnt( cAlias , nReg , nOpc , .T. )

			EndIF
		Else
				If !Empty(xFilial("RD0"))
			   		nPos := Ascan(aAuto,{|x| Alltrim(x[1]) == "RD0_FILIAL"})
			   		If nPos > 0
			   			If FWFilExist(,aAuto[nPos,2])
			   				cFilAnt := aAuto[nPos,2]
			   			Else
			   				Break
			   			EndIf
			   		EndIf
		   		EndIf
				dbSelectArea("RD0")
				MsRotAuto(nOpc,aAuto,"RD0")
		EndIf

	Else
		/*/
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		Ё Chama a Funcao de Montagem do Browse                                   Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
		RD0->( dbSetOrder( RetOrdem( cAlias , "RD0_FILIAL+RD0_CODIGO" ) ) )
		/*
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		Ё Inicializa o filtro utilizando a funcao FilBrowse                      Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
		cFiltraRh := ChkRh("APDA020","RD0","1")
		bFiltraBrw := { || FilBrowse("RD0",@aIndexRD0,@cFiltraRH)}
        Eval( bFiltraBrw )

		mBrowse( 6 , 1 , 22 , 75 , cAlias , NIL , NIL , NIL , "RD0->RD0_MSBLQL$' 2'",, aColors)

		/*
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		Ё Deleta o filtro utilizando a funcao FilBrowse                     	 Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
		EndFilBrw( cAlias , aIndexRD0 )

	EndIF

End Sequence

/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
ЁColoca o Ponteiro do Mouse em Estado de Espera			   	   Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
If !lApd020Auto
	CursorWait()
EndIf
/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Ё Restaura os Dados de Entrada 											 Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
cFilAnt	:= cSvFilAnt
RestArea( aAreaRd0 )
RestArea( aAreaRdz )
RestArea( aAreaSra )
RestArea( aArea    )

//Retorna o SET EPOCH padrao do framework
If(FindFunction( "RetPadEpoch" ))
	RetPadEpoch()
EndIf

/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
ЁRestaura o Cursor do Mouse                				   	   Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
CursorArrow()

Return( NIL )

/*/
зддддддддддбддддддддддддддбддддддбдддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤└o    ЁInApda020Exec ЁAutor ЁMarinaldo de Jesus   Ё Data Ё24/08/2004Ё
цддддддддддеддддддддддддддаддддддадддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁExecutar Funcoes Dentro de APDA020                           Ё
цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   ЁInApda020Exec( cExecIn , aFormParam )						 Ё
цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									 Ё
цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁRetorno   ЁuRet                                                 	     Ё
цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁObserva┤└oЁ                                                      	     Ё
цддддддддддеддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁGenerico 													 Ё
юддддддддддаддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function InApda020Exec( cExecIn , aFormParam )

Local uRet

DEFAULT cExecIn		:= ""
DEFAULT aFormParam	:= {}

IF !Empty( cExecIn )
	cExecIn	:= BldcExecInFun( cExecIn , aFormParam )
	uRet	:= &( cExecIn )
EndIF

Return( uRet )

/*/
зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁApda020VisЁ Autor ЁMarinaldo de Jesus     Ё Data Ё27/02/2004Ё
цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁCadastro de Participantes/Pessoas ( Visualizar )			Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<vide parametros formais>          							Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<vide parametros formais>          							Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁAPDA020()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Apda020Vis( cAlias , nReg )
Return( APDA020( cAlias , nReg , 2 ) )

/*/
зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁApda020IncЁ Autor ЁMarinaldo de Jesus     Ё Data Ё27/02/2004Ё
цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁCadastro de Participantes/Pessoas ( Incluir )				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<vide parametros formais>          							Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<vide parametros formais>          							Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁAPDA020()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Apda020Inc( cAlias , nReg )
Return( APDA020( cAlias , nReg , 3 ) )

/*/
зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁApda020AltЁ Autor ЁMarinaldo de Jesus     Ё Data Ё27/02/2004Ё
цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁCadastro de Participantes/Pessoas ( Alterar )				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<vide parametros formais>          							Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<vide parametros formais>          							Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁAPDA020()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Apda020Alt( cAlias , nReg )
Return( APDA020( cAlias , nReg , 4 ) )

/*/
зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁApda020DelЁ Autor ЁMarinaldo de Jesus     Ё Data Ё27/02/2004Ё
цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁCadastro de Participantes/Pessoas ( Excluir )				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<vide parametros formais>          							Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<vide parametros formais>          							Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁAPDA020()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Apda020Del( cAlias , nReg )
Return( APDA020( cAlias , nReg , 5 ) )

/*/
зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁApda020MntЁ Autor ЁMarinaldo de Jesus     Ё Data Ё18/06/2002Ё
цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁCadastro de Participantes/Pessoas (Manutencao)				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   ЁApda020Mnt( cAlias , nReg , nOpc , lDlgPadSiga )			Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁcAlias 		= Alias do arquivo                              Ё
Ё          ЁnReg   		= Numero do registro                            Ё
Ё          ЁnOpc   		= Numero da opcao selecionada                   Ё
Ё          ЁlDlgPadSiga = Numero da opcao selecionada                   Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁAPDA020()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Apda020Mnt( cAlias , nReg , nOpc , lDlgPadSiga )

Local aArea				:= GetArea(Alias())
Local aSvKeys			:= GetKeys()
Local aAdvSize			:= {}
Local aInfoAdvSize		:= {}
Local aObjSize			:= {}
Local aObjCoords		:= {}
Local aSvRd0Cols		:= {}
Local aRd0Fields		:= {}
Local aRd0Altera		:= {}
Local aRd0NaoAlt		:= {}
Local aRd0VirtEn		:= {}
Local aRd0MemoEn		:= {}
Local aRdyRecnos 		:= {}
Local aRdyKeys			:= {}
Local aRd0NotFields		:= {}
Local aRd0Recnos		:= {}
Local aRd0Keys			:= {}
Local aRd0VisuEn		:= {}
Local aSvSetModulo		:= {}
Local aButtons			:= {}
Local aFreeLocks		:= {}
Local bSet15			:= { || NIL }
Local bSet24			:= { || NIL }
Local bDialogInit		:= { || NIL }
Local bRd0EnchOk		:= { || NIL }
Local bRd0Relation		:= { || NIL }
Local bGetRd0			:= { || NIL }
Local cFilRD0			:= ""
Local cCodRD0			:= ""
Local cSraMat			:= ""
Local lLocks			:= .F.
Local lExecLock			:= ( ( nOpc <> 2 ) .and. ( nOpc <> 3 ) )
Local nOpcAlt			:= 0
Local nRD0Usado			:= 0
Local nLoop				:= 0
Local nLoops			:= 0
Local oDlg				:= NIL
Local oEndRd0			:= NIL

Private aGets
Private aTela

Private aRd0Header		:= {}
Private aRd0Cols		:= {}
Private __nRd0SvRecno__	:= 0
Private nGetSX8Len		:= GetSX8Len()

If IsInCallStack("ATFA012") .Or. IsInCallStack("ATFA240")
	lApd020Auto := .F.
Endif

/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
ЁPoe o cursor do Mouse em Estado de Espera					   Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
If !lApd020Auto
	CursorWait()
EndIf

Begin Sequence

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁCheca a Opcao Selecionada									   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	aRotSetOpc( cAlias , @nReg , nOpc )
	__nRd0SvRecno__ := nReg

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Executa a Funcao para a Carga de Participantes/Pessoas	   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF ( nOpc == 6 )
		// Informa usuАrio sobre compartilhamento indevido na SRA
		If fR33SRA()
			Return
		EndIf
		Apda020Rd0Upd( cAlias , nReg , nOpc )
		Break
	ElseIF ( nOpc == 3 )
		/*/
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		Ё Inclusao a Partir do Cadastro de Funcionarios				   Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
		IF ( cModulo $ "GPE_PON_APD_RSP_TRM_CSA_CSA_TCF" )	//Modulos de RH
			CursorArrow()
			IF ( MsgNoYes( OemToAnsi( STR0014 ) ) ) //"InclusЦo de Participante FuncionАrio?"
				// Informa usuАrio sobre compartilhamento indevido na SRA
				If fR33SRA()
					Return
				EndIf
				aSvSetModulo := SetModulo( "SIGAGPE" , "GPE" )
				cCadastro	 := STR0035	//"FuncionАrios"
				Gp010Inc( "SRA" , 0 , nOpc , @cSraMat )
				ReSetModulo( aSvSetModulo )
				IF ( cModulo == "APD" )
					cCadastro   := OemToAnsi( STR0007 )	//"Cadastro de Participantes"
				Else
					cCadastro   := OemToAnsi( STR0024 )	//"Cadastro de Pessoas"
				EndIF
				IF (;
						Empty( cSraMat );
						.or.;
						!ExistePessoa( "SRA" , xFilial("SRA") + cSraMat , cEmpAnt , cFilAnt , .T. );
					)
					Break
				EndIF
				nReg := RD0->( Recno() )
				aRotSetOpc( cAlias , nReg , 4 )
			EndIF
			If !lApd020Auto
				CursorWait()
			EndIf
		EndIF
	EndIF

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Monta os Dados para a Enchoice							   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	aRd0NotFields	:= { "RD0_FILIAL" }
	bGetRd0			:= { |lLock,lExclu|	IF( lExecLock , ( lLock := .T. , lExclu	:= .T. ) , aRd0Keys := NIL ),;
										aRd0Cols := RD0->(;
															GdBuildCols(	@aRd0Header		,;	//01 -> Array com os Campos do Cabecalho da GetDados
																			@nRd0Usado		,;	//02 -> Numero de Campos em Uso
																			@aRd0VirtEn		,;	//03 -> [@]Array com os Campos Virtuais
																			@aRd0VisuEn		,;	//04 -> [@]Array com os Campos Visuais
																			"RD0"			,;	//05 -> Opcional, Alias do Arquivo Carga dos Itens do aCols
																			aRd0NotFields	,;	//06 -> Opcional, Campos que nao Deverao constar no aHeader
																			@aRd0Recnos		,;	//07 -> [@]Array unidimensional contendo os Recnos
																			"RD0"		   	,;	//08 -> Alias do Arquivo Pai
																			NIL				,;	//09 -> Chave para o Posicionamento no Alias Filho
																			NIL				,;	//10 -> Bloco para condicao de Loop While
																			NIL				,;	//11 -> Bloco para Skip no Loop While
																			NIL				,;	//12 -> Se Havera o Elemento de Delecao no aCols
																			NIL				,;	//13 -> Se Sera considerado o Inicializador Padrao
																			NIL				,;	//14 -> Opcional, Carregar Todos os Campos
																			NIL				,;	//15 -> Opcional, Nao Carregar os Campos Virtuais
																			NIL				,;	//16 -> Opcional, Utilizacao de Query para Selecao de Dados
																			NIL				,;	//17 -> Opcional, Se deve Executar bKey  ( Apenas Quando TOP )
																			NIL				,;	//18 -> Opcional, Se deve Executar bSkip ( Apenas Quando TOP )
																			NIL				,;	//19 -> Carregar Coluna Fantasma
																			NIL				,;	//20 -> Inverte a Condicao de aNotFields carregando apenas os campos ai definidos
																			NIL				,;	//21 -> Verifica se Deve Checar se o campo eh usado
																			NIL				,;	//22 -> Verifica se Deve Checar o nivel do usuario
																			NIL				,;	//23 -> Verifica se Deve Carregar o Elemento Vazio no aCols
																			@aRd0Keys		,;	//24 -> [@]Array que contera as chaves conforme recnos
																			@lLock			,;	//25 -> [@]Se devera efetuar o Lock dos Registros
																			@lExclu			 ;	//26 -> [@]Se devera obter a Exclusividade nas chaves dos registros
																	    );
														  ),;
										IF( lExecLock , ( lLock .and. lExclu ) , .T. );
	  					}
	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁLock do Registro do RD0									   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF !( lLocks := WhileNoLock( "RD0" , NIL , NIL , 1 , 1 , .T. , 1 , 5 , bGetRd0 ) )
		Break
	EndIF

	If !lApd020Auto
		CursorWait()
	EndIf
	
	aSvRd0Cols		:= aClone( aRd0Cols )
	cFilRD0			:= RD0->RD0_FILIAL
	cCodRD0			:= RD0->RD0_CODIGO

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Cria as Variaveis de Memoria e Carrega os Dados Conforme o arЁ
	Ё quivo														   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	If nOpc == 3  .Or. (nOpc == 4 .And. aSvRd0Cols[1, 1] == cCodRD0)
		For nLoop := 1 To nRD0Usado
			aAdd( aRd0Fields , aRd0Header[ nLoop , 02 ] )
			If !lApd020Auto
				SetMemVar( aRd0Header[ nLoop , 02 ] , aRd0Cols[ 01 , nLoop ] , .T. )
			EndIf
		Next nLoop

		If !IsInCallStack("APDA020INC")
			aBkpCols := aClone(aSvRd0Cols)
		EndIf

	EndIf
	
	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁDefine os Campos Editaveis na Enchoice Apenas na Inclusao( 3 )Ё
	Ёou Alteracao(4)											   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF ( ( nOpc == 3 ) .or. ( nOpc == 4 ) )

		/*/
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		Ё Define os Campos Editaveis								   Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
		nLoops := Len( aRd0VisuEn )
		For nLoop := 1 To nLoops
			aAdd( aRd0NaoAlt , aRd0VisuEn[ nLoop ] )
		Next nLoop
		IF ( nOpc == 4 )
			aAdd( aRd0NaoAlt , "RD0_CODIGO" )
		EndIF
		nLoops := Len( aRd0Fields )
		For nLoop := 1 To nLoops
			IF ( aScan( aRd0NaoAlt , { |cNaoA| cNaoA == aRd0Fields[ nLoop ] } ) == 0 )
				aAdd( aRd0Altera , aRd0Fields[ nLoop ] )
			EndIF
		Next nLoop

	EndIF

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁObtem os Recnos e Chaves dos Memos                            Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	//aAdd( aRd0MemoEn , { "RD0_MEMOQF" } )
	IF ( ( nOpc <> 2 ) .and. ( nOpc <> 3 ) )
		IF !( lLocks := ApdMemRec( "RD0" , aRd0Recnos , aRd0MemoEn , @aRdyRecnos , @aRdyKeys , .T. ) )
			Break
		EndIF
	EndIF


	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁVerifica se Pode Efetuar a Delecao dos Registros			   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF ( nOpc == 5 )
		IF !( Apda020ChkDel( cAlias , nReg , nOpc , cCodRD0 ) )
			Break
		EndIF
	EndIF

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Monta as Dimensoes dos Objetos         					   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	DEFAULT lDlgPadSiga	:= .F.
	aAdvSize		:= MsAdvSize( )
	aInfoAdvSize	:= { aAdvSize[1] , aAdvSize[2] , aAdvSize[3] , aAdvSize[4] , 1 , 1 }
	aAdd( aObjCoords , { 000 , 000 , .T. , .T. } )
	aObjSize		:= MsObjSize( aInfoAdvSize , aObjCoords )

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Define o Bloco para o TudoOk da Enchoice   				   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	bRd0EnchOk		:= { || Apda020TEncOk( nOpc , oEndRd0 ) }	//Valida Todos os Campos da Enchoice

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁSe Existir o Arquivo de Relacionamento com o RD0 DisponibilizaЁ
	ЁBotao														   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF BldArrRdZRel()
		/*/
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		Ё Define o Botao de Pesquisa dos Relacionamentos com o RD0	   Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
		bRd0Relation := { || Rd0Relation( cAlias , nReg , nOpc ),;
							SetKey( VK_F6 , bRd0Relation );
				   	  }
		aAdd(;
				aButtons	,;
								{;
									"DESTINOS_OCEAN"					,;
		   							bRd0Relation						,;
		       	   					OemToAnsi( STR0036  + "...<F6>"  )	,;	//"Relacionamentos"
		       	   					OemToAnsi( STR0036  )				 ;	//"Relacionamentos"
		           				};
		     )
	EndIF

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Define o Bloco para a Tecla <CTRL-O>						   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	bSet15		:= { || IF(;
								( ( nOpc == 3 ) .or. ( nOpc == 4 ) );			//Inclusao ou Alteracao
								.and.;
								Eval( bRd0EnchOk ),;							//Verifica os Campos Obrigatoris na Enchoice
								(;
									nOpcAlt := 1 ,;
									RestKeys( aSvKeys , .T. ),;
									oDlg:End();
							 	),;
							 	IF(;
							 		( ( nOpc == 3 ) .or. ( nOpc == 4 ) ) ,;		//Inclusao ou Visualizacao
							 			(;
							 				nOpcAlt := 0 ,;
							 				.F.;
							 			 ),;
									(;
										nOpcAlt := IF( nOpc == 2 , 0 , 1 ) ,;	//Visualizacao ou Exclusao
										RestKeys( aSvKeys , .T. ),;
										oDlg:End();
							 		);
							 	  );
						   );
					 }
	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Define o Bloco para a Tecla <CTRL-X>     	   				   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	bSet24		:= { || ( nOpcAlt := 0 , RestKeys( aSvKeys , .T. ) , oDlg:End() ) }

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Define o Bloco para a Inicializacao do Dialog            	   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	bDialogInit		:= { || EnchoiceBar( oDlg , bSet15 , bSet24 , NIL , aButtons ) , SetKey( VK_F6 , bRd0Relation ) }

	// Monta a Dialog Principal
	If lApd020Auto
			Apda020Grava(	nOpc		,;	//Opcao de Acordo com aRotina
										 					nReg		,;	//Numero do Registro do Arquivo Pai ( RD0 )
										 					aRd0Header	,;	//Campos do Arquivo Pai ( RD0 )
										 					aRd0Cols	,;	//Conteudo Atual dos Campos do Arquivo Pai ( RD0 )
										 					aSvRd0Cols	,;	//Conteudo Anterior dos Campos do Arquivo Pai ( RDM )
										 					aRd0VirtEn	,;	//Campos Virtuais do Arquivo Pai ( RD0 )
														 	aRd0MemoEn	 ;	//Campos Memo para a MsMm
														)
	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Monta o Dialogo Principal para a Manutencao das Formulas	   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	Else
	   	DEFINE MSDIALOG oDlg TITLE OemToAnsi( STR0007 ) From aAdvSize[7],0 TO aAdvSize[6],aAdvSize[5]  OF GetWndDefault() PIXEL

			/*/
			здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
			Ё Monta o Objeto Enchoice para o RD0                      	   Ё
			юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
			oEndRd0	:= MsmGet():New(	cAlias		,;
										nReg		,;
										nOpc		,;
										NIL			,;
										NIL			,;
										NIL			,;
										aRd0Fields	,;
										aObjSize[1]	,;
										aRd0Altera	,;
										NIL			,;
										NIL			,;
										NIL			,;
										oDlg        ,;
										NIL			,;
										.F.			,;
										NIL			,;
										.F.			 ;
									)

		ACTIVATE MSDIALOG oDlg ON INIT Eval( bDialogInit ) CENTERED
	EndIf
	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Coloca o Ponteiro do Mouse em Estado de Espera			   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	If !lApd020Auto
		CursorWait()
	EndIf

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁGarante o Posicionamento do RD0							   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	RD0->( MsGoto( nReg ) )

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁQuando Confirmada a Opcao e Nao for Visualizacao Grava ou   ExЁ
	Ёclui as Informacoes do RD0      							   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF( nOpcAlt == 1 )
		/*/
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		Ё Apenas se nao For Visualizacao              				   Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
 		IF ( nOpc != 2 )
			MsAguarde(;
						{ ||;
								Apda020Grava(	nOpc		,;	//Opcao de Acordo com aRotina
							 					nReg		,;	//Numero do Registro do Arquivo Pai ( RD0 )
							 					aRd0Header	,;	//Campos do Arquivo Pai ( RD0 )
							 					aRd0Cols	,;	//Conteudo Atual dos Campos do Arquivo Pai ( RD0 )
							 					aSvRd0Cols	,;	//Conteudo Anterior dos Campos do Arquivo Pai ( RDM )
							 					aRd0VirtEn	,;	//Campos Virtuais do Arquivo Pai ( RD0 )
											 	aRd0MemoEn	 ;	//Campos Memo para a MsMm
											);
						};
					 )
		EndIF
	ElseIF ( nOpc == 3 )
		/*/
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		Ё RollBack da Numeracao Automatica            				   Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
		While ( GetSX8Len() > nGetSX8Len )
			RollBackSX8()
		End While
	EndIF

	If Len(aBkpCols) > 0
		For nLoop := 1 To nRD0Usado
			If !lApd020Auto
				SetMemVar(aRd0Header[nLoop, 02], aBkpCols[01, nLoop], .T.)
			EndIf
		Next nLoop
	EndIf

End Sequence

If !lApd020Auto
	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Coloca o Ponteiro do Mouse em Estado de Espera			   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	CursorWait()
	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁLibera os Locks             								   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/

	aAdd( aFreeLocks , { "RD0" , aRd0Recnos , aRd0Keys } )
	aAdd( aFreeLocks , { "RDY" , aRdyRecnos , aRdyKeys } )
	ApdFreeLocks( aFreeLocks )
EndIf
/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
ЁRestaura os Dados de Entrada								   Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
RestArea( aArea )

/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
ЁRestaura as Teclas de Atalho											 Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
RestKeys( aSvKeys , .T. )

/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
ЁRestaura o Estado do Ponteiro do Mouse						   Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
CursorArrow()

Return( MBrChgLoop( ( nOpc == 3 ) .and. ( nOpcAlt == 1 ) ) )

/*/
зддддддддддбддддддддддддддбдддддбдддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤└o    ЁRd0Relation	  ЁAutorЁ Marinaldo de Jesus  Ё Data Ё18/08/2004Ё
цддддддддддеддддддддддддддадддддадддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁVisualizacao dos Relacionamentos com o RD0         		    Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<vide parametros formais>     								Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁAPDA020                                                  	Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁRetorno   ЁNIL    														Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<vide parametros formais>									Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Static Function Rd0Relation( cAlias , nRec , nOpc )

Local aSvKeys		:= GetKeys()
Local aArea 		:= GetArea()
Local aAreaRD0		:= RD0->( GetArea() )
Local aAreaSRA		:= SRA->( GetArea("SRA") )
Local cProcName3	:= Upper( AllTrim( ProcName( 3 ) ) )
Local cProcName5	:= Upper( AllTrim( ProcName( 5 ) ) )
Local cSvcCadastro  := cCadastro
Local lOpcOk		:= .F.
Local lSRAChanged   := .F.

Local bVisual
Local cMsgInfo
Local cEntidade
Local nEntRecno

Begin Sequence

	IF !( "APDA020MNT" $ ( cProcName3 + cProcName5 ) )
		Break
	EndIF

	IF Empty( cEntidade := Rd0GetEnt( @lOpcOk ) )
		cMsgInfo := STR0038	//"NЦo И PossМvel visualizar os relacionamentos"
		cMsgInfo += CRLF
		cMsgInfo += STR0039	//"Verifique se o arquivo" + " " + GetIniRdzRel()
		cMsgInfo += STR0040	//"encontra-se no diretСrio de sistemas."
		Break
	EndIF

	IF lChkRdzRel
		lSRAChanged := ExecBlock( "ChkRdzRel" , .F., .F., { "INIT" } )
	EndIF

	IF !RdzExisteRel( cEntidade , GetMemVar( "RD0_CODIGO" ) , cEmpAnt , cFilAnt , .T. )
		cMsgInfo := STR0041	//"NЦo Existe Relacionamento com a Entidade Selecionada."
		Break
	EndIF

	nEntRecno	:= ( cEntidade )->( Recno() )
    cCadastro	:= Capital( AllTrim( fDesc( "SX2" , cEntidade , "X2Nome()" , NIL , NIL , 1 , .F. ) ) )
   	IF ( cEntidade == "SRA" )
   		bVisual := { || Gpea010Vis( cEntidade , nEntRecno , 2 , NIL , .T. ) }
   	Else
   		bVisual := { || AxVisual( cEntidade , nEntRecno , 2 ) }
   	EndIF
	MsAguarde( bVisual , OemToAnsi( cCadastro + " - " + OemToAnsi( STR0036 ) ) ) //"Relacionamentos"
	aRotSetOpc( cAlias , NIL , nOpc )

	IF lChkRdzRel
		ExecBlock( "ChkRdzRel" , .F., .F., { "END" , lSRAChanged } )
	EndIF

End Sequence

IF (;
		( lOpcOk );
		.and.;
		!Empty( cMsgInfo );
	 )
	MsgInfo( OemToAnsi( cMsgInfo ) , OemToAnsi( cCadastro + " - " + OemToAnsi( STR0036 ) ) ) //"Relacionamentos"
EndIF

cCadastro := cSvcCadastro
RestArea( aAreaSRA )
RestArea( aAreaRD0 )
RestArea( aArea )

RestKeys( aSvKeys , .T. )

Return( NIL )

/*/
зддддддддддбддддддддддддддбдддддбдддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤└o    ЁRd0GetEnt	  ЁAutorЁ Marinaldo de Jesus  Ё Data Ё18/08/2004Ё
цддддддддддеддддддддддддддадддддадддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁObtem a Entidade para a Visualizacao do Relacionamento	    Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<vide parametros formais>     								Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁAPDA020                                                  	Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁRetorno   ЁNIL    														Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<vide parametros formais>									Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Static Function Rd0GetEnt( lOpcOk )

Local aSvKeys	:= GetKeys()
Local aCombo	:= {}
Local bSet15	:= { || lOpcOk	:= .T.	, RestKeys( aSvKeys , .T. ) , oDlg:End() }
Local bSet24	:= { || lOpcOk	:= .F.	, RestKeys( aSvKeys , .T. ) , oDlg:End() }
Local cCombo	:= ""

Local nRd0
Local oDlg
Local oCombo
Local aRetcoords := {}

DEFAULT lOpcOk := .F.

If SX2->(DbSeek("RDT"))
	aCombo	:= If(RDT->(FieldPos("RDT_ALIAS")) # 0,Sx3Box2Arr( "RDT_ALIAS" ),{})
Endif

Begin Sequence

	nRd0 := aScan( aCombo , { |x| "RD0" $ Upper( x ) } )
	IF ( nRd0 > 0 )
		aDel( aCombo , nRd0 )
		aSize( aCombo , ( Len( aCombo ) - 1 ) )
	EndIF

	IF Empty( aCombo )
		Break
	EndIF

	aRetcoords := RetCoords(4,3,10,20)
	DEFINE FONT oFont NAME "Arial" SIZE 0,-11 BOLD
	DEFINE MSDIALOG oDlg FROM  094,001 TO 250,430 TITLE OemToAnsi( STR0036 ) PIXEL	//"Relacionamentos"

		@ aRetcoords[2][1]   , aRetcoords[2][2]	GROUP oGroup TO aRetcoords[12][1],190 LABEL OemToAnsi(STR0037) OF oDlg PIXEL	//"Selecione o Objeto da Pesquisa" //015,005
		oGroup:oFont:=oFont

		@ aRetcoords[7][1]   , aRetcoords[7][2] COMBOBOX oCombo VAR cCombo ITEMS aCombo SIZE 155,010 OF oDlg PIXEL
		oDlg:lEscClose := .F. //Nao permite sair ao se pressionar a tecla ESC.

	ACTIVATE MSDIALOG oDlg CENTERED ON INIT EnchoiceBar( oDlg , bSet15 , bSet24 )
	RestKeys( aSvKeys , .T. )

	IF !( lOpcOk )
		cCombo := NIL
	EndIF

End Sequence

Return( cCombo )

/*/
зддддддддддбдддддддддддддбдддддбддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁApda020TEncOkЁAutorЁMarinaldo de Jesus    Ё Data Ё18/06/2002Ё
цддддддддддедддддддддддддадддддаддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁTudoOk para a Enchoice                                      Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   ЁApda020TEncOk( nOpc , oEndRd0 )								Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ 															Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁAPDA020()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Static Function Apda020TEncOk( nOpc , oEndRd0 )

Local lTudoOk		:= .T.
Local lInteReser	:= SuperGetMV("MV_RESEXP",.F.,"0") <>  "0" // Integrado com Reserve
Local lExpCad		:= SubStr(SuperGetMV("MV_RESCAD",.F.,"000"),3,1) == "1"	//Verifica se a exportacao de participantes esta habilitada
Local lRD0_VIAJA	:= RD0->(FieldPos("RD0_FVIAJ")) > 0
Local nOrdRD0Old	:= 0

DEFAULT lRd0CPO		:= ChkFile("RD0") .And. If(RD0->(ColumnPos("RD0_FILRH")) > 0, .T., .F.)

IF ( ( nOpc == 3 ) .or. ( nOpc == 4 ) )
	lTudoOk := EnchoTudOk( oEndRd0 )
EndIF

if lTudoOk .and. lInteReser .and. M->RD0_DVIAGE <> '1' .And. lExpCad
	lTudoOk := If( FindFunction('Fina673Obr'), Fina673Obr("RD0"), .T.)
endif

// Valida chave Filial + UsuАrio Portal
If lTudoOK .And. lRd0CPO
	// Caso Usuario Portal esteja preenchido, ou apenas a Filial Usuario esteja preenchida
	If !Empty(M->RD0_PORTAL) .Or. (!Empty(M->RD0_FILRH) .And. Empty(M->RD0_PORTAL))
		dbSelectArea("AI3")
		AI3->(dbSetOrder(1))
		If !(AI3->(dbSeek(xFilial("AI3",M->RD0_FILRH)+M->RD0_PORTAL)))		
			lTudoOK := .F.
			// "AtenГЦo"
			// "NecessАrio preencher os campos Filial UsuАrio Portal e CСdigo UsuАrio Portal com dados vАlidos - revise o conteЗdo dos campos."
			MsgAlert( OemToAnsi( STR0068 ) , OemToAnsi( STR0067 ) )
		EndIf
	EndIf
EndIf

If lTudoOk .And. lRD0_VIAJA .And. M->RD0_FVIAJ == "1" .And. !Empty(M->RD0_USER)
	nOrdRD0Old := RD0->(IndexOrd())
	RD0->(DbSetOrder(12))
	If RD0->(DbSeek(xFilial("RD0") + M->RD0_USER + M->RD0_FVIAJ)) 
		If nOpc == 3
			lTudoOK := .F.
			MsgAlert( STR0076 + M->RD0_USER + STR0077 ,STR0067 )
		ElseIf nOpc == 4 .And. (M->RD0_CODIGO <> RD0->RD0_CODIGO)
			lTudoOK := .F.
			MsgAlert( STR0076 + M->RD0_USER + STR0077 ,STR0067 )
		EndIf
	EndIf
	RD0->(DbSetOrder(nOrdRD0Old))
EndIf

Return( lTudoOk )

/*/
зддддддддддбдддддддддддддбдддддбддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁApda020Grava ЁAutorЁMarinaldo de Jesus    Ё Data Ё21/07/2003Ё
цддддддддддедддддддддддддадддддаддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁGrava as Informacoes o RD0                                  Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁAPDA020()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Static Function Apda020Grava(	nOpc		,;	//Opcao de Acordo com aRotina
							 	nReg		,;	//Numero do Registro do Arquivo Pai ( RD0 )
							 	aRd0Header	,;	//Campos do Arquivo Pai ( RD0 )
							 	aRd0Cols	,;	//Conteudo Atual dos Campos do Arquivo Pai ( RD0 )
							 	aSvRd0Cols	,;	//Conteudo Anterior dos Campos do Arquivo Pai ( RD0 )
							 	aRd0VirtEn	,;	//Campos Virtuais do Arquivo Pai ( RD0 )
							 	aRd0MemoEn	 ;	//Campos Memo para a MsMm
							 )

/*/
зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Ё Variaveis de Inicializacao Obrigatoria					  Ё
юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Local aMestre		:= GdPutIStrMestre( 01 )
Local aItens		:= {}
Local aRelation		:= {}
Local cOpcao		:= IF( ( nOpc == 5 ) , "DELETE" , IF( ( ( nOpc == 3 ) .or. ( nOpc == 4 ) ) , "PUT" , NIL ) )
Local lRD0Altrado	:= .F.

/*/
зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Ё Variaveis que serao inicializadas no Corpo da Funcao		  Ё
юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Local nLoop
Local nLoops
Local MV_RESEXP	:= SuperGetMv("MV_RESEXP",.T., '0')  // Parametro para Integracao com Reserve
Local lExpCad		:= SubStr(SuperGetMV("MV_RESCAD",.F.,"000"),3,1) == "1"	//Verifica se a exportacao do participante esta habilitada

/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Ё Altera o Estado do Cursor  								   Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
If !lApd020Auto
	CursorWait()
EndIf

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Atualiza aRd0Cols para Verificar se Houveram Alteracoes	   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	nLoops := Len( aRd0Header )
	For nLoop := 1 To nLoops
		aRd0Cols[ 01 , nLoop ] := GetMemVar( aRd0Header[ nLoop , 02 ] )
	Next nLoop

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Seta a Gravacao ou Exclusao Apenas se Houveram Alteracoes  ouЁ
	Ё se foi Selecionada a Exclusao								   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	lRD0Altrado := !( ArrayCompare( aRd0Cols , aSvRd0Cols ) )
	aMestre[ 01 , 01 ]	:= "RD0"
	aMestre[ 01 , 02 ]	:= nReg
	aMestre[ 01 , 03 ]	:= ( ( nOpc == 5 ) .or. lRD0Altrado )
	aMestre[ 01 , 04 ]	:= aClone( aRd0Header )
	aMestre[ 01 , 05 ]	:= aClone( aRd0VirtEn )
	aMestre[ 01 , 06 ]	:= aClone( aRd0MemoEn )
	aMestre[ 01 , 07 ]	:= aClone( aItens )
	aMestre[ 01 , 08 ]	:= "RDY"

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Grava e/ou exclui as Informacoes                        	   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	GdPutInfoData( aMestre , cOpcao )

	If lExpCad
	    // ManutenГЦo do reserve se o reserve trabalhar on-line
	    if MV_RESEXP $ '13' .and. FindFunction("FINA657Mnt") // Integrado ONLINE
		   	FINA657Mnt(RD0->RD0_EMPATU, RD0->RD0_FILATU)
		elseif MV_RESEXP <> '0' .and. FindFunction("DatIntRes")// Integrado com Reserve Marcar
			DatIntRes()
			RecLock("RD0", .F.)
			RD0->RD0_RESERV := ' ' // NЦo Processado
			msUnlock()
	    endif
	EndIf

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Tratamento para as Entidades Relacionadas   				   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF ( nOpc == 5 )
		/*/
		здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
		Ё Exclui os Relacionamentos                   				   Ё
		юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
		IF ( BldArrRdZRel( aRelation ) )
			nLoops := Len( aRelation )
			For nLoop := 1 To nLoops
				UndoRelRdz( aRelation[ nLoop , 01 ]  , GetMemVar( "RD0_CODIGO" ) , cEmpAnt , cFilAnt )
			Next nLoop
		EndIF
	EndIF

	If lIntegDef
		FwIntegdef("APDA020")
	EndIf
	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Confirmando a Numeracao Automatica          				   Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF ( nOpc == 3 )
		While ( GetSX8Len() > nGetSX8Len )
			ConfirmSX8()
		End While
	EndIF

/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Ё Restaura o Estado do Cursor								   Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
CursorArrow()

Return( NIL )

/*/
зддддддддддбдддддддддддддбдддддбддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁApda020ChkDelЁAutorЁMarinaldo de Jesus    Ё Data Ё21/07/2003Ё
цддддддддддедддддддддддддадддддаддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁVerifica se os Registros podem ser Deletados                Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁApda020()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Static Function Apda020ChkDel(	cAlias		,;	//Alias do Arquivo Principal
								nReg		,;	//Recno do Arquivo Principal
								nOpc		,;	//Opcao do Arquivo Principal
								cCodigo		,;	//Chave para Exclusao (Sem a Filial)
								lShowLog	,;	//Se deve Mostrar o Log
								aLog		,;	//Array com os Logs
								aLogTitle	 ;	//Array com os Titulos do Log
							  )

Local aArea			:= GetArea()
Local aAreas		:= {}
Local aNotSelect	:= {}
Local aNotChkSX9	:= { "RDZ" }
Local lChkDelOk 	:= .T.
Local nAreas		:= 0

Local cKeyDel
Local cTitLog
Local cMsgNoDelOk
Local nLoop
Local nLoops

DEFAULT cAlias		:= Alias()
DEFAULT nReg		:= ( cAlias )->( Recno() )
DEFAULT nOpc		:= 5
DEFAULT cCodigo		:= ""
DEFAULT lShowLog	:= .T.
DEFAULT aLog		:= {}
DEFAULT aLogTitle	:= {}

If lApd020Auto
	lShowLog := .F.
EndIf

( cAlias )->( MsGoto( nReg ) )
lChkDelOk  := ChkDelRegs(	cAlias				,;	//01 -> Alias do Arquivo Principal
							nReg				,;	//02 -> Registro do Arquivo Principal
							nOpc				,;	//03 -> Opcao para a AxDeleta
							NIL              	,;	//04 -> Filial do Arquivo principal para Delecao
							NIL    				,;	//05 -> Chave do Arquivo Principal para Delecao
							aAreas				,;	//06 -> Array contendo informacoes dos arquivos a serem pesquisados
							NIL					,;	//07 -> Mensagem para MsgYesNo
							NIL					,;	//08 -> Titulo do Log de Delecao
							NIL					,;	//09 -> Mensagem para o corpo do Log
							.F.				 	,;	//10 -> Se executa AxDeleta
							@lShowLog			,;	//11 -> Se deve Mostrar o Log
							@aLog				,;	//12 -> Array com o Log de Exclusao
							@aLogTitle		 	,;	//13 -> Array com o Titulo do Log
							NIL					,;	//14 -> Bloco para Posicionamento no Arquivo
							NIL					,;	//15 -> Bloco para a Condicao While
							NIL					,;	//16 -> Bloco para Skip/Loop no While
							.T.					,;	//17 -> Verifica os Relacionamentos no SX9
							aNotChkSX9			,;	//18 -> Alias que nao deverao ser Verificados no SX9
												,;	//19 -> Se faz uma checagem soft
							lApd020Auto		 ;	//20 -> Se esta executando rotina automatica
						)

//RDZ ( Verifica se existe relacionamentos com outras entidades )
IF ( lChkDelOk )
	IF ( Select( "RDZ" ) == 0 )
		aAdd( aNotSelect , "RDZ" )
	EndIF
	IF CheckExecForm( { || dbSelectArea( "RDZ" ) } , .F. )
		aAdd( aAreas , Array( 04 ) )
		nAreas := Len( aAreas )
		aAreas[nAreas,01] := RDZ->( GetArea() )
		aAreas[nAreas,02] := Array( 04 )
							aAreas[nAreas,02,01] := "RDZ_FILIAL"
							aAreas[nAreas,02,02] := "RDZ_CODRD0"
							aAreas[nAreas,02,03] := "RDZ_EMPENT"
							aAreas[nAreas,02,04] := "RDZ_FILENT"
		aAreas[nAreas,03] := RetOrdem( "RDZ" , "RDZ_FILIAL+RDZ_CODRD0+RDZ_EMPENT+RDZ_FILENT" , .T. )
		cKeyDel		:= ( cCodigo + cEmpAnt + cFilAnt )
		IF ( cModulo == "APD" )
			cTitLog		:= STR0022	//"Log de OcorrЙncias na ExclusЦo de Participantes"
		Else
			cTitLog		:= STR0023	//"Log de OcorrЙncias na ExclusЦo de Pessoas"
		EndIF
		lChkDelOk	:= ChkDelRegs(	cAlias				,;	//01 -> Alias do Arquivo Principal
									nReg				,;	//02 -> Registro do Arquivo Principal
									nOpc				,;	//03 -> Opcao para a AxDeleta
									xFilial( cAlias )	,;	//04 -> Filial do Arquivo principal para Delecao
									cKeyDel				,;	//05 -> Chave do Arquivo Principal para Delecao
									aAreas				,;	//06 -> Array contendo informacoes dos arquivos a serem pesquisados
									NIL					,;	//07 -> Mensagem para MsgYesNo
									cTitLog				,;	//08 -> Titulo do Log de Delecao
									@cMsgNoDelOk		,;	//09 -> Mensagem para o corpo do Log
									.F.				 	,;	//10 -> Se executa AxDeleta
									.F.					,;	//11 -> Se deve Mostrar o Log
									@aLog				,;	//12 -> Array com o Log de Exclusao
									@aLogTitle		 	,;	//13 -> Array com o Titulo do Log
									NIL					,;	//14 -> Bloco para Posicionamento no Arquivo
									NIL					,;	//15 -> Bloco para a Condicao While
									NIL					,;	//16 -> Bloco para Skip/Loop no While
									.F.					,;	//17 -> Verifica os Relacionamentos no SX9
									NIL					,;	//18 -> Alias que nao deverao ser Verificados no SX9
														,;	//19 -> Se faz uma checagem soft
									lApd020Auto		 ;	//20 -> Se esta executando rotina automatica
								 )
		IF !( lChkDelOk )
			IF ( lShowLog )
				MsAguarde( { || fMakeLog( { aLog } , aLogTitle , NIL , NIL , FunName() , cTitLog ) } , cTitLog )
			Else
				MsgInfo( OemToAnsi( cMsgNoDelOk ) , ( cCadastro + " - " + cTitLog ) )
			EndIF
		EndIF
	EndIF
EndIF

nLoops := Len( aNotSelect )
For nLoop := 1 To nLoops
	IF ( Select( aNotSelect[ nLoop ] ) > 0 )
		( aNotSelect[ nLoop ] )->( dbCloseArea() )
	EndIF
Next nLoop

RestArea( aArea )

Return( lChkDelOk  )

/*/
зддддддддддбдддддддддддддбдддддбддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁApda020Rd0UpdЁAutorЁMarinaldo de Jesus	  Ё Data Ё21/07/2003Ё
цддддддддддедддддддддддддадддддаддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁCarrega os Participantes/Pessoas a partir do SRA            Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁApda020()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Static Function Apda020Rd0Upd( cAlias , nReg , nOpc )

Local aSvKeys			:= GetKeys()
Local aArea				:= GetArea()
Local aAreaRd0			:= RD0->(GetArea())
Local lApda020Rd0Upd	:= .F.
Local nOpcRelRd0		:= 0
Local cMsgInfo			:= IF( ( cModulo == "APD" ) , STR0009 , STR0010  )	//"A rotina de Carga de Participantes est═ sendo utilizada por outro usu═rio"###"A rotina de Carga de Pessoas est═ sendo utilizada por outro usu═rio"
Local cTitleProc		:= ""
Local cMayIUseCode		:= "MayIUseApda020Rd0Upd"

Begin Sequence

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁApenas um Usuario Podera Estar Efetuando Esta operacao por vezЁ
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF !( lApda020Rd0Upd := WhileYesNoWait(;
					 							{ || MayIUseCode( cMayIUseCode ) }	,;	//Bloco a Ser Executando Enquando ( Devera Retornar Valor Logico )
					 							1000								,;	//Numero de Tentativas
					 							.T.									,;	//Se podera Encerrar as as Tentativas ( Button Cancel Enabled )
					 							cMsgInfo							,;	//Mensagem de Corpo para a MsgInfo
					 							cCadastro							,;	//Titulo para a MsgInfo
					 							OemToAnsi( STR0008 )				,;	//Mensagem de Corpo para a MsgYesNo //"Tentar novamente?"
					 							cCadastro							,;	//Titulo para a MsgYesNo
					 							OemToAnsi( STR0011 )				,;	//Mensagem de corpo para a ProcWaiting //"Tentanto executar novamente."
					 							cCadastro							 ;	//Titulo para a ProcWaiting
					 					  );
		)
		Break
	EndIF

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	ЁAbandona se cancelou a Opcao de Relacionamento                Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF ( ( nOpcRelRd0 := OpcRelRd0( nOpc ) ) == 0 )
		Break
	EndIF

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Obtendo o Titulo do Processamento                            Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	IF ( nOpcRelRd0 == 1 )
		IF ( cModulo == "APD" )
			cTitleProc := OemToAnsi( STR0012 )	//"Efetuando Relacionamento Funcion═rios vs Participantes"
		Else
			cTitleProc := OemToAnsi( STR0013 )	//"Efetuando Relacionamento Funcion═rios vs Pessoas"
		EndIF
	ElseIF ( nOpcRelRd0 == 2 )
		cTitleProc := OemToAnsi( STR0020 )	//"Atualizando Relacionamento das Entidades"
	ElseIF ( nOpcRelRd0 == 3 )
		cTitleProc := OemToAnsi( STR0021 )	//"Relacionando Funcion═rio e Atualizando Entidades"
	EndIF

	/*/
	здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	Ё Chamada ao Processamento                                     Ё
	юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
	Proc2BarGauge( { || SraUpdRd0( nOpcRelRd0 ) } , cTitleProc , NIL , NIL , .T. , .T. , .F. , .F. )

End Sequence

/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
ЁLibera o Codigo Exclusivo ja Utilizado						   Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Leave1Code ( cMayIUseCode )

/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
ЁRestaura Area e Ordem de Entrada                              Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
RestKeys( aSvKeys )
RestArea( aAreaRd0 )
RestArea( aArea )

Return( lApda020Rd0Upd )

/*/
зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o	   ЁOpcRelRd0 Ё Autor Ё Marinaldo de Jesus 	  Ё Data Ё10/04/2004Ё
цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁDialogo com as Opcoes para Relacionamento dos Participantes/Ё
Ё          ЁPessoas														Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   ЁOpcRelRd0( nOpc )											Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ 															Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁRetorno   ЁNumero da Opcao de Recalculo da Rescisao: 1 -> Relacionar   Ё
Ё          Ё                                          2 -> Atualizar	Ё
Ё          Ё                                          3 -> Ambos        Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso	   ЁApda020Rd0Upd() em APDA020								    Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Static Function OpcRelRd0( nOpc )

Local aSvKeys	:= GetKeys()
Local bSet15	:= { || lOpcOk	:= .T.	, RestKeys( aSvKeys , .T. ) , oDlg:End() }
Local bSet24	:= { || nOpcRel	:= 0	, RestKeys( aSvKeys , .T. ) , oDlg:End() }
Local cLabel	:= IF( cModulo == "APD" , STR0015 , STR0016 )	//"Relacionamento de Participantes"###"Relacionamento de Pessoas"
Local lOpcOk	:= .F.
Local nOpcRel	:= 1.00
Local aRetcoords:= {}

Local oRadio
Local oDlg
Local oGroup
Local oFont


aRetcoords := RetCoords(10,8,15,7,4,40)

DEFINE FONT oFont NAME "Arial" SIZE 0,-11 BOLD
DEFINE MSDIALOG oDlg FROM  094,001 TO 300,700 TITLE OemToAnsi( cCadastro + " - " + SubSTr( aRotina[ nOpc , 01 ] , 1 ) ) PIXEL

	@ aRetcoords[1][1]   , aRetcoords[1][2]	GROUP oGroup TO   aRetcoords[80][1]   , 340 LABEL OemToAnsi(cLabel) OF oDlg PIXEL //015,005 TO 075,220
	oGroup:oFont:=oFont

	@ aRetcoords[22][1]   , aRetcoords[22][2] RADIO oRadio VAR nOpcRel ITEMS 	OemToAnsi(STR0017)	,;			//"Relacionar"  025,010
												OemToAnsi(STR0018)	,;			//"Atualizar"
												OemToAnsi(STR0019)	 ;			//"Ambos"
				SIZE 75,010 OF oDlg PIXEL

	oDlg:lEscClose := .F. //Nao permite sair ao se pressionar a tecla ESC.

ACTIVATE MSDIALOG oDlg CENTERED ON INIT EnchoiceBar( oDlg , bSet15 , bSet24 )
RestKeys( aSvKeys , .T. )

IF !( lOpcOk )
	nOpcRel := 0
EndIF

Return( nOpcRel )

/*/
зддддддддддбдддддддддддддбдддддбддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁSraUpdRd0    ЁAutorЁMarinaldo de Jesus    Ё Data Ё03/02/2004Ё
цддддддддддедддддддддддддадддддаддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁCarregar os Funcionarios no Cad. de Participantes/Pessoas   Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁApda020()	                                                Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Static Function SraUpdRd0( nOpcRel ) //0-> Break;1 -> Relacionar;2 -> Atualizar;3 -> Ambos

Local aLogIncon		:= {}
Local cSvFilAnt 	:= cFilAnt

Local aRelation

Local cRd0Codigo
Local cFilSRA
Local cCic
Local cCicKey
Local cRd0Fil
Local cTimeIni

Local dMsDate

Local lSraCompart
Local lRelacInativ
Local lExistePessoa
Local nSraRecno
Local nSraNextRecno
Local nRd0Recno
Local nRd0NextRecno
Local nRecsBarG
Local nRd0Order
Local nRd0CicOrder
Local bFiltro
Local cFilIni		:= ""
Local cFilFin		:= ""
Local cMatIni		:= ""
Local cMatFin		:= ""
Local dAdmIni		:= STOD("")
Local dAdmFin		:= STOD("")
Local cCategor	:= ""
Local lFilPerg		:= .F.
Local cRetSituac	:= ""
Local aOfusca		:= If(FindFunction('ChkOfusca'), ChkOfusca(), { .T., .F. }) //[2]Ofuscamento
Local aFldRel		:= Iif( aOfusca[2], FwProtectedDataUtil():UsrNoAccessFieldsInList( {"RA_NOME"} ), {} )
Local lOfusca		:= Len(aFldRel) > 0

Private lAbortPrint := .F.
Private aPerUpdRd0  := {}

// Ponto de Entrada para retornar as situacoes que considera Funcionario Inativo
cRetSituac := "D"	//Carrega como Default "D" Apenas Demitido
if ExistBlock("APDGRV02")
	cRetSituac := ExecBlock( "APDGRV02", .F., .F.)
EndIf

DbSelectArea("SX1")
DbSetOrder(1)
lFilPerg := dbSeek("APD20UPDRA")

If lFilPerg
	If !Pergunte("APD20UPDRA",.T. )
		nOpcRel := 0 // Aborta
	EndIf
	cFilIni		:= AllTrim(MV_PAR01)
	cFilFin		:= AllTrim(MV_PAR02)
	cMatIni		:= AllTrim(MV_PAR03)
	cMatFin		:= AllTrim(MV_PAR04)
	dAdmIni		:= MV_PAR05
	dAdmFin		:= MV_PAR06
	cCategor	:= AllTrim(MV_PAR07)
	lRelacInativ := (MV_PAR08 == 1)

	bFiltro:= {|| (AllTrim(SRA->RA_FILIAL) >= cFilIni .AND. AllTrim(SRA->RA_FILIAL) <=  cFilFin) .AND.;
					(AllTrim(SRA->RA_MAT) >= cMatIni .AND. AllTrim(SRA->RA_MAT) <= cMatFin) .AND.; 
					(SRA->RA_ADMISSA >= STOD(DtoS(dAdmIni)) .AND. SRA->RA_ADMISSA <= STOD(DtoS(dAdmFin))) .AND.;
					AllTrim(SRA->RA_CATFUNC) $ cCategor }

Else
	lRelacInativ := MsgYesNo( OemToAnsi( STR0027 ) ) //"Relacionar FuncionАrios Inativos?"
EndIf

Begin Sequence

	IF ( nOpcRel == 0 )
		Break
	EndIF

	IF !( BldArrRdZRel( @aRelation ) )
		Break
	EndIF
    lTabelaVza	 := Empty(RD0->RD0_CODIGO)

	cTimeIni		:= Time()
	dMsDate			:= MsDate()
	lSraCompart		:= Empty( xFilial( "SRA" ) )

	nRecsBarG		:= SRA->( RecCount() )
	nSraRdzOrd		:= GetRdzIndRel( "SRA" )
	nRd0Order		:= RetOrdem( "RD0" , "RD0_FILIAL+RD0_CODIGO" )
	nRd0CicOrder	:= RetOrdem( "RD0" , "RD0_FILIAL+RD0_CIC" )

	RD0->( dbSetOrder( nRd0Order ) )

	BarGauge1Set( nRecsBarG )
	SRA->( dbGotop() )
	SRA->( dbSetOrder( nSraRdzOrd ) )
	While SRA->( !Eof() )
		If lFilPerg .and. !Eval(bFiltro)
			IF !GetNextRecno( "SRA" , @nSraNextRecno , @nSraRecno , nSraRdzOrd )
				Exit
			EndIF
			SRA->( dbSkip() )
			Loop
		EndIf

		//--Ponto de entrada para desprezar funcionarios do processamento.
		If lAPD20REL
			If( ValType( lRet := ExecBlock( "APD20REL", .F., .F.) ) == "L" )
				If !lRet
					IF !GetNextRecno( "SRA" , @nSraNextRecno , @nSraRecno , nSraRdzOrd )
						Exit
					EndIF
					SRA->( dbSkip() )
					Loop
				EndIf
			EndIf
		EndIf
		IF !GetNextRecno( "SRA" , @nSraNextRecno , @nSraRecno , nSraRdzOrd )
			Exit
		EndIF
		IncPrcG1Time( NIL , nRecsBarG , cTimeIni , .T. , NIL , 1 )
		IF ( lAbortPrint )
			Break
		EndIF

		dMsDate	:= Nil
		If !Empty( aPerUpdRd0 )
			nPos	:= aScan( aPerUpdRd0,{ |x| x[1] == SRA->RA_FILIAL + SRA->RA_PROCES } )
			If nPos > 0
				dMsDate := aPerUpdRd0[nPos,2]
			EndIf
		EndIf

		//-- Atualiza o status do funcionАrio
		// - A funГЦo RetSituacao serА responsАvel por carregar a data de referЙncia.
		RetSituacao( SRA->RA_FILIAL , SRA->RA_MAT , lRelacInativ , , , .F. )
		IF !( lRelacInativ )
			IF ( SRA->RA_SITFOLH == "D" )
				IF !GotoNextRecno( "SRA" , nSraNextRecno , nSraRdzOrd )
					Exit
				EndIF
				Loop
			EndIF
		Else
			/*/
			здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
			Ё Para todas opГoes, nao considera como inativo funcionarios   Ё
			Ё transferidos para nao replicar como uma nova pessoa.         Ё
			юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
			IF SRA->RA_RESCRAI$'30/31'
				IF !GotoNextRecno( "SRA" , nSraNextRecno , nSraRdzOrd )
					Exit
				EndIF
				Loop
			Endif
		EndIF
		cCic		:= SRA->RA_CIC
		cFilSRA		:= SRA->RA_FILIAL
		IF Empty( cCic )
			cMsgLog := STR0028	//"O FuncionАrio ->"
			cMsgLog += " "
			cMsgLog += STR0029	//"Matricula:"
			cMsgLog += " "
			cMsgLog += SRA->RA_MAT
			cMsgLog += " "
			cMsgLog += STR0030	//"Nome:"
			cMsgLog += " "
			cMsgLog += If(lOfusca, Replicate('*',30), SRA->RA_NOME)
			cMsgLog += " "
			cMsgLog += STR0031	//"Filial:"
			cMsgLog += " "
			cMsgLog += cFilSRA
			cMsgLog += " "
			cMsgLog += STR0032	//"NЦo Possui CPF."
			aAdd( aLogIncon , cMsgLog )
			IF !GotoNextRecno( "SRA" , nSraNextRecno , nSraRdzOrd )
				Exit
			EndIF
			Loop
		EndIF

		cFilAnt		:= IF( ( lSraCompart .OR. Len(xFilial("SRA")) < FWGETTAMFILIAL ), cSvFilAnt , cFilSRA )
	  	lExistePessoa	:= ExistePessoa( "SRA" , ( cFilSRA+SRA->RA_MAT ) , cEmpAnt , cFilAnt , ( ( nOpcRel == 2 ) .or. ( nOpcRel == 3 ) ) )

		IF (!lExistePessoa .And. (nOpcRel == 1 .Or. nOpcRel == 3)) .Or. nOpcRel == 2
			RD0->( dbSetOrder( nRd0CicOrder ) )
			cRd0Fil			:= xFilial("RD0")
			cRd0Codigo		:= ""
			nRd0NextRecno	:= NIL
			cCicKey			:= ( cRd0Fil+cCic )
			IF RD0->( dbSeek( cCicKey , .F. ) )
				While RD0->( !Eof() .and. ( ( RD0_FILIAL + RD0_CIC ) == cCicKey )  )
					cRd0Codigo := RD0->RD0_CODIGO
					IF !GetNextRecno( "RD0" , @nRd0NextRecno , @nRd0Recno , nRd0CicOrder )
						Exit
					EndIF
					IF !( lRelacInativ )
						IF !(;
									( RD0->RD0_MSBLQL == "2" );
									.or.;
									Empty( RD0->RD0_MSBLQL );
							 )
							IF !GotoNextRecno( "RD0" , nRd0NextRecno , nRd0Order )
								Exit
							EndIF
							Loop
						EndIF
					EndIF
					IF !( RdzExisteRel( "SRA" , RD0->RD0_CODIGO , cEmpAnt , cFilAnt , .T. ) )
						cRd0Codigo := RD0->RD0_CODIGO
						Exit
					EndIF
					IF !GotoNextRecno( "RD0" , nRd0NextRecno , nRd0Order )
						Exit
					EndIF
				End While
			EndIF
			RD0->( dbSetOrder( nRd0Order ) )
			IF ( SRA->( RecLock( "SRA" , .F. ) ) )
				Begin Transaction
					EntUpdateRd0(	@cRd0Codigo			,;	//01 -> Codigo da Pessoa
									"SRA"				,;	//02 -> Entidade Relacionada
									cFilSRA+SRA->RA_MAT	,;	//03 -> Chave da Entidade
									nSraRdzOrd			,;	//04 -> Ordem
									nSraRecno			,;	//05 -> Recno da Entidade
									cEmpAnt				,;	//06 -> Codigo da Empresa
									cFilAnt				,;	//07 -> Codigo da Filial
									"1"					,;	//08 -> Conteudo para o RD0_TIPO "1"=Interno;"2"=Externo
									.F.					,;	//09 -> Se atualiza as Demais Entidades Relacionadas
									NIL					,;	//10 -> Array com as Entidades para o Before Update
									NIL					,;	//11 -> Se Executa algo depois do Update
									aRelation		 	 ;	//12 -> Array com as Estruturas para o Update
								)
					SRA->(DbGoTo(nSraRecno))
					IF RD0->( dbSeek( cRd0Fil + cRd0Codigo , .F. ) )
						RD0->( RecLock("RD0",.F.) )
						If SRA->RA_SITFOLH != "D"
							RD0->RD0_MSBLQL := "2"
						Else
							RD0->RD0_MSBLQL := "1"
						EndIf
						RD0->(MsUnLock())
					EndIF
				End Transaction
				/*
				зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
				Ё Ponto de entrada para alterar algum campo da tabela RDO,aposЁ
				Ё gravacao do registro                                        Ё
				юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
				If lAPDGRV01
					ExecBlock("APDGRV01",.F.,.F.,{cRd0Codigo,"SRA",nSraRecno,cFilSRA+SRA->RA_MAT,aRelation,nOpcRel,"I"})
				Endif
				IF !GotoNextRecno( "SRA" , nSraRecno , nSraRdzOrd )
					Exit
				EndIF
				SRA->( MsUnLock() )
			EndIF
		ElseIF (;
					( lExistePessoa );
					.and.;
					(;
						( nOpcRel == 2 );
						.or.;
						( nOpcRel == 3 );
					);
					.and.;
					( fCheckAtivo() );
				)
			IF ( SRA->( RecLock( "SRA" , .F. ) ) )
				Begin Transaction
					EntUpdateRd0(	RD0->RD0_CODIGO		,;	//01 -> Codigo da Pessoa
									"SRA"				,;	//02 -> Entidade Relacionada
									cFilSRA+SRA->RA_MAT	,;	//03 -> Chave da Entidade
									nSraRdzOrd			,;	//04 -> Ordem
									nSraRecno			,;	//05 -> Recno da Entidade
									cEmpAnt				,;	//06 -> Codigo da Empresa
									cFilAnt				,;	//07 -> Codigo da Filial
									"1"					,;	//08 -> Conteudo para o RD0_TIPO "1"=Interno;"2"=Externo
									.F.					,;	//09 -> Se atualiza as Demais Entidades Relacionadas
									NIL					,;	//10 -> Array com as Entidades para o Before Update
									NIL					,;	//11 -> Se Executa algo depois do Update
									aRelation		 	 ;	//12 -> Array com as Estruturas para o Update
								)
				End Transaction
				/*
				зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
				Ё Ponto de entrada para alterar algum campo da tabela RDO,aposЁ
				Ё gravacao do registro                                        Ё
				юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
				If lAPDGRV01
					ExecBlock("APDGRV01",.F.,.F.,{RD0->RD0_CODIGO,"SRA",nSraRecno,cFilSRA+SRA->RA_MAT,aRelation,nOpcRel,"A"})
				Endif
				IF !GotoNextRecno( "SRA" , nSraRecno , nSraRdzOrd )
					Exit
				EndIF
				SRA->( MsUnLock() )
			EndIF
		EndIF
		IF !GotoNextRecno( "SRA" , nSraNextRecno , nSraRdzOrd )
			Exit
		EndIF
	End While

End Sequence

SRA->(DBClearFilter())

cFilAnt := cSvFilAnt

IF !Empty( aLogIncon )
	IF MsgYesNo( STR0033 )//"Ocorreram inconsistЙncias Durante o Relacionamento. Deseja ConsultА-las?"
		//"InconsistЙncias no Relacionamento do SRA com o RD0"
		MsAguarde( { || fMakeLog( { aLogIncon } , { STR0034 } , NIL , .T. , FunName() , NIL , "G" , "L" , NIL , NIL ) } , STR0034 )
	EndIF
EndIF

Return( NIL )

/*/
зддддддддддбдддддддддддддбдддддбддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0CodigoVld ЁAutorЁMarinaldo de Jesus    Ё Data Ё06/10/2003Ё
цддддддддддедддддддддддддадддддаддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁFuncao para Validar o Conteudo do Campo RD0_CODIGO          Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID para o campo RD0_CODIGO                         	Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0CodigoVld()

Local cRd0Codigo	:= GetMemVar( "RD0_CODIGO" )
Local lRd0CodigoOk	:= .T.

Begin Sequence

	IF ( Type( "__nRd0SvRecno__" ) == "N" )
		IF (  __nRd0SvRecno__ > 0 )
			RD0->( MsGoto( __nRd0SvRecno__ ) )
		ElseIF ( Inclui )
			PutFileInEof( "RD0" )
		EndIF
	EndIF

	IF !( lRd0CodigoOk := Rd0GetCodigo( @cRd0Codigo , .F. , .T. ) )
    	Break
    EndIF

    SetMemVar( "RD0_CODIGO" , cRd0Codigo )

End Sequence

Return( lRd0CodigoOk )

/*/
зддддддддддбдддддддддддддбдддддбддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0GetCodigo ЁAutorЁMarinaldo de Jesus    Ё Data Ё26/01/2004Ё
цддддддддддедддддддддддддадддддаддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁObtem Numeracao Valida para o RD0_CODIGO                    Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁObter Numeracao valida para o RD0_CODIGO                 	Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0GetCodigo( cRd0Codigo , lExistChav , lShowHelp )
Return(;
			GetNrExclOk(	@cRd0Codigo 			,;
							"RD0"					,;
							"RD0_CODIGO"			,;
							"RD0_FILIAL+RD0_CODIGO" ,;
							NIL						,;
							lExistChav				,;
							lShowHelp	 			 ;
						);
		)

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0CodigoInit	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/11/2002Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁInicializadora Padrao do Campo RD0_CODIGO					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_RELACAO do campo RD0_CODIGO								Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0CodigoInit()
Local cRd0Codigo
Rd0GetCodigo( @cRd0Codigo , .F. )
Return( cRd0Codigo )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0NomeVld		 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_NOME                    				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_NOME                   				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0NomeVld()

Local lRd0NomeOk := .T.

Begin Sequence

	IF !( lRd0NomeOk := NaoVazio() )
		Break
	EndIF

	IF !( lRd0NomeOk := Texto() )
		Break
	EndIF

	If (M->RD0_NOME <> RD0->RD0_NOME)
		lAlterApi := .T.
	EndIf

End Sequence

Return( lRd0NomeOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0TipoVld		 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_TIPO                    				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_TIPO                   				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0TipoVld()

Local lRd0TipoOk := .T.

Begin Sequence

	IF !( lRd0TipoOk := Pertence( OpBxIntExt( .T. ) ) )
		Break
	EndIF

End Sequence

Return( lRd0TipoOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0TipoBox		 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁOpcBox do Campo RD0_TIPO                    				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_CBOX do campo RD0_TIPO             						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0TipoBox()
Return( OpBxIntExt( .F. ) )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0SexoVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_SEXO                  					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_SEXO           						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0SexoVld()

Local lRd0SexoOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF ( lRd0SexoOk := Pertence( OpBxSexo( .T. ) ) )
		Break
	EndIF

End Sequence

If (M->RD0_SEXO <> RD0->RD0_SEXO)
	lAlterApi := .T.
EndIf

Return( lRd0SexoOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0SexoBox		 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁOpcBox do Campo RD0_SEXO                    				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_CBOX do campo RD0_SEXO            						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0SexoBox()
Return( OpBxSexo( .F. ) )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0DtNascVld	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_DTNASC                					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_DTNASC          						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0DtNascVld()

Local cTipo 			:= GetMemVar("RD0_TIPO")
Local lRd0DtNascOk 	:= .T.

Begin Sequence

	If cTipo == "1"
		IF ( Vazio() )
			Help("",1,"DTNASCINTER")
			lRd0DtNascOk := .F.
			Break
		EndIF
	EndIf

	IF ( lRd0DtNascOk := ChkDtNa( dDataBase , GetMemVar( "RD0_DTNASC" ) ) )
		Break
	EndIF

	If (M->RD0_DTNASC <> RD0->RD0_DTNASC)
		lAlterApi := .T.
	Endif

End Sequence

Return( lRd0DtNascOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0CicVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_CIC                   					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_CIC            						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0CicVld()

Local lRd0CicOk 	:= .T.
Local aArea 		:=  {}

Begin Sequence
aArea := RD0->( GetArea() )


	RD0->(DbSetOrder(6))
	RD0->(dbSeek(xFilial("RD0")+GetMemVar( "RD0_CIC" )+GetMemVar( "RD0_CODIGO" )))

	If ( Empty(M->RD0_CIC) .And. ( M->RD0_IDENT == "TST" .or. ( M->RD0_IDENT == "ADV" .and. M->RD0_TIPO == "2" ) ) )
		lRd0CicOk	:= .T.
	Else
		If ( cPaisLoc == "BRA") .and. !(Empty(M->RD0_CIC)) .And. !( ChkCPF( GetMemVar( "RD0_CIC" ) ) )
			lRd0CicOk	:= .F.
		ElseIf Inclui .or.(Empty(RD0->RD0_USRPRE) .And. M->RD0_CIC <> RD0->RD0_CIC .AND. !Empty(RD0->RD0_CIC))
			If !Empty(M->RD0_CIC) .AND. RD0->(dbSeek(xFilial("RD0")+GetMemVar( "RD0_CIC" )))
		 		Help( ' ' , 1 , 'RHEXISTCPF' , , OemToAnsi( STR0051 ) , 1 , 0 )
		 		lRd0CicOk	:= .F.
			EndIf
		EndIf
	EndIf

	If (M->RD0_CIC <> RD0->RD0_CIC)
		lAlterApi := .T.
	Endif

End Sequence

RD0->( RestArea( aArea ) )

Return( lRd0CicOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0DtAdmiVld	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_DTADMI                					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_DTADMI          						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0DtAdmiVld()

Local lRd0DtAdmiOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF ( lRd0DtAdmiOk := ChkDtAd( GetMemVar( "RD0_DTNASC" ) , GetMemVar( "RD0_DTADMI" ) ) )
		Break
	EndIF

End Sequence

Return( lRd0DtAdmiOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0EndVld		 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_END                     				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_END                    				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0EndVld()

Local lRd0EndOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF !( lRd0EndOk := Texto() )
		Break
	EndIF

	If (M->RD0_END <> RD0->RD0_END)
		lAlterApi := .T.
	EndIf

End Sequence

Return( lRd0EndOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0CmpEndVld	 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_CMPEND                     				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_CMPEND                   				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0CmpEndVld()

Local lRd0CmpEndOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF !( lRd0CmpEndOk := Texto() )
		Break
	EndIF

End Sequence

Return( lRd0CmpEndOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0CepVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_CEP                     				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_CEP                   				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0CepVld()

Local lRd0CepOk := .T.

Begin Sequence

	If (M->RD0_CEP <> RD0->RD0_CEP)
		lAlterApi := .T.
	EndIf

End Sequence

Return( lRd0CepOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0BairroVld	 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_BAIRRO                     				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_BAIRRO                   				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0BairroVld()

Local lRd0BairroOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF !( lRd0BairroOk := Texto() )
		Break
	EndIF

	If (M->RD0_BAIRRO <> RD0->RD0_BAIRRO)
		lAlterApi := .T.
	EndIf

End Sequence

Return( lRd0BairroOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0MunVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_MUN                     				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_MUN                   				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0MunVld()

Local lRd0MunOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF !( lRd0MunOk := Texto() )
		Break
	EndIF

	If (M->RD0_MUN <> RD0->RD0_MUN)
		lAlterApi := .T.
	EndIf

End Sequence

Return( lRd0MunOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0UfVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_UF           	          				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_UF            	       				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0UfVld()

Local lRd0UfOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF !( lRd0UfOk := ExistCpo( "SX5" , "12" + GetMemVar( "RD0_UF" ) ) )
		Break
	EndIF

End Sequence

Return( lRd0UfOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0DDIVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_DDI           	          				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_DDI            	       				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0DDIVld()

Local lRd0DDIOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF !( lRd0DDIOk := ( Val( GetMemVar( "RD0_DDI" ) ) > 0 ) )
		Break
	EndIF

End Sequence

Return( lRd0DDIOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0DDDVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_DDD           	          				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_DDD            	       				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0DDDVld()

Local lRd0DDDOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF !( lRd0DDDOk := ( Val( GetMemVar( "RD0_DDD" ) ) > 0 ) )
		Break
	EndIF

	If (M->RD0_DDD <> RD0->RD0_DDD)
		lAlterApi := .T.
	EndIf

End Sequence

Return( lRd0DDDOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0FoneVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_FONE                  					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_FONE           						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0FoneVld()

Local lRd0FoneOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	If (M->RD0_FONE <> RD0->RD0_FONE)
		lAlterApi := .T.
	EndIf

End Sequence

Return( lRd0FoneOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0NumCelVld 	 ЁAutorЁMarinaldo de JesusЁ Data Ё26/04/2004Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_NUMCEL                					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_NUMCEL         						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0NumCelVld()

Local lRd0NumCelOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

End Sequence

Return( lRd0NumCelOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0FaxVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_FAX                   					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_FAX            						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0FaxVld()

Local lRd0FaxOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

End Sequence

Return( lRd0FaxOk )

/*/{Protheus.doc} RD0NUMENDVld
Processo para validar o campo RD0_NUMENDVld nos processos de inclusЦo/alteraГЦo do registro para a 
integraГЦo via API REST.

@since	01/06/2020
@autor	Wesley Alves Pereira
@version P12.1.XX

/*/

Function RD0NUMENDVld()

Local lRd0NumendOk := .T.

Begin Sequence

	If (M->RD0_NUMEND <> RD0->RD0_NUMEND)
		lAlterApi := .T.
	EndIf

End Sequence

Return( lRd0NumendOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0CcVld	     ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_CC                    					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_CC              						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0CcVld()

Local cLastCc
Local lRd0CcOk		:= .T.
Local lSRAChanged   := .F.

If FindFunction("SPFilterOff")       // verifica se existe a funГЦo
	SPFilterOff( { "CTT" } )           //desabilita o filtro da tabela "CTT"
EndIf

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF !( lRd0CcOk := CTB105CC() )
		Break
	EndIF

	IF (;
			( Type( "aRd0Header" ) == "A" );
			.and.;
			( Type( "aRd0Cols" ) == "A" );
		)
		cLastCc := GdFieldGet( "RD0_CC" , 1 , .F. , aRd0Header , aRd0Cols )
		IF ( !Empty( cLastCc ) .and. ( cLastCc <> GetMemVar( "RD0_CC" ) ) )
			IF lChkRdzRel
				lSRAChanged := ExecBlock( "ChkRdzRel" , .F., .F., { "INIT" } )
			EndIF

			IF !( lRd0CcOk := !( RdzExisteRel( "SRA" , GetMemVar("RD0_CODIGO") , cEmpAnt , cFilAnt ) ) )
				IF ( cModulo == "APD" )
					cMsgInfo := STR0026	//"O Centro de Custo para Participantes Relacionados ao SRA (Cadastro de FuncionАrios) sС pode ser alterado via Rotina de TransferЙncia."
    		    Else
					cMsgInfo := STR0025	//"O Centro de Custo para Pessoas Relacionadas ao SRA (Cadastro de FuncionАrios) sС pode ser alterado via Rotina de TransferЙncia."
				EndIF
				MsgInfo( OemToAnsi( cMsgInfo ) )
				Break
			EndIF
		EndIF
	EndIF

	SetMemVar( "RD0_DESCCC" , Rd0DescCcInit( GetMemVar( "RD0_CC" ) ) )

End Sequence

If FindFunction("SPFilterOff")       // verifica se existe a funГЦo
	SPFilterOff(  { "CTT" },  .f.  )    //ativa o filtro
EndIf

IF lChkRdzRel
	ExecBlock( "ChkRdzRel" , .F., .F., { "END" , lSRAChanged } )
EndIF

Return( lRd0CcOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0DescCcInit    ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁInit do Campo RD0_DESCCC                   					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_RELACAO do campo RD0_DESCCC     							Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0DescCcInit(cCc)

	Local cAliasCc	:= "SI3"
	Local cCpoDesCc	:= "I3_DESC"
	Local cKeyOrder	:= "I3_FILIAL+I3_CUSTO"
	Local nOrder
	Local cDescCC	:= ""

	DEFAULT cCc := RD0->RD0_CC

	IF ( CtbInUse() )
		cAliasCc	:= "CTT"
		cCpoDesCc	:= "CTT_DESC01"
		cKeyOrder	:= "CTT_FILIAL+CTT_CUSTO"
	EndIF

	nOrder	:= RetOrdem(cAliasCc, cKeyOrder, .F.)

	If Type("INCLUI") == "L" .And. INCLUI
		cDescCC := ""
	Else
		cDescCC	:= fDesc(cAliasCc, cCc, cCpoDesCc, GetSx3Cache("RD0_DESCCC", "X3_TAMANHO"), xFilial(cAliasCc), nOrder, .F.)
	EndIf

Return cDescCC

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0DescCcBrw	 ЁAutorЁMarinaldo de JesusЁ Data Ё21/01/2004Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁInit do Browse para o Campo RD0_DESCCC                   	Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_INIBRW do campo RD0_DESCCC     							Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0DescCcBrw()
Return( Rd0DescCcInit( RD0->RD0_CC ) )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0EmailVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_EMAIL                 					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_EMAIL          						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0EmailVld()

Local lRd0EmailOk := .T.

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF !( lRd0EmailOk := ( "@" $ GetMemVar( "RD0_EMAIL" ) ) )
		Break
	EndIF

	If (M->RD0_EMAIL <> RD0->RD0_EMAIL)
		lAlterApi := .T.
	EndIf

End Sequence

Return( lRd0EmailOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0UserVld 		 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_USER                  					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_USER          						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0UserVld()

Local lRd0UserOk := .T.

Begin Sequence

	IF ( Vazio() )
		//Retorna vazio para o campo nome de usuario
		M->RD0_USRNAM := Space( GetSx3Cache("RD0_USRNAM", "X3_TAMANHO") )
		Break
	EndIF

	IF !( lRd0UserOk := UsrExist( GetMemVar( "RD0_USER" ) ) )
		//Retorna vazio para o campo nome de usuario
		M->RD0_USRNAM := Space( GetSx3Cache("RD0_USRNAM", "X3_TAMANHO") )
		Break
	EndIF

	SetMemVar( "RD0_USRNAM" , Rd0UsrNamInit( GetMemVar( "RD0_USER" ) ) )

End Sequence

Return( lRd0UserOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0UsrNamInit	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_USRNAM                  					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_USRNAM          						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0UsrNamInit(cUsrCod)

	Local cDescUsu := ""

	DEFAULT cUsrCod := RD0->RD0_USER

	If Type("INCLUI") == "L" .And. INCLUI
		cDescUsu	:= ""
	Else
		cDescUsu	:= UsrRetName(cUsrCod)
	EndIf

Return cDescUsu

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0UsrNamBrw	 ЁAutorЁMarinaldo de JesusЁ Data Ё21/01/2004Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁInit do Browse para o Campo RD0_USRNAM                   	Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_INIBRW do campo RD0_USRNAM     							Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0UsrNamBrw()
Return( Rd0UsrNamInit( RD0->RD0_USER ) )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0CodMenVld	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_CODMEN                					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_CODMEN          						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0CodMenVld()

Local aArea			:= GetArea()
Local aAreaRD0		:= RD0->( GetArea() )
Local lRd0CodMenOk	:= .T.
Local nOrder		:= RetOrdem( "RD0" , "RD0_FILIAL+RD0_CODIGO" , .F. )

Begin Sequence

	IF ( Vazio() )
		Break
	EndIF

	IF ( Type( "__nRd0SvRecno__" ) == "N" )
		IF (  __nRd0SvRecno__ > 0 )
			RD0->( MsGoto( __nRd0SvRecno__ ) )
		ElseIF ( Inclui )
			PutFileInEof( "RD0" )
		EndIF
	EndIF

	IF !( lRd0CodMenOk := ExistCpo( "RD0" , GetMemVar( "RD0_CODMEN" ) , nOrder ) )
		Break
	EndIF

	SetMemVar( "RD0_NOMMEN" , Rd0NomMenInit( GetMemVar( "RD0_CODMEN" ) ) )

End Sequence

RestArea( aAreaRD0 )
RestArea( aArea )

Return( lRd0CodMenOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0NomMenInit	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁInit do Campo RD0_NOMMEN                   					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_RELACAO do campo RD0_NOMMEN     							Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0NomMenInit( cCodMen )

Local aArea		:= GetArea()
Local aAreaRD0	:= RD0->( GetArea() )
Local nOrder	:= RetOrdem( "RD0" , "RD0_FILIAL+RD0_CODIGO" , .F. )

Local cNomMen

DEFAULT cCodMen	:= RD0->RD0_CODMEN

cNomMen := fDesc( "RD0" , cCodMen , "RD0_NOME" , GetSx3Cache( "RD0_NOMMEN" , "X3_TAMANHO" ) , xFilial("RD0") , nOrder , .F. )

RestArea( aAreaRD0 )
RestArea( aArea )

Return( cNomMen )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0NomMenBrw	 ЁAutorЁMarinaldo de JesusЁ Data Ё21/01/2004Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁInit do Browse para o Campo RD0_NOMMEN                   	Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_INIBRW do campo RD0_NOMMEN     							Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0NomMenBrw()
Return( Rd0NomMenInit( RD0->RD0_CODMEN ) )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0MsBlQlVld	 ЁAutorЁMarinaldo de JesusЁ Data Ё09/10/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValidar o Campo RD0_TIPO                    				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_TIPO                   				Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0MsBlQlVld()

Local lRd0MsBlQlOk := .T.

Begin Sequence

	//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//ЁQuando for alteraГЦo, permitir deixar o campo RD0_MSBLQL, em brancoЁ
	//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	IF !( lRd0MsBlQlOk := Pertence( If(!INCLUI," ","")+OpBxNaoSim( .T. ) ) )
		Break
	EndIF

End Sequence

Return( lRd0MsBlQlOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0MsBlQlInit	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁInit do Campo RD0_MSBLQL                   					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_RELACAO do campo RD0_MSBLQL           					Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0MsBlQlInit()
Return( SubStr( OpBxNaoSim( .T. ) , 2 , 1 ) )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0MsBlQlBox	 ЁAutorЁMarinaldo de JesusЁ Data Ё22/07/2003Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁOpcBox do Campo RD0_MSBLQL                    				Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_CBOX do campo RD0_MSBLQL            						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0MsBlQlBox()
Return( OpBxNaoSim( .F. ) )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0PortalVld	 ЁAutorЁMarinaldo de JesusЁ Data Ё11/08/2004Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_PORTAL                					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_PORTAL          						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0PortalVld()

	Local nSizeRD0		:= TamSX3("RD0_PORTAL")[1]
	Local lRd0PortalOk 	:= .T.
	Local lPergunte		:= .F.
	Local lFilRH 		:= .F.

	DEFAULT lRd0CPO		:= ChkFile("RD0") .And. If(RD0->(ColumnPos("RD0_FILRH")) > 0, .T., .F.)

	If Valtype(MV_PAR09) <> Nil .And. !Empty(MV_PAR09)
		lFilRH := .T.
	Endif

	if lFilRH
		lPergunte := !Empty(MV_PAR07)
	endif

	Begin Sequence

		If Vazio()
			Break
		EndIf

		If AllTrim(Upper(ReadVar())) == "M->RD0_PORTAL" .Or. lPergunte

			lRd0PortalOk := ExistCpo("AI3", Iif(!lPergunte, M->RD0_PORTAL, MV_PAR08))

			If lRd0CPO .And. lRd0PortalOk
				If lPergunte
					cFilUsr := MV_PAR07
					cCodUsr := MV_PAR08

					If Empty(cFilUsr)
						cRd0Fil := Posicione("AI3", 1, xFilial("AI3") + cCodUsr, "AI3_FILIAL")
					Else
						cRd0Fil := Posicione("AI3", 1, xFilial("AI3", cFilUsr) + cCodUsr, "AI3_FILIAL")
					EndIf
				Else
					If Empty(M->RD0_FILRH)
						cRd0Fil := Posicione("AI3", 1, xFilial("AI3") + M->RD0_PORTAL, "AI3_FILIAL")
					Else
						cRd0Fil := Posicione("AI3", 1, xFilial("AI3", M->RD0_FILRH) + M->RD0_PORTAL, "AI3_FILIAL")
					EndIf
				EndIf

				If !lPergunte .And. cRd0Fil <> M->RD0_FILRH 
					M->RD0_FILRH := cRd0Fil
				ElseIf lPergunte .And. cRd0Fil <> cFilUsr
					cFilUsr := cRd0Fil
					lRd0PortalOk := .F.
					// "AtenГЦo"
					// "NecessАrio preencher os campos Filial UsuАrio Portal e CСdigo UsuАrio Portal com dados vАlidos - revise o conteЗdo dos campos."
					MsgAlert(OemToAnsi(STR0068), OemToAnsi(STR0067))		
				EndIf
			EndIf

		ElseIf lRd0CPO .And. AllTrim(Upper(ReadVar())) == "M->RD0_FILRH"
			lRd0PortalOk := ExistCpo("SM0", cEmpAnt + AllTrim(M->RD0_FILRH))

			cRd0Fil := Posicione("AI3", 1, xFilial("AI3", M->RD0_FILRH) + M->RD0_PORTAL, "AI3_FILIAL")

			If lRd0CPO .And. lRd0PortalOk .And. !Empty(M->RD0_PORTAL) .And. cRd0Fil <> M->RD0_FILRH 
				M->RD0_PORTAL := Space(nSizeRD0)
			EndIf
		EndIf

	End Sequence

Return lRd0PortalOk

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0IdentVld	 	 ЁAutorЁMarinaldo de JesusЁ Data Ё11/08/2004Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁValid do campo RD0_IDENT                					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_VALID do campo RD0_IDENT          						Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0IdentVld()

Local lRd0IdentOk := .T.

Begin Sequence

	IF Vazio()
		Break
	EndIF

	IF CheckExecForm( { || dbSelectArea( "RE8" ) , ( Select( "RE8" ) > 0 ) } , .F. , "NOEXISTALS" )
		IF !( lRd0IdentOk := ExistCpo( "RE8" ) )
			Break
		EndIF
		SetMemVar( "RD0_IDESCR" , Rd0IDescRInit( GetMemVar( "RD0_IDENT" ) ) )
	EndIF

End Sequence

Return( lRd0IdentOk )

/*/
зддддддддддбдддддддддддддддддбдддддбддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o    ЁRd0IDescRInit    ЁAutorЁMarinaldo de JesusЁ Data Ё11/08/2004Ё
цддддддддддедддддддддддддддддадддддаддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁInit do Campo RD0_IDESCR                   					Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       ЁX3_RELACAO do campo RD0_IDESCR     							Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function Rd0IDescRInit( cRd0Ident )

Local cRd0IDescRInit
Local nOrder
Local cFil:= ""

Private lCorpManage		:= fIsCorpManage()

DEFAULT cRd0Ident := RD0->RD0_IDENT
If lCorpManage
	cFil:= xFilial("RE8", RE8->RE8_FILIAL)
Else
	cFil:= xFilial("RD0")
Endif


IF CheckExecForm( { || dbSelectArea( "RE8" ) , ( Select( "RE8" ) > 0 ) } , .F. , "NOEXISTALS" )
	nOrder := RetOrdem( "RE8" , "RE8_FILIAL+RE8_IDENT" )
	IF cIdiom == "es"
		cRd0IDescRInit := fDesc( "RE8" , cRd0Ident , "RE8_IDSCSP" , GetSx3Cache( "RD0_IDESPA" , "X3_TAMANHO" ) , xFilial("RD0") , nOrder , .F. )
	ELSEIF cIdiom == "en"
		cRd0IDescRInit := fDesc( "RE8" , cRd0Ident , "RE8_IDSCEN" , GetSx3Cache( "RD0_IDEENG" , "X3_TAMANHO" ) , xFilial("RD0") , nOrder , .F. )
	ELSE
		cRd0IDescRInit := fDesc( "RE8" , cRd0Ident , "RE8_IDESCR" , GetSx3Cache( "RD0_IDESCR" , "X3_TAMANHO" ) , cFil , nOrder , .F. )
	ENDIF
Else
	IF cIdiom == "es"
		cRd0IDescRInit := Space( GetSx3Cache( "RD0_IDESPA" , "X3_TAMANHO" ) )
	ELSEIF cIdiom == "en"
		cRd0IDescRInit := Space( GetSx3Cache( "RD0_IDEENG" , "X3_TAMANHO" ) )
	ELSE
		cRd0IDescRInit := Space( GetSx3Cache( "RD0_IDESCR" , "X3_TAMANHO" ) )
	ENDIF
EndIF

Return( cRd0IDescRInit )

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммммммммкмммммммямммммммммммммммммкммммммямммммммммм╩╠╠
╠╠╨Programa  Ё  Apda020Leg    ╨Autor  ЁEmerson Grassi   ╨ Data Ё 29/03/05 ╨╠╠
╠╠лммммммммммьммммммммммммммммймммммммомммммммммммммммммйммммммомммммммммм╧╠╠
╠╠╨Desc.     ЁLegenda de Browse do cadastro de Pessoas.		              ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё AP                                                         ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ*/
Function Apda020Leg()

	BrwLegenda	(cCadastro,STR0045, {	{"BR_VERMELHO"	, OemToAnsi(STR0042)},; //"Legenda###"Inativo"
										{"ENABLE"		, OemToAnsi(STR0043)} ; //"Ativo"
								  	};
				)
Return Nil


/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммммммммкмммммммямммммммммммммммммкммммммямммммммммм╩╠╠
╠╠╨Programa  Ё  Apda020Seg    ╨Autor  ЁMarcelo Faria    ╨ Data Ё 14/10/20 ╨╠╠
╠╠лммммммммммьммммммммммммммммймммммммомммммммммммммммммйммммммомммммммммм╧╠╠
╠╠╨Desc.     ЁOpcao para troca de senha criptografada.		              ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё AP                                                         ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ*/
Function Apda020Seg( cAlias , nRec , nOpc )
Local aSvKeys		:= GetKeys()
Local aArea 		:= GetArea()
Local aAreaRD0		:= RD0->( GetArea() )
Local nPolSeg		:= SuperGetMv("MV_POLSEG", .F. , 0)
Local lChkRules   	:= nPolSeg > 0 .And. FindFunction("MPPSWVAULT") //A partir da LIB de 13/04/2021
Local cSvcCadastro  := cCadastro
Local nOpca			:= 0
Local aRetcoords	:= {}

Local cSenhaNova	:= Space(50)
Local cSenhaConf	:= Space(50)

If nPolSeg == 0
	Aviso(STR0050,STR0071,{"Ok"}) //"Aviso"###"ParБmetro MV_POLSEG nЦo configurado para atualizar senha criptografada"
Else
	aRetcoords := RetCoords(4,3,50,15,1)
	DEFINE MSDIALOG oDlg1  FROM 0,0 TO 200,430 TITLE OemToAnsi( STR0007 ) PIXEL //"Cadastro de Participantes" 10,20 TO 26,80

	@ aRetcoords[02][1], aRetcoords[02][2] SAY STR0070 PIXEL		//"Alt.Senha Criptografada"

	@ aRetcoords[06][1], aRetcoords[06][2] SAY STR0072 PIXEL		//"Nova Senha: "
	@ aRetcoords[07][1], aRetcoords[07][2] MSGET cSenhaNova PASSWORD PIXEL SIZE 50,7

	@ aRetcoords[10][1], aRetcoords[10][2] SAY STR0049 PIXEL		//"Confirma Senha: "
	@ aRetcoords[11][1], aRetcoords[11][2] MSGET cSenhaConf PASSWORD PIXEL SIZE 50,7

	ACTIVATE MSDIALOG oDlg1 CENTERED ON INIT (EnchoiceBar(oDlg1, {|| nOpca:= 1, If( RdoVldSenha(cSenhaNova,cSenhaConf,.T.,lChkRules),oDlg1:End(),Nil ) },{||nOpca:=2,oDlg1:End()}))

	If nOpca == 1
		//Atualiza nova senha
		If !fPwdChange( AllTrim(cSenhaNova) )
			Aviso(STR0050,STR0073,{"Ok"}) //"NЦo foi possМvel a atualizaГЦo da senha no momento!" 
		EndIf
	EndIf
EndIf	

cCadastro := cSvcCadastro
RestArea( aAreaRD0 )
RestArea( aArea )

RestKeys( aSvKeys , .T. )

Return( NIL )


/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммммммммкмммммммямммммммммммммммммкммммммямммммммммм╩╠╠
╠╠╨Programa  Ё  Apda020Sen    ╨Autor  ЁEmerson Grassi   ╨ Data Ё 29/03/05 ╨╠╠
╠╠лммммммммммьммммммммммммммммймммммммомммммммммммммммммйммммммомммммммммм╧╠╠
╠╠╨Desc.     ЁOpcao para troca de senha.					              ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё AP                                                         ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ*/
Function Apda020Sen( cAlias , nRec , nOpc )

Local aSvKeys		:= GetKeys()
Local aArea 		:= GetArea()
Local aAreaRD0		:= RD0->( GetArea() )
Local cSvcCadastro  := cCadastro
Local nOpca			:= 0
Local aRetcoords	:= {}

Local cSenhaAtu		:= Embaralha(RD0->RD0_SENHA, 1)
Local cSenhaNova	:= Space(6)
Local cSenhaConf	:= Space(6)
Local cUsrConectado := RetCodUsr()

Local cAliasQry    	:= "QSRA"
Local cQuery		:= ""
Local cSeek			:= ""
Local cCod 			:= RD0->RD0_CODIGO

DEFAULT lLastPwd  	:= ChkFile("RD0") .And. RD0->(ColumnPos("RD0_ULI")) > 0

If AllTrim(cUsrConectado) != AllTrim(RD0->RD0_USER)
	cSenhaAtu := "******"
EndIf

aRetcoords := RetCoords(4,3,50,15,1)
DEFINE MSDIALOG oDlg1  FROM 0,0 TO 200,430 TITLE OemToAnsi( STR0007 ) PIXEL //"Cadastro de Participantes" 10,20 TO 26,80

@ aRetcoords[02][1], aRetcoords[02][2] SAY STR0047 PIXEL		//"Senha Antiga: "
@ aRetcoords[03][1], aRetcoords[03][2] SAY cSenhaAtu PIXEL SIZE 50,7

@ aRetcoords[06][1], aRetcoords[06][2] SAY STR0048 PIXEL		//"Senha Atual: "
@ aRetcoords[07][1], aRetcoords[07][2] MSGET cSenhaNova PASSWORD PIXEL SIZE 50,7

@ aRetcoords[10][1], aRetcoords[10][2] SAY STR0049 PIXEL		//"Confirma Senha: "
@ aRetcoords[11][1], aRetcoords[11][2] MSGET cSenhaConf PASSWORD PIXEL SIZE 50,7

ACTIVATE MSDIALOG oDlg1 CENTERED ON INIT (EnchoiceBar(oDlg1, {|| nOpca:= 1, If( RdoVldSenha(cSenhaNova,cSenhaConf),oDlg1:End(),Nil ) },{||nOpca:=2,oDlg1:End()}))

If nOpca == 1
	cSenha := Embaralha(cSenhaNova, 0)
	RD0->( RecLock("RD0",.F.) )
		RD0->RD0_SENHA := cSenha
		//Zera o contador de senhas incorretas caso exista na base
		If lLastPwd
			RD0->RD0_ULI := 0
		EndIf
	MsUnlock()

	//Quando altera a senha da Pessoa altera a senha do funcionАrio tambИm
	cQuery := " SELECT "
	cQuery += " 	RDZ.RDZ_FILIAL, "
	cQuery += " 	RDZ.RDZ_CODRD0, "
	cQuery += " 	RDZ.RDZ_ENTIDA, "
	cQuery += " 	RDZ.RDZ_FILENT, "
	cQuery += " 	RDZ.RDZ_CODENT "
	cQuery += " FROM " + RetSqlName("RD0") + " RD0  "
	cQuery += " 	INNER JOIN " + RetSqlName("RDZ") + " RDZ ON "
	cQuery += " 		RD0_FILIAL = RDZ_FILIAL AND "
	cQuery += "     '"+cCod+"' = RDZ_CODRD0 AND "
	cQuery += "		RD0_CODIGO = RDZ_CODRD0 AND "
	cQuery += " 		RDZ_ENTIDA = 'SRA' AND "
	cQuery += "     '"+cEmpAnt+"' = RDZ_EMPENT AND"
	cQuery += "   RD0.D_E_L_E_T_=' ' AND "
	cQuery += "   RDZ.D_E_L_E_T_=' ' "

	cQuery := ChangeQuery( cQuery )
	If Select(cAliasQry) > 0
		(cAliasQry)->(dbCloseArea())
	Endif
	dbUseArea( .T., "TOPCONN", TcGenQry( ,, cQuery ), cAliasQry, .F., .T. )
	(cAliasQry)->(dbGoTop())
	While !( cAliasQry )->( Eof() )

		dBSelectArea("SRA")
		dbSetOrder(1)
		cSeek := Rtrim(( cAliasQry )->RDZ_CODENT )
		If SRA->(dbSeek(cSeek))
			RecLock('SRA')
			SRA->RA_SENHA := cSenha
			SRA->(MSUNLOCK())	
		EndIf
		
		DbSelectArea( cAliasQry )
		( cAliasQry )->(DbSkip())
	EndDo
	If Select(cAliasQry) > 0
		(cAliasQry)->(dbCloseArea())
	Endif
EndIf

cCadastro := cSvcCadastro
RestArea( aAreaRD0 )
RestArea( aArea )

RestKeys( aSvKeys , .T. )

Return( NIL )


/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммммммммкмммммммямммммммммммммммммкммммммямммммммммм╩╠╠
╠╠╨Programa  Ё  RdoVldSenha   ╨Autor  ЁEmerson Grassi   ╨ Data Ё 29/03/05 ╨╠╠
╠╠лммммммммммьммммммммммммммммймммммммомммммммммммммммммйммммммомммммммммм╧╠╠
╠╠╨Desc.     ЁValidacao da troca de senha.					              ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё AP                                                         ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ*/
Static Function RdoVldSenha(cSenha1, cSenha2, lSenhaC, lChkRules)
Local lOk		:= .F.
Local cMsgFault	:= ""

default lSenhaC := .F.
default lChkRules := .F.

If(cSenha1 == cSenha2) .And. !Empty(cSenha1)
		lOk := .T.
Else
	Aviso(STR0050,STR0046,{"Ok"}) //"Aviso"###"Senha em branco ou Confirmacao diferente da Senha."
EndIf

If lOk .And. lSenhaC

	//Checa se a nova senha atende as regras de preenchimento de senhas do Protheus - EXCETO se for a senha padrao
	If lChkRules .And. !( AllTrim(cSenha1) == SubStr(dToS(RD0->RD0_DTNASC),3,2) + SubStr(dToC(RD0->RD0_DTADMI),1,2) + SubStr(RD0->RD0_CIC,10,2))
		lOk := fPwdRules( RD0->RD0_CODIGO, AllTrim(cSenha1), @cMsgFault )
		cMsgFault := If( Empty(cMsgFault), cMsgFault, DecodeUTF8(cMsgFault) )
	EndIf

	//validaГУes de politica de seguranГa
	If lOk
		nCheck   := If( lChkRules, 2, 1 )
		cMsgFault := fPwdValid( alltrim(cSenha1) , nCheck, , lChkRules )
	EndIf
	
	If !Empty(cMsgFault)             
		lOk := .F.
		Aviso(STR0050,cMsgFault,{"Ok"}) 
	Else

		//validaГУes de senha criptografada anterior
		cMsgFault := fPwdValid( alltrim(cSenha1) , 2 , , lChkRules )

		If !Empty(cMsgFault)             
			lOk := .F.
			Aviso(STR0050,cMsgFault,{"Ok"}) 
		EndIf
	EndIf	
EndIf

Return lOk


/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠иммммммммммяммммммммммммммммкмммммммямммммммммммммммммкммммммямммммммммм╩╠╠
╠╠╨Programa  Ё  Rd0IdentSx7   ╨Autor  ЁTania Bronzeri   ╨ Data Ё30/10/2006╨╠╠
╠╠лммммммммммьммммммммммммммммймммммммомммммммммммммммммйммммммомммммммммм╧╠╠
╠╠╨Desc.     Ё Preenchimento do campo descricao da identif. profissional  ╨╠╠
╠╠лммммммммммьмммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╧╠╠
╠╠╨Uso       Ё SX7                                                        ╨╠╠
╠╠хммммммммммомммммммммммммммммммммммммммммммммммммммммммммммммммммммммммм╪╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ*/
Function Rd0IdentSx7()
Local cRet	:= space(30)

IF cIdiom == "es"
	cRet := RE8->RE8_IDSCSP
ELSEIF cIdiom == "en"
	cRet := RE8->RE8_IDSCEN
ELSE
	cRet := RE8->RE8_IDESCR
ENDIF
Return cRet

/*
зддддддддддбддддддддддддддддбдддддбдддддддддддддддддддбддддддбдддддддддд©
ЁFun┤└o    Ё MenuDef		ЁAutorЁ  Luiz Gustavo     Ё Data Ё20/12/2006Ё
цддддддддддеддддддддддддддддадддддадддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁIsola opcoes de menu para que as opcoes da rotina possam    Ё
Ё          Ёser lidas pelas bibliotecas Framework da Versao 9.12 .      Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё< Vide Parametros Formais >									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё Uso      ЁAPDA020                                                     Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё Retorno  ЁaRotina														Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ< Vide Parametros Formais >									Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

Static Function MenuDef()
/*/
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Ё Define Array contendo as Rotinas a executar do programa      Ё
Ё ----------- Elementos contidos por dimensao ------------     Ё
Ё 1. Nome a aparecer no cabecalho                              Ё
Ё 2. Nome da Rotina associada                                  Ё
Ё 3. Usado pela rotina                                         Ё
Ё 4. Tipo de Transa┤└o a ser efetuada                          Ё
    1 - Pesquisa e Posiciona em um Banco de Dados             Ё
Ё    2 - Simplesmente Mostra os Campos                         Ё
Ё    3 - Inclui registros no Bancos de Dados                   Ё
Ё    4 - Altera o registro corrente                            Ё
Ё    5 - Remove o registro corrente do Banco de Dados          Ё
Ё    6 - Copiar                                                Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/

Local aRotina
Local aRotPE	:= {}

aRotina :=  {;
				{ STR0001 , "AxPesqui"	 , 0 , 01,,.F. } ,;	//"Pesquisar"
				{ STR0002 , "Apda020Mnt" , 0 , 02 } ,;		//"Visualizar"
				{ STR0003 , "Apda020Mnt" , 0 , 03 } ,;		//"Incluir"
				{ STR0004 , "Apda020Mnt" , 0 , 04 } ,;		//"Alterar"
				{ STR0005 , "Apda020Mnt" , 0 , 05 } ,;		//"Excluir"
				{ STR0006 , "Apda020Mnt" , 0 , 03 } ,;		//"Relac.Partic."
				{ STR0044 , "Apda020Sen" , 0 , 04 } ,;		//"Alt.Senha"
				{ STR0070 , "Apda020Seg" , 0 , 04 } ,;  	//"Alt.Senha Criptografada"
				{ STR0055 , "Apda020Usu" , 0 , 04 } ,;		//"Alt.UsuАrio Portal"
				{ STR0063 , "Apda020Vin" , 0 , 01 } ,;		//"Excluir Vinculo"
				{ STR0045 , "Apda020Leg" , 0 , 02, ,.F.} ;	//"Legenda"
				}

// Ponto de entrada - Adiciona rotinas ao aRotina
If lAPD20ROT
	aRotPE := ExecBlock( "APD20ROT", .F., .F. )
	If ValType( aRotPE ) == "A" .And. !Empty( aRotPE )
		AEval( aRotPE, {|x| aAdd( aRotina,x )} )
	EndIf
EndIf

Return aRotina

/*
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    ЁfCheckAtivo    Ё Autor ЁRenan Borges      Ё Data Ё19/09/2014Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o Ё Funcao de processamento da gravacao do SX9                 Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso      Ё ATFA190                                                    Ё╠╠
╠╠юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
*/
Static function fCheckAtivo()
Local aArea := SRA->( GetArea() )
Local lAtualiza := .T.
Local cIndKeySra
Local cArqSRA
Local nIndexSra
Local dAdmiss := SRA->RA_ADMISSA
Local dDemiss	:= SRA->RA_DEMISSA

cIndKeySRA	:= "RA_CIC+RA_ADMISSA"
cArqSRA		:= CriaTrab( Nil, .F. )
IndRegua( "SRA", cArqSRA, cIndKeySRA, , ,'', .T. )
nIndexSRA	:= SRA->( RetIndex( ) ) + 1
SRA->( DbSetOrder ( nIndexSRA ) )
DbSeek(RD0->RD0_CIC)

While !Eof() .AND. SRA->RA_CIC == RD0->RD0_CIC

	If !Empty(dDemiss)	// Foi demitido
		If Empty(SRA->RA_DEMISSA) // HА outro registro ativo
			lAtualiza := .F.
			Exit
		ElseIF !(SRA->RA_RESCRAI $ '30/31')	// Outro registro demitido e nЦo И transferido
			If SRA->RA_DEMISSA >  dDemiss	// Se a data de demissЦo do outro registro for maior, entЦo nЦo atualiza, pois nЦo И o registro mais atual.
				lAtualiza := .F.
				Exit
			ElseIf SRA->RA_DEMISSA == dDemiss .AND. SRA->RA_ADMISSA > dAdmiss // Se forem iguais as datas de demissЦo e houver outro registro com data de admissЦo maior, nЦo atualiza.
				lAtualiza := .F.
				Exit
			EndIf
		EndIf
	Else	// NЦo estА demitido
		If Empty(SRA->RA_DEMISSA) .AND. dAdmiss < SRA->RA_ADMISSA	// NЦo И o registro mais novo a estar ativo
			lAtualiza := .F.
			Exit
		EndIf
	EndIf

	dbSkip()

EndDo

RestArea(aArea)
Return lAtualiza

/*
зддддддддддбддддддддддддддбдддддддбдддддддддддддддддддбддддддбдддддддддд©
ЁFuncao    Ё IntegDef	  Ё Autor Ё Renan Borges    Ё Data Ё 11/05/17 Ё
цддддддддддеддддддддддддддадддддддадддддддддддддддддддаддддддадддддддддд╢
ЁDescricao Ё Funcao para a interacao com EAI - Envio/Recebimento        Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso       Ё APDA020		                                        	Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
Static Function IntegDef( cXml, nType, cTypeMsg, cVersaoMsg )
Local aRet := {}

	aRet:= APDI020( cXml, nType, cTypeMsg, cVersaoMsg )

Return( aRet )

/*/{Protheus.doc} Rd0AproVld
Valid do campo RD0_APROPC
@author isabel.noguti
@since 23/11/2017
@version 12.1.17/12.1.16
/*/
Function Rd0AproVld()

	Local lRet := Vazio() .Or. ( Existcpo( "RD0" , M->RD0_APROPC, 1 ) .And. ( M->RD0_APROPC <> M->RD0_CODIGO .OR. GetMvRH("MV_RESAPRT") == "1" ) )

Return lRet

/*/{Protheus.doc} Rd0ApsuVld
Valid do campo RD0_APSUBS
@author isabel.noguti
@since 23/11/2017
@version 12.1.17/12.1.16
/*/
Function Rd0ApsuVld()

	Local lRet := Vazio() .Or. ( ExistCpo( "RD0" , M->RD0_APSUBS, 1 ) .And. ( M->RD0_APSUBS <> M->RD0_CODIGO .OR. GetMvRH("MV_RESAPRT") == "1" ) )

Return lRet

/*/{Protheus.doc} Rd0UsprVld
Valid do campo RD0_USRPRE
@author isabel.noguti
@since 23/11/2017
@version 12.1.17/12.1.16
/*/
Function Rd0UsprVld()

	Local lRet := Vazio() .Or. ( Existcpo( "RD0" , M->RD0_USRPRE, 1 ) .And. M->RD0_USRPRE <> M->RD0_CODIGO )

Return lRet

/*/{Protheus.doc} Apda020Usu
//TODO AtualizaГЦo em lote do campo UsuАr.Portal(RD0_PORTAL).
@author martins.marcio
@since 09/08/2019
@version 12.1.28

@type function
/*/
Function Apda020Usu()
Local lRet	:= .T.
Local nOpcA	:= 0
Local aArea			:= GetArea()
Local aSays			:= {}
Local aButtons		:= {}
Private cCadPart   := OemToAnsi( STR0055 ) // 'Alt.UsuАrio Portal'

AADD(aSays,OemToAnsi( STR0056 )) // "Esta rotina tem como objetivo fazer a atualizaГЦo em lote"
AADD(aSays,OemToAnsi( STR0057 ) )// "do campo UsuАrio Portal"

AADD(aButtons, { 5,.T.,{|| Pergunte("APD20U",.T. ) } } )
AADD(aButtons, { 1,.T.,{|o| nOpcA := 1,IF(gpconfOK(),FechaBatch(),nOpcA := 0 ) }} )
AADD(aButtons, { 2,.T.,{|o| FechaBatch() }} )

FormBatch( cCadPart, aSays, aButtons )

IF ( nOpcA == 1 )
	Processa({|| Apd20Proc() },OemToAnsi(STR0058))
	MostraErro()
EndIF

RestArea( aArea )

Return lRet

/*/{Protheus.doc} Apd20Proc
//TODO AtualizaГЦo em Lote do usuАrio do Portal.
MV_PAR01 - Filial De
MV_PAR02 - Filial Ate
MV_PAR03 - Codigo De
MV_PAR04 - Codigo AtИ
MV_PAR05 - FunГЦo De
MV_PAR06 - FunГЦo AtИ
MV_PAR07 - Filial Usuario Portal ?       
MV_PAR08 - UsuАrio Portal?
MV_PAR09 - Alterar jА preenchidos? 1=NЦo; 2=Sim.
@author martins.marcio
@since 12/08/2019
@version 12.1.28

@type function
/*/
Static Function Apd20Proc()

Local cFilDe	:= AllTrim(MV_PAR01)
Local cFilAte	:= AllTrim(MV_PAR02)
Local cCodDe	:= AllTrim(MV_PAR03)
Local cCodAte	:= AllTrim(MV_PAR04)
Local cFuncDe	:= AllTrim(MV_PAR05)
Local cFuncAte	:= AllTrim(MV_PAR06)
Local cFilRH	:= ''
Local cUserPor	:= ''
Local lAltPreen	:= .F.
Local cAliasQry := getNextAlias()
Local lAchouRA	:= .F.
Local lAtualiza	:= .F.
Local cChave	:= ""
Local nQtdAt	:= 0
Local cQuebra	:= Chr(13) + Chr(10)
Local nSizeFil	:= FWSizeFilial()
Local nSizeRD0	:= TamSX3("RD0_CODIGO")[1]
Local nSizeCFun	:= TamSX3("RA_CODFUNC")[1]
Local aOfusca	:= If(FindFunction('ChkOfusca'), ChkOfusca(), { .T., .F. }) //[2]Ofuscamento
Local aFldOfusca:= If( aOfusca[2], FwProtectedDataUtil():UsrNoAccessFieldsInList( {"RD0_NOME","RD0_CIC"} ), {} )
Local lOfuscaNom:= .F.
Local lOfuscaCpf:= .F.
Local lGestao   := ( FWSizeFilial() > 2 ) 	// Indica se usa Gestao Corporativa
Local lAI3Excl  := Iif( lGestao, FWModeAccess("AI3",1) == "E", FWModeAccess("AI3",3) == "E")

DEFAULT lRd0CPO		:= ChkFile("RD0") .And. If(RD0->(ColumnPos("RD0_FILRH")) > 0, .T., .F.)

If ( lAI3Excl .And. Empty(MV_PAR07) ) .Or. ( !lAI3Excl .And. !Empty(MV_PAR07) )
	MsgInfo( OemToAnsi( STR0078) ) //"Filial do UsuАrio do Portal deve ser preenchida."
	Return Nil
Endif

cCodDe	:= If(Upper(TCGetDB()) # "ORACLE", AllTrim(MV_PAR03),PADR(cCodDe,nSizeRD0))

If Len(aFldOfusca) > 0
	lOfuscaNom := aScan( aFldOfusca , { |x| x:CFIELD == "RD0_NOME" } ) > 0
	lOfuscaCpf := aScan( aFldOfusca , { |x| x:CFIELD == "RD0_CIC" } ) > 0
ENDIF

If ValType(MV_PAR09) == "N"
	cFilRH	:= AllTrim(MV_PAR07)
	cUserPor:= AllTrim(MV_PAR08)
	lAltPreen := (MV_PAR09 == 2)// Alterar jА preenchidos?
Else
	If !Empty(MV_PAR08)
		cUserPor:= AllTrim(MV_PAR07)
		cFilRH  := ''
		lAltPreen := (MV_PAR08 == 2)// Alterar jА preenchidos?
	EndIf	
EndIf

cFilAnt := cAuxFil

AutoGrLog("ParБmetros:")
AutoGrLog("Filial de '" + PADR(cFilDe,nSizeFil) + "' AtИ '" + PADR(cFilAte,nSizeFil) + "'")
AutoGrLog("Codigo de '" + PADR(cCodDe,nSizeRD0) + "' AtИ '" + PADR(cCodAte,nSizeRD0) + "'")
AutoGrLog("FunГЦo de '" + PADR(cFuncDe,nSizeCFun) + "' AtИ '" + PADR(cFuncAte,nSizeCFun) + "'")
AutoGrLog("Atualiza jА preenchidos? " + If(lAltPreen,"'SIM'","'NцO'")+cQuebra)

BeginSql alias cAliasQry
	SELECT RD0.R_E_C_N_O_,
			RD0.RD0_PORTAL,
			RD0.RD0_CODIGO
	FROM
		%Table:RD0% RD0
	WHERE RD0.RD0_FILIAL BETWEEN %exp:xFilial("RD0",cFilDe)% AND %exp:xFilial("RD0",cFilAte)% AND
	RD0_CODIGO BETWEEN %exp:cCodDe% AND %exp:cCodAte% AND
	RD0.%notDel%
EndSql

DbSelectArea("RD0")
ProcRegua(Reccount())
AutoGrLog(OemToAnsi(STR0061) + "'" + AllTrim(cUserPor) + "'" +cQuebra) // "UsuАrio Portal: "
AutoGrLog(OemToAnsi(STR0059)+cQuebra) // "Participantes atualizados: "
(cAliasQry)->(DbGoTop())
While !(cAliasQry)->(Eof())

	lAchouRA := .F.
	If Empty((cAliasQry)->RD0_CODIGO)
		(cAliasQry)->(DbSkip())
		Loop
	EndIf

	If Empty((cAliasQry)->RD0_PORTAL) .Or. lAltPreen
		lAtualiza := .T.
		RD0->(DbGoTo((cAliasQry)->R_E_C_N_O_))
		cChave := AllTrim(RD0->RD0_FILIAL) + " | " + AllTrim(RD0->RD0_CODIGO) + " | " + If(lOfuscaNom, Replicate('*',12), Left(AllTrim(RD0->RD0_NOME),12)) + " | " + OemToAnsi(STR0062) + If(lOfuscaCpf, Replicate('*',11), AllTrim(RD0->RD0_CIC)) + " |"
		IncProc(OemToAnsi(STR0060) + cChave) // Atualizando Participante:

		// Busca informacoes do funcionario na SRA
		DbSelectArea("RDZ")
		DbSetOrder(2)
		If !Empty(RD0->RD0_CODIGO) .And. !Empty(RD0->RD0_CIC)
			If DbSeek(xFilial("RDZ",RD0->RD0_FILIAL)+RD0->RD0_CODIGO+cEmpAnt)
				DBSelectArea("SRA")
				DbSetOrder(5)
				While RDZ->(!Eof() .and. RDZ->RDZ_ENTIDA == 'SRA' .and. RD0->RD0_CODIGO == RDZ->RDZ_CODRD0)
					If SRA->(DbSeek( RDZ->RDZ_FILENT+RD0->RD0_CIC) )
						If RDZ->RDZ_FILENT+RD0->RD0_CIC == SRA->RA_FILIAL+SRA->RA_CIC .And. !Empty(SRA->RA_MAT)
							lAchouRA := .T.
							If SRA->RA_FILIAL >= xFilial("SRA",cFilDe) .And. SRA->RA_FILIAL <= xFilial("SRA",cFilAte) ;
								.And. (Empty(cFuncAte) .Or. (SRA->RA_CODFUNC >= cFuncDe .And. SRA->RA_CODFUNC <= cFuncAte))
								If RD0->( RecLock("RD0",.F.) )
									RD0->RD0_PORTAL := cUserPor
									if lRd0CPO
										RD0->RD0_FILRH	:= cFilRH
									endif
									AutoGrLog(cChave + " Mat: "+ SRA->RA_MAT)
									nQtdAt ++
									RD0->(MsUnlock())
									lAtualiza := .F.
								EndIf
							EndIf
						EndIf
					EndIf
					RDZ->(DbSkip())
				EndDo
			EndIf
		EndIf

		// Atualiza participantes que nao foram encontrados na SRA
		If lAtualiza .And. !lAchouRA
			If RD0->( RecLock("RD0",.F.) )
				RD0->RD0_PORTAL := cUserPor
				if lRd0CPO
					RD0->RD0_FILRH  := cFilRH
				endif
				AutoGrLog(cChave + " Mat: N/A ")
				nQtdAt ++
				RD0->(MsUnlock())
				lAtualiza := .F.
			EndIf
		EndIf

	EndIf
	(cAliasQry)->(DbSkip())
EndDo

If nQtdAt == 0
	AutoGrLog("Nenhum registro foi atualizado.")
EndIf

(cAliasQry)->(DbCloseArea())

Return ( Nil )

/*/{Protheus.doc} Apda020Vin
//Realiza a exclusЦo do vМnculo do Participante com a entidade RDZ, afim de permitir a exclusЦo do Participante vinculado.
@author Wesley Alves Pereira
@since 29/10/2019
@version undefined
@return Nil
/*/
Function Apda020Vin()
Local lPrim := .T.
Local lExcl := .F.
DBSelectArea("RDZ")
DBSetOrder(2)
If !Empty(RD0->RD0_CODIGO)
	If DBSeek(xFilial("RDZ",RD0->RD0_FILIAL)+RD0->RD0_CODIGO,.F.)
			While !EOF() .AND. RDZ->RDZ_FILIAL == xFilial("RDZ",RD0->RD0_FILIAL) .AND. RDZ->RDZ_CODRD0 == RD0->RD0_CODIGO
				If Alltrim(RDZ->RDZ_ENTIDA) == "SRA"
					If lPrim
						lPrim := .F.
						If MsgYesNo(OemToAnsi(STR0064))//"Deseja realmente excluir o vМnculo deste Participante?"
							lExcl := .T.
							If RDZ->( RecLock("RDZ",.F.) )
								dbDelete()
								MsUnlock()
								ApMsgInfo(STR0065) //"Vinculo Entre o FuncionАrio e o Participante excluМdo com sucesso!"
							EndIf
						EndIf
					Else
						If lExcl
							If RDZ->( RecLock("RDZ",.F.) )
								dbDelete()
								MsUnlock()
							EndIf
						EndIf
					EndIf
				EndIf
				DBSelectArea("RDZ")
				RDZ->(DBSkip())
			EndDo
	EndIf
EndIf

If !lExcl
	ApMsgInfo(STR0066) //"NЦo existe vМnculo entre este participante e um funcionАrio"
EndIf

Return (Nil)


/*/{Protheus.doc} Function Apd020SetFil
FunГЦo para executar filtro conforme campo RD0_FIL
@since	02/07/2020
@autor	raquel.andrade
@version 1.0
/*/
Function Apd020SetFil()
Local cFiltro := ""

DEFAULT lRd0CPO		:= ChkFile("RD0") .And. If(RD0->(ColumnPos("RD0_FILRH")) > 0, .T., .F.)

If FunName() $ "APDA020*TCFA130" .And. lRd0CPO

	If !Empty(M->RD0_FILRH)
		cFiltro := "AI3->AI3_FILIAL == '" + xFilial("AI3",M->RD0_FILRH) + "'"
	EndIf

	If Empty(cFiltro)
		cFiltro := "AI3->AI3_FILIAL == '" + xFilial("AI3") + "'"
	EndIf

EndIf

cFiltro := "@#" + cFiltro + "@#"

Return(cFiltro)


//-------------------------------------------------------------------
/*/{Protheus.doc} function VldFAI3
Valida a existencia de registros na tabela AI3 para a filial informada
@author  Gisele Nuncherino
@since   02/09/2020
/*/
//-------------------------------------------------------------------
Function VldFAI3()
Local lPergunte	:= .F.
Local lFilRH 	:= .F.
Local lRet 		:= .T.
Local lGestao   := ( FWSizeFilial() > 2 ) 	// Indica se usa Gestao Corporativa
Local lAI3Excl  := Iif( lGestao, FWModeAccess("AI3",1) == "E", FWModeAccess("AI3",3) == "E")

DEFAULT lRd0CPO		:= ChkFile("RD0") .And. If(RD0->(ColumnPos("RD0_FILRH")) > 0, .T., .F.)

If Valtype(MV_PAR09) <> Nil
	lFilRH := .T.
Endif

if lFilRH
	lPergunte := !Empty(MV_PAR07)
endif

If FunName() == "APDA020" .And. lRd0CPO

	if lPergunte 
		IF !empty(alltrim(Posicione("AI3",1,xFilial("AI3",MV_PAR07),"AI3_FILIAL")))
			lret := .T.
			cFilAnt := MV_PAR07	
		ELSE
			MsgInfo( OemToAnsi( STR0069) ) //"Filial nЦo cadastrada na tabela AI3 (UsuАrios do Portal)" 
			lret := .F.
		ENDIF
	ElseIf !lPergunte .And. lAI3Excl 
		MsgInfo( OemToAnsi( STR0078) ) //"Filial do UsuАrio do Portal deve ser preenchida."
		lret := .F.
	Endif
Endif

Return lRet

//-------------------------------------------------------------------
/*/{Protheus.doc} function SetFilAI3
Filtra os registros da tabela AI3 para a filial informada
@author  Gisele Nuncherino
@since   02/09/2020
/*/
//-------------------------------------------------------------------
Function SetFilAI3()
Local cFiltro 	:= ""
Local lPergunte	:= .F.
Local lFilRH 	:= .F.

DEFAULT lRd0CPO		:= ChkFile("RD0") .And. If(RD0->(ColumnPos("RD0_FILRH")) > 0, .T., .F.)

If Valtype(MV_PAR09) <> Nil
	lFilRH := .T.
Endif

If lFilRH
	lPergunte := !Empty(MV_PAR07)
	AI3->(DBSetOrder(1))
	AI3->(DBGOTOP())
	AI3->(DBSEEK(xFilial("AI3")))
Endif

If FunName() $ "APDA020*JURA159" .And. lRd0CPO
	If lPergunte 
		cFiltro := "AI3->AI3_FILIAL == '" + xFilial("AI3") + "'"
	Endif
	cFiltro := "@#" + cFiltro + "@#"
EndIf

Return(cFiltro)

/*/{Protheus.doc} Function Rd0FornVld
FunГЦo para executar Valid do campo RD0_FORNEC
@since	05/10/2023
@autor	emerson.grassi
@version 1.0
/*/
Function Rd0FornVld()

Local lRd0FornOk := .T.

//Seta Cadastro de Fornecedores para validaГЦo
dbSelectArea('SA2')

dbSelectArea('RD0')
If Empty(M->RD0_FORNEC)
	M->RD0_LOJA := ""
ElseIf 	( M->RD0_FORNEC + M->RD0_LOJA <> RD0->RD0_FORNEC + RD0->RD0_LOJA ) .And.;
		( M->RD0_FORNEC + M->RD0_LOJA <> SA2->A2_COD + SA2->A2_LOJA ) //Se nЦo for selecionado atravИs da consulta padrЦo
	lRd0FornOk := ExistCpoRH('SA2',M->RD0_FORNEC)

	If lRd0FornOk
		M->RD0_LOJA := SA2->A2_LOJA
	Else
		M->RD0_LOJA := ""
	EndIf	
EndIf
Return( lRd0FornOk )

/*/{Protheus.doc} Function Rd0CcWhen
FunГЦo para executar When do campo RD0_CC
@since	10/05/2024
@autor	emerson.grassi
@version 1.0
/*/
Function Rd0CcWhen(nOpc)

Local lWhen := .T.

If nOpc == 4
	//Verificar se Pessoa estА associado a um funcionАrio
	lWhen := !( RdzExisteRel( "SRA" , GetMemVar("RD0_CODIGO") , cEmpAnt , cFilAnt ) )		
EndIF

Return( lWhen )

/*/{Protheus.doc} Function Apda020PFS
FunГЦo para avaliar se a integraГЦo com escritСrios de advocacia (mСdulo 77 - SIGAPFS) estА habilitada
@since	25/11/2024
@autor	totvs
@version 1.0
/*/
Static Function Apda020PFS()
Local lIntegrPFS := .F.

If FindFunction("JURA159") .And. SuperGetMV("MV_JFTJURI",, "2" ) == "1" .And. GetApoInfo("JURA159.PRW")[4] >= CtoD("01/10/2024")
	// A integraГЦo estarА ativa quando:
	// - MV_JFTJURI = "1" - Indica que o sistema estА sendo utilizado por um escritСrios de advocacia
	// - Fonte JURA159 atualizado com os ajustes necessАrios para a integraГЦo
	// - Tabela NS7 (escritСrios) e NUR (complemento de participantes) existirem e tiverem registros
	//   (Esses cadastros sЦo especМficos do jurМdico, portanto se existirem registros neles foi feito uso do jurМdico)
	If FWAliasInDic("NS7") .And. ChkFile("NS7") .And. FWAliasInDic("NUR") .And. ChkFile("NUR")
		lIntegrPFS := NS7->(!EOF()) .And. NUR->(!EOF())
	EndIf
EndIf

Return lIntegrPFS
