#INCLUDE "PROTHEUS.CH"
#INCLUDE "FWLIBVERSION.CH"
#include "gpersv570.ch"

//-------------------------------------------------------------------
/*/{Protheus.doc} GPERSV570

Chamada do objeto de negócios rh.treports.gper570, para abrir o relátorio e a visão de dados no Smart View pela função totvs.framework.treports.callTReports  

@author  Bruno Costa
@since   02/10/2023
@version 1.0
/*/

Function GPERSV570()

    Local lSuccess  As Logical
    Local cError

    If( lCfgSV() )

        //1 parâmetro = Relatório cadastrado na tabela de De/Para (Campo TR__IDREL)
        //2 parâmetro = Tipo do relatório ("reports" = relatório, 
        //"data-grid" = visão de dados, "pivot-table" = tabela dinâmica)

		lSuccess := totvs.framework.treports.callTReports("rh.sv.gpe.gper570",,,,,.F.,,.T., @cError)
        If !lSuccess
            Conout(cError)
        EndIf
    EndIf    

Return


//---------------------------------------------------------------------
/*/{Protheus.doc} lCfgSV
@author			Bruno Costa
@since			02/10/2023
@version		1.0
/*/
//---------------------------------------------------------------------
Static Function lCfgSV()

    Local nOpc  	as numeric
	Local lRotSV    as logical
    Local lSuccess  As Logical
	Local lRet	    as logical

	lRotSV	  := .F.
	lSuccess  := .F.

	If GetRpoRelease() >= "12.1.2210" .AND. FWLibVersion() >= "20231009"
		lRotSV	 := Len(GetApoInfo( "rh.sv.gpe.gper570.rel.rep.trp" )) > 0 .OR. Len(GetApoInfo( "rh.sv.gpe.gper570.visao.dg.trp" )) > 0
        lSuccess := totvs.framework.smartview.util.isConfig()

		If lRotSV 
            If lSuccess
			    lRet := .T.
            Else
                nOpc := Aviso( STR0004, STR0005 + CRLF + CRLF +; //##"Smart View!" ##"Não existe configuração do Smart View."
									STR0006 + CRLF + CRLF +; //"Para atualização dessa funcionalidade, será necessário instalar e configurar o Smart View."
									STR0007, { STR0008, STR0009 }, 3 ) //##"Siga as instruções da documentação." ##"Sair" ##"Abrir"

				If nOpc == 2 //Doc
					ShellExecute( "Open", "https://tdn.totvs.com/pages/releaseview.action?pageId=626636542", "", "", 1 ) 
				EndIf
            EndIf           
		Else
            MsgAlert( STR0003 ) //"Arquivos rh.sv.gpe.gper570.rel e rh.sv.gpe.gper570.visao não existem no RPO. Contate o administrador do sistema."
        EndIf
	Else
		Aviso( STR0001, STR0002, { STR0008 }, 2 ) //##"Rotina indisponível" ##"Esta funcionalidade está disponível apenas para a versão igual ou superior a 12.1.2210 e LIB igual ou superior a 20231009." ##"Sair"
	EndIf

Return lRet
