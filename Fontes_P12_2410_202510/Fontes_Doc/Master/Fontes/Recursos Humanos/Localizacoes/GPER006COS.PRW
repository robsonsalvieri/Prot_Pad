#INCLUDE "PROTHEUS.CH"
#INCLUDE "GPER006COS.CH"
/*


Ŀ
Funo    GPER006COS Autor   Flor Monroy                Data  26/07/11 
Ĵ
Descrio  Reportes Validacin D152                                        
Ĵ
Sintaxe    GPER006COS()                                                    
Ĵ
         ATUALIZACOES SOFRIDAS DESDE A CONSTRUAO INICIAL.                  
Ĵ
Programador  Data        FNC     Motivo da Alteracao                     
Ĵ
Christiane V23/11/11024239/2011 Correo do Error Log ao acessar a rotina
Christiane V30/11/11024239/2011 Correo da Impresso do relatrio       
Christiane V13/12/11024239/2011 Correo da Impresso do relatrio       
Christiane V28/12/11024239/2011 Correo Impresso do relatrio por ms  
                                                                           
ٱ

*/

Function GPER006COS()


Local oReport
Local aGetArea	:=	GetArea()
Local cPerg		:=	"GPR006COS"
                                              
Private cSuc	:=	""	//Parametro de Entrada: Sucursal
Private cProceso:=	""	//Parametro de Entrada: Proceso
Private cPeriodo:=	""	//Parametro de Entrada: Periodo
Private cNumPag	:=	""	//Parametro de Entrada: Numero de Pago
Private cNomina	:=	""	//Parametro de Entrada: Nomina
Private cTipoD	:=	""	//Parametro de Entrada: 1=Analitico, 2=Sintetico
Private cOrdemD	:=	""	//Parametro de Entrada: 1=Empleado, 2=Concepto, 3=Mes
Private cRot	:=  ""
Private cAliasRG7:=	criatrab(nil,.f.)	// Creo mi tabla temporal
Private cNomeProg:=	"GPER006COS"

dbSelectArea("SRC")
dbSelectArea("SRV")
dbSelectArea("RCJ")
dbSelectArea("RCH")
dbSelectArea("SRY")
dbSelectArea("SRA")
dbSelectArea("RCC")

DbSetOrder(1)

Pergunte(cPerg, .F.)
cRot := MV_PAR03

IF Pergunte(cPerg,.T.)
	IF TodoOK()
		IF cOrdemD==3
			OREPORT:=REPORTDEFh()
		ELSE
			OREPORT:=REPORTDEFv()
		ENDIF

		OREPORT:PRINTDIALOG()	
	endif
ENDIF
RestArea(aGetArea)
Return

/*/


Ŀ
Funo    ReportDefV|  Autor FMonroy                Data 26/07/2011
Ĵ
Descrio   Def. Reporte en Vertical, esta definicin servira para    
            construir los siguieentes Reportes de Validacin D152:    
            -Reporte Sinttico por Empleado o Concepto.               
            -Reporte Analtico por Concepto.                          
            -Reporte Analtico por Empleado.                          
                                                                      
Ĵ
Sintaxe    ReportDefV()                                               
Ĵ
Parametros                                                            
Ĵ
 Uso        GPER006COS                                                   
ٱ

*/
Static Function ReportDefV()

Local aArea      := GetArea() 
Local oReport
Local oSection1
Local oSection2
Local oSection3
Local oSection4
Local oSection5

Private cTitulo	:=OEMTOANSI(STR0001) //"Reporte de Validacin D152"

cTitulo := Trim(cTitulo)
//Ŀ
//Criacao do componente de impressao                                      
//TReport():New                                                           
//ExpC1 : Nome do relatorio                                               
//ExpC2 : Titulo                                                          
//ExpC3 : Pergunte                                                        
//ExpB4 : Bloco de codigo que sera executado na confirmacao da impressao  
//ExpC5 : Descricao                                                       
//
oReport:=TReport():New(cNomeProg,OemToAnsi(cTitulo), /*Pregunta*/  ,{|oReport| PrintReport(oReport)})	
oReport:nColSpace	:= 2
oReport:nFontBody	:= 6 	// Define o tamanho da fonte.
oReport:CFONTBODY	:=	"COURIER NEW"    
oReport:Setlandscape(.f.)//Vertical
//Ŀ
//Criacao da celulas da secao do relatorio                                
//TRCell():New                                                            
//ExpO1 : Objeto TSection que a secao pertence                            
//ExpC2 : Nome da celula do relatrio. O SX3 ser consultado              
//ExpC3 : Nome da tabela de referencia da celula                          
//ExpC4 : Titulo da celula                                                
//        Default : X3Titulo()                                            
//ExpC5 : Picture                                                         
//        Default : X3_PICTURE                                            
//ExpC6 : Tamanho                                                         
//        Default : X3_TAMANHO                                            
//ExpL7 : Informe se o tamanho esta em pixel                              
//        Default : False                                                 
//ExpB8 : Bloco de cdigo para impressao.                                 
//        Default : ExpC2                                                 
//

//Ŀ
// Definicin de la Primera Seccin: Encabezado                             
// 

oSection1:= TRSection():New(oReport,"Encabezado",,/*aOrdem */,/*Campos do SX3*/,/*Campos do SIX*/)
oSection1:SetHeaderSection(.T.)	//Exibe Cabecalho da Secao
oSection1:SetHeaderPage(.F.)		//Exibe Cabecalho da Secao
oSection1:SetLineStyle(.T.)   		//Pone titulo del campo y aun lado el y valor
OSection1:SetCharSeparator(":") 
   
oSection1:SetLeftMargin(10)

TRCell():New(oSection1,"EMP", ,STR0002,	,100	)	//"Empresa"
TRCell():New(oSection1,"SUC", ,STR0003,	,50		)	//"Sucursal"
TRCell():New(oSection1,"IDE", ,STR0004,	,50		)	//"No Identificacin"

//Ŀ
// Definicin de la Segunda Seccin: Detalle -Reporte Sinttico por Emppleado o Concepto 
// 

oSection2:= TRSection():New(oReport,"Detalle1",,/*aOrdem */ ,/*Campos do SX3*/,/*Campos do SIX*/) 

oSection2:SetLineStyle(.F.)   		//Pone titulo del campo y aun lado el y valor
oSection2:SetHeaderSection(.T.)	//Exibe Cabecalho da Secao
oSection2:SetHeaderPage(.F.)		//Exibe Cabecalho da Secao
oSection2:SetLeftMargin(10)

TRCell():New(oSection2,"TPRE",	,STR0005	,						,100	)	//"Tipo Remuneracin:"
TRCell():New(oSection2,"IMP",	,STR0006	,"999,999,999,999.99"	,15		)	//"Importe"

//Ŀ
// Definicin de la Tercera Seccin:  Encabezado de Seccin de los Reportes:
//  *Reporte Analtico por Concepto.			                             
//  *Reporte Analtico por Empleado.           			                 
// 

oSection3:= TRSection():New(oReport,"Detalle2",,/*aOrdem */,/*Campos do SX3*/,/*Campos do SIX*/) 

oSection3:SetLineStyle(.T.)  		//Pone titulo del campo y aun lado el y valor
oSection3:SetHeaderSection(.T.)	//Exibe Cabecalho da Secao
oSection3:SetHeaderPage(.F.)	   	//Exibe Cabecalho da Secao
oSection3:SetCharSeparator(":") 
oSection3:SetLeftMargin(10)

TRCell():New(oSection3,"TPRE",	,STR0005	,						,100	)	//"Tipo Remuneracin:"
 
//Ŀ
// Definicin de la Cuarta Seccin:  Detalle  de los Reportes:              
//  *Reporte Analtico por Concepto.			                             
//  *Reporte Analtico por Empleado.           			                 
// 

oSection4:= TRSection():New(oReport,"Detalle3",,/*aOrdem */,/*Campos do SX3*/,/*Campos do SIX*/) 

oSection4:SetLineStyle(.F.)		//Pone titulo del campo y aun lado el y valor
oSection4:SetHeaderSection(.T.)	//Exibe Cabecalho da Secao
oSection4:SetHeaderPage(.F.)		//Exibe Cabecalho da Secao
oSection4:SetLeftMargin(10)
TRCell():New(oSection4,"RC_PD",  cAliasRG7	,STR0006, 						,TamSx3("RC_PD")[1])	//Concepto
TRCell():New(oSection4,"RV_DESC",cAliasRG7	,STR0007,  					    ,TamSx3("RV_DESC")[1])	//Descripcim
TRCell():New(oSection4,"RC_VALOR",	cAliasRG7,STR0008,"999,999,999,999.99"   	,15)				//Importe

//Ŀ
// Definicin de la Quinta Seccin:  Encabezado de la seccin del Reporte:  
//  *Reporte Analtico por Empleado.           			                 
// 

oSection5:= TRSection():New(oReport,"Detalle4",,/*aOrdem */,/*Campos do SX3*/,/*Campos do SIX*/) 

oSection5:SetLineStyle(.F.)   		//Pone titulo del campo y aun lado el y valor
oSection5:SetHeaderSection(.T.)	//Exibe Cabecalho da Secao
oSection5:SetHeaderPage(.F.)		//Exibe Cabecalho da Secao
oSection5:SetLeftMargin(10)

TRCell():New(oSection5,"RA_MAT",	,STR0009,   ,TamSx3("RA_MAT")[1])//"Matricula"
TRCell():New(oSection5,"RA_NOME",	,STR0010,   ,TamSx3("RA_NOME")[1]+5)//"Nombre"
TRCell():New(oSection5,"RA_CIC",	,STR0011,   ,TamSx3("RA_CIC")[1])//"No Identidicacin"

Return( oReport )
/*/


Ŀ
Funo    ReportDefH|  Autor FMonroy                Data 26/07/2011
Ĵ
Descrio   Def. Reporte en Horizontal, esta definicin servira para  
            construir los siguieentes Reportes de Validacin D152:    
            -Reporte Sinttico por Mes.                               
            -Reporte Analtico por Mes.                               
Ĵ
Sintaxe    ReportDefH()                                               
Ĵ
Parametros                                                            
Ĵ
 Uso        GPER006COS                                                
ٱ

*/
Static Function ReportDefH()

Local aArea      := GetArea() 

Local oReport
Local oSection1
Local oSection2
Local oSection3
Local oSection4

Private cTitulo	:=OEMTOANSI(STR0001) // "Reporte de Validacin D152"

cTitulo := Trim(cTitulo)
//Ŀ
//Criacao do componente de impressao                                      
//TReport():New                                                           
//ExpC1 : Nome do relatorio                                               
//ExpC2 : Titulo                                                          
//ExpC3 : Pergunte                                                        
//ExpB4 : Bloco de codigo que sera executado na confirmacao da impressao  
//ExpC5 : Descricao                                                       
//
oReport:=TReport():New(cNomeProg,OemToAnsi(cTitulo),/*cNomeProg*/  ,{|oReport| PrintReport(oReport)})	
oReport:nColSpace	:= 0
oReport:nFontBody	:= 5.5 	// Define o tamanho da fonte.
oReport:CFONTBODY	:=	"COURIER NEW"
oReport:Setlandscape(.T.)//Pag Horizontal
//Ŀ
//Criacao da celulas da secao do relatorio                                
//TRCell():New                                                            
//ExpO1 : Objeto TSection que a secao pertence                            
//ExpC2 : Nome da celula do relatrio. O SX3 ser consultado              
//ExpC3 : Nome da tabela de referencia da celula                          
//ExpC4 : Titulo da celula                                                
//        Default : X3Titulo()                                            
//ExpC5 : Picture                                                         
//        Default : X3_PICTURE                                            
//ExpC6 : Tamanho                                                         
//        Default : X3_TAMANHO                                            
//ExpL7 : Informe se o tamanho esta em pixel                              
//        Default : False                                                 
//ExpB8 : Bloco de cdigo para impressao.                                 
//        Default : ExpC2                                                 
//

//Ŀ
// Definicin de la Primera Seccin: Encabezado                             
// 

oSection1:= TRSection():New(oReport,"Detalle1",,/*aOrdem */,/*Campos do SX3*/,/*Campos do SIX*/)
oSection1:SetHeaderSection(.T.)	//Exibe Cabecalho da Secao
oSection1:SetHeaderPage(.F.)		//Exibe Cabecalho da Secao
oSection1:SetLineStyle(.T.)   		//Pone titulo del campo y aun lado el y valor
OSection1:SetCharSeparator(":") 

TRCell():New(oSection1,"EMP", ,STR0002,	,100	)	//"Empresa"
TRCell():New(oSection1,"SUC", ,STR0003, ,50		)	//"Sucursal"
TRCell():New(oSection1,"IDE", ,STR0004,	,50		)	//"No Identificacin"

//Ŀ
// Definicin de la Segunda Seccin:  Encabezado de Seccin de los Reportes:
//  *Reporte Analtico por Mes.			                                 
//  *Reporte Sinttico por Mes.           			                         
// 

oSection2:= TRSection():New(oReport,"Detalle2",,/*aOrdem */,/*Campos do SX3*/,/*Campos do SIX*/) 

oSection2:SetLineStyle(.T.)  		//Pone titulo del campo y aun lado el y valor
oSection2:SetHeaderSection(.T.)	//Exibe Cabecalho da Secao
oSection2:SetHeaderPage(.F.)	   	//Exibe Cabecalho da Secao
oSection2:SetCharSeparator(":") 

TRCell():New(oSection2,"TPRE",	,STR0005	,						,100	)	//"Tipo Remuneracin:"
 
//Ŀ
// Definicin de la Tercera Seccin:  Detalle  de los Reportes:             
//  *Reporte Analtico por Mes.  			                                 
//  *Reporte Sinttico por Mes.           			                         
// 

oSection3:= TRSection():New(oReport,"Detalle3",,/*aOrdem */,/*Campos do SX3*/,/*Campos do SIX*/) 

oSection3:SetLineStyle(.F.)		//Pone titulo del campo y aun lado el y valor
oSection3:SetHeaderSection(.T.)	//Exibe Cabecalho da Secao
oSection3:SetHeaderPage(.F.)		//Exibe Cabecalho da Secao

TRCell():New(oSection3,"RG7_PD",	cAliasRG7	,STR0006, 						   ,8)	//Concepto
TRCell():New(oSection3,"RV_DESC",	cAliasRG7	,STR0007,  					       ,TamSx3("RV_DESC")[1])	//Descripcim

TRCell():New(oSection3,"RG7_ACUM01",cAliasRG7	,STR0012	,"@E 999,999,999,999.99"   	,22)				//Importe01
TRCell():New(oSection3,"RG7_ACUM02",cAliasRG7	,STR0013	,"@E 999,999,999,999.99"   	,22)				//Importe02
TRCell():New(oSection3,"RG7_ACUM03",cAliasRG7	,STR0014	,"@E 999,999,999,999.99"   	,22)				//Importe03
TRCell():New(oSection3,"RG7_ACUM04",cAliasRG7	,STR0015	,"@E 999,999,999,999.99"   	,22)				//Importe04
TRCell():New(oSection3,"RG7_ACUM05",cAliasRG7	,STR0016	,"@E 999,999,999,999.99"   	,22)				//Importe05
TRCell():New(oSection3,"RG7_ACUM06",cAliasRG7	,STR0017	,"@E 999,999,999,999.99"   	,22)				//Importe06
TRCell():New(oSection3,"RG7_ACUM07",cAliasRG7	,STR0018	,"@E 999,999,999,999.99"   	,22)				//Importe07
TRCell():New(oSection3,"RG7_ACUM08",cAliasRG7	,STR0019	,"@E 999,999,999,999.99"   	,22)				//Importe08
TRCell():New(oSection3,"RG7_ACUM09",cAliasRG7	,STR0020	,"@E 999,999,999,999.99"   	,22)				//Importe09
TRCell():New(oSection3,"RG7_ACUM10",cAliasRG7	,STR0021	,"@E 999,999,999,999.99"   	,22)				//Importe10
TRCell():New(oSection3,"RG7_ACUM11",cAliasRG7	,STR0022	,"@E 999,999,999,999.99"   	,22)				//Importe11
TRCell():New(oSection3,"RG7_ACUM12",cAliasRG7	,STR0023	,"@E 999,999,999,999.99"   	,22)				//Importe12
TRCell():New(oSection3,"RG7_ACUM13",cAliasRG7	,STR0024	,"@E 999,999,999,999.99"   	,22)				//Importe13

//Ŀ
// Definicin de la Cuarta Seccin:  Encabezado de la seccin del Reporte:  
//  *Reporte Analtico por Mes.           			                 
// 

oSection4:= TRSection():New(oReport,"Detalle4",,/*aOrdem */,/*Campos do SX3*/,/*Campos do SIX*/) 

oSection4:SetLineStyle(.F.)   		//Pone titulo del campo y aun lado el y valor
oSection4:SetHeaderSection(.t.)	//Exibe Cabecalho da Secao
oSection4:SetHeaderPage(.F.)		//Exibe Cabecalho da Secao

TRCell():New(oSection4,"RA_MAT",	,STR0009,   ,TamSx3("RA_MAT")[1])//"Matricula"
TRCell():New(oSection4,"RA_NOME",	,STR0010,   ,TamSx3("RA_NOME")[1]+5)//"Nombre"
TRCell():New(oSection4,"RA_CIC",	,STR0011,   ,TamSx3("RA_CIC")[1])//"No Identidicacin"

RestArea( aArea )

Return( oReport )

/*/


Ŀ
Funo    PrintReport Autor  FMonroy                Data 31/05/2011
Ĵ
Descrio    Impresin del Informe                                    
                                                                      
Ĵ
Sintaxe       PrintReport(oExp)                                       
Ĵ
Parametros                                                            
Ĵ
 Uso        GPER006COS                                                   
ٱ

*/
Static Function PrintReport(oReport)

//Ŀ
//  Obtiene Registro                 
//
getQuery()
Do Case
	//Ŀ
	//  Analtico Ordenado por Empleado  
	//
	Case cTipoD==1 .And. cOrdemD==1
	    ImpAnaEmp(oReport) 
	//Ŀ
	//  Analtico Ordenado por Concepto  
	//
	Case cTipoD==1 .And. cOrdemD==2
		ImpAnaCon(oReport) 
	//Ŀ
	//  Analtico Ordenado por Mes       
	//
	Case cTipoD==1 .And. cOrdemD==3
		ImpAnaMes(oReport) 
	//Ŀ
	//  Sinttico Ordenado por Empleado o Concepto  
	//
	Case cTipoD==2 .And. (cOrdemD==1 .Or. cOrdemD==2) 
		ImpSinEmp(oReport) 
	//Ŀ
	//  Sinttico Ordenado por Mes       
	//
	Case cTipoD==2 .And. cOrdemD==3 
		ImpSinMes(oReport) 
EndCase

(cAliasRG7)->(dbCloseArea()) 

Return ( Nil )

/*


ͻ
Funcao    TodoOK    Autor  FMonroy              Data   26/07/11   
͹
Desc.     Validacion de los datos antes de Ejecutar el proceso        
                                                                      
͹
Uso                                                                   
ͼ


*/
Static Function TodoOK(cPerg)

Pergunte(cPerg,.F.)

cSuc	:=	MV_PAR01 // Sucursal
cProceso:=	ConvQry(MV_PAR02,"RCJ_CODIGO")// Lista de Procesos 
cNomina	:=	MV_PAR03 // Nomina
cPeriodo:=	MV_PAR04 // Periodo
cNumPag	:=	MV_PAR05 // Numero de Pago
cTipoD	:=	MV_PAR06 // 1=Analitico, 2=Sintetico
cOrdemD	:=	MV_PAR07 // 1= Empleado, 2=Concepto, 3=Mes

Return (.T.)
/*


ͻ
Funcao    ConvQry   Autor  Microsiga            Data   27/05/11   
͹
Descrio Convierte a exprecin sql un campo informado con un listbox 
                                                                      
Ĵ
Sintaxe      ConvQry(cExp,cExp1)                                      
Ĵ
Parametros    cExp: Cadena de caracteres que retorna el litbox        
              cExp1: Campo del diccionario de datos                   
Ĵ
 Uso        GPER006COS                                                   
ٱ

*/
Static Function ConvQry(cLista,cCampo)
Local cTxt:=''
Local nTamReg := TamSX3(cCampo)[1]
Local nCont:=0
/*
//Ŀ
//Genera texto para usar  para usar despues en Query             
//
*/                 
cLista:=alltrim(cLista)


For nCont := 1 To Len( cLista ) Step nTamReg
    cTxt+="'"+SubStr( cLista , nCont , nTamReg )+"',"
NEXT       
cTxt:=substr(cTxt,1,len(cTxt)-1)                                   
Return ( cTxt )

/*/


Ŀ
Funo    ImpAnaEmp | Autor  FMonroy                Data 27/07/2011
Ĵ
Descrio   Analtico Ordenado por Empleado                           
Ĵ
Sintaxe     ImpAnaEmp(oExp1)                                          
Ĵ
Parametros  oExp1: Objeto TReport                                     
Ĵ
 Uso        GPER006COS                                                   
ٱ

*/
Static Function ImpAnaEmp(oReport) 
Local oSection1	:= 	oReport:Section(1)
Local oSection3	:= 	oReport:Section(3)
Local oSection4	:= 	oReport:Section(4)
Local oSection5	:= 	oReport:Section(5)

Local nTotal	:=	0
Local nPosS020	:=	0 
Local nImportT	:=  0

Local cFilOri	:=	SM0->M0_CODFIL
Local cRemu		:=	""
Local cTitle	:=	""


dbSelectArea("SM0")
SM0->(dbSeek(cEmpAnt+cSuc,.T.))

Pergunte(oReport:GetParam(),.F.)   
//Ŀ
//  Altera o Titulo do Relatorio conforme o parametro selecionado   
//
cTitle 	:= If(AllTrim(oReport:Title())==AllTrim(cTitle), OemToansi(cTitulo),oReport:Title())
oReport:SetTitle(cTitle+" - "+STR0026)//"Formato Anlitico por Empleado"

Begin Sequence 
	dbSelectArea( cAliasRG7 )
	count to nTotal
	oReport:SetMeter(nTotal) 
	(cAliasRG7)->(DbGoTop()) 
	If (cAliasRG7)->(!Eof())
	
		oSection1:Init()
		
		oSection1:Cell("EMP"):SETVALUE(SM0->M0_CODIGO+Space(2)+SM0->M0_NOMECOM)
		oSection1:Cell("SUC"):SETVALUE(SM0->M0_CODFIL+Space(2)+SM0->M0_FILIAL)
		oSection1:CELL("IDE"):SETVALUE(SM0->M0_CGC)
		
		oSection1:Printline()
		oSection1:Finish()
		oReport:Skipline()
		
		While (cAliasRG7)->(!Eof()) 
		    cMat:=(cAliasRG7)->RC_MAT
			oSection5:Init()
			oSection5:Cell("RA_MAT"):SETVALUE((cAliasRG7)->RC_MAT)
			oSection5:Cell("RA_NOME"):SETVALUE(rtrim((cAliasRG7)->RA_PRINOME) + Space(1) + rtrim((cAliasRG7)->RA_SECNOME) + Space(1)+ rtrim((cAliasRG7)->RA_PRISOBR) + Space(1) + rtrim((cAliasRG7)->RA_SECSOBR))
			oSection5:Cell("RA_CIC"):SETVALUE((cAliasRG7)->RA_CIC)
			oSection5:PrintLine()
			oSection5:Finish()
			oSection3:Init()
			While (cAliasRG7)->(!Eof()) .And. cMat==(cAliasRG7)->RC_MAT
				cRemu:=(cAliasRG7)->RV_DECLANU
				oReport:Skipline()
				nPosS020:=FPOSTAB("S020",(cAliasRG7)->RV_DECLANU,"=",4) 
				If nPosS020 > 0
					oSection3:Cell("TPRE"):SETVALUE((cAliasRG7)->RV_DECLANU+Space(1)+FTABELA("S020",nPosS020,5))
				Else
					oSection3:Cell("TPRE"):SETVALUE(" ")
				Endif
				oSection3:PrintLine()
				oSection4:Init()
				nImportT:=0
				While (cAliasRG7)->(!Eof()) .And. cMat==(cAliasRG7)->RC_MAT .And. cRemu==(cAliasRG7)->RV_DECLANU
					oSection4:Cell("RC_PD"):Setvalue((cAliasRG7)->RC_PD)//"Total"
					oSection4:Cell("RV_DESC"):SetValue((cAliasRG7)->RV_DESC)
					oSection4:Cell("RC_VALOR"):SetValue((cAliasRG7)->RC_VALOR)
					nImportT+=(cAliasRG7)->RC_VALOR
					oSection4:PrintLine()
					(cAliasRG7)->(dbSkip())
					oReport:IncMeter()
				EndDo
				//Ŀ
				//Imprime Totales     
				//
				oReport:Skipline()
				oSection4:Cell("RC_PD"):Setvalue(STR0025)//"Total"
				oSection4:Cell("RV_DESC"):SetValue(Space(1))
				oSection4:Cell("RC_VALOR"):SetValue(nImportT)
				oSection4:Printline()
				oSection4:Finish()
				
			EndDo
			oSection3:Finish()
		EndDo
		oSection5:Finish()
		
		
	EndIf
End Sequence
//Ŀ
//Volta a empresa anteriormente selecionada.
//
dbSelectArea("SM0")
SM0->(dbSeek(cEmpAnt+cFilOri,.T.))
cFilAnt := SM0->M0_CODFIL

Return ( Nil )
/*/


Ŀ
Funo    ImpAnaCon | Autor  FMonroy                Data 27/07/2011
Ĵ
Descrio   Analtico Ordenado por Concepto                           
Ĵ
Sintaxe     ImpAnaCon(oExp1)                                          
Ĵ
Parametros  oExp1: Objeto TReport                                     
Ĵ
 Uso        GPER006COS                                                   
ٱ

*/
Static Function ImpAnaCon(oReport) 
Local oSection1	:= 	oReport:Section(1)
Local oSection3	:= 	oReport:Section(3)
Local oSection4	:= 	oReport:Section(4)

Local nTotal	:=	0
Local nPosS020	:=	0 
Local nImportT  :=	0

Local cFilOri	:=	SM0->M0_CODFIL
Local cTitle	:=	""
Local cRemu		:=	""

dbSelectArea("SM0")
SM0->(dbSeek(cEmpAnt+cSuc,.T.))
Pergunte(oReport:GetParam(),.F.)   
//Ŀ
//  Altera o Titulo do Relatorio conforme o parametro selecionado   
//
cTitle 	:= If(AllTrim(oReport:Title())==AllTrim(cTitle), OemToansi(cTitulo),oReport:Title())
oReport:SetTitle(cTitle+" - "+STR0027)//"Formato Analtico por Concepto"

Begin Sequence 
	dbSelectArea( cAliasRG7 )
	count to nTotal
	oReport:SetMeter(nTotal) 
	(cAliasRG7)->(DbGoTop()) 
	If (cAliasRG7)->(!Eof())
	
		oSection1:Init()
		oSection1:Cell("EMP"):SETVALUE(SM0->M0_CODIGO+Space(2)+SM0->M0_NOMECOM)
		oSection1:Cell("SUC"):SETVALUE(SM0->M0_CODFIL+Space(2)+SM0->M0_FILIAL)
		oSection1:CELL("IDE"):SETVALUE(SM0->M0_CGC)
		oSection1:Printline()
		oSection1:Finish()
		oReport:Skipline()
		
		oSection3:Init()
		While (cAliasRG7)->(!Eof()) 
		    cRemu:=(cAliasRG7)->RV_DECLANU
			oReport:Skipline()
			nPosS020:=FPOSTAB("S020",(cAliasRG7)->RV_DECLANU,"=",4)                 
			If nPosS020 > 0
				oSection3:Cell("TPRE"):SETVALUE((cAliasRG7)->RV_DECLANU+Space(1)+FTABELA("S020",nPosS020,5))
			Else 
				oSection3:Cell("TPRE"):SETVALUE(" ")			
			Endif
			oSection3:PrintLine()
			oSection4:Init()
			nImportT:=0
			While (cAliasRG7)->(!Eof()) .And. cRemu==(cAliasRG7)->RV_DECLANU
				oSection4:Cell("RC_PD"):Setvalue((cAliasRG7)->RC_PD)//"Total"
				oSection4:Cell("RV_DESC"):SetValue((cAliasRG7)->RV_DESC)
				oSection4:Cell("RC_VALOR"):SetValue((cAliasRG7)->RC_VALOR)
				nImportT+=(cAliasRG7)->RC_VALOR
				oSection4:PrintLine()
				(cAliasRG7)->(dbSkip())
				oReport:IncMeter()
			EndDo
			//Ŀ
			//Imprime Totales     
			//
			oReport:Skipline()
			oSection4:Cell("RC_PD"):Setvalue(STR0025)//"Total"
			oSection4:Cell("RV_DESC"):SetValue(Space(1))
			oSection4:Cell("RC_VALOR"):SetValue(nImportT)
			oSection4:Printline()
			oSection4:Finish()
		EndDo
		oSection3:Finish()
		
	EndIf
End Sequence
//Ŀ
//Volta a empresa anteriormente selecionada.
//
dbSelectArea("SM0")
SM0->(dbSeek(cEmpAnt+cFilOri,.T.))
cFilAnt := SM0->M0_CODFIL
Return ( Nil )
/*/


Ŀ
Funo    ImpAnaMes | Autor  FMonroy                Data 27/07/2011
Ĵ
Descrio   Analtico Ordenado por Mes                                
Ĵ
Sintaxe     ImpAnaMes(oExp1)                                          
Ĵ
Parametros  oExp1: Objeto TReport                                     
Ĵ
 Uso        GPER006COS                                                   
ٱ

*/
Static Function	ImpAnaMes(oReport) 

Local oSection1	:= 	oReport:Section(1)
Local oSection2	:= 	oReport:Section(2)
Local oSection3	:= 	oReport:Section(3)
Local oSection4	:= 	oReport:Section(4)

Local nTotal	:=	0
Local nPosS020	:=	0 

Local cFilOri	:=	SM0->M0_CODFIL
Local cRemu		:=	""
Local cTitle	:=	""

Local aImporT	:= {0,0,0,0,0,0,0,0,0,0,0,0,0}

dbSelectArea("SM0")
SM0->(dbSeek(cEmpAnt+cSuc,.T.))
Pergunte(oReport:GetParam(),.F.)   
//Ŀ
//  Altera o Titulo do Relatorio conforme o parametro selecionado   
//
cTitle 	:= If(AllTrim(oReport:Title())==AllTrim(cTitle), OemToansi(cTitulo),oReport:Title())
oReport:SetTitle(cTitle+" - "+STR0028)//"Formato Analtico por Mes"

Begin Sequence 
	dbSelectArea( cAliasRG7 )
	count to nTotal
	oReport:SetMeter(nTotal) 
	(cAliasRG7)->(DbGoTop()) 
	If (cAliasRG7)->(!Eof())
	
		oSection1:Init()		
		oSection1:Cell("EMP"):SETVALUE(SM0->M0_CODIGO+Space(2)+SM0->M0_NOMECOM)
		oSection1:Cell("SUC"):SETVALUE(SM0->M0_CODFIL+Space(2)+SM0->M0_FILIAL)
		oSection1:CELL("IDE"):SETVALUE(SM0->M0_CGC)
		oSection1:Printline()
		oSection1:Finish()
		
		oReport:Skipline()
		
		
		While (cAliasRG7)->(!Eof()) 
		    cMat:=(cAliasRG7)->RG7_MAT
			oSection4:Init()
			oSection4:Cell("RA_MAT"):SETVALUE((cAliasRG7)->RG7_MAT)
			oSection4:Cell("RA_NOME"):SETVALUE(rtrim((cAliasRG7)->RA_PRINOME) + Space(1) + rtrim((cAliasRG7)->RA_SECNOME) + Space(1)+ rtrim((cAliasRG7)->RA_PRISOBR) + Space(1) + rtrim((cAliasRG7)->RA_SECSOBR))
			oSection4:Cell("RA_CIC"):SETVALUE((cAliasRG7)->RA_CIC)
			oSection4:PrintLine()
			oSection4:Finish()
			oSection2:Init()
			While (cAliasRG7)->(!Eof()) .And. cMat==(cAliasRG7)->RG7_MAT
				cRemu:=(cAliasRG7)->RV_DECLANU
				nPosS020:=FPOSTAB("S020",(cAliasRG7)->RV_DECLANU,"=",4)
				oReport:skipline()                                                      
				If nPosS020 > 0
					oSection2:Cell("TPRE"):SETVALUE((cAliasRG7)->RV_DECLANU+Space(1)+FTABELA("S020",nPosS020,5))
				Else 
					oSection2:Cell("TPRE"):SETVALUE(" ")
				Endif
				oSection2:PrintLine()
				oSection3:Init()
				aImporT	:= {0,0,0,0,0,0,0,0,0,0,0,0,0}
				While (cAliasRG7)->(!Eof()).And. cMat==(cAliasRG7)->RG7_MAT .And. cRemu==(cAliasRG7)->RV_DECLANU
				
					oSection3:Cell("RG7_PD"):SETVALUE((cAliasRG7)->RG7_PD)
					oSection3:Cell("RV_DESC"):SETVALUE((cAliasRG7)->RV_DESC)
					oSection3:Cell("RG7_ACUM01"):SETVALUE((cAliasRG7)->RG7_ACUM01)
					oSection3:Cell("RG7_ACUM02"):SETVALUE((cAliasRG7)->RG7_ACUM02)
					oSection3:Cell("RG7_ACUM03"):SETVALUE((cAliasRG7)->RG7_ACUM03)
					oSection3:Cell("RG7_ACUM04"):SETVALUE((cAliasRG7)->RG7_ACUM04)
					oSection3:Cell("RG7_ACUM05"):SETVALUE((cAliasRG7)->RG7_ACUM05)
					oSection3:Cell("RG7_ACUM06"):SETVALUE((cAliasRG7)->RG7_ACUM06)
					oSection3:Cell("RG7_ACUM07"):SETVALUE((cAliasRG7)->RG7_ACUM07)
					oSection3:Cell("RG7_ACUM08"):SETVALUE((cAliasRG7)->RG7_ACUM08)
					oSection3:Cell("RG7_ACUM09"):SETVALUE((cAliasRG7)->RG7_ACUM09)
					oSection3:Cell("RG7_ACUM10"):SETVALUE((cAliasRG7)->RG7_ACUM10)
					oSection3:Cell("RG7_ACUM11"):SETVALUE((cAliasRG7)->RG7_ACUM11)
					oSection3:Cell("RG7_ACUM12"):SETVALUE((cAliasRG7)->RG7_ACUM12)
					oSection3:Cell("RG7_ACUM13"):SETVALUE((cAliasRG7)->RG7_ACUM13)
				
					aImporT[1]:=aImporT[1]+(cAliasRG7)->RG7_ACUM01
					aImporT[2]:=aImporT[2]+(cAliasRG7)->RG7_ACUM02
					aImporT[3]:=aImporT[3]+(cAliasRG7)->RG7_ACUM03
					aImporT[4]:=aImporT[4]+(cAliasRG7)->RG7_ACUM04
					aImporT[5]:=aImporT[5]+(cAliasRG7)->RG7_ACUM05
					aImporT[6]:=aImporT[6]+(cAliasRG7)->RG7_ACUM06
					aImporT[7]:=aImporT[7]+(cAliasRG7)->RG7_ACUM07
					aImporT[8]:=aImporT[8]+(cAliasRG7)->RG7_ACUM08
					aImporT[9]:=aImporT[9]+(cAliasRG7)->RG7_ACUM09
					aImporT[10]:=aImporT[10]+(cAliasRG7)->RG7_ACUM10
					aImporT[11]:=aImporT[11]+(cAliasRG7)->RG7_ACUM11
					aImporT[12]:=aImporT[12]+(cAliasRG7)->RG7_ACUM12
					aImporT[13]:=aImporT[13]+(cAliasRG7)->RG7_ACUM13
					oSection3:PrintLine()
					(cAliasRG7)->(dbSkip())
					oReport:IncMeter()
				EndDo
				//Ŀ
				//Imprime Totales     
				//
				oReport:skipline()
				oSection3:Cell("RG7_PD"):SetValue(STR0025)//"Total"
				oSection3:Cell("RV_DESC"):SetValue(Space(1))
				oSection3:Cell("RG7_ACUM01"):SetValue(aImporT[1])
				oSection3:Cell("RG7_ACUM02"):SetValue(aImporT[2])
				oSection3:Cell("RG7_ACUM03"):SetValue(aImporT[3])
				oSection3:Cell("RG7_ACUM04"):SetValue(aImporT[4])
				oSection3:Cell("RG7_ACUM05"):SetValue(aImporT[5])
				oSection3:Cell("RG7_ACUM06"):SetValue(aImporT[6])
				oSection3:Cell("RG7_ACUM07"):SetValue(aImporT[7])
				oSection3:Cell("RG7_ACUM08"):SetValue(aImporT[8])
				oSection3:Cell("RG7_ACUM09"):SetValue(aImporT[9])
				oSection3:Cell("RG7_ACUM10"):SetValue(aImporT[10])
				oSection3:Cell("RG7_ACUM11"):SetValue(aImporT[11])
				oSection3:Cell("RG7_ACUM12"):SetValue(aImporT[12])
				oSection3:Cell("RG7_ACUM13"):SetValue(aImporT[13])
				oSection3:PrintLine()
				oSection3:Finish()
			EndDo
			oSection2:Finish()
		EndDo
		oSection4:Finish()
	EndIf
End Sequence
//Ŀ
//Volta a empresa anteriormente selecionada.
//
dbSelectArea("SM0")
SM0->(dbSeek(cEmpAnt+cFilOri,.T.))
cFilAnt := SM0->M0_CODFIL

Return ( Nil )
/*/


Ŀ
Funo    ImpSinEmp | Autor  FMonroy                Data 27/07/2011
Ĵ
Descrio   Sinttico Ordenado por Empleado o Concepto                
Ĵ
Sintaxe     ImpSinEmp(oExp1)                                          
Ĵ
Parametros  oExp1: Objeto TReport                                     
Ĵ
 Uso        GPER006COS                                                   
ٱ

*/
Static Function	ImpSinEmp(oReport) 
Local oSection1	:= 	oReport:Section(1)
Local oSection2	:= 	oReport:Section(2)

Local nTotal	:=	0
Local nPosS020	:=	0 

Local cFilOri	:=	SM0->M0_CODFIL
Local cTitle	:=	""

dbSelectArea("SM0")
SM0->(dbSeek(cEmpAnt+cSuc,.T.))
Pergunte(oReport:GetParam(),.F.)   
//Ŀ
//  Altera o Titulo do Relatorio conforme o parametro selecionado   
//
cTitle 	:= If(AllTrim(oReport:Title())==AllTrim(cTitle), OemToansi(cTitulo),oReport:Title())
oReport:SetTitle(cTitle+" - "+STR0029)//"Formato Sinttico por Empleado o Concepto"
Begin Sequence 
	dbSelectArea( cAliasRG7 )
	count to nTotal
	oReport:SetMeter(nTotal) 
	(cAliasRG7)->(DbGoTop()) 
	If (cAliasRG7)->(!Eof())
	
		oSection1:Init()		
		oSection1:Cell("EMP"):SETVALUE(SM0->M0_CODIGO+Space(2)+SM0->M0_NOMECOM)
		oSection1:Cell("SUC"):SETVALUE(SM0->M0_CODFIL+Space(2)+SM0->M0_FILIAL)
		oSection1:CELL("IDE"):SETVALUE(SM0->M0_CGC)
		oSection1:Printline()
		oSection1:Finish()
		oReport:Skipline()
		
		oSection2:Init()
		While (cAliasRG7)->(!Eof()) 
			nPosS020:=FPOSTAB("S020",(cAliasRG7)->RV_DECLANU,"=",4)                 
			If nPosS020 > 0
				oSection2:Cell("TPRE"):SETVALUE((cAliasRG7)->RV_DECLANU+Space(1)+FTABELA("S020",nPosS020,5))
			Else 
				oSection2:Cell("TPRE"):SETVALUE(" ")
			Endif
			oSection2:Cell("IMP"):SETVALUE((cAliasRG7)->RC_VALOR)
			oSection2:PrintLine()
			(cAliasRG7)->(dbSkip())
			oReport:IncMeter()
		EndDo
		oSection2:Finish()
	EndIf
End Sequence
//Ŀ
//Volta a empresa anteriormente selecionada.
//
dbSelectArea("SM0")
SM0->(dbSeek(cEmpAnt+cFilOri,.T.))
cFilAnt := SM0->M0_CODFIL

Return ( Nil )
/*/


Ŀ
Funo    ImpSinMes | Autor  FMonroy                Data 27/07/2011
Ĵ
Descrio   Sinttico Ordenado por Mes                                
Ĵ
Sintaxe     ImpSinMes(oExp1)                                          
Ĵ
Parametros  oExp1: Objeto TReport                                     
Ĵ
 Uso        GPER006COS                                                   
ٱ

*/
Static Function	ImpSinMes(oReport) 

Local oSection1	:= 	oReport:Section(1)
Local oSection2	:= 	oReport:Section(2)
Local oSection3	:= 	oReport:Section(3)

Local nTotal	:=	0
Local nPosS020	:=	0 

Local cFilOri	:=	SM0->M0_CODFIL
Local cRemu		:=	""
Local cTitle	:=	""

Local aImporT	:= {0,0,0,0,0,0,0,0,0,0,0,0,0}

dbSelectArea("SM0")
SM0->(dbSeek(cEmpAnt+cSuc,.T.))
Pergunte(oReport:GetParam(),.F.)   
//Ŀ
//  Altera o Titulo do Relatorio conforme o parametro selecionado   
//
cTitle 	:= If(AllTrim(oReport:Title())==AllTrim(cTitle), OemToansi(cTitulo),oReport:Title())
oReport:SetTitle(cTitle+" - "+STR0030)//"Formato Sinttico por Mes"


Begin Sequence 
	dbSelectArea( cAliasRG7 )
	count to nTotal
	oReport:SetMeter(nTotal) 
	(cAliasRG7)->(DbGoTop()) 
	If (cAliasRG7)->(!Eof())
	
		oSection1:Init()
		
		oSection1:Cell("EMP"):SETVALUE(SM0->M0_CODIGO+Space(2)+SM0->M0_NOMECOM)
		oSection1:Cell("SUC"):SETVALUE(SM0->M0_CODFIL+Space(2)+SM0->M0_FILIAL)
		oSection1:CELL("IDE"):SETVALUE(SM0->M0_CGC)
		
		oSection1:Printline()
		oSection1:Finish()
		oReport:Skipline()
		
		oSection2:Init()
		
		While (cAliasRG7)->(!Eof()) 
		    cRemu:=(cAliasRG7)->RV_DECLANU
			oReport:skipline()
			nPosS020:=FPOSTAB("S020",(cAliasRG7)->RV_DECLANU,"=",4)                 
			If nPosS020 > 0
				oSection2:Cell("TPRE"):SETVALUE((cAliasRG7)->RV_DECLANU+Space(1)+FTABELA("S020",nPosS020,5))
			Else 
				oSection2:Cell("TPRE"):SETVALUE(" ")
			Endif
			oSection2:PrintLine()
			oSection3:Init()
			aImporT	:= {0,0,0,0,0,0,0,0,0,0,0,0,0}
			While (cAliasRG7)->(!Eof()) .And. cRemu==(cAliasRG7)->RV_DECLANU
				oSection3:Cell("RG7_PD"):SETVALUE((cAliasRG7)->RG7_PD)
				oSection3:Cell("RV_DESC"):SETVALUE((cAliasRG7)->RV_DESC)
				oSection3:Cell("RG7_ACUM01"):SETVALUE((cAliasRG7)->RG7_ACUM01)
				oSection3:Cell("RG7_ACUM02"):SETVALUE((cAliasRG7)->RG7_ACUM02)
				oSection3:Cell("RG7_ACUM03"):SETVALUE((cAliasRG7)->RG7_ACUM03)
				oSection3:Cell("RG7_ACUM04"):SETVALUE((cAliasRG7)->RG7_ACUM04)
				oSection3:Cell("RG7_ACUM05"):SETVALUE((cAliasRG7)->RG7_ACUM05)
				oSection3:Cell("RG7_ACUM06"):SETVALUE((cAliasRG7)->RG7_ACUM06)
				oSection3:Cell("RG7_ACUM07"):SETVALUE((cAliasRG7)->RG7_ACUM07)
				oSection3:Cell("RG7_ACUM08"):SETVALUE((cAliasRG7)->RG7_ACUM08)
				oSection3:Cell("RG7_ACUM09"):SETVALUE((cAliasRG7)->RG7_ACUM09)
				oSection3:Cell("RG7_ACUM10"):SETVALUE((cAliasRG7)->RG7_ACUM10)
				oSection3:Cell("RG7_ACUM11"):SETVALUE((cAliasRG7)->RG7_ACUM11)
				oSection3:Cell("RG7_ACUM12"):SETVALUE((cAliasRG7)->RG7_ACUM12)
				oSection3:Cell("RG7_ACUM13"):SETVALUE((cAliasRG7)->RG7_ACUM13)
				
				aImporT[1]:=aImporT[1]+(cAliasRG7)->RG7_ACUM01
				aImporT[2]:=aImporT[2]+(cAliasRG7)->RG7_ACUM02
				aImporT[3]:=aImporT[3]+(cAliasRG7)->RG7_ACUM03
				aImporT[4]:=aImporT[4]+(cAliasRG7)->RG7_ACUM04
				aImporT[5]:=aImporT[5]+(cAliasRG7)->RG7_ACUM05
				aImporT[6]:=aImporT[6]+(cAliasRG7)->RG7_ACUM06
				aImporT[7]:=aImporT[7]+(cAliasRG7)->RG7_ACUM07
				aImporT[8]:=aImporT[8]+(cAliasRG7)->RG7_ACUM08
				aImporT[9]:=aImporT[9]+(cAliasRG7)->RG7_ACUM09
				aImporT[10]:=aImporT[10]+(cAliasRG7)->RG7_ACUM10
				aImporT[11]:=aImporT[11]+(cAliasRG7)->RG7_ACUM11
				aImporT[12]:=aImporT[12]+(cAliasRG7)->RG7_ACUM12
				aImporT[13]:=aImporT[13]+(cAliasRG7)->RG7_ACUM13
				
				oSection3:PrintLine()
				(cAliasRG7)->(dbSkip())
				oReport:IncMeter()
			EndDo
			//Ŀ
			//Imprime Totales     
			//
			oReport:skipline()
			oSection3:Cell("RG7_PD"):SetValue(STR0025)//"Total"
			oSection3:Cell("RV_DESC"):SetValue(Space(1))
			oSection3:Cell("RG7_ACUM01"):SetValue(aImporT[1])
			oSection3:Cell("RG7_ACUM02"):SetValue(aImporT[2])
			oSection3:Cell("RG7_ACUM03"):SetValue(aImporT[3])
			oSection3:Cell("RG7_ACUM04"):SetValue(aImporT[4])
			oSection3:Cell("RG7_ACUM05"):SetValue(aImporT[5])
			oSection3:Cell("RG7_ACUM06"):SetValue(aImporT[6])
			oSection3:Cell("RG7_ACUM07"):SetValue(aImporT[7])
			oSection3:Cell("RG7_ACUM08"):SetValue(aImporT[8])
			oSection3:Cell("RG7_ACUM09"):SetValue(aImporT[9])
			oSection3:Cell("RG7_ACUM10"):SetValue(aImporT[10])
			oSection3:Cell("RG7_ACUM11"):SetValue(aImporT[11])
			oSection3:Cell("RG7_ACUM12"):SetValue(aImporT[12])
			oSection3:Cell("RG7_ACUM13"):SetValue(aImporT[13])
			oSection3:PrintLine()
			oSection3:Finish()
			
		EndDo
		oSection2:Finish()
		
	EndIf
End Sequence
//Ŀ
//Volta a empresa anteriormente selecionada.
//
dbSelectArea("SM0")
SM0->(dbSeek(cEmpAnt+cFilOri,.T.))
cFilAnt := SM0->M0_CODFIL


Return ( Nil )
/*/


Ŀ
Funo    getQuery  | Autor  FMonroy                Data 27/07/2011
Ĵ
Descrio   Obtencin de Datos, Segn el tipo de reporte seleccionado 
Ĵ
Sintaxe     getQuery()                                                
Ĵ
Parametros                                                            
Ĵ
 Uso        GPER006COS                                                
ٱ

*/
Static Function getQuery()
Local aArea		:= GetArea()
Local cQuery 	:= ""

	//Ŀ
	//  Analtico Ordenado por Empleado  
	//
	If (cTipoD == 1 .And. cOrdemD == 1)
	
		cQuery := " SELECT SRC.RC_FILIAL,SRC.RC_MAT,SRA.RA_NOME,SRA.RA_CIC,SRC.RC_PD,SRV.RV_DESC,SRV.RV_DECLANU, SUM(SRC.RC_VALOR) RC_VALOR,SRA.RA_PRINOME,SRA.RA_SECNOME, SRA.RA_PRISOBR,SRA.RA_SECSOBR"
		cQuery += " FROM " + RetSqlName("SRC") + " SRC "
		cQuery += " INNER JOIN " + RetSqlName("SRV") + " SRV "
		cQuery += " ON SRC.RC_PD = SRV.RV_COD AND SRV.RV_FILIAL = '"+XFILIAL("SRV",SRC->RC_FILIAL)+"' AND SRV.RV_DECLANU<>''  "
		cQuery += " INNER JOIN " + RetSqlName("SRA") + " SRA "
		cQuery += " ON SRA.RA_MAT = SRC.RC_MAT AND SRA.RA_FILIAL = '"+XFILIAL("SRA",SRC->RC_FILIAL)+"' "
		cQuery += " WHERE SRC.RC_FILIAL = '" + cSuc+ "' "
		cQuery += " 		AND SRC.RC_PROCES IN( "+  cProceso +") "
		cQuery += " 		AND SRC.RC_PERIODO = '"+ cPeriodo +"' "
		cQuery += " 		AND SRC.RC_SEMANA = '"+ cNumPag +"' "
		cQuery += " 		AND SRC.RC_ROTEIR = '"+ cNomina +"' "
		cQuery += " AND SRC.D_E_L_E_T_ <> '*' AND SRV.D_E_L_E_T_ <> '*' "
		cQuery += " GROUP BY SRC.RC_FILIAL,SRC.RC_MAT,SRA.RA_NOME,SRA.RA_CIC,SRV.RV_DECLANU,SRC.RC_PD,SRV.RV_DESC,SRA.RA_PRINOME,SRA.RA_SECNOME, SRA.RA_PRISOBR,SRA.RA_SECSOBR " 
		cQuery += " ORDER BY SRA.RA_CIC,SRC.RC_FILIAL,SRC.RC_MAT,SRA.RA_NOME,SRV.RV_DECLANU,SRC.RC_PD "
		
	//Ŀ
	//  Analtico Ordenado por Concepto  
	//
	ElseIf (cTipoD == 1 .And. cOrdemD == 2)
	
		cQuery := " SELECT SRC.RC_FILIAL,SRC.RC_PD,SRV.RV_DESC,SRV.RV_DECLANU, SUM(SRC.RC_VALOR) RC_VALOR"
		cQuery += " FROM " + RetSqlName("SRC") + " SRC "
		cQuery += " INNER JOIN " + RetSqlName("SRV") + " SRV "
		cQuery += " ON SRC.RC_PD = SRV.RV_COD AND SRV.RV_FILIAL = '"+XFILIAL("SRV",SRC->RC_FILIAL)+"' AND SRV.RV_DECLANU<>''  "
		cQuery += " WHERE SRC.RC_FILIAL = '" + cSuc+ "'"
		cQuery += " 		AND SRC.RC_PROCES IN ( "+  cProceso +") "
		cQuery += " 		AND SRC.RC_PERIODO = '"+ cPeriodo +"' "
		cQuery += " 		AND SRC.RC_SEMANA = '"+ cNumPag +"' "
		cQuery += " 		AND SRC.RC_ROTEIR = '"+ cNomina +"' "
		cQuery += " AND SRC.D_E_L_E_T_ <> '*' AND SRV.D_E_L_E_T_ <> '*' "
		cQuery += " GROUP BY SRC.RC_FILIAL,SRV.RV_DECLANU,SRC.RC_PD,SRV.RV_DESC " 
		cQuery += " ORDER BY SRC.RC_FILIAL,SRV.RV_DECLANU,SRC.RC_PD,SRV.RV_DESC " 
		
	//Ŀ
	//  Analtico Ordenado por Mes       
	//
	ElseIf (cTipoD == 1 .And. cOrdemD == 3)
	
		cQuery := "SELECT RG7.RG7_MAT,SRA.RA_NOME,SRA.RA_CIC,RG7.RG7_PD, SUM(RG7.RG7_ACUM01) RG7_ACUM01, SUM(RG7.RG7_ACUM02) RG7_ACUM02, SUM(RG7.RG7_ACUM03) RG7_ACUM03,SUM( RG7.RG7_ACUM04) RG7_ACUM04"
		cQuery += "      ,SUM(RG7.RG7_ACUM05) RG7_ACUM05, SUM(RG7.RG7_ACUM06) RG7_ACUM06, SUM(RG7.RG7_ACUM07) RG7_ACUM07, SUM(RG7.RG7_ACUM08) RG7_ACUM08, SUM(RG7.RG7_ACUM09) RG7_ACUM09 "
		cQuery += "      ,SUM(RG7.RG7_ACUM10) RG7_ACUM10, SUM(RG7.RG7_ACUM11) RG7_ACUM11, SUM(RG7.RG7_ACUM12) RG7_ACUM12, SUM(RG7.RG7_ACUM13) RG7_ACUM13, SRV.RV_DECLANU "
		cQuery += "      ,SRV.RV_DESC,SRA.RA_PRINOME,SRA.RA_SECNOME, SRA.RA_PRISOBR,SRA.RA_SECSOBR "		
		cQuery += "FROM " +RetSQLName("RG7")+ " RG7, " 
		cQuery +=          RetSQLName("SRA")+ " SRA, " 
		cQuery +=          RetSQLName("SRV")+ " SRV, " 
		cQuery +=     	   RetSqlName("RCH")+ " RCH  "
		cQuery += "WHERE "

		cQuery += "  	SRA.RA_FILIAL ='"+XFILIAL("SRA",RG7->RG7_FILIAL)+"' "
		cQuery += "  AND SRA.RA_MAT = RG7.RG7_MAT "
		cQuery += "  AND SRV.RV_FILIAL ='"+XFILIAL("SRV",RG7->RG7_FILIAL)+"' "
		cQuery += "  AND SRV.RV_COD = RG7.RG7_PD AND SRV.RV_DECLANU<>'' "
		
		cQuery += "  AND RG7.RG7_FILIAL = SRA.RA_FILIAL"
		cQuery += "  AND RG7.RG7_MAT = SRA.RA_MAT"
		cQuery += "  AND RG7.RG7_PROCES = RCH.RCH_PROCES "
		cQuery += "  AND RG7.RG7_ANOINI = YEAR(RCH.RCH_DTINI)"
		cQuery += "  AND RG7.RG7_ANOFIM = YEAR(RCH.RCH_DTFIM)"		
		
		cQuery += " 	AND RCH.RCH_PROCES IN( "+ cProceso +") "
		cQuery += " 	AND RCH.RCH_PER = '"+ cPeriodo +"' "
		cQuery += " 	AND RCH.RCH_NUMPAG = '"+ cNumPag +"' "
		cQuery += " 	AND RCH.RCH_ROTEIR = '"+ cNomina +"' "
		
		cQuery += "  AND RG7.D_E_L_E_T_  = ' ' "
		cQuery += "  AND SRA.D_E_L_E_T_  = ' ' "
		cQuery += "  AND SRV.D_E_L_E_T_  = ' ' "
		cQuery += "  AND RCH.D_E_L_E_T_  = ' ' "
	    cQuery += " GROUP BY SRV.RV_DECLANU,RG7.RG7_PD,RG7.RG7_MAT,SRA.RA_NOME,SRA.RA_CIC,SRV.RV_DESC , SRA.RA_PRINOME,SRA.RA_SECNOME, SRA.RA_PRISOBR,SRA.RA_SECSOBR" 
	    cQuery += " ORDER BY SRA.RA_CIC,RG7.RG7_MAT,SRV.RV_DECLANU,RG7.RG7_PD" 
	//Ŀ
	//  Sinttico Ordenado por Empleado o Concepto  
	//
	ElseIf (cTipoD == 2 .And. (cOrdemD == 1 .Or. cOrdemD == 2))
		cQuery := " SELECT SRC.RC_FILIAL,SRV.RV_DECLANU, SUM(SRC.RC_VALOR) RC_VALOR"
		cQuery += " FROM " + RetSqlName("SRC") + " SRC "
		cQuery += " INNER JOIN " + RetSqlName("SRV") + " SRV "
		cQuery += " ON SRC.RC_PD = SRV.RV_COD AND SRV.RV_FILIAL ='"+XFILIAL("SRV",SRC->RC_FILIAL)+"' AND SRV.RV_DECLANU<>''  "	
		cQuery += " INNER JOIN " + RetSqlName("SRA") + " SRA "
		cQuery += " ON SRA.RA_MAT = SRC.RC_MAT AND SRA.RA_FILIAL ='"+XFILIAL("SRA",SRC->RC_FILIAL)+"'"
		cQuery += " WHERE SRC.RC_FILIAL = '" + cSuc+ "' "
		cQuery += " 		AND SRC.RC_PROCES IN ( "+ cProceso +") "
		cQuery += " 		AND SRC.RC_PERIODO = '"+ cPeriodo +"' "
		cQuery += " 		AND SRC.RC_SEMANA = '"+ cNumPag +"' "
		cQuery += " 		AND SRC.RC_ROTEIR = '"+ cNomina +"' "
		cQuery += " AND SRC.D_E_L_E_T_ <> '*' AND SRV.D_E_L_E_T_ <> '*' "
		cQuery += " GROUP BY SRC.RC_FILIAL,SRV.RV_DECLANU " 
		cQuery += " ORDER BY SRC.RC_FILIAL,SRV.RV_DECLANU " 
	//Ŀ
	//  Sinttico Ordenado por Mes       
	//
	ElseIf (cTipoD == 2 .And. cOrdemD == 3)
	 	
		cQuery := "SELECT RG7.RG7_PD, SUM(RG7.RG7_ACUM01) RG7_ACUM01, SUM(RG7.RG7_ACUM02) RG7_ACUM02, SUM(RG7.RG7_ACUM03) RG7_ACUM03,SUM( RG7.RG7_ACUM04) RG7_ACUM04"
		cQuery += "      ,SUM(RG7.RG7_ACUM05) RG7_ACUM05, SUM(RG7.RG7_ACUM06) RG7_ACUM06, SUM(RG7.RG7_ACUM07) RG7_ACUM07, SUM(RG7.RG7_ACUM08) RG7_ACUM08, SUM(RG7.RG7_ACUM09) RG7_ACUM09 "
		cQuery += "      ,SUM(RG7.RG7_ACUM10) RG7_ACUM10, SUM(RG7.RG7_ACUM11) RG7_ACUM11, SUM(RG7.RG7_ACUM12) RG7_ACUM12, SUM(RG7.RG7_ACUM13) RG7_ACUM13, SRV.RV_DECLANU "
		cQuery += "      ,SRV.RV_DESC "		
		cQuery += "FROM " +RetSQLName("RG7")+ " RG7, " 
		cQuery +=          RetSQLName("SRV")+ " SRV, " 
		cQuery +=     	   RetSqlName("RCH")+ " RCH  "
		cQuery += "WHERE "            
		
		cQuery += "  SRV.RV_FILIAL ='"+XFILIAL("SRV",RG7->RG7_FILIAL)+"' "
		cQuery += "  AND SRV.RV_COD = RG7.RG7_PD AND SRV.RV_DECLANU<>'' "
		
		//cQuery += "  AND RG7.RG7_PROCES = RCH.RCH_PROCES "
		cQuery += "  AND RG7.RG7_ANOINI = YEAR(RCH.RCH_DTINI)"
		cQuery += "  AND RG7.RG7_ANOFIM = YEAR(RCH.RCH_DTFIM)"		
		
		cQuery += " 	AND RCH.RCH_PROCES IN( "+ cProceso +") "
		cQuery += " 	AND RCH.RCH_PER = '"+ cPeriodo +"' "
		cQuery += " 	AND RCH.RCH_NUMPAG = '"+ cNumPag +"' "
		cQuery += " 	AND RCH.RCH_ROTEIR = '"+ cNomina +"' "

		cQuery += "  AND RG7.D_E_L_E_T_  = ' ' "
		cQuery += "  AND SRV.D_E_L_E_T_  = ' ' "
		cQuery += "  AND RCH.D_E_L_E_T_  = ' ' "
	    cQuery += " GROUP BY SRV.RV_DECLANU,RG7.RG7_PD,SRV.RV_DESC" 
	    cQuery += " ORDER BY SRV.RV_DECLANU,RG7.RG7_PD,SRV.RV_DESC" 
		
EndIf
        
cQuery := ChangeQuery(cQuery)

dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasRG7,.T.,.T.)
RestArea( aArea )
Return ( Nil )

/*


Ŀ
Funo	 Gpr006Roteiro Autor  Christiane Vieira      Data 30/11/11
Ĵ
Descrio  Retorna a descricao do roteiro selecionado na pergunte.     
Ĵ
 Uso		  GPER006COS                                                  
    		                                                			   
ٱ

 */
Function Gpr006Roteiro()

Local lRet := .T.

lRet := ExistCpo("SRY", MV_PAR03)

cRot := MV_PAR03

Return ( lRet )