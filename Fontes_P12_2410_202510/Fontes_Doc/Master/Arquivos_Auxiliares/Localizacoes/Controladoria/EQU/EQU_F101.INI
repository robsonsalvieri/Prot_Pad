?{"Nombre del Archivo INI","EQU_F101.INI"}
?{"Descripción Completa del Archivo Magnético","RESOLUCIÓN Nº NAC-DGER2008-1520, Servicio de Rentas Internas (SRI) de Ecuador"}
?{"A Quien si Destina","Los Agentes de Retención estan obligados a cumplir las obligaciones de la resolución."}
?{"Objetivo","DECLARACIÓN DEL IMPUESTO A LA RENTA Y PRESENTACIÓN DE BALANCES FORMULARIO ÚNICO SOCIEDADES Y ESTABLECIMIENTOS PERMANENTES"}
?{"Plazo de Entrega","Anual"}
?{"Aplicativo Disponibilizado por Servicio de Rentas Internas (SRI)","SRI"}
?{"Versión del Aplicativo Contemplada pela Microsiga","Software del Contribuyente - DIMM Version 16 (30-Abril-2010)"}
?{"Legislación", "RESOLUCIÓN Nº NAC-DGER2008-1520."}
?{"Buscar en", "http://www.sri.gov.ec"}

@XML

[XXX - Inicializacao]
(PRE) _aTotal[001] := {}
(PRE) _aTotal[002] := {}
(PRE) _aTotal[003] := .F.
(PRE) _aTotal[004] := {}
(PRE) _aTotal[10]  := ""
//Pegar Data Inicial e Final        
(PRE) _aTotal[11] := "20"+Subs(DTOS(mv_par01),3,2)+"-"+Subs(DTOS(mv_par01),5,2)+"-"+Subs(DTOS(mv_par01),7,2)
(PRE) _aTotal[12] := "20"+Subs(DTOS(mv_par02),3,2)+"-"+Subs(DTOS(mv_par02),5,2)+"-"+Subs(DTOS(mv_par02),7,2)
//Totalizadores: Valor Total e Quantidade de Registros Processados
(PRE) _aTotal[13]  := 0
(PRE) _aTotal[14]  := 0
(PRE) _aTotal[15]  := mv_par01 
(PRE) _aTotal[16]  := mv_par02      
(PRE) _aTotal[17]  := {}     
(PRE) _aTotal[18]  := REPLICATE("X",60)
(PRE) _aTotal[19]  := REPLICATE(" ",15)
(PRE) _aTotal[20]  := {}
(PRE) _aTotal[21]  := {}
                  
[XXX - Definicao das celulas que terao tratamento de impressao diferenciado - TEXTO]
// 102 - ANO ; 104 - NUMERO DO FORMULARIO SUBSTITUTO; 198 - CEDULA DE IDENTIDADE DO REPRESETANTE LEGAL ; 199 - RUC DA FIRMA CONTADOR
// 201 - RUC DO SUJEITO PASSIVO ; 202 - RAZAO SOCIAL ; 203 - EXPEDIENTE
(PRE) aAdd(_aTotal[17],"102")
(PRE) aAdd(_aTotal[17],"104")
(PRE) aAdd(_aTotal[17],"198")
(PRE) aAdd(_aTotal[17],"199")
(PRE) aAdd(_aTotal[17],"201")
(PRE) aAdd(_aTotal[17],"202")
(PRE) aAdd(_aTotal[17],"203")
(PRE) aAdd(_aTotal[21], cNomArq)

[SM0 - Informacoes ]
(PREREG)  SM0->M0_CODIGO==cEmpAnt .And. SM0->M0_CODFIL==cFilAnt
(PRE) aAdd(_aTotal[20],SM0->M0_CGC)
(PRE) aAdd(_aTotal[20],SM0->M0_NOMECOM)
(PRE) aAdd(_aTotal[20],space(60))
(PRE) aAdd(_aTotal[20],space(60))

[XXX - Montagem do CFP Utilizado pela rotina - PRINCIPAL]
(PRE) aAdd (_aTotal[001], "Procesamiento del Informe - DECLARACIÓN DEL IMPUESTO A LA RENTA Y PRESENTACIÓN DE BALANCES FORMULARIO ÚNICO SOCIEDADES Y ESTABLECIMIENTOS PERMANENTES")
(PRE) aAdd (_aTotal[001], "")
(PRE) aAdd (_aTotal[001], "Llenar correctamiente los datos solicitados.")
(PRE) aAdd (_aTotal[001], "Informaciones necesárias para el recargo automático de Declaración.")

[XXX - Montagem do FORMULARIO utilizado pela rotina - TELA 02]
(PRE) aAdd (_aTotal[002], {})
(PRE) aAdd (_aTotal[002][1], "Procesamiento del DECLARACION FORMULARIO 101.")
(PRE) aAdd (_aTotal[002][1], "DECLARACION DEL IMPUESTO A LA RENTA")
(PRE) aAdd (_aTotal[002][1], {})
// pergunta 01 - 102 ano da declaracao do Imposto de Renda
(PRE) aAdd (_aTotal[002][1][3], {1, "102- Año de Declaracion",,,,,,})
// (PRE) aAdd(_aTotal[2][1][3], {01, 02,    03, 04, 05, 06, 07, 08,                                09, 10, 11})
(PRE) aAdd (_aTotal[002][1][3], { 2,   ,"9999",  1,  0,   ,   ,  4,{.F.,StrZero(Year(dDataBase),4,0)},   ,   })
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})   
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,}) 
// pergunta 02 - 104 NUMERO FORMULARIO SUBSTITUTO
(PRE) aAdd (_aTotal[002][1][3], {1, "104- Número de Formulario que Substituye",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], {2,,_aTotal[18],1,,,,60}) 
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})   
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
// pergunta 03 - 201 RUC SUJETO PASSIVO
(PRE) aAdd (_aTotal[002][1][3], {1, "201- RUC del Identificacion del Sujeto Pasivo",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], { 2,   ,_aTotal[18],  1,   ,   ,   , 60,{.F.,_aTotal[20][1]}}) 
// (PRE) aAdd(_aTotal[2][1][3], {01, 02,         03, 04, 05, 06, 07, 08,                                09, 10, 11})
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})   
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
// pergunta 04 - 202 RAZAO TESTE SOCIAL // Razao o Denominacion Social
(PRE) aAdd (_aTotal[002][1][3], {1, "202- Razao o Denominacion Social",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], { 2,   ,_aTotal[18],  1,   ,   ,   , 60,{.F.,_aTotal[20][2]}}) 
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})   
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
// pergunta 05 - 203 Expediente
(PRE) aAdd (_aTotal[002][1][3], {1, "203- Expediente",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], {2,  ,_aTotal[18], 1,  ,  ,  ,60}) 
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})   
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
// pergunta 06 - 198 CEDULA IDENTIDADE / PASAPORTE REPRESETANTE LEGAL
(PRE) aAdd (_aTotal[002][1][3], {1, "198- Ced.Identif./Pasaporte Repr.Legal",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], { 2,   ,_aTotal[18],  1,   ,   ,   , 60,{.F.,_aTotal[20][3]}}) 
// (PRE) aAdd(_aTotal[2][1][3], {01, 02,         03, 04, 05, 06, 07, 08,                                09, 10, 11})
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})   
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
// pergunta 07 - 199 RUC CONTADOR
(PRE) aAdd (_aTotal[002][1][3], {1, "199- RUC del Identificacion del Contador",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], { 2,   ,_aTotal[18],  1,   ,   ,   , 60,{.F.,_aTotal[20][4]}}) 
// (PRE) aAdd(_aTotal[2][1][3], {01, 02,         03, 04, 05, 06, 07, 08,                                09, 10, 11})
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})   
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
// pergunta 08 - Codigo Visao Contabil
(PRE) aAdd (_aTotal[002][1][3], {1, "Codigo Visao Contabil",,,,,,})
// (PRE) aAdd(_aTotal[2][1][3], {01, 02,    03, 04, 05, 06, 07, 08, 09, 10,   11})
(PRE) aAdd (_aTotal[002][1][3], { 2,   , "XXX",  1,   ,   ,   , 03,   ,   ,"CTN"})
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
// pergunta 09 - Moneda
(PRE) aAdd (_aTotal[002][1][3], {1, "Moneda",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], {2,,"XX",1,,,,02,,,"CTO"})
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})   
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
// pergunta 10 - Tipo de Saldo
(PRE) aAdd (_aTotal[002][1][3], {1, "Tipo de Saldo",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], {2,,"X",1,,,,02,,,"SL"})
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
// pergunta 11 - Codigo Quadro Contabil
(PRE) aAdd (_aTotal[002][1][3], {1, "Codigo Quadro Contabil",,,,,,})
// (PRE) aAdd(_aTotal[2][1][3], {01, 02,    03, 04, 05, 06, 07, 08, 09, 10,   11})
(PRE) aAdd (_aTotal[002][1][3], { 2,   , "XXX",  1,   ,   ,   , 03,   ,   ,"CVQ"})
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[002][1][3], {0, "",,,,,,})


[XXX - Llamada del Wizard]
(PRE) _atotal[003] := xMagWizard( _aTotal[001] , _aTotal[002] , "EQUF101" )
(PRE) Iif(_aTotal[003], xMagLeWiz("EQUF101", @_aTotal[004], .T.), NIL)
(PRE) lAbtMT950	:= !_atotal[003]  

[XXX - Armando archivo Transitório]
(PRE) CtEQUF101( _aTotal[15], _aTotal[16], _aTotal[004][1], @_aTotal)

                       
[XXX - Cabecera del XML] 
(PRE) _aTotal[10]:= 'version="1.0" encoding="UTF-8" ?'   
(PRE) _aTotal[12]:= '01200901'
//        Function MontaXML(01-cTag                    ,                               02-cCampo , 03-Tipo, 04-nTam, 05-nDec, 06-cMask, 07-nDesloc, 08-lTagIn, 09-lTagFim, 10A-lQuebra,  11B-cAtrib, 12C-lAcento, 13D-lDiopsfin)
Linha1     C 000 0 MontaXML("?xml "                    ,                                         ,        ,        ,        ,         ,           ,       .T.,        .F.,         .T., _aTotal[10],         .F., .F.)
Linha2     C 000 0 MontaXML('formulario version="0.2"' ,                                         ,        ,        ,        ,         ,           ,       .T.,        .F.,         .T.,            ,         .F., .F.)  
Linha3     C 000 0 MontaXML('cabecera'                 ,                                         ,        ,        ,        ,         ,           ,       .T.,        .F.,         .T.,            ,         .F., .F.)  
Linha4     C 000 0 MontaXML('codigo_version_formulario',                              _aTotal[12],        ,        ,        ,         ,          1,       .T.,        .T.,         .T.,            ,         .F., .F.)  
Linha5     C 000 0 MontaXML('ruc'                      ,              ALLTRIM(_aTotal[004][1][3]),        ,        ,        ,         ,          1,       .T.,        .T.,         .T.,            ,         .F., .F.)  
Linha6     C 000 0 MontaXML('codigo_moneda'            ,ALLTRIM(STR(VAL(_aTotal[004][1][9]),2,0)),        ,        ,        ,         ,          1,       .T.,        .T.,         .T.,            ,         .F., .F.)  
Linha7     C 000 0 MontaXML("cabecera"                 ,                                         ,        ,        ,        ,         ,           ,       .F.,        .T.,         .T.,            ,         .F., .F.)
Linha8     C 000 0 MontaXML("detalle"                  ,                                         ,        ,        ,        ,         ,          1,       .T.,        .F.,         .F.,            ,         .F., .F.)

[F101 - Lectura de datos del archivo]
(PRE) F101->(dbGoTop()) 
(PREREG) F101->(!EOF())
//        Function MontaXML(01-cTag,              02-cCampo, 03-Tipo, 04-nTam, 05-nDec, 06-cMask, 07-nDesloc, 08-lTagIn, 09-lTagFim, 10A-lQuebra,                                       11B-cAtrib, 12C-lAcento, 13D-lDiopsfin)
Flinha     C 000 0 MontaXML('campo', ALLTRIM(F101->DESCCTA),        ,        ,        ,         ,          2,       .T.,        .T.,         .F.,'numero="'+ALLTRIM(STR(VAL(F101->CONTA),3,0))+'"',         .F., .F.)

[XXX - Ultima TAG do XML]                                                 
//        Function MontaXML(01-cTag     , 02-cCampo, 03-Tipo, 04-nTam, 05-nDec, 06-cMask, 07-nDesloc, 08-lTagIn, 09-lTagFim, 10A-lQuebra, 11B-cAtrib, 12C-lAcento, 13D-lDiopsfin)
LinhaA     C 000 0 MontaXML("detalle"   ,          ,        ,        ,        ,         ,          1,       .F.,        .T.,         .T.,           ,         .F., .F.)			
LinhaB     C 000 0 MontaXML("formulario",          ,        ,        ,        ,         ,           ,       .F.,        .T.,         .T.,           ,         .F., .F.)			

[XXX - Fin del XML]
// diretorio e arquivo destino
(PRE) cArqDest := _aTotal[21][1]
