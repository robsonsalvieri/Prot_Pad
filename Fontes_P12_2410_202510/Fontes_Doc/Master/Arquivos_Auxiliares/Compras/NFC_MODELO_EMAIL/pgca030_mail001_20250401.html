<html>
	<head>
		<meta charset="windows-1252">
		<meta charset="UTF-8">
		<style>
		/* Os estilos devem ser colocados nas proprias tags para compatibilidade com diversos webmails */
		</style>
	</head>
	
	<body style="width: 100%; font: normal normal normal 14px 'open sans', sans-serif;overflow-x: hidden" onload="loadValues()">
		
		<h1 style="font: normal normal normal 22px 'open sans', sans-serif;color: rgb(0, 136, 203);padding-top: 5px;padding-bottom:3px;margin: 5px auto 5px 10px;">
			%cSTR0001% %cNumCot% %cSTR0040% %cProposta%
		</h1>

        <input name="fornece" id="fornece" type="text" value="%cFornece%" style="display: none;"/>
        <input name="loja" id="loja" type="text" value="%cLoja%" style="display: none;"/>
		<input name="forNome" id="forNome" type="text" value="%cForNome%" style="display: none;"/>
		<input name="paisLoc" id="paisLoc" type="text" value="%cPaisLoc%" style="display: none;"/>
		<input name="hasSupObs" id="hasSupObs" type="text" value="%cHasSupObs%" style="display: none;"/>
        <input name="draftString" id="draftString" class="draftString" type="text" value="%cSTR0078%" style="display: none;"/>
        <input name="savedString" id="savedString" class="savedString" type="text" value="%cSTR0079%" style="display: none;"/>

		<!-- Cabeçalho do Pedido --> 
		<div style="border-top: solid rgb(0, 136, 203) 2px;padding: 10px 5px 0 10px;margin-right: 15px;margin-top: 10px;">
			<table style="font: normal normal normal 14px 'open sans', sans-serif;text-align: left;border-width:0px;width:100%;">
				<tr>
					<td style="width:100px;">%cSTR0002%</td> 
					<td style="width:500px;">%cNomeFor%</td>
				</tr>
				<tr>
					<td style="width:100px;">%cSTR0003% </td>
					<td style="width:500px;">%cDataEmis%</td>
				</tr>
				<tr>
					<td style="width:100px;">%cSTR0004%</td> 
					<td style="width:500px;">%cCNPJFor%</td>
				</tr>
				<tr><td colspan="04"><hr></td></tr>
				<tr>
					<td style="width:100px;">%cSTR0005%</td> 
					<td style="width:500px;">%cNomeCli%</td>
				</tr>
				<tr>
					<td style="width:100px;">%cSTR0041%</td> 
					<td style="width:500px;">%cFilCot% - %cNomeFil%</td>
				</tr>
				<tr>
					<td style="width:100px;">%cSTR0004%</td> 
					<td style="width:500px;">%cCNPJCli%</td>
				</tr>
				<tr>
					<td style="width:100px;">%cSTR0006%</td> 
					<td colspan="03">%cEndeCli%		   </td>
				</tr>
				<tr>
					<td style="width:100px;">%cSTR0007%</td>
					<td style="width:500px;">%cCepCli% </td>
				</tr>
				<tr>
					<td style="width:100px;">%cSTR0008%</td>
					<td style="width:500px;">%cFoneCli%</td>
				</tr>
			</table>
		</div>
		
		<!-- Itens do Pedido -->
		<form name="FrontPage_Form1" id="FrontPage_Form1" method="post" action="mailto:%25WFMailTo%25">
			<div style="border-top: solid rgb(0, 136, 203) 2px;padding: 10px 5px 0 10px;margin-right: 15px;margin-top: 10px;">
				<h2 style="font: normal normal normal 18px 'open sans', sans-serif;font-weight: bold;color: #4a5c60;;">
					%cSTR0009%
				</h2>
				<table id="tableItems" class="tableItems" style="font: normal normal normal 14px 'open sans', sans-serif;text-align: left;width:100%;border-collapse: collapse;">
					<thead style="font: normal normal normal 12px 'open sans', sans-serif; background: #0c9abe; color:White; text-align: left; border-width: 0px;">
						<tr>
							<th align="center" style="display: none;">%cSTR0066%</th> <!-- Produto-->
							<th align="center" >%cSTR0010%</th> <!-- Descrição -->
							<th align="center" >%cSTR0069%</th> <!-- Un.Medida -->
							<th align="center" >%cSTR0011%</th> <!-- Quantidade -->
							<th align="center" >%cSTR0012%</th> <!-- Entrega -->
							<th align="center" >%cSTR0013%</th> <!-- Valor Unitário -->
							<th align="center" >%cSTR0014%</th> <!-- Qtde.Disponível -->
							<th align="center" >%cSTR0046%</th> <!-- Subtotal -->
							<th align="center" >%cSTR0026%</th> <!-- Desconto% -->
							<th align="center" >%cSTR0048%</th> <!-- Desconto Moeda -->
							<th align="center" id="thValorIPI" class="thValorIPI" >%cSTR0080%</th> <!-- Valor IPI -->
							<th align="center" id="thValorIPI" class="thValorICMSSOL" >%cSTR0081%</th> <!-- Val ICMS Sol -->
							<th align="center" >%cSTR0049%</th> <!-- Situacao -->
							<th align="center" >%cSTR0097%</th> <!-- Observações -->
							<th align="center" id="thcObservacao" class="thcObservacao">%cSTR0093%</th> <!-- Observacao SC -->
							<th align="center" id="thcObsForn" class="thcObsForn">%cSTR0094%</th> <!-- Observacao fornecedor -->
						</tr>
					</thead>

					<tbody>
						<tr style="height: 30px;" class="item">
							<td style="display: none;">%It.cCodProd%</td> <!-- Produto -->
							<td class="product" id="%It.cItem%" style="width:155px; border-bottom: 1px solid #ddd;">%It.cProDesc%</td> <!-- Descrição -->
							<td class="measureUnit" align="center" style="width:70px; border-bottom: 1px solid #ddd;">%It.cUnMedida%</td> <!-- Un.Medida -->
							<td class="quantityRequested" align="center" value="It.nQuant" style="width:79px; border-bottom: 1px solid #ddd;">%It.nQuant%</td><!-- Quantidade -->
							<td align="center" style="width:75px; border-bottom: 1px solid #ddd;"><!-- Entrega -->
								<input id="deliverydate" class="deliverydate" onblur="myFunction(event)" type="date" required style="width: 110px;border-radius: 5px;height: 30px;border: solid 1px;" name="dataentrega" value="%It.cDtEnt%">
							</td>
							<td style="width:79px; border-bottom: 1px solid #ddd;" ><!-- Valor Unitário -->
								<input id="unitaryValue" class="unitaryValue" onchange="myFunction(event)" size="%It.cSizeValor%" style="text-align:right;width: 100%; " type="number" step="%It.cStepValor%" min="0" name="nValor" value="%It.nValor%">
							</td>
							<td align="right" style="width:45px;border-bottom: 1px solid #ddd;"><!-- Qtde.Disponível -->
								<input id="quantity" class="quantity" onchange="myFunction(event)" size=12 style="text-align:right;width: 100%; " type="number" min="0" step="%It.cStepQuant%" name="nQtDisp" value="%It.nQtDisp%">
								<input class="centralized" name="centralized" id="centralized" type="text" value="%It.Desativado%" style="display: none;"/>
							</td>
							<td class="totalItem" align="center" style="width:95px; border-bottom: 1px solid #ddd;" size="%It.cSizeTotal%" step="%It.cStepTotal%"> %It.nSubTotal% </td><!-- subtotal -->
							<td align="right" style="width:30px;border-bottom: 1px solid #ddd;"><!-- Desconto %-->
								<input id="descPercent" class="descPercent" onchange="myFunction(event)" style="text-align:right;width: 100%; " type="number" min="0" max="100" step="%It.cStepDesc%" name="nPercDesc" value="%It.nPercDesc%" size="7" maxlength="5">
							</td>
							<td align="right" style="width:55px;border-bottom: 1px solid #ddd;"><!-- Desconto moeda -->
								<input id="desconto" class="desconto" onchange="myFunction(event)" size=12 style="text-align:right;width: 100%; " type="number" min="0"  name="nValDesc" value="%It.nValDesc%" step="0.01">
							</td>
							<td align="right" id="tdValorIPI" class="tdValorIPI" style="width:55px;border-bottom: 1px solid #ddd;"><!-- Valor IPI -->
								<input id="valorIPI" class="valorIPI" onchange="myFunction(event)" size=12 style="text-align:right;width: 100%; " type="number" min="0"  name="nValIPI" value="%It.nValIPI%" step="%It.cStepValIPI%">
							</td>
							<td align="center" id="tdValorICMSSOL" class="tdValorICMSSOL" style="width:55px;border-bottom: 1px solid #ddd;"><!-- Valor ICMS Sol -->
								<input id="valorICMSSOL" class="valorICMSSOL" onchange="myFunction(event)" size=12 style="text-align:right;width: 100%; " type="number" min="0"  name="nValICMS" value="%It.nValICMSSOL%" step="%It.cStepValICMS%">
							</td>
							<td align="center" style="width:83px; border-bottom: 1px solid #ddd;">
								<select id="cSituacao" class="cSituacao" name="cSituacao" onchange="changeStatus(event)" style="width: 100%; height: 21px;"><!-- Situacao -->
									<option value="1">%cSTR0056%</option>
									<option value="2">%cSTR0058%</option>
									<option value="3">%cSTR0057%</option>
								</select>
								<input class="situacao" style="display: none;" value=%It.cSituacao%>
							</td>

							<td align="center" style="width:40px; border-bottom: 1px solid #ddd;">
								<button onclick="editObservation(this, '%It.cObservacao%', '%It.cObsForn%')" type="button" style="background: none; border: none; cursor: pointer; font-size: 16px; color: #0c9abe;">
									(...)
								</button>
							</td>
							
							<td align="right" style="width:150px;border-bottom: 1px solid #ddd; display: none;">
								<input size=12 style="text-align:left;width: 100%;" type="text" class="cObservacao" name="cObservacao" value="%It.cObservacao%" disabled="true">
							</td>
								
							<td align="right" style="width:150px;border-bottom: 1px solid #ddd; display: none;">
								<input size=12 style="text-align:left;width: 100%;" type="text" class="cObsForn" name="cObsForn" value="%It.cObsForn%">
							</td>
						</tr>
					</tbody>
				</table>
			</div>	

            <!-- Frete e entrega -->
            <div style="border-top: solid rgb(0, 136, 203) 2px;padding: 10px 5px 0 10px;margin-right: 15px;margin-top: 10px;">
                <h2 style="font: normal normal normal 18px 'open sans', sans-serif;font-weight: bold;color: #4a5c60;">
                    %cSTR0028%
                </h2>

				<div style="display: flex; justify-content: space-between; ">
				
					<div>
						<label for="tipoFrete" style="font-weight: bold; color: #4a5c60;">%cSTR0031%</label>
						<select onchange="checkFrete(value)" class="tipoFrete" id="tipoFrete" name="tipoFrete" value="%cTipoFrete%" required style="width: 120px;border-radius: 5px;height: 30px;">
							<option value="C">%cSTR0036%</option>
							<option value="F">%cSTR0037%</option>
							<option value="T">%cSTR0038%</option>
							<option value="S">%cSTR0039%</option>			
						</select>
					</div>
	
					<div>
						<label style="font-weight: bold; color: #4a5c60;">%cSTR0033%</label>
						<input min="0" name="valorFrete" onchange="nStepFrete()" step="0.01" class="valorFrete" type="number" size="15" value="%nValorFrete%" style="width: 100px;border-radius: 5px;height: 30px;border: solid 1px;"/>
						<input name="oldValorFrete" id="oldValorFrete" type="number" step="0.01" style="display: none;" value="%nOldValorFrete%" min="0" size="15"/>
					</div>
					
					<div>
						<label style="font-weight: bold; color: #4a5c60;">%cSTR0067%</label>
						<input  min="0" name="valorDespesa" onchange="nStepDespesa()" step="0.01" class="valorDespesa" type="number" size="15" value="%nValorDespesa%" style="width: 100px;border-radius: 5px;height: 30px;border: solid 1px;"/>
						<input name="oldValorDespesa" id="oldValorDespesa" type="number" step="0.01" style="display: none;" value="%nOldValorDespesa%" min="0" size="15"/>
					</div>
		
					<div>
						<label style="font-weight: bold; color: #4a5c60;">%cSTR0068%</label>
						<input  min="0" name="valorSeguro" onchange="nStepSeguro()" step="0.01" class="valorSeguro" type="number" size="15" value="%nValorSeguro%" style="width: 100px;border-radius: 5px;height: 30px;border: solid 1px;"/>
						<input name="oldValorSeguro" id="oldValorSeguro" type="number" step="0.01" style="display: none;" value="%nOldValorSeguro%" min="0" size="15"/>
					</div>
				</div>

            </div>
    
            <!-- Pagamento -->
            <div style="border-top: solid rgb(0, 136, 203) 2px;padding: 10px 10px 0 10px;margin-right: 15px;margin-top: 10px;">
                <h2 style="font: normal normal normal 18px 'open sans', sans-serif;font-weight: bold;color: #4a5c60;">
                    %cSTR0027%
                </h2>
				<div style="display: flex; justify-content: space-between; ">
					<div>
						<label style="font-weight: bold; color: #4a5c60;">%cSTR0047%</label>
                		<input class="totalPagar" name="totalPagar" id="totalPagar" type="number" value="%nTotalPagar%" disabled="" style="width: 100px;border-radius: 5px;height: 30px;border: solid 1px;" step="%It.cStepTotal%"/>
					</div>
					<div>
						<label for="listCond" style="font-weight: bold; color: #4a5c60;">%cSTR0029%</label>
						<input autocomplete="on" list="CONDPGTO" name="listCond" id="listCond" value="%cCondicao%" required style="width: 170px;border-radius: 5px;height: 30px; border: solid 1px;"/> 
						<datalist name="CONDPGTO" id="CONDPGTO">
						</datalist>
					</div>
	
					<div>
						<label for="listMoeda" style="font-weight: bold; color: #4a5c60;">%cSTR0050%</label>
						<input onchange="checkOption()" autocomplete="on" list="MOEDALIST" name="listMoeda" id="listMoeda" value="%cMoeda1%" required style="width: 170px;border-radius: 5px;height: 30px; border: solid 1px;"/> 
						<datalist name="MOEDALIST" id="MOEDALIST">
						</datalist>
					</div>
					<div>
						<label style="font-weight: bold; color: #4a5c60;">%cSTR0051%</label>
                		<input name="taxaMoeda" class="taxaMoeda" onchange="nStepTaxa()" type="number" min="0" value="%nTaxaMoeda%" step="%cStepMoeda%" style="width: 100px;border-radius: 5px;height: 30px;border: solid 1px;"/>			
					</div>
					<div>
						<label style="font-weight: bold; color: #4a5c60;">%cSTR0055%</label>
                		<input name="validade" id="validade" type="date" value="%dValidade%" required style="width: 110px;border-radius: 5px;height: 30px;border: solid 1px;"/>			
					</div>
				</div>

            </div>

			<!-- Tabela oculta que carrega as condições de pagamento -->
            <table id="tableMoeda" style="display: none;">
                <thead>
                    <tr>
						<td>Value</td>
                        <td>Code</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
						<td id="value">%Moeda.cValue%</td>
						<td id="moeda">%Moeda.cMoeda%</td>
                    </tr>
                </tbody>
            </table>
            
            <!-- Tabela oculta que carrega as condições de pagamento -->
            <table id="tableCondPgto" style="display: none;">
                <thead>
                    <tr>
                        <td>Code</td>
                        <td>Description</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="condition">%Cond.cCond%</td>
                        <td id="description">%Cond.cDesc%</td>
                    </tr>
                </tbody>
            </table>
			
			<!-- Tabela oculta que armazena as situações dos produtos -->
            <table id="tableStatus" style="display: none;">
                <thead>
                    <tr>
                        <td>Item</td>
                        <td>Status</td>
                    </tr>
                </thead>
                <tbody>
                    <tr class="status">
                        <td id="item">%Stat.cItem%</td>
                        <td>
							<input id="status" size=12 style="text-align:left;width: 100%;" type="text" name="cStatus" value="%Stat.cSituacao%">
						</td>
                    </tr>
                </tbody>
            </table>
    
            <!-- Botões de Resposta -->
            <div style="display: flex;border-top: solid rgb(0, 136, 203) 2px;padding: 10px 5px 0 10px;margin-right: 15px;margin-top: 10px;justify-content: flex-end;">
				<label style="font-weight: bold; color: #4a5c60; margin-right: 5px; margin-top: 18px;">%cSTR0098%</label>
				<select id="cHasResumWf" class="cHasResumWf" name="cHasResumWf" value="%cHasResumWf%" style="width: 100px;border-radius: 5px;height: 30px; margin-right: 15px; margin-top: 10px;">
					<option value="1" selected>%cSTR0053%</option>
					<option value="2">%cSTR0054%</option>
				</select>

				<button type="button" name="replicatedate" id="replicatedate"
					style="border-radius: 5px;cursor: pointer;width: 95px;height: 40px;margin-right: 1em;color: rgb(4,91,143);border: solid 2px rgb(4,91,143);background-color: white;font-weight: bolder;font-size: 16px;"> %cSTR0088% </button>
				<button type="button" value="%cSTR0016%" name="B2" id="rejectBtn"
					style="border-radius: 5px;cursor: pointer;width: 95px;height: 40px;margin-right: 1em;color: rgb(4,91,143);border: solid 2px rgb(4,91,143);background-color: white;font-weight: bolder;font-size: 16px;"> %cSTR0016% </button>
				<button type="button" id="draftButton" name="draftButton"
					style="border-radius: 5px;cursor: pointer;width: 95px;height: 40px;margin-right: 1em;color: rgb(4,91,143);border: solid 2px rgb(4,91,143);background-color: white;font-weight: bolder;font-size: 16px;"></button>
				<button id="enviarBtn" type="submit" value="2" name="enviarBtn" 
					style="border-radius: 5px;cursor: pointer;width: 140px;height: 40px;background-color: rgb(4,91,143);border: solid rgb(4,91,143);color: white;font-weight: bolder; font-size: 16px;"> %cSTR0015% </button>
            </div>
 
			<!-- Modal Recusar -->
			<div id="modal" class="modal"
				style=" display: none;position: fixed;z-index: 1;padding-top: 100px;left: 0;
							top: 0;width: 100%;height: 100%;overflow: auto;	background-color: rgb(0, 0, 0);background-color:rgba(5,45,62,0.7); ">
				<div class="modal-content"
					style="background-color: #fefefe;margin: auto;padding: 20px;border: 1px solid #888;width: 50%;">
					<span class="close" style="color: #0c9abe;float: right;font-size: 28px; cursor: pointer;">
						&times;
					</span>
					<p style="font: normal normal normal 18px 'open sans', sans-serif;font-weight: bold;color: #4a5c60;">%cSTR0052%
					</p>
					<div style="display: flex; justify-content: flex-end;">
						<button type="button" id="noBtn"
							style="border-radius: 5px;cursor: pointer;width: 65px;height: 40px;margin-right: 1em;color: rgb(4,91,143);border: solid 2px rgb(4,91,143);background-color: white;font-weight: bolder;font-size: 16px;">
							%cSTR0054%
						</button>
						<button type="submit" id="yesRejectBtn" value="1" name="%cRecusa%"
							style="border-radius: 5px;cursor: pointer;width: 65px;height: 40px;background-color: rgb(4,91,143);border: solid rgb(4,91,143);color: white;font-weight: bolder; font-size: 16px;">
							%cSTR0053A%
						</button>
					</div>
				</div>
			</div>


			<!-- Modal Replicar data -->
			<div id="modalPrt" class="modalPrt"
				style=" display: none;position: fixed;z-index: 1;padding-top: 100px;left: 0;
							top: 0;width: 100%;height: 100%;overflow: auto;	background-color: rgb(0, 0, 0);background-color:rgba(5,45,62,0.7); ">
				<div class="modalPrt-content"
					style="background-color: #fefefe;margin: auto;padding: 20px;border: 1px solid #888;width: 50%;">
					<span class="close2" style="color: #0c9abe;float: right;font-size: 28px; cursor: pointer;">
						&times;
					</span>
					<p style="font: normal normal normal 18px 'open sans', sans-serif;font-weight: bold;color: #4a5c60;">%cSTR0085% </p>
					<p style="font: normal normal normal 14px 'open sans', sans-serif;font-weight: bold;color: #000000;">%cSTR0086% </p>
					<p style="font: normal normal normal 14px 'open sans', sans-serif;font-weight: bold;color: #000000;">%cSTR0087% </p>
					<div style="display: flex; justify-content: flex-end;">
						<button type="button" id="noReplicate" value="0"
							style="border-radius: 5px;cursor: pointer;width: 65px;height: 40px;margin-right: 1em;color: rgb(4,91,143);border: solid 2px rgb(4,91,143);background-color: white;font-weight: bolder;font-size: 16px;">
							%cSTR0054%
						</button>
						<button type="button" id="yesReplicate" name="%yesReplicate%" value="1"
							style="border-radius: 5px;cursor: pointer;width: 65px;height: 40px;background-color: rgb(4,91,143);border: solid rgb(4,91,143);color: white;font-weight: bolder; font-size: 16px;">
							%cSTR0053%
						</button>
					</div>
				</div>
			</div>

			<!-- Modal Editar Observação -->
			<div id="modalEditObservation" class="modal" style="display: none; position: fixed; z-index: 1000; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);">
				<div class="modal-content" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #fff; border-radius: 8px; width: 400px; padding: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
					<span id="closeModalEdit" style="float: right; font-size: 28px; cursor: pointer; color: #0c9abe;">&times;</span>
					<h3 style="font-size: 18px; color: #0c9abe; margin-bottom: 15px;">%cSTR0092%</h3> <!--Editar observações-->
					
					<div style="margin-bottom: 15px;">
						<label for="modalObsSC" style="font-weight: bold; display: block; margin-bottom: 5px;">%cSTR0093%</label> <!--Observação da solicitação de compra-->
						<textarea id="modalObsSC" style="width: 100%; height: 60px; border: 1px solid #ccc; border-radius: 4px; padding: 5px;" readonly></textarea>
					</div>
					
					<div style="margin-bottom: 15px;" id="textObsFornece" class="textObsFornece">
						<label for="modalObsFornecedor" style="font-weight: bold; display: block; margin-bottom: 5px;">%cSTR0094%</label> <!--Observação do fornecedor-->
						<textarea id="modalObsFornecedor" style="width: 100%; height: 60px; border: 1px solid #ccc; border-radius: 4px; padding: 5px;"></textarea>
					</div>
					
					<div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px;">
						<button id="cancelObservation" type="button" 
							style="border-radius: 5px; cursor: pointer; width: 95px; height: 35px; color: rgb(4,91,143); border: solid 2px rgb(4,91,143); background-color: white; font-weight: bolder; font-size: 14px;">
							%cSTR0095% <!-- Cancelar -->
						</button>
						<button id="saveObservation" type="button" 
							style="border-radius: 5px; cursor: pointer; width: 120px; height: 35px; background-color: rgb(4,91,143); border: solid 2px rgb(4,91,143); color: white; font-weight: bolder; font-size: 14px;">
							%cSTR0096% <!-- Salvar -->
						</button>
					</div>
				</div>
			</div>
		</form>

		<script>
			const condPgto = document.querySelector('#CONDPGTO');
            const tableCondPgto = document.querySelectorAll('#tableCondPgto tbody tr');
			const form = document.getElementById('FrontPage_Form1');
			const isBrazil = document.querySelector('#paisLoc').value === 'BRA';
			const hasSupObs = document.querySelector('#hasSupObs').value === 'true';
			
			const moeda = document.querySelector('#MOEDALIST');
			const tableMoeda = document.querySelectorAll('#tableMoeda tbody tr');

			let rejectBtn = document.getElementById("rejectBtn");
			let yesRejectBtn = document.getElementById("yesRejectBtn");
			let enviarBtn = document.getElementById("enviarBtn");
			let draftButton = document.getElementById('draftButton');
			let modal = document.getElementById("modal");
			let noBtn = document.getElementById("noBtn");
			let span = document.getElementsByClassName("close")[0];
			let isSubmitEvent = false;
			let replicatedate = document.getElementById("replicatedate");
			let modalReplicate = document.getElementById("modalPrt");
			let noReplicate = document.getElementById('noReplicate');
			let yesReplicate = document.getElementById('yesReplicate');
			let span2 = document.getElementsByClassName("close2")[0];

			form.addEventListener('keydown', function(event) {
				if (event.key === 'Enter') { // Impede o envio do formulário quando a tecla Enter é pressionada
					event.preventDefault();
				}
			});

			window.addEventListener('beforeunload', function (event) {
				if (!isSubmitEvent) {
					const message = 'message'; // Mensagem de confirmação
					event.returnValue = message; // Standard para navegadores modernos
					return message;
				}
			});

			minValidity();
			dataListEvent('listCond', 'CONDPGTO');
			dataListEvent('listMoeda', 'MOEDALIST');

			for (let i = 0; i < tableCondPgto.length; i++) {
                let itemCond = tableCondPgto[i];
                let condition = itemCond.querySelector('#condition').textContent;
                let description = itemCond.querySelector('#description').textContent;
                let option = document.createElement('option');

                option.value = condition;
                option.innerHTML = description;
                condPgto.appendChild(option); 
            }

			//Moeda
			for (let i = 0; i < tableMoeda.length; i++) {
                let itemMoeda = tableMoeda[i];
                let moedaValue = itemMoeda.querySelector('#moeda').textContent;
				let value = itemMoeda.querySelector('#value').textContent;
                let option = document.createElement('option');

                option.value = value;
                option.innerHTML = moedaValue;
                moeda.appendChild(option); 
            }


			// modal
			rejectBtn.onclick = function() {
				changeRequiredFields(true, true);
				changeRequiredItems(true);
			}
			
			yesRejectBtn.onclick = function() {
				isSubmitEvent = true;
			}

			enviarBtn.onclick = function() {
				const form = document.getElementById('FrontPage_Form1');
				changeRequiredFields(false);
				changeRequiredItems();

				if (form.checkValidity()) {
					isSubmitEvent = true;
				}
			}

			draftButton.onclick = function() {
				let alertMessage = 'Rascunho salvo com sucesso!';
				const savedString = document.querySelector('.savedString').value;
				
				if (savedString) {
					alertMessage = savedString;
				}
				
				changeRequiredFields(true);
				changeRequiredItems();
				saveStorage();

				alert(alertMessage);
			}

			//modal para replicar a data para os demais itens
			replicatedate.onclick = function() {		
				modalPrt.style.display = "block";
			}			

			span.onclick = function() {
				changeRequiredFields(false);
				changeRequiredItems();
				modal.style.display = "none";
			}

			noBtn.onclick = function() {
				changeRequiredFields(false);
				changeRequiredItems();
				modal.style.display = "none";
			}

			noReplicate.onclick = function() {
				modalReplicate.style.display = "none";
			}

			yesReplicate.onclick = function() {
				let Message = 'Data replicada com sucesso!';
				const tableItems = document.querySelectorAll('.item');
				let dateSel		 = tableItems[0].querySelector(".deliverydate").value;;
			
				for(let i = 0; i < tableItems.length; i++) {
					tableItems[i].querySelector('.deliverydate').value = dateSel;
				}
				modalReplicate.style.display = "none";
				alert(Message);
			}

			span2.onclick = function() {
				modalReplicate.style.display = "none";
			}

			//-- Altera obrigatoriedade dos campos do formulário
			function changeRequiredFields(isRemoveRequired, isRejectModal = false) {
				let tipoFrete = document.querySelector('#tipoFrete');
				let listCond = document.querySelector('#listCond');
				let listMoeda = document.querySelector('#listMoeda');
				let validade = document.querySelector('#validade');
				
				if (isRemoveRequired) {
					tipoFrete.removeAttribute('required');
					listCond.removeAttribute('required');
					listMoeda.removeAttribute('required');
					validade.removeAttribute('required');
					if (isRejectModal) {
						modal.style.display = "block";
					}
				} else {
					tipoFrete.setAttribute('required', 'true');
					listCond.setAttribute('required', 'true');
					listMoeda.setAttribute('required', 'true');
					validade.setAttribute('required', 'true');
				}
			}

			//-- Altera itens obrigatórios
			function changeRequiredItems(isRejectModal = false) {
				const tableItems = document.querySelectorAll('.item');
				let hasValue = true;
				let count = 0;

				for (let i = 0; i < tableItems.length; i++) { //-- Verifica se ao menos um item foi preenchido
					const tdQuantity = tableItems[i].querySelector(".quantity");
					const tdUnitaryValue = tableItems[i].querySelector(".unitaryValue");
					const tdSituation = tableItems[i].querySelector(".cSituacao");

					if ((tdQuantity.value == 0 || tdUnitaryValue.value == 0) && tdSituation.value == '1') { //-- Todos os itens com situação considerada, devem estar preenchidos
						hasValue = false;
						break;
					} else if (tdSituation.value != '1') {
						count ++;
					}
				}

				if (count == tableItems.length) { //-- Todos os itens são não vende ou sem estoque
					hasValue = true;
				}

				for(let i = 0; i < tableItems.length; i++) {
					const tdQuantity = tableItems[i].querySelector(".quantity");
					const tdUnitaryValue = tableItems[i].querySelector(".unitaryValue");
					let stepQuant = tdQuantity.getAttribute('step');
					let stepValor = tdUnitaryValue.getAttribute('step');

					if (isRejectModal || hasValue) { //-- Se for o modal de rejeição ou tem valores preenchidos, deve remover obrigatoriedade de todos os itens
						tdQuantity.removeAttribute('required');
						tdQuantity.removeAttribute('min');

						tdUnitaryValue.removeAttribute('required');
						tdUnitaryValue.removeAttribute('min');
					} else {
						tdQuantity.setAttribute('required', 'true');
						tdQuantity.setAttribute('min', stepQuant);

						tdUnitaryValue.setAttribute('required', 'true');
						tdUnitaryValue.setAttribute('min', stepValor);
					}
				}
			}

			function minValidity() {
				const dataInput = document.getElementById('validade');
				const dataDelivery = document.getElementById('deliverydate');
				const dataAtual = new Date();
				const ano = dataAtual.getFullYear();
				const mes = (dataAtual.getMonth() + 1).toString().padStart(2, '0');
				const dia = dataAtual.getDate().toString().padStart(2, '0');

				const dataMinima = `${ano}-${mes}-${dia}`;
				dataInput.setAttribute('min', dataMinima);
				dataDelivery.setAttribute('min', dataMinima);
			}

			// function paymentConditionEvent () {
			function dataListEvent (input, table) {
				document.getElementById(input).addEventListener('change', function() {
					let input = this;
					let datalist = document.getElementById(table);
					let validOption = false;

					for (let i = 0; i < datalist.options.length; i++) { // Verifica se o valor inserido corresponde a uma opção da datalist
						if (input.value === datalist.options[i].value) {
							validOption = true;
							break;
						}
					}
					if (!validOption) { // Se o valor não for válido, limpa o campo
						input.value = '';
					}
				});
			}

			function nStepTaxa(){
				let tdTaxaMoeda = document.querySelector('.taxaMoeda');
				let taxaMoeda = tdTaxaMoeda.value;
				let nStepTaxa = parseFloat(tdTaxaMoeda.getAttribute('step').length-2);

				if (taxaMoeda == 0 || taxaMoeda < 0 || isNaN(taxaMoeda)) {
					taxaMoeda = 0;
				}

				tdTaxaMoeda.value = Number(taxaMoeda).toFixed(nStepTaxa);	
			}

			function nStepFrete() {
				let tdValorFrete = document.querySelector('.valorFrete');
				let tdTotalPagar = document.querySelector('.totalPagar');
				let tdOldValorFrete = document.querySelector('#oldValorFrete');
				let valorFrete = parseFloat(tdValorFrete.value);
				let oldValorFrete = parseFloat(tdOldValorFrete.value);
				let valorTotal = parseFloat(tdTotalPagar.value);
				let tdTotalItem = document.querySelector(".totalItem");
				let nStepTotal = parseFloat(tdTotalItem.getAttribute('step').length-2);

				if (valorFrete == 0 || valorFrete < 0 || isNaN(valorFrete)) {
					valorTotal = valorTotal - oldValorFrete;
					tdTotalPagar.value = valorTotal.toFixed(nStepTotal);
					tdValorFrete.value = parseFloat(0).toFixed(2);
					tdOldValorFrete.value = parseFloat(0).toFixed(2);
				} else {
					valorTotal = valorTotal - oldValorFrete + valorFrete;
					tdTotalPagar.value = valorTotal.toFixed(nStepTotal);
					tdValorFrete.value = valorFrete.toFixed(2);
					tdOldValorFrete.value = valorFrete.toFixed(2);
				}
			}

			function nStepDespesa() {
				let tdValorDespesa = document.querySelector('.valorDespesa');
				let tdTotalPagar = document.querySelector('.totalPagar');
				let tdOldValorDespesa = document.querySelector('#oldValorDespesa');
				let valorDespesa = parseFloat(tdValorDespesa.value);
				let oldValorDespesa = parseFloat(tdOldValorDespesa.value);
				let valorTotal = parseFloat(tdTotalPagar.value);
				let tdTotalItem = document.querySelector(".totalItem");
				let nStepTotal = parseFloat(tdTotalItem.getAttribute('step').length-2);

				if (valorDespesa == 0 || valorDespesa < 0 || isNaN(valorDespesa)) {
					valorTotal = valorTotal - oldValorDespesa;
					tdTotalPagar.value = parseFloat(valorTotal).toFixed(nStepTotal);
					tdValorDespesa.value = parseFloat(0).toFixed(2);
					tdOldValorDespesa.value = parseFloat(0).toFixed(2);
				} else {
					let diff = valorDespesa - oldValorDespesa;
					valorTotal = valorTotal - (diff*-1);
					tdTotalPagar.value = parseFloat(valorTotal).toFixed(nStepTotal);
					tdValorDespesa.value = parseFloat(tdValorDespesa.value).toFixed(2);
					tdOldValorDespesa.value = valorDespesa.toFixed(2);
				}
			}

			function nStepSeguro() {
				let tdValorSeguro = document.querySelector('.valorSeguro');
				let tdTotalPagar = document.querySelector('.totalPagar');
				let tdOldValorSeguro = document.querySelector('#oldValorSeguro');
				let valorSeguro = parseFloat(tdValorSeguro.value);
				let oldValorSeguro = parseFloat(tdOldValorSeguro.value);
				let valorTotal = parseFloat(tdTotalPagar.value);
				let tdTotalItem = document.querySelector(".totalItem");
				let nStepTotal = parseFloat(tdTotalItem.getAttribute('step').length-2);

				if (valorSeguro == 0 || valorSeguro < 0 || isNaN(valorSeguro)) {
					valorTotal = valorTotal - oldValorSeguro;
					tdTotalPagar.value = parseFloat(valorTotal).toFixed(nStepTotal);
					tdValorSeguro.value = parseFloat(0).toFixed(2);
					tdOldValorSeguro.value = parseFloat(0).toFixed(2);
				} else {
					let diff = valorSeguro - oldValorSeguro; // Calcula a diferença entre o novo valor do seguro e o valor antigo.
					valorTotal = valorTotal - (diff*-1);
					tdTotalPagar.value = parseFloat(valorTotal).toFixed(nStepTotal);
					tdValorSeguro.value = parseFloat(tdValorSeguro.value).toFixed(2);
					tdOldValorSeguro.value = valorSeguro.toFixed(2);
				}
			}

			function myFunction(e) {
				let tdOrigem = e.target.parentNode;				
				let item = tdOrigem.parentNode; //TR items[i];
				let tdUnitaryValue = item.querySelector(".unitaryValue");
				let tdProduct = item.querySelector(".product");
				let unitaryValue = tdUnitaryValue.value;
				let tdQuantity = item.querySelector(".quantity");
				let quantity = tdQuantity.value;
				let tdTotalItem = item.querySelector(".totalItem");
				let tdTotalPagar = document.querySelector(".totalPagar");
				let totalPagar = 0;
				let desconto = item.querySelector(".desconto");
				let descPercent = item.querySelector(".descPercent");
				let quantityRequested = item.querySelector(".quantityRequested");
				let tdValorFrete = document.querySelector('.valorFrete');
				let valorFrete = tdValorFrete.value;
				let tdValorDespesa = document.querySelector('.valorDespesa');
				let valorDespesa = tdValorDespesa.value;
				let tdValorSeguro = document.querySelector('.valorSeguro');
				let valorSeguro = tdValorSeguro.value;
				let tddataEntrega = item.querySelector(".deliverydate");
				let cdataEntrega = tddataEntrega.value;
							
				let tdIPIValue;
				let valorIPI;
				let tdICMSValue;
				let valorICMS;

				if (isBrazil) {
					tdIPIValue  = item.querySelector(".valorIPI");
					valorIPI    = tdIPIValue.value;
					tdICMSValue = item.querySelector(".valorICMSSOL");
					valorICMS   = tdICMSValue.value;
				}
												
				let items = document.querySelectorAll(".item");

				let nStepQuant = Number(tdQuantity.getAttribute('step').length-2);
				let nStepValor = Number(tdUnitaryValue.getAttribute('step').length-2);
				let nStepDesc = Number(descPercent.getAttribute('step').length-2);
				let nStepTotal = Number(tdTotalItem.getAttribute('step').length-2);
				let nStepIPI;
				let nStepICMS;
				
				if (unitaryValue === '') {
					unitaryValue = "0";
				}

				if (quantity === '') {
					quantity = "0";
				}

				tdUnitaryValue.value = parseFloat(unitaryValue).toFixed(nStepValor);
				tdQuantity.value = parseFloat(quantity).toFixed(nStepQuant);
				tdTotalItem.textContent = parseFloat(quantity*unitaryValue).toFixed(nStepTotal);

				if (isBrazil) {
					nStepIPI = Number(tdIPIValue.getAttribute('step').length-2);
					nStepICMS = Number(tdICMSValue.getAttribute('step').length-2);
					tdIPIValue.value = Number(valorIPI).toFixed(nStepIPI);
					tdICMSValue.value = Number(valorICMS).toFixed(nStepICMS);
				}
				

				if (e.target.getAttribute('class') == 'unitaryValue') {
					let linDesc= item.querySelector(".desconto");
					let linDescPer= item.querySelector(".descPercent");

					linDesc.value = (0).toFixed(2);
					linDescPer.value = (0).toFixed(nStepDesc);

					if (isBrazil) {
						tdIPIValue.value = (0).toFixed(nStepIPI);
						tdICMSValue.value = (0).toFixed(nStepICMS);		
					}
				} 

				else if (e.target.getAttribute('class') == 'descPercent'){
					desconto.value = parseFloat(parseFloat(tdTotalItem.textContent) * descPercent.value / 100).toFixed(2);
				}

				else if (e.target.getAttribute('class') == "deliverydate") {
					let newDateCmp = new Date().toISOString().substring(0,10);
					var dataComp = new Date(cdataEntrega);

					if ( cdataEntrega === '' || dataComp < new Date() ) {
						tddataEntrega.value = newDateCmp;
					} 
				}

				else if (e.target.getAttribute('class') == 'desconto'){
					descPercent.value = Number(desconto.value / parseFloat(tdTotalItem.textContent) * 100).toFixed(nStepDesc);	
				}

				desconto.value = Number(desconto.value).toFixed(2);
				descPercent.value = Number(descPercent.value).toFixed(nStepDesc);

				// Valores invalidos
				if (descPercent.value > 99.99){
					descPercent.value = 99.99;
					desconto.value = Number(parseFloat(tdTotalItem.textContent) * descPercent.value / 100).toFixed(2);
				}

				else if (descPercent.value < 0 || desconto.value < 0 ){
					descPercent.value = (0).toFixed(nStepDesc);
					desconto.value = parseFloat((tdTotalItem.textContent) * descPercent.value / 100).toFixed(2);
				}

				else if ( tdQuantity.value > parseFloat(quantityRequested.textContent) || tdQuantity.value < 0) {
					tdQuantity.value = parseFloat(quantityRequested.textContent).toFixed(nStepQuant);
					tdTotalItem.textContent = parseFloat(tdQuantity.value*unitaryValue).toFixed(nStepTotal);
				}

				else if ( tdUnitaryValue.value < 0 ) {
					tdUnitaryValue.value = (0).toFixed(nStepValor);
					tdTotalItem.textContent = parseFloat(quantity*tdUnitaryValue.value).toFixed(nStepTotal);
				}

				else if (isBrazil && ( valorIPI >= Number(parseFloat(tdTotalItem.textContent)) || valorIPI < 0 )) {
					tdIPIValue.value = (0).toFixed(nStepIPI);
				}

				else if (isBrazil && ( valorICMS >= Number(parseFloat(tdTotalItem.textContent)) || valorICMS < 0)) {
					tdICMSValue.value = (0).toFixed(nStepICMS);
				}
				
				for (let i = 0; i < items.length; i++) {
					let totalItem 		= items[i].querySelector(".totalItem");				
					let desconto 		= items[i].querySelector(".desconto");
					let ipivalorimp; 	
					let icmssolvalorimp;

					if (isBrazil) {
						ipivalorimp  	= items[i].querySelector(".valorIPI");
						icmssolvalorimp = items[i].querySelector(".valorICMSSOL");
					}

					totalPagar += parseFloat(totalItem.textContent);
					totalPagar -= parseFloat(desconto.value);

					if (isBrazil) {
						totalPagar += Number(ipivalorimp.value);
						totalPagar += Number(icmssolvalorimp.value);
					}
				}
				totalPagar += parseFloat(valorFrete);
				totalPagar += parseFloat(valorDespesa);
				totalPagar += parseFloat(valorSeguro);
				tdTotalPagar.value = parseFloat(totalPagar).toFixed(nStepTotal);
			}

			// desabilita/habilita campo de taxa de moeda
			function checkOption() {
				let taxaMoeda = document.querySelector('.taxaMoeda');
				let nStepTaxa = Number(taxaMoeda.getAttribute('step').length-2);
				let moeda = document.querySelector('#listMoeda').value
				
				if (moeda == "1") {
					taxaMoeda.readOnly = true;
					taxaMoeda.value = Number(0).toFixed(nStepTaxa);
				} else {
					taxaMoeda.readOnly = false;
				}
				
			}

			// desabilita/habilita campo de tipo de frete
			function checkFrete(value) {
				let tdValorFrete = document.querySelector('.valorFrete');
				let tdTotalPagar = document.querySelector('.totalPagar');
				let valorTotal = tdTotalPagar.value;
				let valorFrete = tdValorFrete.value;
				let tdOldValorFrete = document.querySelector('#oldValorFrete');
				let tdTotalItem = document.querySelector(".totalItem");
				let nStepTotal = parseFloat(tdTotalItem.getAttribute('step').length-2);

				if (value != "C") {
					tdValorFrete.readOnly = true;
					tdValorFrete.value = Number(0).toFixed(2);
					valorTotal = parseFloat(valorTotal) - parseFloat(valorFrete);
					tdTotalPagar.value = parseFloat(valorTotal).toFixed(nStepTotal);
					tdOldValorFrete.value = valorFrete;
				} else {
					tdValorFrete.readOnly = false;
				}
			}

			// atualiza o Status na tabela de status
			function changeStatus(e) {
				let tdOrigem = e.target.parentNode;				
				let item = tdOrigem.parentNode; //TR items[i];
				let tdProduct = item.querySelector(".product");
				let tdSituacao = item.querySelector("#cSituacao");
				let situacao = tdSituacao.options[tdSituacao.selectedIndex].value;
				let cItem = tdProduct.getAttribute("id");
				let status = document.querySelectorAll(".status");				
				
				for (let i = 0; i < status.length; i++) {
					let tdItem = status[i].querySelector("#item");
					let tdStatus = status[i].querySelector("#status");
					let itemStatus = tdItem.textContent;
					
					if (itemStatus==cItem) {
						tdStatus.value = situacao;						
					}					
				}

				let quantity 		= item.querySelector(".quantity");
				let desconto 		= item.querySelector(".desconto");
				let descPercent		= item.querySelector(".descPercent");
				let unitaryValue 	= item.querySelector(".unitaryValue");
				let valorICMSSOL;
				let valorIPI;

				if (isBrazil) {
					valorICMSSOL = item.querySelector(".valorICMSSOL");
					valorIPI	 = item.querySelector(".valorIPI");
				}
				
				if (situacao != "1") { //-- Zera valores e desativa os campos
					quantity.value 		= 0;
					desconto.value 		= 0;
					descPercent.value 	= 0;
					unitaryValue.value 	= 0;

					if (isBrazil) {
						valorICMSSOL.value	  = 0;
						valorIPI.value		  = 0;
						valorICMSSOL.readOnly = true;
						valorIPI.readOnly 	  = true;	
					}

					quantity.readOnly 		= true;
					desconto.readOnly 		= true;
					descPercent.readOnly 	= true;
					unitaryValue.readOnly 	= true;
				} else {
					quantity.readOnly		= false;
					desconto.readOnly 		= false;
					descPercent.readOnly 	= false;
					unitaryValue.readOnly 	= false;
					quantity.value			= (quantity || quantity === 0) ? parseFloat(item.querySelector(".quantityRequested").textContent) : quantity.value;
					disableQuantity();

					if (isBrazil) {
						valorICMSSOL.readOnly = false;
						valorIPI.readOnly 	  = false;	
					}
				}

				myFunction(e);
			}
			
			// Carrega valores pré-definidos
			function loadValues() {
				let buttonString = 'Salvar rascunho';
				const draftString = document.querySelector('.draftString').value;
				const thValorIpi = document.querySelector('.thValorIPI');
				const thValorIcmsSol = document.querySelector('.thValorICMSSOL');
				const table = document.querySelector('.tableItems');
				const tableItems = document.querySelectorAll('.item');
				
				if (draftString) {
					buttonString = draftString;
				}
				
				document.querySelector('#draftButton').innerHTML = buttonString;

				hideTableFields();

				if (!hasSupObs) { //-- Remove campo observação do fornecedor caso não exista no dicionário
					const textObsFornece = document.querySelector('.textObsFornece');
					textObsFornece.style.display = 'none';
				}

				if (localStorage.getItem(lastURLParam())) {
					loadDataByStorage(); //- Carrega dados através do storage
				} else {
					loadDataByQuotation(); //-- Carrega dados através da cotação
				}
				disableQuantity();
        	}

			//-- Oculta campos da tabela
			function hideTableFields() {
				let hideFields = [];
				const table = document.querySelector('.tableItems');
				const tableItems = document.querySelectorAll('.item');

				if (!isBrazil) {
					hideFields.push('ValorIPI');
					hideFields.push('ValorICMSSOL');
				}

				hideFields.push('cObsForn');
				hideFields.push('cObservacao');

				hideFields.forEach(fieldClass => {
					// Ocultar o cabeçalho
					const thElement = document.querySelector(`.th${fieldClass}`);
					if (thElement) {
						thElement.style.display = 'none';
					}

					// Ocultar os elementos da tabela
					tableItems.forEach(item => {
						const tdElement = item.querySelector(`.td${fieldClass}`);
						if (tdElement) {
							tdElement.style.display = 'none';
						}
					});
				});

				// Ajustar o tamanho das colunas
				const totalLength = table.offsetWidth;
				const numCels = table.rows[0].cells.length;
				const newLength = totalLength / numCels;

				for (let i = 0; i < numCels; i++) {
					table.rows[0].cells[i].style.width = newLength + "px";
				}
			}

			//-- Carrega valores da cotação na tela
			function loadDataByQuotation() {
				// Define valor padrão do select tipoFrete
				select = document.querySelector('select.tipoFrete');
				select.value = select.attributes.value.value;
				
				checkFrete(select.value);

				// Define valores padrões dos selects de situação
				var selects = document.querySelectorAll('select.cSituacao');
				var inputs = document.querySelectorAll('input.situacao');

				if (selects.length == inputs.length) {
					for(var i = 0; i < selects.length; i++) {
						selects[i].value = inputs[i].value;
						triggerChangeEvent(selects[i]); //-- Atualiza situação
					}
				}

				const listCond = document.querySelector('#listCond');
				listCond.value = listCond.value.trim();

				triggerChangeEvent(listCond);


				const listMoeda = document.querySelector('#listMoeda');
				listMoeda.value = listMoeda.value.trim();

				triggerChangeEvent(listMoeda);
			}

			//-- Carrega valores da cotação através do storage
			function loadDataByStorage() {
				let storageValue = localStorage.getItem(lastURLParam());

				if (storageValue) {
					// Converter a string JSON de volta para um objeto
					let quotation = JSON.parse(storageValue);

					// Define valor padrão do select tipoFrete
					select = document.querySelector('select.tipoFrete');
					select.value = quotation['tipoFrete'];
					
					checkFrete(select.value); //-- Atualiza frete

					//-- Preenche cabeçalho
					document.querySelector('select.tipoFrete').value = quotation['tipoFrete'];
					document.querySelector('.valorFrete'     ).value = quotation['valorFrete'];
					document.querySelector('.valorDespesa'   ).value = quotation['valorDespesa'];
					document.querySelector('.valorSeguro'    ).value = quotation['valorSeguro'];
					document.querySelector('#listCond'       ).value = quotation['listCond'];
					document.querySelector('#listMoeda'      ).value = quotation['listMoeda'];
					document.querySelector('.taxaMoeda'      ).value = quotation['taxaMoeda'];
					document.querySelector('#validade'       ).value = quotation['validade'];

					const selectResumWf = document.querySelector('#cHasResumWf');
					selectResumWf.value = quotation['resumWf'];

					triggerChangeEvent(selectResumWf);

					const tableItems = document.querySelectorAll('.item');

					if (tableItems.length == quotation['items'].length) {
						for(let i = 0; i < tableItems.length; i++) {
							//-- Preenche itens
							tableItems[i].querySelector('.quantity'    ).value = quotation['items'][i]['quantity'];
							tableItems[i].querySelector('.unitaryValue').value = quotation['items'][i]['unitaryValue'];
							tableItems[i].querySelector('.descPercent' ).value = quotation['items'][i]['descPercent'];
							tableItems[i].querySelector('.desconto'    ).value = quotation['items'][i]['desconto'];
							tableItems[i].querySelector('.cSituacao'   ).value = quotation['items'][i]['cSituacao'];
							tableItems[i].querySelector('.cObservacao' ).value = quotation['items'][i]['cObservacao'];
							tableItems[i].querySelector('.cObsForn'    ).value = quotation['items'][i]['cObsForn'];
							tableItems[i].querySelector('.deliverydate').value = quotation['items'][i]['deliverydate'];

							if (isBrazil) {
								tableItems[i].querySelector('.valorIPI'    ).value = quotation['items'][i]['valorIPI'];
								tableItems[i].querySelector('.valorICMSSOL').value = quotation['items'][i]['valorICMSSOL'];
							}
	
							triggerChangeEvent(tableItems[i].querySelector('.cSituacao')); //-- Atualiza status
						}
					}
				}
			}

			//-- Salva o storage
			function saveStorage() {
				const tableItems = document.querySelectorAll('.item');
				let items = [];
				
				tableItems.forEach(function(item) {
					const itemValues = {
						'quantity': item.querySelector('.quantity').value,
						'unitaryValue': item.querySelector('.unitaryValue').value,
						'descPercent': item.querySelector('.descPercent').value,
						'desconto': item.querySelector('.desconto').value,
						'cSituacao': item.querySelector('.cSituacao').value,
						'cObservacao': item.querySelector('.cObservacao').value,
						'cObsForn': item.querySelector('.cObsForn').value,
						'deliverydate': item.querySelector('.deliverydate').value,
					}

					if (isBrazil) {
						itemValues['valorIPI'] = item.querySelector('.valorIPI').value;
						itemValues['valorICMSSOL'] = item.querySelector('.valorICMSSOL').value;
					}
					items.push(itemValues);
				});

				const data = {
					'tipoFrete': document.querySelector('select.tipoFrete').value,
					'valorFrete': document.querySelector('.valorFrete').value,
					'valorDespesa': document.querySelector('.valorDespesa').value,
					'valorSeguro': document.querySelector('.valorSeguro').value,
					'listCond': document.querySelector('#listCond').value,
					'listMoeda': document.querySelector('#listMoeda').value,
					'taxaMoeda': document.querySelector('.taxaMoeda').value,
					'validade': document.querySelector('#validade').value,
					"resumWf": document.querySelector('#cHasResumWf').value,
					'items': items
				};

				localStorage.setItem(lastURLParam(), JSON.stringify(data));
			}

			//-- Dispara evento change manualmente
			function triggerChangeEvent(element) {
				var event = new Event('change');
				element.dispatchEvent(event);
			}

			//-- Obter último parâmetro da URL
			function lastURLParam() {
				const url = window.location.href;
				const urlParts = url.split('/');
				const lastParam = urlParts[urlParts.length - 1].split('.')[0]; // Remover a extensão .htm

				return lastParam;
			}


			//-- Desabilitar campo de quantidade disponivel, quando compra centralizada
			function disableQuantity() {
				const tableItems = document.querySelectorAll('.item');	
				for(let i = 0; i < tableItems.length; i++) {
					if ( tableItems[i].querySelector(".centralized").value === "0") {
						tableItems[i].querySelector(".quantity").setAttribute('readonly', 'readonly');
					}
				}
			}

			let currentRow; // Variável para armazenar a linha atual que está sendo editada

			// Função para abrir o modal e carregar os dados da linha
			function editObservation(button) {
				// Obtém a linha correspondente ao botão clicado
				currentRow = button.closest('tr');

				// Seleciona os valores existentes na linha
				const obsSCValue = currentRow.querySelector('.cObservacao')?.value || ''; // Valor da célula "Obs. SC"
				const obsFornecedorValue = currentRow.querySelector('.cObsForn')?.value || ''; // Valor da célula "Obs. Fornecedor"

				// Define os valores no modal
				document.getElementById('modalObsSC').value = obsSCValue;
				document.getElementById('modalObsFornecedor').value = obsFornecedorValue;

				// Exibe o modal
				document.getElementById('modalEditObservation').style.display = 'block';
			}

			// Função para salvar as alterações no modal
			function saveObservation() {
				if (currentRow) {
					// Atualiza os valores na linha correspondente
					const obsFornCell = currentRow.querySelector('.cObsForn');
					if (obsFornCell) {
						obsFornCell.value = document.getElementById('modalObsFornecedor').value; // Atualiza o valor de "Obs. SC"
					}
				}

				// Fecha o modal
				closeModal();
			}

			// Função para fechar o modal
			function closeModal() {
				document.getElementById('modalEditObservation').style.display = 'none';
			}

			// Eventos para os botões do modal
			document.getElementById('saveObservation').onclick = saveObservation;
			document.getElementById('cancelObservation').onclick = closeModal;
			document.getElementById('closeModalEdit').onclick = closeModal;
		</script>
	</body>
</html>