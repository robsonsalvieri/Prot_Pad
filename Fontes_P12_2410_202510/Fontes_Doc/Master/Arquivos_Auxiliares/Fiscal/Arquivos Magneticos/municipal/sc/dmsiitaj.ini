?{"Nome do Arquivo INI","DMS.INI"}
?{"Descrição Completa do Arquivo Magnético","Declaração Mensal de Serviço do Município de Itajaí - SC"}
?{"A Quem se Destina","Empresas prestadoras de serviços, pessoa física ou jurídica, inscritas no cadastro econômico da prefeitura, contribuintes do ISSQN, ou as empresas tomadoras de serviços e declarantes conveniados."}
?{"Objetivo","Declarar mensalmente ao fisco as informações dos serviços tomados/prestados no período de competência."}
?{"Prazo de Entrega","Mensal."}
?{"Aplicativo Disponibilizado pelo Fisco","Programas PMM"}
?{"Versão do Aplicativo Contemplada pela Microsiga","2.20"}
?{"Legislação Contemplada","A Prefeitura Municipal de Itajaí "}
?{"Comentários",""}

[XXX Inicializacao]
(PRE) _aTotal[001] := mv_par01
(PRE) _aTotal[002] := mv_par02
(PRE) _aTotal[003] := {}
(PRE) _aTotal[004] := {} 
(PRE) _aTotal[005] := .F.  
(PRE) _aTotal[006] := .F.        
(PRE) _aTotal[007] := ""  
(PRE) _aTotal[008] := {}     
(PRE) _aTotal[009] := .F.  
(PRE) _aTotal[011] := {}   
(PRE) _aTotal[012] := ""  
(PRE) _aTotal[013] := {}
(PRE) _aTotal[014] := {}  
(PRE) _aTotal[015] := .F.      
(PRE) _aTotal[016] := ""
(PRE) _aTotal[017] := cFilAnt  
(PRE) _aTotal[018] := .F.     
(PRE) _aTotal[019] := 0  
(PRE) _aTotal[020] := ""   
(PRE) _aTotal[021] := .F.
(PRE) _aTotal[022] := 0    
(PRE) _aTotal[023] := {} 
(PRE) _aTotal[024] := "" 
(PRE) _aTotal[025] := ""
(PRE) _aTotal[026] := 0 
(PRE) _aTotal[027] := 0 
(PRE) _aTotal[028] := 0 
(PRE) _aTotal[029] := 0 
(PRE) _aTotal[030] := 0 
(PRE) _aTotal[031] := "" 
(PRE) _aTotal[032] := "" 
(PRE) _aTotal[098] := {}
(PRE) _aTotal[099] := {}      

                                     
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³TELA PRINCIPAL³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
[XXX Montagem do CFP Utilizado pela rotina - PRINCIPAL]
(PRE) aAdd (_aTotal[003], "Processamento da DMS")
(PRE) aAdd (_aTotal[003], "")
(PRE) aAdd (_aTotal[003], "Preencha corretamente as informações solicitadas.")
(PRE) aAdd (_aTotal[003], "Informações necessárias para o preenchimento automático da DMS - Declaração Mensal de Serviço do Município de Itajaí - SC.")
    
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³INFORMACOES PRINCIPAIS ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
[XXX Montagem do CFP Utilizado pela rotina - COMPLEMENTAR]
(PRE) aAdd (_aTotal[004], {})
(PRE) aAdd (_aTotal[004][1], "Processamento da DMS")
(PRE) aAdd (_aTotal[004][1], "Informações para preenchimento do Quadro de Identificação")
(PRE) aAdd (_aTotal[004][1], {})                            
(PRE) aAdd (_aTotal[004][1][3], {1,"Inscr. Municipal:",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {0,"",,,,,,})  
(PRE) aAdd (_aTotal[004][1][3], {2,,"@!",1,,,,20}) 
(PRE) aAdd (_aTotal[004][1][3], {0,"",,,,,,})   
(PRE) aAdd (_aTotal[004][1][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][1][3], {0,"",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1,"Telefone:",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1,"Fax:",,,,,,})  
(PRE) aAdd (_aTotal[004][1][3], {2,,"9999999999",1,,,,10}) 
(PRE) aAdd (_aTotal[004][1][3], {2,,"9999999999",1,,,,10})  
(PRE) aAdd (_aTotal[004][1][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][1][3], {0,"",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1,"E-mail:",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1,"Home Page:",,,,,,})  
(PRE) aAdd (_aTotal[004][1][3], {2,,"",1,,,,100}) 
(PRE) aAdd (_aTotal[004][1][3], {2,,"",1,,,,100})  
           
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³INFORMACOES DO SOCIO   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ                                              
(PRE) aAdd (_aTotal[004], {})
(PRE) aAdd (_aTotal[004][2], "Processamento da DMS")
(PRE) aAdd (_aTotal[004][2], "Sócios e Atividades")
(PRE) aAdd (_aTotal[004][2], {})          
(PRE) aAdd (_aTotal[004][2][3], {1, "Gerar Reg. de Inf. do Sòcio:",,,,,,})                            
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,})  
(PRE) aAdd (_aTotal[004][2][3], {3,,,,,{"N=Não","S=Sim"},,}) 
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,})                                                                               
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "CNPJ/CPF do Sócio:",,,,,,})                            
(PRE) aAdd (_aTotal[004][2][3], {1, "Nome do Sócio Responsável:",,,,,,})  
(PRE) aAdd (_aTotal[004][2][3], {2,,"99999999999999",1,,,,14}) 
(PRE) aAdd (_aTotal[004][2][3], {2,,"@!",1,,,,100})                                                                               
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,})  
(PRE) aAdd (_aTotal[004][2][3], {1, "Logradouro do Sócio:",,,,,,})                            
(PRE) aAdd (_aTotal[004][2][3], {1, "Número End. Sócio:",,,,,,}) 
(PRE) aAdd (_aTotal[004][2][3], {2,,"@!",1,,,,100})   
(PRE) aAdd (_aTotal[004][2][3], {2,,"99999999",1,,,,008})   
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,})                      
(PRE) aAdd (_aTotal[004][2][3], {1, "Complemento:",,,,,,})                            
(PRE) aAdd (_aTotal[004][2][3], {1, "Bairro:",,,,,,}) 
(PRE) aAdd (_aTotal[004][2][3], {2,,"@!",1,,,,050})   
(PRE) aAdd (_aTotal[004][2][3], {2,,"@!",1,,,,070})               
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,})          
(PRE) aAdd (_aTotal[004][2][3], {1, "Cidade:",,,,,,})                            
(PRE) aAdd (_aTotal[004][2][3], {1, "CEP:",,,,,,}) 
(PRE) aAdd (_aTotal[004][2][3], {2,,"@!",1,,,,070})   
(PRE) aAdd (_aTotal[004][2][3], {2,,"99999999",1,,,,008}) 
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,})                                             
(PRE) aAdd (_aTotal[004][2][3], {1, "UF:",,,,,,})                            
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][2][3], {2,,"@!",1,,,,02})   
(PRE) aAdd (_aTotal[004][2][3], {0,"",,,,,,})        

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA DE INFORMACOES ECONOMICAS      ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ                                              
(PRE) aAdd (_aTotal[004], {})
(PRE) aAdd (_aTotal[004][3], "Processamento da DMS")
(PRE) aAdd (_aTotal[004][3], "Informações Econômicas (Anuais)")
(PRE) aAdd (_aTotal[004][3], {})
(PRE) aAdd (_aTotal[004][3][3], {1, "Gerar Reg. de Inf. Econômicas:",,,,,,})                            
(PRE) aAdd (_aTotal[004][3][3], {1, "Ano:",,,,,,})  
(PRE) aAdd (_aTotal[004][3][3], {3,,,,,{"N=Não","S=Sim"},,}) 
(PRE) aAdd (_aTotal[004][3][3], {2,,"9999",1,,,,004})                                                                               
(PRE) aAdd (_aTotal[004][3][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][3][3], {0,"",,,,,,})
(PRE) aAdd (_aTotal[004][3][3], {1,"Total Despesas:",,,,,,})                            
(PRE) aAdd (_aTotal[004][3][3], {1, "Outras Receitas:",,,,,,})  
(PRE) aAdd (_aTotal[004][3][3], {2,,"@E",1,,,,015}) 
(PRE) aAdd (_aTotal[004][3][3], {2,,"@E",1,,,,015})  
(PRE) aAdd (_aTotal[004][3][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][3][3], {0,"",,,,,,})
(PRE) aAdd (_aTotal[004][3][3], {1,"Valor do Ativo:",,,,,,})                            
(PRE) aAdd (_aTotal[004][3][3], {1, "Valor do passivo:",,,,,,})  
(PRE) aAdd (_aTotal[004][3][3], {2,,"@E",1,,,,015}) 
(PRE) aAdd (_aTotal[004][3][3], {2,,"@E",1,,,,015}) 
(PRE) aAdd (_aTotal[004][3][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][3][3], {0,"",,,,,,})
(PRE) aAdd (_aTotal[004][3][3], {1,"Patrimônio Líquido:",,,,,,})                            
(PRE) aAdd (_aTotal[004][3][3], {1, "Capital Social:",,,,,,})  
(PRE) aAdd (_aTotal[004][3][3], {2,,"@E",1,,,,015}) 
(PRE) aAdd (_aTotal[004][3][3], {2,,"@E",1,,,,015})  
(PRE) aAdd (_aTotal[004][3][3], {0,"",,,,,,}) 
(PRE) aAdd (_aTotal[004][3][3], {0,"",,,,,,})
(PRE) aAdd (_aTotal[004][3][3], {1,"Num. empregados 01/Jan:",,,,,,})                            
(PRE) aAdd (_aTotal[004][3][3], {1,"Num. empregados 31/Dez",,,,,,})  
(PRE) aAdd (_aTotal[004][3][3], {2,,"9999999999",1,,,,010}) 
(PRE) aAdd (_aTotal[004][3][3], {2,,"9999999999",1,,,,010})    

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³CHAMA WIZARD           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ                 
[XXX Chamada do Wizard]
(PRE) _aTotal[099] := xMagWizard( _aTotal[003] , _aTotal[004] , "DMSITAJAI" )
(PRE) Iif(_atotal[099], xMagLeWiz ("DMSITAJAI", @_aTotal[098], .T.), Nil)
(PRE) lAbtMT950	:= !_atotal[099]  
                          
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA 10 - SIGAMAT   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ 
[SM0 01-Identicacao - CNPJ e Razao Social]      
(DEL) # M         
(PREREG) ( Alltrim(cEmpAnt)== Alltrim(SM0->M0_CODIGO) .and. Alltrim(_aTotal[017])==Alltrim(SM0->M0_CODFIL))
CABEC      C 002 0 "10"               
CNPJ       C 014 0 SubStr(AllTrim(SM0->M0_CGC),01,14)
TIPOCAD	   C 003 0 "EMC"	                        
INSCMUN	   C 020 0 _aTotal[098][1][1]		
RAZAO      C 070 0 AllTrim(SM0->M0_NOMECOM)              
NOMEFANT   C 050 0 AllTrim(SM0->M0_NOME) 	                
LOGRAD     C 100 0 AllTrim(SubStr(AllTrim(FisGetEnd(SM0->M0_ENDCOB)[01]),1,100))   
NUMLOGRAD  C 008 0 AllTrim(Iif(","$SM0->M0_ENDCOB,FisGetEnd(SM0->M0_ENDCOB)[3],""))
COMPLEM    C 050 0 AllTrim(Substr(AllTrim(SM0->M0_COMPCOB),1,50))    
BAIR	   C 070 0 AllTrim(SM0->M0_BAIRCOB) 
MUNICIPIO  C 100 0 Substr(AllTrim(SM0->M0_CIDCOB),1,100)	
CEP        C 008 0 AllTrim(SM0->M0_CEPCOB)   
UF         C 002 0 AllTrim(SM0->M0_ESTCOB)
TELEFONE   C 010 0 AllTrim(_aTotal[098][1][2])		
FAX        C 010 0 AllTrim(_aTotal[098][1][3])
EMAIL      C 100 0 AllTrim(_aTotal[098][1][4])	
HOMEPG     C 100 0 AllTrim(_aTotal[098][1][5])
CODMUN     C 007 0 SM0->M0_CODMUN      
        
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA 10 - CONTRIBUINTES - SA1   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ 
[XXX Movimentos que serao apresentados no periodo]
(PRE) SF3->(dbSetOrder(1))
(PRE) _aTotal[10] := {"SF3",""}
(PRE) FsQuery(_aTotal[10],1,"F3_FILIAL = '" + _aTotal[017] + "' AND F3_ENTRADA >= '" + DTOS(_aTotal[001]) + "' AND F3_ENTRADA <= '" + DTOS(_aTotal[002]) + "' AND SUBSTRING(F3_CFO,1,1)>= '5' AND F3_CODISS <> ''  AND (F3_DTCANC = '' OR F3_OBSERV LIKE 'CANCEL$')","F3_FILIAL == '" + _aTotal[017] + "' .AND. DTOS(F3_ENTRADA) >= '" + DTOS(_aTotal[001]) + "' .AND. DTOS(F3_ENTRADA) <= '" + DTOS(_aTotal[002]) + "' .And. substr(F3_CFO,1,1)>='5' .And. !Empty(F3_CODISS) .And. (Empty(F3_DTCANC) .Or. 'CANCEL'$F3_OBSERV)",SF3->(IndexKey()))
(PRE) SF3->(dbGoTop())      
(POS)     

[SF3 - Registro Tipo 10 - Contribuintes]
(DEL) # M            
(PRE) SA1->(dbSetOrder(1))  
(PRE) SA2->(dbSetOrder(1))    
(PREREG) Iif(  !(SF3->F3_TIPO$"D/B") , SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA))  , SA2->(MsSeek(xFilial("SA2")+SF3->F3_CLIEFOR+SF3->F3_LOJA)) )
(PREREG) _aTotal[007] := Iif( !(SF3->F3_TIPO$"D/B")  ,UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN , UfCodIBGE(SA2->A2_EST)+SA2->A2_COD_MUN )  
(PREREG) _aTotal[009] := !(aScan( _aTotal[008], Iif( !(SF3->F3_TIPO$"D/B")  ,SA1->A1_CGC , SA2->A2_CGC )   )>0)  
(PREREG) (aAdd(_aTotal[008], Iif( !(SF3->F3_TIPO$"D/B")  ,SA1->A1_CGC , SA2->A2_CGC )   ),.T.) 
(PREREG) (_aTotal[012] := Iif( !(SF3->F3_TIPO$"D/B")  ,SA1->A1_END, SA2->A2_END )  ,.T.)

CABEC      C 002 0 "10" 
CNPJ       C 014 0 SubStr(AllTrim( IIf(!(SF3->F3_TIPO$"D/B"),SA1->A1_CGC,SA2->A2_CGC)   ),01,14)  
TIPOCAD	   C 003 0 Iif( (AllTrim(_aTotal[007])=="08203") , "EIM" , "EFM"  )	                       
INSCMUN	   C 020 0 IIf(!(SF3->F3_TIPO$"D/B"),SA1->A1_INSCRM,SA2->A2_INSCRM)  
RAZAO      C 070 0 IIf(!(SF3->F3_TIPO$"D/B"),SA1->A1_NOME,SA2->A2_NOME) 
NOMEFANT   C 050 0 IIf(!(SF3->F3_TIPO$"D/B"),SA1->A1_NREDUZ,SA2->A2_NREDUZ)  
LOGRAD     C 100 0 AllTrim(SubStr(AllTrim(FisGetEnd(_aTotal[012])[01]),1,100))	   
NUMLOGRAD  C 008 0 AllTrim(Iif(","$_aTotal[012],FisGetEnd(_aTotal[012])[3],""))  
COMPLEM    C 050 0 IIf(!(SF3->F3_TIPO$"D/B"),FisGetEnd(SA1->A1_END)[4],FisGetEnd(SA2->A2_END)[4])  
BAIR	   C 070 0 IIf(!(SF3->F3_TIPO$"D/B"),SA1->A1_BAIRRO,SA2->A2_BAIRRO)  
MUNICIPIO  C 100 0 IIf(!(SF3->F3_TIPO$"D/B"),SA1->A1_MUN,SA2->A2_MUN)   
CEP        C 008 0 IIf(!(SF3->F3_TIPO$"D/B"),SA1->A1_CEP,SA2->A2_CEP)   
UF         C 002 0 IIf(!(SF3->F3_TIPO$"D/B"),SA1->A1_EST,SA2->A2_EST)   
TELEFONE   C 010 0 (IIf(!(SF3->F3_TIPO$"D/B"),(Right(AllTrim(SA1->A1_DDD),2)+Space(01)+SA1->A1_TEL) , (Right(AllTrim(SA2->A2_DDD),2)+Space(01)+SA2->A2_TEL) ))
FAX        C 010 0 (IIf(!(SF3->F3_TIPO$"D/B"),(Right(AllTrim(SA1->A1_DDD),2)+Space(01)+SA1->A1_FAX) , (Right(AllTrim(SA2->A2_DDD),2)+Space(01)+SA2->A2_FAX) )) 
EMAIL      C 100 0 AllTrim(IIf(!(SF3->F3_TIPO$"D/B"),SA1->A1_EMAIL,SA2->A2_EMAIL))	
HOMEPG     C 100 0 AllTrim(IIf(!(SF3->F3_TIPO$"D/B"),SA1->A1_HPAGE,SA2->A2_HPAGE))	
CODMUN     C 007 0 AllTrim(IIf(!(SF3->F3_TIPO$"D/B"),UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN,UfCodIBGE(SA2->A2_EST)+SA2->A2_COD_MUN))
(POS) FsQuery (_aTotal[10], 2)     

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA 10 - CONTRIBUINTES - SA2   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ 
[XXX Movimentos que serao apresentados no periodo]
(PRE) SF3->(dbSetOrder(1))
(PRE) _aTotal[10] := {"SF3",""}
(PRE) FsQuery(_aTotal[10],1,"F3_FILIAL = '" + _aTotal[017] + "' AND F3_ENTRADA >= '" + DTOS(_aTotal[001]) + "' AND F3_ENTRADA <= '" + DTOS(_aTotal[002]) + "' AND SUBSTRING(F3_CFO,1,1) < '5' AND F3_CODISS <> ''  AND (F3_DTCANC = '' OR F3_OBSERV LIKE 'CANCEL$')","F3_FILIAL == '" + _aTotal[017] + "' .AND. DTOS(F3_ENTRADA) >= '" + DTOS(_aTotal[001]) + "' .AND. DTOS(F3_ENTRADA) <= '" + DTOS(_aTotal[002]) + "' .And. substr(F3_CFO,1,1)>='5' .And. !Empty(F3_CODISS) .And. (Empty(F3_DTCANC) .Or. 'CANCEL'$F3_OBSERV)",SF3->(IndexKey()))
(PRE) SF3->(dbGoTop())      
(POS)    
    
[SF3 - Registro Tipo 10 - Contribuintes]
(DEL) # M            
(PRE) SA2->(dbSetOrder(1))  
(PRE) SA1->(dbSetOrder(1))    
(PREREG) Iif(  !(SF3->F3_TIPO$"D/B") , SA2->(MsSeek(xFilial("SA2")+SF3->F3_CLIEFOR+SF3->F3_LOJA))  , SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA)) )
(PREREG) _aTotal[007] := Iif( !(SF3->F3_TIPO$"D/B")  ,UfCodIBGE(SA2->A2_EST)+SA2->A2_COD_MUN , UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN )  
(PREREG) _aTotal[009] := !(aScan( _aTotal[008], Iif( !(SF3->F3_TIPO$"D/B")  ,SA2->A2_CGC , SA1->A1_CGC )   )>0)  
(PREREG) (aAdd(_aTotal[008], Iif( !(SF3->F3_TIPO$"D/B")  ,SA2->A2_CGC , SA1->A1_CGC )   ),.T.) 
(PREREG) (_aTotal[012] := Iif( !(SF3->F3_TIPO$"D/B")  ,SA2->A2_END, SA1->A1_END )  ,.T.)

CABEC      C 002 0 "10" 
CNPJ       C 014 0 SubStr(AllTrim( IIf(!(SF3->F3_TIPO$"D/B"),SA2->A2_CGC,SA1->A1_CGC)   ),01,14)  
TIPOCAD	   C 003 0 Iif( (AllTrim(_aTotal[007])=="08203") , "EIM" , "EFM"  )	                       
INSCMUN	   C 020 0 IIf(!(SF3->F3_TIPO$"D/B"),SA2->A2_INSCRM,SA1->A1_INSCRM)  
RAZAO      C 070 0 IIf(!(SF3->F3_TIPO$"D/B"),SA2->A2_NOME,SA1->A1_NOME) 
NOMEFANT   C 050 0 IIf(!(SF3->F3_TIPO$"D/B"),SA2->A2_NREDUZ,SA1->A1_NREDUZ)  
LOGRAD     C 100 0 AllTrim(SubStr(AllTrim(FisGetEnd(_aTotal[012])[01]),1,100))	 	   
NUMLOGRAD  C 008 0 AllTrim(Iif(","$_aTotal[012],FisGetEnd(_aTotal[012])[3],""))  
COMPLEM    C 050 0 IIf(!(SF3->F3_TIPO$"D/B"),FisGetEnd(SA2->A2_END)[4],FisGetEnd(SA1->A1_END)[4])   
BAIR	   C 070 0 IIf(!(SF3->F3_TIPO$"D/B"),SA2->A2_BAIRRO , SA1->A1_BAIRRO)  
MUNICIPIO  C 100 0 IIf(!(SF3->F3_TIPO$"D/B"),SA2->A2_MUN    , SA1->A1_MUN)   
CEP        C 008 0 IIf(!(SF3->F3_TIPO$"D/B"),SA2->A2_CEP    , SA1->A1_CEP)   
UF         C 002 0 IIf(!(SF3->F3_TIPO$"D/B"),SA2->A2_EST    , SA1->A1_EST)   
TELEFONE   C 010 0 (IIf(!(SF3->F3_TIPO$"D/B"),(Right(AllTrim(SA2->A2_DDD),2)+Space(01)+SA2->A2_TEL) , (Right(AllTrim(SA1->A1_DDD),2)+Space(01)+SA1->A1_TEL) ))
FAX        C 010 0 (IIf(!(SF3->F3_TIPO$"D/B"),(Right(AllTrim(SA2->A2_DDD),2)+Space(01)+SA2->A2_FAX) , (Right(AllTrim(SA1->A1_DDD),2)+Space(01)+SA1->A1_FAX) )) 
EMAIL      C 100 0 AllTrim(IIf(!(SF3->F3_TIPO$"D/B"),SA2->A2_EMAIL,SA1->A1_EMAIL))	
HOMEPG     C 100 0 AllTrim(IIf(!(SF3->F3_TIPO$"D/B"),SA2->A2_HPAGE,SA1->A1_HPAGE))	
CODMUN     C 007 0 AllTrim(IIf(!(SF3->F3_TIPO$"D/B"),UfCodIBGE(SA2->A2_EST)+SA2->A2_COD_MUN,UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN))
(POS) FsQuery (_aTotal[10], 2) 
  
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA 11             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ 
[XXX 01-Dados do Sócio responsável e atividade da empresa]    
(DEL) # M 
(PREREG) ( Alltrim(cEmpAnt)== Alltrim(SM0->M0_CODIGO) .and. Alltrim(_aTotal[017])==Alltrim(SM0->M0_CODFIL))
(PREREG) _aTotal[006] := "S"$AllTrim(_aTotal[098][2][1]) 
CABEC      C 002 0 "11"   
XX1CNPJ    C 014 0 SubStr(AllTrim(SM0->M0_CGC),01,14)
NOME       C 100 0 AllTrim(_aTotal[098][2][03])	
CNPJCPF    C 014 0 AllTrim(_aTotal[098][2][02]) 
LOGRAD     C 100 0 AllTrim(_aTotal[098][2][04])
NUMERO     C 008 0 AllTrim(_aTotal[098][2][05])
COMPLEM    C 050 0 AllTrim(_aTotal[098][2][06])
BAIRRO     C 070 0 AllTrim(_aTotal[098][2][07])
CIDADE     C 070 0 AllTrim(_aTotal[098][2][08])
CEP        C 008 0 AllTrim(_aTotal[098][2][09])
UF         C 002 0 AllTrim(_aTotal[098][2][10])  

        
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA 20 - CABECALHO - SAIDA  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ   
[XXX Movimentos que serao apresentados no periodo]
(PRE) SF3->(dbSetOrder(1))
(PRE) _aTotal[10] := {"SF3",""}
(PRE) _aTotal[031] := SerieNfId("SF3",3,"F3_SERIE")
(PRE) FsQuery(_aTotal[10],1,"F3_FILIAL = '" + _aTotal[017] + "' AND F3_ENTRADA >= '" + DTOS(_aTotal[001]) + "' AND F3_ENTRADA <= '" + DTOS(_aTotal[002]) + "' AND SUBSTRING(F3_CFO,1,1)>= '5' AND (F3_DTCANC = '' OR F3_OBSERV LIKE 'CANCEL$')","F3_FILIAL == '" + _aTotal[017] + "' .AND. DTOS(F3_ENTRADA) >= '" + DTOS(_aTotal[001]) + "' .AND. DTOS(F3_ENTRADA) <= '" + DTOS(_aTotal[002]) + "' .And. substr(F3_CFO,1,1)>='5' .And. (Empty(F3_DTCANC) .Or. 'CANCEL'$F3_OBSERV)","F3_FILIAL+DTOS(F3_ENTRADA)+F3_NFISCAL+F3_SERIE+F3_CLIEFOR+F3_LOJA+F3_CFO",,,"F3_FILIAL, F3_CLIEFOR, F3_LOJA, F3_NFISCAL, F3_SERIE, F3_CFO, F3_ENTRADA, SUM(F3_VALCONT) AS F3_VALCONT, SUM(F3_VALICM) AS F3_VALICM, SUM(F3_BASEICM) AS F3_BASEICM, SUM(F3_ICMSRET) AS F3_ICMSRET, SUM(F3_BASERET) AS F3_BASERET, F3_TIPO, F3_ALIQICM" + Iif(_aTotal[031] == "F3_SDOC"," , F3_SDOC",""),"F3_FILIAL, F3_CLIEFOR, F3_LOJA, F3_NFISCAL, F3_SERIE, F3_CFO, F3_ENTRADA, F3_TIPO, F3_ALIQICM" + Iif(_aTotal[031] == "F3_SDOC"," , F3_SDOC",""))
(PRE) SF3->(dbGoTop())      
(POS)     

[SF3 - Registro Tipo 2 - Nota Fiscal]  
(DEL) # M            
(PRE) SF2->(dbSetOrder(2))
(PRE) SA1->(dbSetOrder(1))  
(PRE) SA2->(dbSetOrder(1))     
(PRE) SC6->(dbSetOrder(4))
(PRE) SC5->(dbSetOrder(1))        
(PREREG) Iif(  !(SF3->F3_TIPO$"D/B") , SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA))  , SA2->(MsSeek(xFilial("SA2")+SF3->F3_CLIEFOR+SF3->F3_LOJA)) )
(PREREG) SF2->(MsSeek(xFilial("SF2")+SF3->F3_CLIEFOR+SF3->F3_LOJA+SF3->F3_NFISCAL+SF3->F3_SERIE))  
(PREREG) ( _aTotal[015] := SC6->(MsSeek(xFilial("SC6")+SF3->F3_NFISCAL+SF3->F3_SERIE)), .T.)    
(PREREG) ( _aTotal[018] := Iif( _aTotal[015] , SC5->(MsSeek(xFilial("SC5")+SC6->C6_NUM)), .F. ) ,.T. )
(PREREG) ( _aTotal[020] := Iif(!(SF3->F3_TIPO$"D/B"),UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN,UfCodIBGE(SA2->A2_EST)+SA2->A2_COD_MUN), .T.)            
(PREREG) ( _aTotal[026] += Iif(SF3->F3_TIPO == 'S' .And. SF3->F3_VALCONT>0, SF3->F3_VALCONT, 0), .T.)
(PREREG) ( _aTotal[022] += Iif(SF3->F3_TIPO <> 'S' .And. SF3->F3_VALCONT>0, SF3->F3_VALCONT, 0), .T.)
(PREREG) ( _aTotal[027] += Iif(SF3->F3_TIPO == 'S' .And. SF3->F3_VALICM>0, SF3->F3_VALICM, 0), .T.)
(PREREG) ( _aTotal[028] += Iif(SF3->F3_TIPO == 'S' .And. SF3->F3_BASEICM>0, SF3->F3_BASEICM, 0), .T.)
(PREREG) ( _aTotal[029] += Iif(SF3->F3_TIPO == 'S' .And. SF3->F3_ICMSRET>0, SF3->F3_ICMSRET, 0), .T.)
(PREREG) ( _aTotal[030] += Iif(SF3->F3_TIPO == 'S' .And. SF3->F3_BASERET>0, SF3->F3_BASERET, 0), .T.)
(PREREG) ( _aTotal[014] := (SF2->F2_VALBRUT),.T.)     
(PREREG) ( _aTotal[021] := (_aTotal[015] .AND. _aTotal[018]),.T.)
(PREREG) (SF3->F3_TIPO == 'S')
(POSREG) (_aTotal[022] := 0)
(POSREG) (_aTotal[026] := 0) 
(POSREG) (_aTotal[027] := 0)
(POSREG) (_aTotal[028] := 0)
(POSREG) (_aTotal[029] := 0)
(POSREG) (_aTotal[030] := 0)
CABEC      C 002 0 "20"   
CNPJ       C 014 0 SubStr(AllTrim(SM0->M0_CGC),01,14) 
SERIE      C 003 0 SerieNfId("SF3",2,"F3_SERIE")                      
NUMNOTA	   C 009 0 RetNf(SF3->F3_NFISCAL,9,"N")
CNPJ       C 014 0 Iif(!(SF3->F3_TIPO$"D/B"), Iif(!Empty(SA1->A1_CGC),SA1->A1_CGC,"9") , Iif(!Empty(SA2->A2_CGC),SA2->A2_CGC,"9") )
DDATENF	   C 010 0 SubStr(AllTrim(DtoS(SF3->F3_ENTRADA)),7,2)+"/"+SubStr(AllTrim(DtoS(SF3->F3_ENTRADA)),5,2)+"/"+SubStr(AllTrim(DtoS(SF3->F3_ENTRADA)),1,4)       
CFPS       N 004 0 0000    
VALISS     C 014 0 Iif((_aTotal[027]>0),AllTrim(STRTran(Transform(_aTotal[027],"@E 999999999.99"),",",".")),"0")     
BASEISS    C 014 0 Iif((_aTotal[028]>0),AllTrim(STRTran(Transform(_aTotal[028],"@E 999999999.99"),",",".")),"0")    
ISSRET     C 014 0 Iif((_aTotal[029]>0),AllTrim(STRTran(Transform(_aTotal[029],"@E 999999999.99"),",",".")),"0") 
BASERET    C 014 0 Iif((_aTotal[030]>0),AllTrim(STRTran(Transform(_aTotal[030],"@E 999999999.99"),",",".")),"0")  
VALSERV    C 014 0 Iif((_aTotal[026]>0),AllTrim(STRTran(Transform(_aTotal[026],"@E 999999999.99"),",",".")),"0")    
VALMERC    C 014 0 Iif((_aTotal[022]>0),AllTrim(STRTran(Transform(_aTotal[022],"@E 999999999.99"),",",".")),"0")  
VTNOTA     C 014 0 Iif((_aTotal[014]>0),AllTrim(STRTran(Transform(_aTotal[014],"@E 999999999.99"),",",".")),"0")  
NTCOPMPL   C 001 0 "N"   
LOCPREST   C 007 0 Iif( _aTotal[021] , Iif( !Empty(SC5->C5_MUNPRES) , AllTrim(SC5->C5_MUNPRES) , _aTotal[020] ) , _aTotal[020]  )
(POS)      
                                                                                         
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA 21 - ITENS - SAIDA     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
{SFT - Registro Tipo 3 - Item de Servico de Nota Fiscal}
(CHV) xFilial("SFT")+SF3->F3_NFISCAL+SF3->F3_SERIE+SF3->F3_CLIEFOR+SF3->F3_LOJA = SFT->(FT_FILIAL+FT_NFISCAL+FT_SERIE+FT_CLIEFOR+FT_LOJA) 
(DEL) # M 
(PRE) SFT->(dbSetOrder(1)) 
(PRE) SX5->(dbSetOrder(1))                                                                                                                      
(PRE) SD2->(dbSetOrder(3)) 
(PRE) (_aTotal[019] := 0)
(PRE) (SFT->(MsSeek(xFilial("SFT")+"S"+SF3->F3_SERIE+SF3->F3_NFISCAL+SF3->F3_CLIEFOR+SF3->F3_LOJA)),.F.)         
(PREREG) (_aTotal[023] := "",.T.)
(PREREG) (Iif(Empty(_aTotal[023]),SX5->(dbSeek(xFilial("SX5")+"60"+SFT->FT_CODISS)),.T.),.T.)
(PREREG) (_aTotal[023] := Iif(Empty(_aTotal[023]),SX5->X5_DESCRI,_aTotal[023]),.T.) 
(PREREG) (_aTotal[024] := AllTrim(SFT->FT_CODISS),.T.)   
(PREREG) (_aTotal[025] := AllTrim(SFT->FT_CSTISS),.T.) 
(PREREG) (_aTotal[019] += 1,.T.)
(PREREG) (!Empty(SFT->FT_CODISS)) 
CABEC      C 002 0 "21"
CNPJ       C 014 0 SubStr(AllTrim(SM0->M0_CGC),01,14)   
SERIE      C 003 0 SerieNfId("SFT",2,"FT_SERIE")
NUMNOTA	   C 009 0 RetNf(SFT->FT_NFISCAL,9,"N")    
ITEMNF     C 010 0 AllTrim(STR(_aTotal[019]))    
DESC       C 240 0 _aTotal[023]    
ALIQISS	   C 006 0 AllTrim(STRTran(Transform(SFT->FT_ALIQICM ,"@E 999.99"),",","."))     
VALORISS   C 014 0 Iif((SFT->FT_VALICM>0),AllTrim(STRTran(Transform(SFT->FT_VALICM ,"@E 999999999.99"),",",".")),"0")  
VALORSERV  C 014 0 Iif((SFT->FT_VALCONT>0),AllTrim(STRTran(Transform(SFT->FT_VALCONT ,"@E 999999999.99"),",",".")),"0")  
CODLISTA   C 004 0 _aTotal[024]
CST        C 002 0 _aTotal[025]
(POS) 

[XXX Movimentos que serao apresentados no periodo]
(POS) FsQuery (_aTotal[10], 2)     

                                              
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA 30 - CABECALHO - ENTRADA³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
[XXX Movimentos que serao apresentados no periodo]
(PRE) _aTotal[10] := {"SF3",""}
(PRE) _aTotal[031] := Iif (SerieNfId("SF3",3,"F3_SERIE") == "F3_SDOC",", MAX(F3_SDOC) F3_SDOC", "")
(PRE) _aTotal[032] := Iif (SerieNfId("SF3",3,"F3_SERIE") == "F3_SDOC",", F3_SDOC", "")
(PRE) FsQuery(_aTotal[10],1,"F3_FILIAL = '" + _aTotal[017] + "' AND F3_ENTRADA >= '" + DTOS(_aTotal[001]) + "' AND F3_ENTRADA <= '" + DTOS(_aTotal[002]) + "' AND SUBSTRING(F3_CFO,1,1) < '5' AND F3_CODISS <> ''  AND (F3_DTCANC = '' OR F3_OBSERV LIKE 'CANCEL$')","F3_FILIAL == '" + _aTotal[017] + "' .AND. DTOS(F3_ENTRADA) >= '" + DTOS(_aTotal[001]) + "' .AND. DTOS(F3_ENTRADA) <= '" + DTOS(_aTotal[002]) + "' .And. substr(F3_CFO,1,1) < '5' .And. !Empty(F3_CODISS) .And. (Empty(F3_DTCANC) .Or. 'CANCEL'$F3_OBSERV) ",,,," MAX(F3_FILIAL) F3_FILIAL, MAX(F3_NFISCAL) F3_NFISCAL, MAX(F3_SERIE) F3_SERIE, MAX(F3_CLIEFOR) F3_CLIEFOR, MAX(F3_LOJA) F3_LOJA, MAX(F3_TIPO) F3_TIPO, MAX(F3_ICMSRET) F3_ICMSRET, MAX(F3_ISENICM) F3_ISENICM, MAX(F3_ENTRADA) F3_ENTRADA, SUM(F3_VALICM) F3_VALICM, SUM(F3_BASEICM) F3_BASEICM, SUM(F3_ICMSRET) F3_ICMSRET, SUM(F3_BASERET) F3_BASERET, SUM(F3_VALCONT) F3_VALCONT" + _aTotal[031]," F3_FILIAL, F3_NFISCAL, F3_SERIE, F3_CLIEFOR, F3_LOJA, F3_TIPO, F3_SERIE, F3_ENTRADA" + _aTotal[032])   
(PRE) SF3->(dbGoTop())      
(POS)   

[SF3 - Registro Tipo 2 - Nota Fiscal]  
(DEL) # M            
(PRE) SF1->(dbSetOrder(1))
(PRE) SA1->(dbSetOrder(1))  
(PRE) SA2->(dbSetOrder(1)) 
(PRE) (_aTotal[022] := 0)            
(PREREG) Iif(  !(SF3->F3_TIPO$"D/B") , SA2->(MsSeek(xFilial("SA2")+SF3->F3_CLIEFOR+SF3->F3_LOJA))  , SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA)) )
(PREREG) SF1->(MsSeek(xFilial("SF1")+SF3->F3_NFISCAL+SF3->F3_SERIE+SF3->F3_CLIEFOR+SF3->F3_LOJA))                                             
(PREREG) ( _aTotal[020] := Iif(!(SF3->F3_TIPO$"D/B"),UfCodIBGE(SA2->A2_EST)+SA2->A2_COD_MUN,UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN)  , .T.)  
(PREREG) ( _aTotal[022] += Iif(SF3->F3_TIPO <> 'S' .And. SF3->F3_VALCONT>0, SF3->F3_VALCONT, 0), .T.)
(PREREG) ( _aTotal[014] := (SF1->F1_VALBRUT)   ,.T.)
(PREREG) (SF3->F3_TIPO == 'S')
(POSREG) (_aTotal[022] := 0)     
CABEC      C 002 0 "30"   
CNPJ       C 014 0 SubStr(AllTrim(SM0->M0_CGC),01,14) 
SERIE      C 003 0 SerieNfId("SF3",2,"F3_SERIE")                      
NUMNOTA	   C 009 0 RetNf(SF3->F3_NFISCAL,9,"N")
CNPJFORN   C 014 0 Iif(!(SF3->F3_TIPO$"D/B"), Iif(!Empty(SA2->A2_CGC),SA2->A2_CGC,"9") , Iif(!Empty(SA1->A1_CGC),SA1->A1_CGC,"9") )
DDATENF	   C 010 0 SubStr(AllTrim(DtoS(SF3->F3_ENTRADA)),7,2)+"/"+SubStr(AllTrim(DtoS(SF3->F3_ENTRADA)),5,2)+"/"+SubStr(AllTrim(DtoS(SF3->F3_ENTRADA)),1,4)       
CFPS       N 004 0 0000    
VALISS     C 014 0 Iif((SF3->F3_VALICM>0),AllTrim(STRTran(Transform(SF3->F3_VALICM ,"@E 999999999.99"),",",".")),"0")     
BASEISS    C 014 0 Iif((SF3->F3_BASEICM>0),AllTrim(STRTran(Transform(SF3->F3_BASEICM,"@E 999999999.99"),",",".")),"0")    
ISSRET     C 014 0 Iif((SF3->F3_ICMSRET>0),AllTrim(STRTran(Transform(SF3->F3_ICMSRET,"@E 999999999.99"),",",".")),"0") 
BASERET    C 014 0 Iif((SF3->F3_BASERET>0),AllTrim(STRTran(Transform(SF3->F3_BASERET,"@E 999999999.99"),",",".")),"0")  
VALSERV    C 014 0 Iif((SF3->F3_VALCONT>0),AllTrim(STRTran(Transform(SF3->F3_VALCONT,"@E 999999999.99"),",",".")),"0")    
VALMERC    C 014 0 Iif((_aTotal[022]>0), AllTrim(STRTran(Transform(_aTotal[022],"@E 999999999.99"),",",".")),"0")
VTNOTA     C 014 0 Iif((_aTotal[014]>0),AllTrim(STRTran(Transform(_aTotal[014],"@E 999999999.99"),",",".")),"0")  
NTCOPMPL   C 001 0 "N" 
LOCPREST   C 007 0 AllTrim(_aTotal[020])    
(POS)          

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA 31 - ITENS - ENTRADA   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
{SFT - Registro Tipo 3 - Item de Servico de Nota Fiscal}
(CHV) xFilial("SFT")+SF3->F3_NFISCAL+SF3->F3_SERIE+SF3->F3_CLIEFOR+SF3->F3_LOJA = SFT->(FT_FILIAL+FT_NFISCAL+FT_SERIE+FT_CLIEFOR+FT_LOJA) 
(DEL) # M 
(PRE) SFT->(dbSetOrder(1))   
(PRE) SFT->(DbGoTop()) 
(PRE) SX5->(dbSetOrder(1))                                                                                                                      
(PRE) SD1->(dbSetOrder(3)) 
(PRE) (_aTotal[019] := 0)
(PRE) (SFT->(MsSeek(xFilial("SFT")+"E"+SF3->F3_SERIE+SF3->F3_NFISCAL+SF3->F3_CLIEFOR+SF3->F3_LOJA)),.F.)         
(PREREG) (_aTotal[023] := "",.T.)
(PREREG) (Iif(Empty(_aTotal[023]),SX5->(dbSeek(xFilial("SX5")+"60"+SFT->FT_CODISS)),.T.),.T.)
(PREREG) (_aTotal[023] := Iif(Empty(_aTotal[023]) .And. (AllTrim(SFT->FT_CODISS) <> ''),SX5->X5_DESCRI,''),.T.) 
(PREREG) (_aTotal[024] := AllTrim(SFT->FT_CODISS),.T.)   
(PREREG) (_aTotal[025] := AllTrim(SFT->FT_CSTISS),.T.) 
(PREREG) (_aTotal[019] += 1,.T.) 
CABEC      C 002 0 "31"
CNPJ       C 014 0 SubStr(AllTrim(SM0->M0_CGC),01,14)   
SERIE      C 003 0 SerieNfId("SFT",2,"FT_SERIE") 
NUMNOTA	   C 009 0 RetNf(SFT->FT_NFISCAL,9,"N")    
ITEMNF     C 010 0 AllTrim(STR(_aTotal[019]))    
CNPJFORN   C 014 0 Iif(!(SF3->F3_TIPO$"D/B"), Iif(!Empty(SA2->A2_CGC),SA2->A2_CGC,"9") , Iif(!Empty(SA1->A1_CGC),SA1->A1_CGC,"9") )
DESC       C 240 0 _aTotal[023]    
ALIQISS	   C 006 0 AllTrim(STRTran(Transform(SFT->FT_ALIQICM ,"@E 999.99"),",","."))     
VALORISS   C 014 0 Iif((SFT->FT_VALICM>0),AllTrim(STRTran(Transform(SFT->FT_VALICM ,"@E 999999999.99"),",",".")),"0")  
VALORSERV  C 014 0 Iif((SFT->FT_VALCONT>0),AllTrim(STRTran(Transform(SFT->FT_VALCONT ,"@E 999999999.99"),",",".")),"0")  
CODLISTA   C 004 0 _aTotal[024]
CST        C 002 0 _aTotal[025]
(POS) 


[XXX Movimentos que serao apresentados no periodo]
(POS) FsQuery (_aTotal[10], 2)     

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA 50 - ITENS - SAIDA     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  
[XXX Movimentos que serao apresentados no periodo]
(PRE) _aTotal[10] := {"SF3",""}
(PRE) FsQuery(_aTotal[10],1,"F3_FILIAL = '" + _aTotal[017] + "' AND F3_ENTRADA >= '" + DTOS(_aTotal[001]) + "' AND F3_ENTRADA <= '" + DTOS(_aTotal[002]) + "' AND F3_CODISS <> ''  AND (F3_DTCANC <> '' OR F3_OBSERV LIKE 'CANCEL$')","F3_FILIAL == '" + _aTotal[017] + "' .AND. DTOS(F3_ENTRADA) >= '" + DTOS(_aTotal[001]) + "' .AND. DTOS(F3_ENTRADA) <= '" + DTOS(_aTotal[002]) + "' .And. !Empty(F3_CODISS) .And. !(Empty(F3_DTCANC) .Or. 'CANCEL'$F3_OBSERV)",SF3->(IndexKey()))
(PRE) SF3->(dbGoTop())      
(POS)    

[SF3 - Registro Tipo 2 - Nota Fiscal]  
(DEL) # M              
CABEC      C 002 0 "50"   
CNPJ       C 014 0 SubStr(AllTrim(SM0->M0_CGC),01,14) 
SERIE      C 003 0 SerieNfId("SF3",2,"F3_SERIE")                      
NUMNOTA	   C 009 0 RetNf(SF3->F3_NFISCAL,9,"N")    
TIPO       C 010 0 "CANCELADA"
DDATENF	   C 010 0 SubStr(AllTrim(DtoS(SF3->F3_DTCANC)),7,2)+"/"+SubStr(AllTrim(DtoS(SF3->F3_DTCANC)),5,2)+"/"+SubStr(AllTrim(DtoS(SF3->F3_DTCANC)),1,4)
OBS        C 200 0 AllTrim(SF3->F3_OBSERV)  
(POS)      


[XXX Movimentos que serao apresentados no periodo]
(POS) FsQuery (_aTotal[10], 2) 

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ TABELA 60 - ITENS - SAIDA     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  
[XXX 01-Tabela de informações econômicas (Anuais)] 
(DEL) # M                                                                                          
(PREREG) ( Alltrim(cEmpAnt)== Alltrim(SM0->M0_CODIGO) .and.  Alltrim(_aTotal[017])== Alltrim(SM0->M0_CODFIL))
(PREREG) _aTotal[005] := "S"$AllTrim(_aTotal[098][3][1]) 
CABEC      C 002 0 "60"       
CNPJ       C 014 0 SubStr(AllTrim(SM0->M0_CGC),01,14)
ANO        C 004 0 _aTotal[098][3][2]  
TOTDESP    C 014 0 StrTran(_aTotal[098][3][3],",",".") 
OUTREC     C 014 0 StrTran(_aTotal[098][3][4],",",".")
VLATV      C 014 0 StrTran(_aTotal[098][3][5],",",".") 
VLPASS     C 014 0 StrTran(_aTotal[098][3][6],",",".") 
PATRIM     C 014 0 StrTran(_aTotal[098][3][7],",",".") 
CAPIT      C 014 0 StrTran(_aTotal[098][3][8],",",".") 
NUM01      C 010 0 _aTotal[098][3][9]
NUM31      C 010 0 _aTotal[098][3][10]
   
(POS)     
