?{"Nome do Arquivo INI","AUDITFIS.INI"}
?{"Descricao Completa do Arquivo Magnetico","Geração dos arquivos para integração com a sistema da SOFTTEAM de validação de dados para o SPED Fiscal"}
?{"Objetivo","Compartilhamento de informações fiscais com o sistema da SOFTTEAM."}
?{"Aplicativo Disponibilizado","Não há"}                                                                 

[XXX Verificando perguntas da rotina]
//Recupera o MV_PAR quando processadas varias filiais
(PRE) Pergunte("MTA950",.F.)
(PRE) lExitPFil	:= IIf(lAglFil, .T., .F.)
(PRE) _aTotal[100]:= cFilAnt
(PRE) _aTotal[77] := {"INV",""}
(PRE) SA1->(dbSetOrder(1))
(PRE) SA2->(dbSetOrder(1))
(PRE) SA4->(dbSetOrder(1))
(PRE) DA3->(dbSetOrder(1))
(PRE) SB1->(dbSetOrder(1))
(PRE) SF4->(dbSetOrder(1))
(PRE) SF3->(dbSetOrder(1))
(PRE) SFT->(dbSetOrder(1))
(PRE) SF1->(dbSetOrder(1))
(PRE) SF2->(dbSetOrder(1))
(PRE) SD1->(dbSetOrder(1))
(PRE) SD2->(dbSetOrder(3))
(PRE) SE4->(dbSetOrder(1))
//Nome geral dos Arquivos de cada Sessao
(PRE) _aTotal[30] := Right(Str(Year(MV_PAR02),4),2)+StrZero(Month(MV_PAR02),2)+"00"+cEmpAnt+"00"+cFilAnt
//Nome geral dos Arquivos de cada Sessao
(PRE) _aTotal[55] := {}
(PRE) _aTotal[56] := {}
(PRE) _aTotal[57] := {}


//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Documentos Fiscais (cabeçalho e itens)  (bloco C)            ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

[SF2 NOTAS FISCAIS - MESTRE SAIDAS]
(ARQ) _aTotal[30]+".301"
(PRE) _aTotal[90] := {"SF2",""}
(PRE) _aTotal[91] := "F2_FILIAL='"+xFilial("SF2")+"' AND F2_EMISSAO>='"+ DTOS(MV_PAR01) +"' AND F2_EMISSAO<='"+ DTOS(MV_PAR02)+"'"
(PRE) _aTotal[98] := "F2_FILIAL+F2_CLIENTE+F2_LOJA+F2_DOC+F2_SERIE"
(PRE) _aTotal[99] := "F2_FILIAL=='"+ xFilial("SF2") +"' .And. DTOS(F2_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(F2_EMISSAO)<='"+ DTOS(MV_PAR02) +"'"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],_aTotal[98],,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SF2->F2_FILIAL),cFilAnt,SF2->F2_FILIAL)
(PREREG) (SF3->(MsSeek(xFilial('SF2')+DTOS(SF2->F2_EMISSAO)+SF2->F2_DOC+SF2->F2_SERIE+SF2->F2_CLIENTE+SF2->F2_LOJA)))
(PREREG) (SFT->(MsSeek(xFilial('SF2')+"S"+SF2->F2_SERIE+SF2->F2_DOC+SF2->F2_CLIENTE+SF2->F2_LOJA)))
(PREREG) (IiF(SF3->F3_TIPO$"DB",SA2->(MsSeek(xFilial("SA2")+SF3->F3_CLIEFOR+SF3->F3_LOJA)),SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA))))
(PREREG) (_aTotal[51] := SA4->(MsSeek(xFilial("SA4")+SF2->F2_TRANSP)),.T.)
(PREREG) (_aTotal[52] := DA3->(MsSeek(xFilial("DA3")+SF2->F2_VEICUL1)),.T.)
(PREREG) (_aTotal[53] := SE4->(MsSeek(xFilial("SE4")+SF2->F2_COND)),.T.)
Indica_Mov C 001 0 "S"
Desativado C 003 0 ""
Serie      C 005 0 SerieNfId("SF2",2,"F2_SERIE")
NroDoc     C 012 0 Replicate("0",12-len(Alltrim(SF2->F2_DOC))) + Alltrim(SF2->F2_DOC)
DtEmissao  C 008 0 FormDate(SF2->F2_EMISSAO,.F.)
Categoria  C 002 0 IIF(SF3->F3_TIPO$"DB"," 2"," 1")
CodPartic  C 014 0 IIf(SF3->F3_TIPO$"DB",SA2->A2_CGC,SA1->A1_CGC)
Desativado C 001 0 0
ModeloDoc  C 003 0 AModNot(SF3->F3_ESPECIE)
DtMovimto  C 008 0 FormDate(SF2->F2_EMISSAO,.F.)
VlrTtlProd N 017 2 SF2->F2_VALMERC
VlrTotalNF N 017 2 SF2->F2_VALBRUT
VlrDescont N 017 2 SF2->F2_DESCONT
NoDocRef   C 012 0 Replicate("0",12-len(Alltrim(SF2->F2_NFORI))) + Alltrim(SF2->F2_NFORI)
SerieRef   C 005 0 SerieNfId("SF2",2,"F2_SERIORI")   
VlrBaseIPI N 017 2 SF2->F2_BASEIPI
VlrTtlIPI  N 017 2 SF2->F2_VALIPI
InscSubTri C 014 0 IIF(SF3->F3_ICMSRET>0,IESubTrib(SF3->F3_ESPECIE),"")
ObsICMS    C 045 0 SF3->F3_OBSERV
ContribFin C 001 0 IiF(SF3->F3_TIPO$"DB","N",IIF(SA1->A1_TIPO=="F","S","N"))
CancelarNF C 001 0 If(!Empty(SF3->F3_DTCANC),"S","N")
VlrTtlFret N 017 2 SF2->F2_FRETE
VlrTtlSegu N 017 2 SF2->F2_SEGURO
OutrosVals N 017 2 SF2->F2_DESPESA
UF         C 002 0 SF2->F2_EST
Desativado N 006 0 0
DataVecmto C 008 0 FormDate(SF2->F2_EMISSAO,.F.)
TipoNota   C 003 0 SPACE(3)
ViaTransp  C 015 0 SPACE(1)
CodTransp  C 014 0 IIF(_aTotal[51],SA4->A4_CGC,SPACE(14))
QtdeVolume N 017 2 SF2->F2_VOLUME1
EspecieVol C 010 0 SF2->F2_ESPECI1
PesoBruto  N 017 2 SF2->F2_PBRUTO
PesoLiquid N 017 2 SF2->F2_PLIQUI
ModalFrete C 003 0 IIF(SF2->F2_FRETE>0,"CIF","FOB")
PlacaVeic  C 015 0 IIF(_aTotal[52],DA3->DA3_PLACA,SPACE(15))
TipoFatura C 001 0 IIF(_aTotal[53],If(Alltrim(SE4->E4_COND)=="0","1","2"),"9")
Desativado C 011 0 "00000000000"
Desativado C 012 0 "000000000000"
Desativado C 010 0 "0000000000"
Emissao    C 001 0 IF(SF2->F2_FORMUL=="N","T","P")
Grupo      N 006 0 0
Tipo       N 001 0 0
VlrBaseICM N 015 2 SF2->F2_BASEICM
ValorICMS  N 015 2 SF2->F2_VALICM
Desfazimto C 001 0 SPACE(1)
ContribICM C 001 0 IiF(SF3->F3_TIPO$"DB",IIF(Empty(SA2->A2_INSCR),"N","S"),IIF(Empty(SA1->A1_INSCR),"N","S"))
VlrBaseST  N 015 2 SF3->F3_BASERET
ValorST    N 015 2 SF3->F3_ICMSRET
DtInterZFM C 008 0 SPACE(8)
ObsInteZFM C 010 0 SPACE(10)
NFE        C 044 0 SF2->F2_CHVNFE
DataSaida  C 008 0 FormDate(SF2->F2_EMISSAO,.F.)
Desativado N 002 0 0
CodSituac  C 002 0 SPEDSitDoc(,"SFT")
VlrTtlPIS  N 015 2 SF2->F2_VALPIS
VlrTtlCOFI N 015 2 SF2->F2_VALCOFI
VlrTlPISST N 015 2 SF2->F2_VALPS3
VlrTCOFIST N 015 2 SF2->F2_VALCF3
VlrAbatmto N 015 2 SF3->F3_DESCZFR
ICMSFundoP N 015 2 SF3->F3_VALFECP
ProgZero   C 001 0 IIF(SF3->F3_TIPO$"DB",IIF(SA2->A2_FOMEZER=="1","S","N"),IIF(SA1->A1_FOMEZER=="1","S","N"))
NomeMestre C 020 0 SPACE(20)
Desativado C 025 0 ""
CodigoObs  C 006 0 SPACE(6)
CodMunicip C 007 0 IIF( SF3->F3_TIPO$"DB" , UfCodIBGE(SA2->A2_EST)+SA2->A2_COD_MUN , UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN )
CodInfComp C 006 0 SPACE(6)     
LancCont   C 030 0 SF3->F3_LANCAM
ContaContb C 030 0 SF3->F3_CONTA      
DescAtoDec C 050 0 ""
Desativado C 032 0 ""
Desativado C 001 0 ""
Desativado N 001 0 0
Desativado C 050 0 ""
SiglaUFpla C 002 0 Posicione("DA3",1,xFilial("DA3")+SF2->F2_VEICUL1,"DA3->DA3_ESTPLA")
TipoDoc	   C 005 0 SF3->F3_ESPECIE
(POSREG) IIF( SF3->F3_TIPO$"DB",AADD(_aTotal[55],"SA2"+xFilial('SA2')+SF2->F2_CLIENTE+SF2->F2_LOJA),AADD(_aTotal[55],"SA1"+xFilial('SA1')+SF2->F2_CLIENTE+SF2->F2_LOJA))
(POSREG) Iif(_aTotal[51],AADD(_aTotal[56],SA4->A4_COD),"")
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt	:= _aTotal[100]


[SFT NOTAS FISCAIS - ITENS SAIDAS]
(ARQ) _aTotal[30]+".303"
(PRE) _aTotal[90] := {"SFT",""}
(PRE) _aTotal[91] := "FT_FILIAL='"+ xFilial("SFT") +"' AND FT_EMISSAO>='"+DTOS(MV_PAR01)+"' AND FT_EMISSAO<='"+DTOS(MV_PAR02)+"' AND FT_TIPOMOV = 'S' AND FT_TIPO <> 'S' AND FT_ESPECIE <> 'CF'"
(PRE) _aTotal[99] := "FT_FILIAL=='"+ xFilial("SFT") +"' .And. DTOS(FT_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(FT_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. FT_TIPOMOV == 'S' .And. FT_TIPO != 'S' .And. FT_ESPECIE <> 'CF'"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],SFT->(IndexKey()),,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SFT->FT_FILIAL),cFilAnt,SFT->FT_FILIAL)
(PREREG) (SB1->(MsSeek(xFilial("SB1")+SFT->FT_PRODUTO)))
(PREREG) (SD2->(MsSeek(xFilial("SD2")+SFT->FT_NFISCAL+SFT->FT_SERIE+SFT->FT_CLIEFOR+SFT->FT_LOJA+SFT->FT_PRODUTO+SFT->FT_ITEM)))
(PREREG) (SF4->(MsSeek(xFilial("SF4")+SD2->D2_TES)))
(PREREG) (IIF(SFT->FT_TIPO$"DB",SA2->(MsSeek(xFilial("SA2")+SFT->FT_CLIEFOR+SFT->FT_LOJA)),SA1->(MsSeek(xFilial("SA1")+SFT->FT_CLIEFOR+SFT->FT_LOJA))),.T.)
Indica_Mov C 001 0 "S"
Desativado C 003 0 ""
Serie      C 005 0 SerieNfId("SFT",2,"FT_SERIE")
Numero_Doc C 012 0 Replicate("0",12-len(Alltrim(SFT->FT_NFISCAL))) + Alltrim(SFT->FT_NFISCAL)
DtEmissao  C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
Categoria  C 002 0 IIF(SFT->FT_TIPO$"DB"," 2"," 1")
CodPartic  C 014 0 If(SFT->FT_TIPO$"DB",SA2->A2_CGC,SA1->A1_CGC)
NrSeqItem  N 005 0 Val(SFT->FT_ITEM)
Desativado C 020 0 ""
UnidVenda  C 003 0 SB1->B1_UM   
Descricao  C 045 0 SB1->B1_DESC
CentroCust C 028 0 SD2->D2_CCUSTO
CFOP       C 003 0 Left(SFT->FT_CFOP,3)
NaturezaOp C 010 0 SD2->D2_TES
NCMClasFis C 010 0 SFT->FT_POSIPI
UnidMedida C 003 0 SD2->D2_UM
Quantidade N 017 5 SFT->FT_QUANT
PesoLiquid N 015 3 SD2->D2_PESO
PrecoUnit  N 017 4 SFT->FT_PRCUNIT
PrecoTotal N 017 2 (SFT->FT_QUANT * SFT->FT_PRCUNIT)
ValorDesc  N 017 2 SFT->FT_DESCONT
NoRomaneio C 012 0 SPACE(12)
DtRomaneio C 008 0 SPACE(8)
ValorFrete N 017 2 SD2->D2_VALFRE
VlrSeguro  N 017 2 SD2->D2_SEGURO
OutrosVals N 017 2 SD2->D2_DESPESA
Desativado C 001 0 "0"
IndicFed   C 001 0 If(SF4->F4_LFIPI=="T","1",If(SF4->F4_LFIPI$"I","2","3"))
AliqIPI	   N 007 4 SFT->FT_ALIQIPI
BaseIPI    N 017 2 SFT->FT_BASEIPI
ValorIPI   N 017 2 SFT->FT_VALIPI
SituaTrib1 C 001 0 Left(SFT->FT_CLASFIS,1)
SituaTrib2 C 001 0 Substr(SFT->FT_CLASFIS,2,1)
IndicICMS  C 001 0 If(SF4->F4_LFICM=="T","1",If(SF4->F4_LFICM$"I","2","3"))
AliqICMS   N 007 4 SFT->FT_ALIQICM
BaseICMS   N 017 2 SFT->FT_BASEICM
ValorICMS  N 017 2 SFT->FT_VALICM
BaseST     N 017 2 SFT->FT_BASERET
ValorST    N 017 2 SFT->FT_ICMSRET
VlrRedICMS N 017 2 IIf(SFT->FT_BASEICM>0 .And. SFT->FT_OUTRICM>0,SFT->FT_OUTRICM,0)
Desativado C 007 0 "0000000"
Desativado C 010 0 "0000000000"
IsentoIPI  N 017 2 SFT->FT_ISENIPI
OutrasIPI  N 017 2 SFT->FT_OUTRIPI
IsentoICM  N 017 2 SFT->FT_ISENICM
OutrosICM  N 017 2 IIf(SFT->FT_BASEICM==0 .And. SFT->FT_OUTRICM>0,SFT->FT_OUTRICM,0)
CompleCFOP C 002 0 Substr(SFT->FT_CFOP,4,2)
IPINaoDeb  N 017 2 0
Desativado N 017 2 0
Desativado N 017 2 0
SituaTrib3 C 001 0 Right(SFT->FT_CLASFIS,1)
Grupo      N 006 0 0
Tipo       N 001 0 0
DataSaida  C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
MoviFisica C 001 0 SF4->F4_ESTOQUE
CodAntecip C 001 0 SPACE(1)
NumeroLote C 020 0 SD2->D2_LOTECTL
IndicApura C 001 0 "0"
SitTribIPI C 003 0 "0"+SFT->FT_CTIPI
CodEnqIPI  C 003 0 SPACE(3)
AliqSubs   N 007 4 SFT->FT_ALIQICM
SituacTrib C 006 0 SFT->FT_CSTPIS
AliqPIS    N 007 4 SFT->FT_ALIQPIS
BasePIS    N 015 2 SFT->FT_BASEPIS
ValorPIS   N 015 2 SFT->FT_VALPIS
ValorPIS2  N 015 2 SB1->B1_VLR_PIS
QuantidPIS N 015 2 IIF(SB1->B1_VLR_PIS>0,SFT->FT_QUANT,0)
SituaCOFIN C 006 0 SFT->FT_CSTCOF
AliqCOFINS N 007 4 SFT->FT_ALIQCOF
BaseCOFINS N 015 2 SFT->FT_BASECOF
ValorCOFIN N 015 2 SFT->FT_VALCOF
ValorCOFI2 N 015 2 SB1->B1_VLR_COF
QuantCOFIN N 015 2 IIF(SB1->B1_VLR_COF>0,SFT->FT_QUANT,0)
AliqICMSST N 007 4 SFT->FT_ALIQICM
Desativado C 025 0 SFT->FT_CONTA
CodSeloIPI C 006 0 IIF(SB1->B1_SELO=="1" .And. SF4->F4_SELO=="1",SB1->B1_CLASSE,SPACE(6))
QtdSeloIPI N 012 3 IIF(SB1->B1_SELO=="1" .And. SF4->F4_SELO=="1",SFT->FT_QUANT,0)
VltUnidIPI N 015 2 SB1->B1_VLR_IPI
QtdUnidIPI N 017 4 IIF(SB1->B1_VLR_IPI>0,SFT->FT_QUANT,0)
BaseSTInte N 015 2 0
ICMSSTInte N 015 2 0
ICMSSTComp N 015 2 0
ConNTCIAP  C 001 0 SPACE(1)
ConNFCIAP  C 001 0 SF4->F4_CIAP
TpProdut   C 001 0 SPACE(1)
CodDProd   N 005 0 0
ClEnqIPI   N 005 0 0
CodProduto C 060 0 SFT->FT_PRODUTO
ContaContb C 030 0 SFT->FT_CONTA                  
Desativado C 012 0 ""
Desativado N 002 0 0
Desativado N 006 0 0
Desativado N 017 3 0
TipoDoc	   C 005 0 SFT->FT_ESPECIE
(POSREG) AADD(_aTotal[57],SFT->FT_PRODUTO)
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]
                            

[SF1 NOTAS FISCAIS - MESTRE ENTRADAS]
(ARQ) _aTotal[30]+".310"
(PRE) _aTotal[90] := {"SF1",""}
(PRE) _aTotal[91] := "F1_FILIAL='"+xFilial("SF1")+"' AND F1_DTDIGIT>='"+ DTOS(MV_PAR01) +"' AND F1_DTDIGIT<='"+ DTOS(MV_PAR02) +"'"
(PRE) _aTotal[98] := "F1_FILIAL+F1_FORNECE+F1_LOJA+F1_DOC+F1_SERIE"
(PRE) _aTotal[99] := "F1_FILIAL=='"+ xFilial("SF1") +"' .And. DTOS(F1_DTDIGIT)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(F1_DTDIGIT)<='"+ DTOS(MV_PAR02) +"'"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],_aTotal[98],,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SF1->F1_FILIAL),cFilAnt,SF1->F1_FILIAL)
(PREREG) (SF3->(MsSeek(xFilial("SF3")+DTOS(SF1->F1_DTDIGIT)+SF1->F1_DOC+SF1->F1_SERIE+SF1->F1_FORNECE+SF1->F1_LOJA)))
(PREREG) (IiF(!SF3->F3_TIPO$"DB",SA2->(MsSeek(xFilial("SA2")+SF3->F3_CLIEFOR+SF3->F3_LOJA)),SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA))))
(PREREG) (SFT->(MsSeek(xFilial("SFT")+"E"+SF1->F1_SERIE+SF1->F1_DOC+SF1->F1_FORNECE+SF1->F1_LOJA)))
(PREREG) (_aTotal[51] := SA4->(MsSeek(xFilial("SA4")+SF1->F1_TRANSP)),.T.)
(PREREG) (_aTotal[53] := SE4->(MsSeek(xFilial("SE4")+SF1->F1_COND)),.T.)
Indica_Mov C 001 0 "E"
Desativado C 003 0 ""
Serie      C 005 0 SerieNfId("SF1",2,"F1_SERIE")
NroDoc     C 012 0 Replicate("0",12-len(Alltrim(SF1->F1_DOC))) + Alltrim(SF1->F1_DOC)
DtEmissao  C 008 0 FormDate(SF1->F1_EMISSAO,.F.)
Categoria  C 002 0 IIF(!SF3->F3_TIPO$"DB"," 2"," 1")
CodPartic  C 014 0 IIf(!SF3->F3_TIPO$"DB",SA2->A2_CGC,SA1->A1_CGC)
Desativado C 001 0 0
ModeloDoc  C 003 0 AModNot(SF3->F3_ESPECIE)
DtMovimto  C 008 0 FormDate(SF1->F1_DTDIGIT,.F.)
VlrTtlProd N 017 2 SF1->F1_VALMERC
VlrTotalNF N 017 2 SF1->F1_VALBRUT
VlrDescont N 017 2 SF1->F1_DESCONT
NoDocRef   C 012 0 SF1->F1_NFORIG
SerieRef   C 005 0 SerieNfId("SF1",2,"F1_SERORIG")  
Desativado N 012 0 0
VlrBaseIPI N 017 2 SF1->F1_BASEIPI
VlrTtlIPI  N 017 2 SF1->F1_VALIPI
InscSubTri C 014 0 IIF(SF3->F3_ICMSRET>0,IESubTrib(SF3->F3_ESPECIE),"")
ObsICMS    C 045 0 SF3->F3_OBSERV
ContribFin C 001 0 IiF(!SF3->F3_TIPO$"DB","N",IIF(SA1->A1_TIPO=="F","S","N"))
VlrTtlFret N 017 2 SF1->F1_FRETE
VlrTtlSegu N 017 2 SF1->F1_SEGURO
OutrosVals N 017 2 SF1->F1_DESPESA
UF         C 002 0 SF1->F1_EST
Desativado N 006 0 0
DataVecmto C 008 0 FormDate(SF1->F1_EMISSAO,.F.)
TipoNota   C 003 0 SPACE(3)
ViaTransp  C 015 0 SPACE(1)
CodTransp  C 014 0 IIF(_aTotal[51],SA4->A4_CGC,SPACE(14))
QtdeVolume N 017 2 SF1->F1_VOLUME1
EspecieVol C 010 0 SF1->F1_ESPECI1
PesoBruto  N 017 2 SF1->F1_PBRUTO
PesoLiquid N 017 2 SF1->F1_PLIQUI
ModalFrete C 003 0 IIF(SF1->F1_FRETE>0,"CIF","FOB")
PlacaVeic  C 015 0 SPACE(15)
TipoFatura C 001 0 IIF(_aTotal[53],If(Alltrim(SE4->E4_COND)=="0","1","2"),"9")
Desativado C 011 0 "00000000000"
Desativado C 012 0 "000000000000"
Desativado C 010 0 "0000000000"
Emissao    C 001 0 IF(SF1->F1_FORMUL=="N","T","P")
Grupo      N 006 0 0
Tipo       N 001 0 0
CancelarNF C 001 0 If(!Empty(SF3->F3_DTCANC),"S","N")
ValorICMS  N 015 2 SF1->F1_VALICM
Desfazimto C 001 0 SPACE(1)
VlrBaseST  N 015 2 SF3->F3_BASERET
ValorST    N 015 2 SF3->F3_ICMSRET
DtInterZFM C 008 0 SPACE(8)
ObsInteZFM C 010 0 SPACE(10)
NFE        C 044 0 SF1->F1_CHVNFE
Desativado N 002 0 0
CodSituac  C 002 0 SPEDSitDoc(,"SFT")
VlrTtlPIS  N 015 2 SF1->F1_VALPIS
VlrTtlCOFI N 015 2 SF1->F1_VALCOFI
VlrTlPISST N 015 2 SF1->F1_VALPS3
VlrTCOFIST N 015 2 SF1->F1_VALCF3
VlrAbatmto N 015 2 SF3->F3_DESCZFR
VlrBaseIC  N 015 2 SF3->F3_BASEICM
Desativado C 025 0 ""
CodigoObs  C 006 0 SPACE(6)
CodMunicip C 007 0 IIF(!SF3->F3_TIPO$"DB" , UfCodIBGE(SA2->A2_EST)+SA2->A2_COD_MUN , UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN )
CodIfCmple C 006 0 SPACE(6)
LancContab C 030 0 SF3->F3_LANCAM
ContaContb C 030 0 SF3->F3_CONTA
Desativado C 010 0 ""
Desativado C 032 0 ""
Desativado C 001 0 ""
Desativado N 001 0 0
Desativado C 050 0 ""
Desativado C 022 0 ""
TipoDoc	   C 005 0 SF3->F3_ESPECIE
(POSREG) IIF( SF3->F3_TIPO$"DB",AADD(_aTotal[55],"SA1"+xFilial('SA1')+SF1->F1_FORNECE+SF1->F1_LOJA),AADD(_aTotal[55],"SA2"+xFilial('SA2')+SF1->F1_FORNECE+SF1->F1_LOJA))
(POSREG) Iif(_aTotal[51],AADD(_aTotal[56],SA4->A4_COD),"")
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[SFT NOTAS FISCAIS - ITENS ENTRADAS]
(ARQ) _aTotal[30]+".311"
(PRE) _aTotal[90] := {"SFT",""}
(PRE) _aTotal[91] := "FT_FILIAL='"+ xFilial("SFT") +"' AND FT_EMISSAO>='"+DTOS(MV_PAR01)+"' AND FT_EMISSAO<='"+DTOS(MV_PAR02)+"' AND FT_TIPOMOV = 'E' AND FT_TIPO <> 'S' AND FT_ESPECIE <> 'CF'"
(PRE) _aTotal[99] := "FT_FILIAL=='"+ xFilial("SFT") +"' .And. DTOS(FT_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(FT_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. FT_TIPOMOV == 'E' .And. FT_TIPO != 'S' .And. FT_ESPECIE <> 'CF'"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],SFT->(IndexKey()),,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SFT->FT_FILIAL),cFilAnt,SFT->FT_FILIAL)
(PREREG) (SB1->(MsSeek(xFilial("SB1")+SFT->FT_PRODUTO)))
(PREREG) (SD1->(MsSeek(xFilial("SD1")+SFT->FT_NFISCAL+SFT->FT_SERIE+SFT->FT_CLIEFOR+SFT->FT_LOJA+SFT->FT_PRODUTO+SFT->FT_ITEM)))
(PREREG) (SF4->(MsSeek(xFilial("SF4")+SD1->D1_TES)))
(PREREG) (IIF(!SFT->FT_TIPO$"DB",SA2->(MsSeek(xFilial("SA2")+SFT->FT_CLIEFOR+SFT->FT_LOJA)),SA1->(MsSeek(xFilial("SA1")+SFT->FT_CLIEFOR+SFT->FT_LOJA))),.T.)
Indica_Mov C 001 0 "E"
Desativado C 003 0 ""
Serie      C 005 0 SerieNfId("SFT",2,"FT_SERIE")
Numero_Doc C 012 0 Replicate("0",12-len(Alltrim(SFT->FT_NFISCAL))) + Alltrim(SFT->FT_NFISCAL)
DtEmissao  C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
Categoria  C 002 0 IIF(!SFT->FT_TIPO$"DB"," 2"," 1")
CodPartic  C 014 0 IIf(!SFT->FT_TIPO$"DB",SA2->A2_CGC,SA1->A1_CGC)
NrSeqItem  N 005 0 Val(SFT->FT_ITEM)
Desativado C 020 0 ""
UnidVenda  C 003 0 SB1->B1_UM
Descricao  C 045 0 SB1->B1_DESC
CentroCust C 028 0 SD1->D1_CC
CFOP       C 003 0 Left(SFT->FT_CFOP,3)
NCMClasFis C 010 0 SFT->FT_POSIPI
NaturezaOp C 010 0 SD1->D1_TES
UnidMedida C 003 0 SD1->D1_UM
Quantidade N 017 5 SFT->FT_QUANT
PesoLiquid N 015 3 SD1->D1_PESO
PrecoUnit  N 017 4 SFT->FT_PRCUNIT
PrecoTotal N 017 2 (SFT->FT_QUANT * SFT->FT_PRCUNIT)
ValorDesc  N 017 2 SFT->FT_DESCONT
NoRomaneio C 012 0 ""
DtRomaneio C 008 0 SPACE(8)
ValorFrete N 017 2 SD1->D1_VALFRE
VlrSeguro  N 017 2 SD1->D1_SEGURO
OutrosVals N 017 2 SD1->D1_DESPESA
Desativado C 001 0 "0"
IndicFed   C 001 0 If(SF4->F4_LFIPI=="T","1",If(SF4->F4_LFIPI$"I","2","3"))
AliqIPI	   N 007 4 SFT->FT_ALIQIPI
BaseIPI    N 017 2 SFT->FT_BASEIPI
ValorIPI   N 017 2 SFT->FT_VALIPI
SituaTrib1 C 001 0 Left(SFT->FT_CLASFIS,1)
SituaTrib2 C 001 0 Substr(SFT->FT_CLASFIS,2,1)
IndicICMS  C 001 0 If(SF4->F4_LFICM=="T","1",If(SF4->F4_LFICM$"I","2","3"))
AliqICMS   N 007 4 SFT->FT_ALIQICM
BaseICMS   N 017 2 SFT->FT_BASEICM
ValorICMS  N 017 2 SFT->FT_VALICM
BaseST     N 017 2 SFT->FT_BASERET
ValorST    N 017 2 SFT->FT_ICMSRET
VlrRedICMS N 017 2 IIf(SFT->FT_BASEICM>0 .And. SFT->FT_OUTRICM>0,SFT->FT_OUTRICM,0)
Desativado C 007 0 SPACE(7)
Desativado C 010 0 SPACE(10)
IsentoIPI  N 017 2 SFT->FT_ISENIPI
OutrasIPI  N 017 2 SFT->FT_OUTRIPI
IsentoICM  N 017 2 SFT->FT_ISENICM
OutrosICM  N 017 2 IIf(SFT->FT_BASEICM==0 .And. SFT->FT_OUTRICM>0,SFT->FT_OUTRICM,0)
IPINaoCre  N 017 2 0
VlrDifAlq  N 017 2 SFT->FT_ICMSCOM
AlqDifer   N 007 4 0
DatEntrada C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
CompleCFOP C 002 0 Substr(SFT->FT_CFOP,4,2)
BaseDifere N 017 2 0
Desativado N 017 2 0
Desativado N 017 2 0
ICMSNaoCre N 017 2 0
AliqICMSNC N 011 4 0
SituaTrib3 C 001 0 Right(SFT->FT_CLASFIS,1)
Grupo      N 006 0 0
Tipo       N 001 0 0
MoviFisica C 001 0 SF4->F4_ESTOQUE
CodAntecip C 001 0 SPACE(1)
IndicApura C 001 0 "0"
SitTribIPI C 003 0 SFT->FT_CTIPI
CodEnqIPI  C 003 0 SPACE(3)
AliqSubs   N 007 4 SFT->FT_ALIQICM
SituacTrib C 006 0 SFT->FT_CSTPIS
AliqPIS    N 007 4 SFT->FT_ALIQPIS
BasePIS    N 015 2 SFT->FT_BASEPIS
ValorPIS   N 015 2 SFT->FT_VALPIS
ValorPIS2  N 015 2 SB1->B1_VLR_PIS
QuantidPIS N 015 2 IIF(SB1->B1_VLR_PIS>0,SFT->FT_QUANT,0)
SituaCOFIN C 006 0 SFT->FT_CSTCOF
AliqCOFINS N 007 4 SFT->FT_ALIQCOF
BaseCOFINS N 015 2 SFT->FT_BASECOF
ValorCOFIN N 015 2 SFT->FT_VALCOF
ValorCOFI2 N 015 2 SB1->B1_VLR_COF
QuantCOFIN N 015 2 IIF(SB1->B1_VLR_COF>0,SFT->FT_QUANT,0)
AliqICMSST N 007 4 SFT->FT_ALIQICM
Desativado C 025 0 ""
BaseSTInte N 015 2 0
ICMSSTInte N 015 2 0
ICMSSTComp N 015 2 0
ConNTCIAP  C 001 0 SPACE(1)
ConNFCIAP  C 001 0 SF4->F4_CIAP
TpProdut   C 001 0 SPACE(1)
CodDProd   N 005 0 0
ClEnqIPI   N 005 0 0
CodProduto C 060 0 SFT->FT_PRODUTO
ContaContb C 030 0 SFT->FT_CONTA
Desativado C 012 0 ""
Desativado N 002 0 0
Desativado N 006 0 0
Desativado N 017 2 0
Desativado C 020 0 ""
TipoDoc	   C 005 0 SFT->FT_ESPECIE
(POSREG) AADD(_aTotal[57],SFT->FT_PRODUTO)
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[XXX REGISTROS DE ECF]    
(PRE) EcfAud(MV_PAR01, MV_PAR02, aFilsCalc)


[T60A CUPOM FISCAL - ANALITICO]
(ARQ) _aTotal[30]+".60A" 
(PRE) dbGoTop()
DtEmissao  C 008 0 T60A->DATEMIS
NumSerieEq C 020 0 T60A->NUMSEEQ
Numcaixa   C 003 0 T60A->NUMCAIX
Sittrib	   C 004 0 T60A->SITTRIB
ValAcumu   N 016 2 T60A->VALACUM
ValICMS	   N 016 2 T60A->VALICMS
NumMapa    N 006 0 Val(T60A->NUMMAPA)
AliqISS    N 011 4 T60A->ALIQISS


[T60E CUPOM FISCAL - MAQUINA]
(ARQ) _aTotal[30]+".60E" 
(PRE) dbGoTop()
ModeloDoc  C 002 0 T60E->MODDOC
ModeloEqu  C 030 0 T60E->MODEQU
SerieFabr  C 020 0 T60E->SERFAB
NumCaixa   N 003 0 Val(T60E->NUMCXA)
                

[T60I CUPOM FISCAL - ITENS]
(ARQ) _aTotal[30]+".60I"  
(PRE) dbGoTop()
DtEmissao  C 008 0 T60I->DTEMISSAO
NumSerieEq C 020 0 T60I->NUMSERIEEQ  
ModDocFisc C 002 0 T60I->MODDOCFISC  
NumDocumen N 006 0 Val(T60I->NUMDOCUMEN)
NumdoItem  N 003 0 Val(T60I->NUMDOITEM)
Desativado C 014 0 ""
Quantidade N 013 3 T60I->QUANTIDADE  
ValorUnita N 013 3 T60I->VALORUNITA  
BaseICMS   N 012 2 T60I->BASEICMS    
Aliqprodut C 004 0 T60I->ALIQPRODUT  
ValdoICMS  N 012 2 T60I->VALDOICMS   
SequeEqui  N 003 0 Val(T60I->SEQUEEQUI)
NumMapa    N 006 0 Val(T60I->NUMMAPA)
CFOP       N 004 0 Val(T60I->CFOP)
ValorICMSC N 015 2 T60I->VALORICMSC  
TipoICMSC  N 002 0 T60I->TIPOICMSC   
Desativado N 015 0 Val(T60I->DESATIV1)
Desativado N 015 0 Val(T60I->DESATIV2)
Desativado N 015 0 Val(T60I->DESATIV3)
ValBaseISS N 015 2 T60I->VALBASEISS
ValorISS   N 015 2 T60I->VALORISS
ValAcreISS N 015 2 T60I->VALACREISS
ValAcrICMS N 015 2 T60I->VALACRICMS        
ValorAcres N 015 2 T60I->VALORACRES
ValorItem  N 015 4 T60I->VALORITEM
ValorPIS   N 015 4 T60I->VALORPIS    
ValorCOFI  N 015 4 T60I->VALORCOFI   
CodSitTrib C 003 0 T60I->CODSITTRIB
AliqICMS   N 007 4 T60I->ALIQICMS    
ValorDesc  N 015 4 T60I->VALORDESC
UnidMedid  C 003 0 T60I->UNIDMEDID
QuantCance N 013 3 T60I->QUANTCANCE
CodObserv  C 006 0 T60I->CODOBSERV
MunOrigem  C 007 0 T60I->MUNORIGEM  
CPFCNPJ    C 014 0 T60I->CPFCNPJ    
NomeAdqu   C 060 0 T60I->NOMEADQU   
CodTotali  C 010 0 T60I->CODTOTALI
NumTotali  N 004 2 T60I->NUMTOTALI
DescSitTri C 200 0 T60I->DESCSITTRI 
CodProdut  C 060 0 T60I->CODPRODUT
NumCotRed  N 006 0 Val(T60I->NUMCONTRE)

                 
[T60M CUPOM FISCAL - MESTRE]
(ARQ) _aTotal[30]+".60M"               
(PRE) dbGoTop()
DtEmissao  C 008 0 T60M->DATEMISS
NumSerieEq C 020 0 T60M->NUMSEREQ
Numcaixa   N 003 0 Val(T60M->NUMCAIX)
ModDocFisc C 002 0 T60M->MODDOCFI 
NumContIn  N 006 0 Val(T60M->NUMCONTIN)
NumContFi  N 006 0 Val(T60M->NUMCONTFI)
NumCotRed  N 006 0 Val(T60M->NUMCONTRE)
ContReOpe  N 003 0 Val(T60M->CONTREIOP)
ValGranIn  N 016 2 T60M->VALGRANIN
ValGranFi  N 016 2 T60M->VALGRANFI 
NumMapa    N 006 0 Val(T60M->NUMMAPA)
ValTotPIS  N 015 2 T60M->VALTOTPIS
ValTotCOF  N 015 2 T60M->VALTOTCOF
ValBruto   N 014 2 T60M->VALBRUTO 


//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Documentos Fiscais (servicos)  (blocos C e D)                ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
[SF2 COMPLEMENTO DA NOTA FISCAL SERVICO - MESTRE ]
(ARQ) _aTotal[30]+".305"
(PRE) _aTotal[90] := {"SF2",""}
(PRE) _aTotal[91] := "F2_FILIAL='"+xFilial("SF2")+"' AND F2_EMISSAO>='"+ DTOS(MV_PAR01) +"' AND F2_EMISSAO<='"+ DTOS(MV_PAR02) +"' AND F2_BASEICM>0 AND F2_BASEISS>0"
(PRE) _aTotal[98] := "F2_FILIAL+F2_CLIENTE+F2_LOJA+F2_DOC+F2_SERIE"
(PRE) _aTotal[99] := "F2_FILIAL=='"+ xFilial("SF2") +"' .And. DTOS(F2_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(F2_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. F2_BASEICM>0 .And. F2_BASEISS>0"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],_aTotal[98],,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SF2->F2_FILIAL),cFilAnt,SF2->F2_FILIAL)
(PREREG) (SF3->(MsSeek(xFilial("SF3")+DTOS(SF2->F2_EMISSAO)+SF2->F2_DOC+SF2->F2_SERIE+SF2->F2_CLIENTE+SF2->F2_LOJA)))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA)))
Indica_Mov C 001 0 "S"
TipoDoc	   C 005 0 SF3->F3_ESPECIE
Serie      C 005 0 SerieNfId("SF2",2,"F2_SERIE")
NroDoc     C 012 0 Replicate("0",12-len(Alltrim(SF2->F2_DOC))) + Alltrim(SF2->F2_DOC)
DtEmissao  C 008 0 FormDate(SF3->F3_EMISSAO,.F.)
Categoria  C 002 0 " 1"
CodPartic  C 014 0 SA1->A1_CGC
ModeloDoc  C 003 0 AModNot(SF3->F3_ESPECIE)
VlrTtlServ N 017 2 SF2->F2_VALBRUT
VlrDescont N 017 2 SF2->F2_DESCONT
AliqIRRF   N 007 4 0
VlrBasIRRF N 017 2 SF2->F2_BASEIRR
ValorIRRF  N 017 2 SF2->F2_VALIRRF
IndSitCanc C 001 0 If(!Empty(SF3->F3_DTCANC),"S","N")
UnidFedera C 002 0 SF2->F2_EST
DtMovimto  C 008 0 FormDate(SF3->F3_ENTRADA,.F.)
VlrBasINSS N 017 2 SF2->F2_BASEINS
ValorINSS  N 017 2 SF2->F2_VALINSS
Modelo     C 001 0 SPACE(1)
NumParcela N 003 0 0
NumeroAIDF N 007 0 0
AnoAIDF    N 007 0 0
Atividade  N 002 0 0
NFEletron  C 044 0 SF2->F2_CHVNFE
BaseISS    N 017 2 SF2->F2_BASEISS
ValorISS   N 017 2 SF2->F2_VALISS
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[SF2 COMPLEMENTO DA NOTA FISCAL SERVICO - ITENS ]
(ARQ) _aTotal[30]+".306"
(PRE) _aTotal[90] := {"SF2",""}
(PRE) _aTotal[91] := "F2_FILIAL='"+xFilial("SF2")+"' AND F2_EMISSAO>='"+ DTOS(MV_PAR01) +"' AND F2_EMISSAO<='"+ DTOS(MV_PAR02) +"' AND F2_BASEICM>0 AND F2_BASEISS>0"
(PRE) _aTotal[98] := "F2_FILIAL+F2_CLIENTE+F2_LOJA+F2_DOC+F2_SERIE"
(PRE) _aTotal[99] := "F2_FILIAL=='"+ xFilial("SF2") +"' .And. DTOS(F2_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(F2_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. F2_BASEICM>0 .And. F2_BASEISS>0"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],_aTotal[98],,,,,,,aFilsCalc)
(POS) FsQuery(_aTotal[90],2)
//Posiciona atraves da query do SF2, para pegar somente itens de servico de NF's conjugadas
{SFT COMPLEMENTO DA NOTA FISCAL SERVICO - ITENS}
(CHV) SFT->FT_FILIAL+SFT->FT_TIPOMOV+SFT->FT_SERIE+SFT->FT_NFISCAL+SFT->FT_CLIEFOR+SFT->FT_LOJA == SF2->F2_FILIAL+"S"+SF2->F2_SERIE+SF2->F2_DOC+SF2->F2_CLIENTE+SF2->F2_LOJA
(PRE) SFT->(dbSeek(SF2->F2_FILIAL+"S"+SF2->F2_SERIE+SF2->F2_DOC+SF2->F2_CLIENTE+SF2->F2_LOJA))
(PRE) _aTotal[65] := 0
(PREREG) (SFT->FT_TIPO == 'S')
(PREREG) cFilAnt := IIf(Empty(SFT->FT_FILIAL),cFilAnt,SFT->FT_FILIAL)
(PREREG) (SB1->(MsSeek(xFilial("SB1")+SFT->FT_PRODUTO)))
(PREREG) (SD2->(MsSeek(xFilial("SD2")+SFT->FT_NFISCAL+SFT->FT_SERIE+SFT->FT_CLIEFOR+SFT->FT_LOJA+SFT->FT_PRODUTO+SFT->FT_ITEM)))
(PREREG) (SF4->(MsSeek(xFilial("SF4")+SD2->D2_TES)))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SFT->FT_CLIEFOR+SFT->FT_LOJA)))
(PREREG) (_aTotal[65]++,.T.)
Indica_Mov C 001 0 "S"
TipoDoc    C 005 0 SFT->FT_ESPECIE
Serie      C 005 0 SerieNfId("SFT",2,"FT_SERIE")
NroDoc     C 012 0 Replicate("0",12-len(Alltrim(SFT->FT_NFISCAL))) + Alltrim(SFT->FT_NFISCAL)
DtEmissao  C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
Categoria  C 002 0 " 1"
CodPartic  C 014 0 SA1->A1_CGC
NrSeqItem  N 003 0 _aTotal[65]
CodServico C 030 0 SFT->FT_CODISS
Descricao  C 045 0 LEFT(SB1->B1_DESC,45)
UnidMedida C 003 0 SB1->B1_UM
Quantidade N 017 3 SFT->FT_QUANT
PrecoUnit  N 017 2 SFT->FT_PRCUNIT
PrecoTotal N 017 2 (SFT->FT_QUANT * SFT->FT_PRCUNIT)
ValorDesc  N 017 2 SFT->FT_DESCONT
CodImposto C 017 0 SPACE(17)
TipImposto N 003 0 3
CodMunicip C 007 0 UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN
BaseCalcul N 017 2 SFT->FT_BASEICM
Aliquota   N 017 2 SFT->FT_ALIQICM
VlrTtlImp  N 017 2 SFT->FT_VALICM
ContaContb C 010 0 SFT->FT_CONTA
Deducoes   N 017 2 0
OutrasDedu N 017 2 0
FlagEstorn C 001 0 SPACE(1)
TipoPessoa C 001 0 SA1->A1_PESSOA
DtContabil C 008 0 SPACE(8)
DtProvisao C 008 0 SPACE(8)
DtRecolhim C 008 0 SPACE(8)
DtPagmto   C 008 0 SPACE(8)
Observac   C 255 0 SFT->FT_OBSERV
InscINSS   N 001 0 3
NaturezaOp C 010 0 SD2->D2_TES
BaseSubst  N 017 2 0
AliqSubst  N 017 2 0
ValorSubst N 017 2 0
DtMovimto  C 008 0 FormDate(SFT->FT_ENTRADA,.F.)
IndCancmto C 001 0 IIF(!Empty(SFT->FT_DTCANC),"S","N")
CodRecISS  C 005 0 SPACE(4)
ValorFrete N 016 2 SFT->FT_FRETE
VlrOutrasD N 015 2 SFT->FT_DESPESA
VlrSeguro  N 015 2 SFT->FT_SEGURO
NomeOperac C 020 0 SPACE(20)
CodMunicip C 015 0 UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN
CodTipoMun C 006 0 SPACE(6)
CodModServ C 001 0 SPACE(1)
PercFatura C 005 0 SPACE(5)
Desativado N 005 0 0
Desativado N 005 0 0
(POS) cFilAnt := _aTotal[100]


//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Documentos Fiscais (complementos)  (blocos C e D)            ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
[SF2 AGUA CANALIZADA - MESTRE - COMPLEMENTO DA NOTA FISCAL]
(ARQ) _aTotal[30]+".110M"
(PRE) CD4->(dbSetOrder(1))
(PRE) _aTotal[90] := {"SF2",""}
(PRE) _aTotal[91] := "F2_FILIAL='"+xFilial("SF2")+"' AND F2_EMISSAO>='"+ DTOS(MV_PAR01) +"' AND F2_EMISSAO<='"+ DTOS(MV_PAR02) +"' AND (LTRIM(RTRIM(F2_ESPECIE)) = 'NFFA') "
(PRE) _aTotal[98] := "F2_FILIAL+F2_CLIENTE+F2_LOJA+F2_DOC+F2_SERIE"
(PRE) _aTotal[99] := "F2_FILIAL=='"+ xFilial("SF2") +"' .And. DTOS(F2_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(F2_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. (Alltrim(F2_ESPECIE) == 'NFFA') "
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],_aTotal[98],,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SF2->F2_FILIAL),cFilAnt,SF2->F2_FILIAL)
(PREREG) (SF3->(MsSeek(xFilial("SF3")+DTOS(SF2->F2_EMISSAO)+SF2->F2_DOC+SF2->F2_SERIE+SF2->F2_CLIENTE+SF2->F2_LOJA)))
(PREREG) (CD4->(MsSeek(xFilial("CD4")+"S"+SF3->(F3_SERIE+F3_NFISCAL+F3_CLIEFOR+F3_LOJA))))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA)))
DtReferenc C 008 0 FormDate(SF3->F3_ENTRADA,.F.)
Indica_Mov C 001 0 "S"
Clie_Forn  C 014 0 SA1->A1_CGC
NrDocumto  C 010 0 Replicate("0",10-len(Alltrim(SF2->F2_DOC))) + Alltrim(SF2->F2_DOC)
Serie      C 005 0 SerieNfId("SF2",2,"F2_SERIE")
DtMovimto  C 008 0 FormDate(SF3->F3_EMISSAO,.F.)
Grupo      N 006 0 0
ClasseCons C 006 0 CD4->CD4_CLASCO
ValorTotal N 015 2 SF2->F2_VALBRUT
ValorDesc  N 015 2 SF2->F2_DESCONT
ValorForne N 015 2 SF2->F2_VALMERC
VlrIsenICM N 015 2 SF3->F3_ISENICM
VlrCobra3o N 015 2 ACD4Val3o()
VlrBaseICM N 015 2 SF2->F2_BASEICM
VlrDespAce N 015 2 SF2->F2_DESPESA
ValorICMS  N 015 2 SF2->F2_VALICM
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[SFT AGUA CANALIZADA - ITENS - COMPLEMENTO DA NOTA FISCAL ]
(ARQ) _aTotal[30]+".110I"
(PRE) CD4->(dbSetOrder(1))
(PRE) _aTotal[90] := {"SFT",""}
(PRE) _aTotal[91] := "FT_FILIAL='"+ xFilial("SFT") +"' AND FT_EMISSAO>='"+DTOS(MV_PAR01)+"' AND FT_EMISSAO<='"+DTOS(MV_PAR02)+"' AND FT_TIPOMOV = 'S' AND FT_ESPECIE = 'NFFA'"
(PRE) _aTotal[99] := "FT_FILIAL=='"+ xFilial("SFT") +"' .And. DTOS(FT_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(FT_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. FT_TIPOMOV == 'S' .And. FT_ESPECIE == 'NFFA'"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],SFT->(IndexKey()),,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SFT->FT_FILIAL),cFilAnt,SFT->FT_FILIAL)
(PREREG) (CD4->(MsSeek(xFilial("CD4")+SFT->FT_TIPOMOV+SFT->FT_SERIE+SFT->FT_NFISCAL+SFT->FT_CLIEFOR+SFT->FT_LOJA)))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SFT->FT_CLIEFOR+SFT->FT_LOJA)))
DtReferenc C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
Indica_Mov C 001 0 "S"
Clie_Forn  C 014 0 SA1->A1_CGC
NrDocumto  C 010 0 Replicate("0",10-len(Alltrim(SFT->FT_NFISCAL))) + Alltrim(SFT->FT_NFISCAL)
Serie      C 005 0 SerieNfId("SFT",2,"FT_SERIE")
DtMovimto  C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
Grupo      N 006 0 0
Sequencia  N 003 0 Val(SFT->FT_ITEM)
Quantidade N 012 3 SFT->FT_QUANT
ValorAcum  N 015 2 SFT->FT_TOTAL
Vlr_Descon N 015 2 SFT->FT_DESCONT
AliqICMS   N 007 4 SFT->FT_ALIQICM
BaseICMS   N 015 2 SFT->FT_BASEICM
ValorICMS  N 015 2 SFT->FT_VALICM
TipoReceit N 002 0 0
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[SF2 GAS CANALIZADO - MESTRE - COMPLEMENTO DA NOTA FISCAL]
(ARQ) _aTotal[30]+".120M"
(PRE) CD3->(dbSetOrder(1))
(PRE) _aTotal[90] := {"SF2",""}
(PRE) _aTotal[91] := "F2_FILIAL='"+xFilial("SF2")+"' AND F2_EMISSAO>='"+ DTOS(MV_PAR01) +"' AND F2_EMISSAO<='"+ DTOS(MV_PAR02) +"' AND (LTRIM(RTRIM(F2_ESPECIE)) = 'NFCFG') "
(PRE) _aTotal[98] := "F2_FILIAL+F2_CLIENTE+F2_LOJA+F2_DOC+F2_SERIE"
(PRE) _aTotal[99] := "F2_FILIAL=='"+ xFilial("SF2") +"' .And. DTOS(F2_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(F2_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. (Alltrim(F2_ESPECIE) == 'NFCFG') "
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],_aTotal[98],,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SF2->F2_FILIAL),cFilAnt,SF2->F2_FILIAL)
(PREREG) (SF3->(MsSeek(xFilial("SF3")+DTOS(SF2->F2_EMISSAO)+SF2->F2_DOC+SF2->F2_SERIE+SF2->F2_CLIENTE+SF2->F2_LOJA)))
(PREREG) (CD3->(MsSeek(xFilial("CD3")+"S"+SF3->(F3_SERIE+F3_NFISCAL+F3_CLIEFOR+F3_LOJA))))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA)))
DtReferenc C 008 0 FormDate(SF3->F3_ENTRADA,.F.)
Indica_Mov C 001 0 "S"
Clie_Forn  C 014 0 SA1->A1_CGC
NrDocumto  C 010 0 Replicate("0",10-len(Alltrim(SF2->F2_DOC))) + Alltrim(SF2->F2_DOC)
Serie      C 005 0 SerieNfId("SF2",2,"F2_SERIE")
DtMovimto  C 008 0 FormDate(SF3->F3_EMISSAO,.F.)
Grupo      N 006 0 0
ClasseCons C 006 0 CD3->CD3_CLASCO
ValorTotal N 015 2 SF2->F2_VALBRUT
VlrIsenICM N 015 2 SF3->F3_ISENICM
VlrCobra3o N 015 2 ACD3Val3o()
VlrDespAce N 015 2 SF2->F2_DESPESA
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[SFT GAS CANALIZADO - ITENS - COMPLEMENTO DA NOTA FISCAL]
(ARQ) _aTotal[30]+".120I"
(PRE) _aTotal[90] := {"SFT",""}
(PRE) _aTotal[91] := "FT_FILIAL='"+ xFilial("SFT") +"' AND FT_EMISSAO>='"+DTOS(MV_PAR01)+"' AND FT_EMISSAO<='"+DTOS(MV_PAR02)+"' AND FT_TIPOMOV = 'S' AND FT_ESPECIE = 'NFCFG'"
(PRE) _aTotal[99] := "FT_FILIAL=='"+ xFilial("SFT") +"' .And. DTOS(FT_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(FT_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. FT_TIPOMOV == 'S' .And. FT_ESPECIE == 'NFCFG'"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],SFT->(IndexKey()),,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SFT->FT_FILIAL),cFilAnt,SFT->FT_FILIAL)
(PREREG) (CD3->(MsSeek(xFilial("CD3")+SFT->FT_TIPOMOV+SFT->FT_SERIE+SFT->FT_NFISCAL+SFT->FT_CLIEFOR+SFT->FT_LOJA)))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SFT->FT_CLIEFOR+SFT->FT_LOJA)))
DtReferenc C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
Indica_Mov C 001 0 "S"
Clie_Forn  C 014 0 SA1->A1_CGC
NrDocumto  C 010 0 Replicate("0",10-len(Alltrim(SFT->FT_NFISCAL))) + Alltrim(SFT->FT_NFISCAL)
Serie      C 005 0 SerieNfId("SFT",2,"FT_SERIE")
DtMovimto  C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
Grupo      N 006 0 0
Sequencia  N 003 0 Val(SFT->FT_ITEM)
TipoReceit C 002 0 CD3->CD3_TPREC
Receptor   C 014 0 CD3->CD3_RECEP
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[SF2 ENERGIA ELETRICA - MESTRE - COMPLEMENTO DA NOTA FISCAL]
(ARQ) _aTotal[30]+".130M"
(PRE) SFU->(dbSetOrder(1))
(PRE) _aTotal[90] := {"SF2",""}
(PRE) _aTotal[91] := "F2_FILIAL='"+xFilial("SF2")+"' AND F2_EMISSAO>='"+ DTOS(MV_PAR01) +"' AND F2_EMISSAO<='"+ DTOS(MV_PAR02) +"' AND (LTRIM(RTRIM(F2_ESPECIE)) = 'NFCEE') "
(PRE) _aTotal[98] := "F2_FILIAL+F2_CLIENTE+F2_LOJA+F2_DOC+F2_SERIE"
(PRE) _aTotal[99] := "F2_FILIAL=='"+ xFilial("SF2") +"' .And. DTOS(F2_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(F2_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. (Alltrim(F2_ESPECIE) == 'NFCEE') "
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],_aTotal[98],,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SF2->F2_FILIAL),cFilAnt,SF2->F2_FILIAL)
(PREREG) (SF3->(MsSeek(xFilial("SF3")+DTOS(SF2->F2_EMISSAO)+SF2->F2_DOC+SF2->F2_SERIE+SF2->F2_CLIENTE+SF2->F2_LOJA)))
(PREREG) (SFU->(MsSeek(xFilial("SFU")+"S"+SF3->(F3_SERIE+F3_NFISCAL+F3_CLIEFOR+F3_LOJA))))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA)))
(PREREG) (_aTotal[81] := ASFUVal3o(), .T.)
DtReferenc C 008 0 FormDate(SF3->F3_ENTRADA,.F.)
Indica_Mov C 001 0 "S"
Clie_Forn  C 014 0 SA1->A1_CGC
NrDocumto  C 010 0 Replicate("0",10-len(Alltrim(SF2->F2_DOC))) + Alltrim(SF2->F2_DOC)
Serie      C 005 0 SerieNfId("SF2",2,"F2_SERIE")
DtMovimto  C 008 0 FormDate(SF3->F3_EMISSAO,.F.)
Grupo      N 006 0 0
ClasseCons C 006 0 SFU->FU_CLASCON
ConsumoTot N 009 0 _aTotal[81][2]
ValorTotal N 015 2 SF2->F2_VALBRUT
VlrNaoTtib N 015 2 (SF2->F2_VALBRUT-SF2->F2_BASEICM)
VlrCobra3o N 015 2 _aTotal[81][1]
CodDigi    C 032 0 SFU->FU_CHV115
TipoLig    C 002 0 Iif(SFU->FU_TIPLIGA == '0',"1",Iif(SFU->FU_TIPLIGA == '1',"2",Iif(SFU->FU_TIPLIGA == '2',"3","")))
GrupoTens  C 002 0 SFU->FU_GRUPT
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[SFT ENERGIA ELETRICA - ITENS - COMPLEMENTO DA NOTA FISCAL]
(ARQ) _aTotal[30]+".130I"
(PRE) _aTotal[90] := {"SFT",""}
(PRE) _aTotal[91] := "FT_FILIAL='"+ xFilial("SFT") +"' AND FT_EMISSAO>='"+DTOS(MV_PAR01)+"' AND FT_EMISSAO<='"+DTOS(MV_PAR02)+"' AND FT_TIPOMOV = 'S' AND FT_ESPECIE = 'NFCEE'"
(PRE) _aTotal[99] := "FT_FILIAL=='"+ xFilial("SFT") +"' .And. DTOS(FT_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(FT_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. FT_TIPOMOV == 'S' .And. FT_ESPECIE == 'NFCEE'"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],SFT->(IndexKey()),,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SFT->FT_FILIAL),cFilAnt,SFT->FT_FILIAL)
(PREREG) (SFU->(MsSeek(xFilial("SFU")+SFT->FT_TIPOMOV+SFT->FT_SERIE+SFT->FT_NFISCAL+SFT->FT_CLIEFOR+SFT->FT_LOJA)))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SFT->FT_CLIEFOR+SFT->FT_LOJA)))
DtReferenc C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
Indica_Mov C 001 0 "S"
Clie_Forn  C 014 0 SA1->A1_CGC
NrDocumto  C 010 0 Replicate("0",10-len(Alltrim(SFT->FT_NFISCAL))) + Alltrim(SFT->FT_NFISCAL)
Serie      C 005 0 SerieNfId("SFT",2,"FT_SERIE")
DtMovimto  C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
Grupo      N 006 0 0
Sequencia  N 003 0 Val(SFT->FT_ITEM)
CodClassif C 006 0 SFU->FU_CLASSIF
TipoReceit C 002 0 SFU->FU_TIPOREC
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAtu := _aTotal[100]


[SF2 COMUNICAÇÃO TELECOMUNICAÇÃO - MESTRE - COMPLEMENTO DA NOTA FISCAL]
(ARQ) _aTotal[30]+".100M"
(PRE) SFX->(dbSetOrder(1))
(PRE) _aTotal[90] := {"SF2",""}
(PRE) _aTotal[91] := "F2_FILIAL='"+xFilial("SF2")+"' AND F2_EMISSAO>='"+ DTOS(MV_PAR01) +"' AND F2_EMISSAO<='"+ DTOS(MV_PAR02) +"' AND (LTRIM(RTRIM(F2_ESPECIE)) IN ('NFSC','NTSC')) "
(PRE) _aTotal[98] := "F2_FILIAL+F2_CLIENTE+F2_LOJA+F2_DOC+F2_SERIE"
(PRE) _aTotal[99] := "F2_FILIAL=='"+ xFilial("SF2") +"' .And. DTOS(F2_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(F2_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. (Alltrim(F2_ESPECIE) $ 'NFSC/NTSC') "
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],_aTotal[98],,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SF2->F2_FILIAL),cFilAnt,SF2->F2_FILIAL)
(PREREG) (SF3->(MsSeek(xFilial("SF3")+DTOS(SF2->F2_EMISSAO)+SF2->F2_DOC+SF2->F2_SERIE+SF2->F2_CLIENTE+SF2->F2_LOJA)))
(PREREG) (SFX->(MsSeek(xFilial("SFX")+"S"+SF3->(F3_SERIE+F3_NFISCAL+F3_CLIEFOR+F3_LOJA))))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA)))
DtReferenc C 008 0 FormDate(SF3->F3_ENTRADA,.F.)
NrDocumto  C 010 0 Replicate("0",10-len(Alltrim(SF2->F2_DOC))) + Alltrim(SF2->F2_DOC)
Clie_Forn  C 014 0 SA1->A1_CGC
Serie      C 005 0 SerieNfId("SF2",2,"F2_SERIE")
Modelo     C 002 0 AModNot(SF3->F3_ESPECIE)
ClasseCons C 002 0 SFX->FX_CLASCON
PrestDtIni C 008 0 FormDate(SFX->FX_DTINI,.F.)
PrestDtFim C 008 0 FormDate(SFX->FX_DTFIM,.F.)
NoTerminal C 010 0 Replicate("0",10-len(Alltrim(SFX->FX_TERMINA))) + Alltrim(SFX->FX_TERMINA)
DtMoviment C 008 0 FormDate(SF3->F3_EMISSAO,.F.)
Desativado N 006 0 0
TipoServic C 006 0 Replicate("0",6-len(Alltrim(SFX->FX_TIPSERV))) + Alltrim(SFX->FX_TIPSERV)
CodAreaFat C 015 0 SFX->FX_AREATER
VlrServico N 015 2 SF2->F2_VALMERC
VlrNaoTtib N 015 2 (SF2->F2_VALBRUT-SF2->F2_BASEICM)
VlrCobra3o N 015 2 ASFXVal3o()
VlDespAces N 015 2 SF2->F2_DESPESA
TipoEmissa C 001 0 IF(SF2->F2_FORMUL=="N","T","P")
TipoOperac C 001 0 "1"
CodifDigit C 032 0 SFX->FX_CHV115
CodMunTer  C 007 0 Replicate("0",7-len(Alltrim(SFX->FX_AREATER))) + Alltrim(SFX->FX_AREATER)
TipoAssin  C 002 0 SFX->FX_TPASSIN
Movmto     C 001 0 "S"
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[SFT COMUNICAÇÃO TELECOMUNICAÇÃO - ITENS - COMPLEMENTO DA NOTA FISCAL ]
(ARQ) _aTotal[30]+".100I"
(PRE) _aTotal[90] := {"SFT",""}
(PRE) _aTotal[91] := "FT_FILIAL='"+ xFilial("SFT") +"' AND FT_EMISSAO>='"+DTOS(MV_PAR01)+"' AND FT_EMISSAO<='"+DTOS(MV_PAR02)+"' AND FT_TIPOMOV = 'S' AND FT_ESPECIE IN ('NFSC','NTSC','NTST')"
(PRE) _aTotal[99] := "FT_FILIAL=='"+ xFilial("SFT") +"' .And. DTOS(FT_EMISSAO)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(FT_EMISSAO)<='"+ DTOS(MV_PAR02) +"' .And. FT_TIPOMOV == 'S' .And. FT_ESPECIE $ 'NFSC/NTSC/NTST'"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],SFT->(IndexKey()),,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SFT->FT_FILIAL),cFilAnt,SFT->FT_FILIAL)
(PREREG) (SFX->(MsSeek(xFilial("SFX")+SFT->FT_TIPOMOV+SFT->FT_SERIE+SFT->FT_NFISCAL+SFT->FT_CLIEFOR+SFT->FT_LOJA)))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SFT->FT_CLIEFOR+SFT->FT_LOJA)))
DtReferenc C 008 0 FormDate(SFT->FT_EMISSAO,.F.)
NrDocumto  C 010 0 Replicate("0",10-len(Alltrim(SFT->FT_NFISCAL))) + Alltrim(SFT->FT_NFISCAL)
Clie_Forn  C 014 0 SA1->A1_CGC
Serie      C 005 0 SerieNfId("SFT",2,"FT_SERIE")
Item       N 003 0 Val(SFT->FT_ITEM)
Desativado C 011 0 ""
CodClassif C 004 0 SFX->FX_CLASSIF
TipoReceit C 001 0 SFX->FX_TIPOREC
Receptor   C 014 0 Posicione("SA1",1,xFilial("SA1")+SFX->FX_RECEP,"A1_CGC")
Quantidade N 013 3 SFT->FT_QUANT
VlrItem    N 015 2 SFT->FT_VALCONT
VlrDesc    N 012 2 SFT->FT_DESCONT
CFOP       C 012 0 Replicate("0",14-len(Alltrim(SFT->FT_CFOP))) + Alltrim(SFT->FT_CFOP)
AliqIcm    N 005 2 SFT->FT_ALIQICM
BaseIcm    N 013 2 SFT->FT_BASEICM
ValorIcm   N 013 2 SFT->FT_VALICM
ValorNT    N 013 2 (SFT->FT_VALCONT-SFT->FT_BASEICM)
CodItem    C 060 0 SFT->FT_PRODUTO
Movmto     C 001 0 "S"
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[CDL COMPLEMENTO DA NOTA FISCAL - EXPORTAÇÃO ]
(ARQ) _aTotal[30]+".85"
(PRE) CDL->(dbSetOrder(1)) 
(PRE) _aTotal[90] := {"CDL",""}
(PRE) _aTotal[91] := "CDL_FILIAL='"+xFilial("CDL")+"' AND CDL_DTAVB>='"+ DTOS(MV_PAR01) +"' AND CDL_DTAVB<='"+ DTOS(MV_PAR02) +"'"
(PRE) _aTotal[99] := "CDL_FILIAL=='"+ xFilial("CDL") +"' .And. DTOS(CDL_DTAVB)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(CDL_DTAVB)<='"+ DTOS(MV_PAR02) +"'"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],CDL->(IndexKey()),,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(CDL->CDL_FILIAL),cFilAnt,CDL->CDL_FILIAL)
(PREREG) (SF3->(MsSeek(xFilial("SF3")+DTOS(SF2->F2_EMISSAO)+SF2->F2_DOC+SF2->F2_SERIE+SF2->F2_CLIENTE+SF2->F2_LOJA)))
(PREREG) (SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA)))
Indica_Mov C 001 0 "S"
DtMoviment C 008 0 FormDate(SF3->F3_ENTRADA,.F.)
NrDocumto  C 012 0 Replicate("0",12-len(Alltrim(CDL->CDL_DOC))) + Alltrim(CDL->CDL_DOC)
ClieFor    C 014 0 SA1->A1_CGC
Serie      C 005 0 SerieNfId("CDL",2,"CDL_SERIE")
Grupo      N 006 0 0
RegExport  C 012 0 Replicate("0",12-len(Alltrim(CDL->CDL_NRREG))) + Alltrim(CDL->CDL_NRREG)
DeclaraExp C 011 0 Replicate("0",11-len(Alltrim(CDL->CDL_NUMDE))) + Alltrim(CDL->CDL_NUMDE)
DtDeclaExp C 008 0 FormDate(CDL->CDL_DTDE,.F.)
NatExport  C 001 0 CDL->CDL_NATEXP
DtRegExpor C 008 0 FormDate(CDL->CDL_DTREG,.F.)
Desativado C 016 0 ""
DtConhecim C 008 0 FormDate(CDL->CDL_DTCHC,.F.)
TpConhecim C 002 0 CDL->CDL_TPCHC
Pais       C 004 0 CDL->CDL_PAIS
DtAverbac  C 008 0 FormDate(CDL->CDL_DTAVB,.F.)
NumCompExp C 008 0 SPACE(8)
DtCompExpo C 008 0 SPACE(8)
NumDespach N 012 0 0
FornMercad C 028 0 Posicione("SA2",1,xFilial("SA2")+CDL->CDL_FORNEC,"A2_CGC")
ModeloDoc  C 002 0 AModNot(SF3->F3_ESPECIE)
NrNF       N 009 0 0
Serie      C 003 0 SPACE(9)
DtEmissao  C 008 0 SPACE(8)
ChaveNFE   C 044 0 SF3->F3_CHVNFE
MemoExport C 020 0 CDL->CDL_NRMEMO 
ConhecEmb  C 018 0 CDL->CDL_CHCEMB
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[SF1 COMPLEMENTO DA NOTA FISCAL - IMPORTAÇÃO]
(ARQ) _aTotal[30]+".90"
(PRE) CD5->(dbSetOrder(1)) 
(PRE) _aTotal[90] := {"SF1",""}
(PRE) _aTotal[91] := "F1_FILIAL='"+xFilial("SF1")+"' AND F1_DTDIGIT>='"+ DTOS(MV_PAR01) +"' AND F1_DTDIGIT<='"+ DTOS(MV_PAR02) +"' AND F1_EST = 'EX'"
(PRE) _aTotal[98] := "F1_FILIAL+F1_FORNECE+F1_LOJA+F1_DOC+F1_SERIE"
(PRE) _aTotal[99] := "F1_FILIAL=='"+ xFilial("SF1") +"' .And. DTOS(F1_DTDIGIT)>='"+ DTOS(MV_PAR01) +"' .And. DTOS(F1_DTDIGIT)<='"+ DTOS(MV_PAR02) +"' .And. F1_EST = 'EX'"
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[99],_aTotal[98],,,,,,,aFilsCalc)
(PREREG) cFilAnt := IIf(Empty(SF1->F1_FILIAL),cFilAnt,SF1->F1_FILIAL)
(PREREG) (SF3->(MsSeek(xFilial("SF3")+DTOS(SF1->F1_DTDIGIT)+SF1->F1_DOC+SF1->F1_SERIE+SF1->F1_FORNECE+SF1->F1_LOJA)))
(PREREG) (CD5->(MsSeek(xFilial("CD5")+SF3->F3_NFISCAL+SF3->F3_SERIE+SF3->F3_CLIEFOR+SF3->F3_LOJA)))
(PREREG) (SA2->(MsSeek(xFilial("SA2")+SF3->F3_CLIEFOR+SF3->F3_LOJA)))
DtReferenc C 008 0 FormDate(SF3->F3_ENTRADA,.F.)
Indica_Mov C 001 0 "E"
ClieFor    C 014 0 SA2->A2_CGC
NrDocumto  C 010 0 Replicate("0",10-len(Alltrim(CD5->CD5_DOC))) + Alltrim(CD5->CD5_DOC)
Serie      C 005 0 SerieNfId("CD5",2,"CD5_SERIE")
DtMoviment C 008 0 FormDate(SF3->F3_EMISSAO,.F.)
Grupo      N 006 0 0
TpDeclarac C 001 0 CD5->CD5_TPIMP
NrDeclarac C 020 0 Replicate("0",20-len(Alltrim(CD5->CD5_DOCIMP))) + Alltrim(CD5->CD5_DOCIMP)
VlrPIS     N 015 2 CD5->CD5_VLPIS
VlrCOFIN   N 015 2 CD5->CD5_VLCOF
NrConces   C 011 0 ""
(POS) FsQuery(_aTotal[90],2)
(POS) cFilAnt := _aTotal[100]


[XXX COMPLEMENTOS DE DOCUMENTOS]
[XXX COMPLEMENTOS DE DOCUMENTOS]
(PRE) LvAuditFis(IIf(lAglFil,aFilsCalc,NIL))


[T90 COMPLEMENTO DA NOTA FISCAL]
(ARQ) _aTotal[30]+".190"
(PRE) T90->(dbSeek(""))
DtReferenc C 008 0 FormDate(T90->DTMOV,.F.)
Indica_Mov C 001 0 T90->TPMOV
Clie_Forn  C 014 0 T90->CLIFOR
NrDocumto  C 010 0 T90->DOC
Serie      C 005 0 T90->SDOC
CodComplem C 006 0 T90->IFCOMP
TxtComplem C 800 0 T90->TXTCOP


[T91 COMPLEMENTO DA NOTA FISCAL - PROCESSO REFERENCIADO ]
(ARQ) _aTotal[30]+".191"
(PRE) T91->(dbSeek(""))
DtReferenc C 008 0 FormDate(T91->DTMOV,.F.)
Indica_Mov C 001 0 T91->TPMOV
Clie_Forn  C 014 0 T91->CLIFOR
NrDocumto  C 010 0 T91->DOC
Serie      C 005 0 T91->SERIE
CodComplem C 006 0 T91->IFCOMP
NumProc    C 015 0 T91->NUMPRC
OrigProc   C 001 0 T91->ORIPRC


[T93 COMPLEMENTO DA NOTA FISCAL - DOCUMENTO REFERENCIADO ]
(ARQ) _aTotal[30]+".193"
(PRE) T93->(dbSeek(""))
DtReferenc C 008 0 FormDate(T93->DTMOV,.F.)
Indica_Mov C 001 0 T93->TPMOV
Clie_Forn  C 014 0 T93->CLIFOR
NrDocumto  C 010 0 T93->DOC
Serie      C 005 0 T93->SERIE
CodComplem C 006 0 T93->IFCOMP
MovimRefer C 001 0 T93->MOVREF
ClieForRef C 014 0 T93->CFREF
NrDocumRef C 010 0 T93->DOCREF
SerieRef   C 005 0 T93->SERREF
DtEmisRef  C 008 0 FormDate(T93->DTREF,.F.)
Indicador  C 001 0 T93->INDIC
ModDocRef  C 003 0 T93->MODREF


[T94 COMPLEMENTO DA NOTA FISCAL - CUPOM FISCAL REFERENCIADO ]
(ARQ) _aTotal[30]+".194"
(PRE) T94->(dbSeek(""))
DtReferenc C 008 0 FormDate(T94->DTMOV,.F.)
Indica_Mov C 001 0 T94->TPMOV
Clie_Forn  C 014 0 T94->CLIFOR
NrDocumto  C 010 0 T94->DOC
Serie      C 005 0 T94->SERIE
CodComplem C 006 0 T94->IFCOMP
ModDocRef  C 003 0 T94->MODREF
SerieECF   C 020 0 T94->SERECF
CaixaECF   C 003 0 T94->CXECF
NrDocumRef C 006 0 T94->DOCREF
DtEmisRef  C 008 0 FormDate(T94->DTREF,.F.)


[T95 COMPLEMENTO DA NOTA FISCAL - LOCAL DE COLETA E ENTREGA ]
(ARQ) _aTotal[30]+".195"
(PRE) T95->(dbSeek(""))
DtReferenc C 008 0 FormDate(T95->DTMOV,.F.)
Indica_Mov C 001 0 T95->TPMOV
Clie_Forn  C 014 0 T95->CLIFOR
NrDocumto  C 010 0 T95->DOC
Serie      C 005 0 T95->SERIE
CodComplem C 006 0 T95->IFCOMP
TipoTransp C 001 0 T95->TPTRAN
CNPJColeta C 014 0 T95->CNPJCO
IEColeta   C 014 0 T95->IECOL
CPFColeta  C 011 0 T95->CPFCOL
MunColeta  C 007 0 T95->MUNCOL
CNPJEntreg C 014 0 T95->CNPJEN
IEEntrega  C 014 0 T95->IEENT
CPFEntrega C 011 0 T95->CPFENT
MunEntrega C 007 0 T95->MUNENT


[T96 COMPLEMENTO DA NOTA FISCAL - DOCUMENTO DE ARRECADAÇÃO REFERENCIADO ]
(ARQ) _aTotal[30]+".196"
(PRE) T96->(dbSeek(""))
DtReferenc C 008 0 FormDate(T96->DTMOV,.F.)
Indica_Mov C 001 0 T96->TPMOV
Clie_Forn  C 014 0 T96->CLIFOR
NrDocumto  C 010 0 T96->DOC
Serie      C 005 0 T96->SERIE
CodComplem C 006 0 T96->IFCOMP
Documento  C 001 0 T96->TPDOC
UnidFedera C 002 0 T96->UFGUIA
NumDocArre C 020 0 T96->NGUIA
Desativado C 015 0 SPACE(15)
VlrDocArre N 015 2 T96->VRGUIA
DtVencArre C 008 0 FormDate(T96->DTVENC,.F.)
DtPagArre  C 008 0 FormDate(IIF(EMPTY(T96->DTPAG),T96->DTVENC,T96->DTPAG),.F.)
CodAutenti C 100 0 T96->AUTENT


[T2A COMPLEMENTO DA NOTA FISCAL - FATURA ]
(ARQ) _aTotal[30]+".200"
(PRE) T2A->(dbSeek(""))
DtReferenc C 008 0 FormDate(T2A->DTMOV,.F.)
Indica_Mov C 001 0 T2A->TPMOV
Clie_Forn  C 014 0 T2A->CLIFOR
NrDocumto  C 010 0 T2A->DOC
Serie      C 005 0 T2A->SERIE
DtMovimto  C 008 0 FormDate(T2A->DTMOV,.F.)
Grupo      N 006 0 0
Indicador  C 001 0 T2A->INDIC
TipoTitulo N 006 0 Val(T2A->TPTIT)
DescrCompl C 065 0 T2A->DESCR
NumTitulo  C 015 0 T2A->NUMTIT
QtdParcela N 004 0 T2A->QTDPAR
VlrOrigin  N 015 2 T2A->VLROR


[T2B COMPLEMENTO DA NOTA FISCAL - PARCELAS DA FATURA ]
(ARQ) _aTotal[30]+".201"
(PRE) T2B->(dbSeek(""))
DtReferenc C 008 0 FormDate(T2B->DTMOV,.F.)
Indica_Mov C 001 0 T2B->TPMOV
Clie_Forn  C 014 0 T2B->CLIFOR
NrDocumto  C 010 0 T2B->DOC
Serie      C 005 0 T2B->SERIE
DtMovimto  C 008 0 FormDate(T2B->DTMOV,.F.)
Grupo      N 006 0 0
TipoTitulo N 006 0 Val(T2B->TPTIT)
NumTitulo  C 015 0 T2B->NUMTIT
NumParcela N 004 0 T2B->NUMPAR
DtVencimto C 008 0 FormDate(T2B->DTVPAR,.F.)
VlrParcela N 015 2 T2B->VLROR


[T21 COMPLEMENTO DA NOTA FISCAL - OPERAÇÕES COM COMBUSTIVEIS ]
(ARQ) _aTotal[30]+".210"
(PRE) T21->(dbSeek(""))
DtReferenc C 008 0 FormDate(T21->DTMOV,.F.)
Indica_Mov C 001 0 T21->TPMOV
Clie_Forn  C 014 0 T21->CLIFOR
NrDocumto  C 010 0 T21->DOC
Serie      C 005 0 T21->SERIE
DtMoviment C 008 0 FormDate(T21->DTMOV,.F.)
Grupo      N 006 0 0
Sequencia  N 006 0 T21->SEQUEN
CodTransp  C 028 0 T21->CODTRP
PlacaVeicu C 015 0 T21->PLACA
CodSEFAZ   C 020 0 T21->SEFAZ
NumPasse   C 020 0 T21->PASSE
HoraSaida  C 015 0 T21->HORA
GrausCelsi N 008 4 T21->TEMP
QtdVolum   N 009 0 T21->VOLUM
PesoBruto  N 015 3 T21->PBRUT
PesoLiquid N 015 3 T21->PLIQUI
NomeMotori C 065 0 T21->NOMMOT
CPFMotoris C 011 0 T21->CPFMOT
UFPLACA    C 002 0 T21->UFPLAC


[T21 COMPLEMENTO DA NOTA FISCAL - OPERAÇÕES COM COMBUSTIVEIS ]
(ARQ) _aTotal[30]+".211"
(PRE) T21->(dbSeek(""))
DtReferenc C 008 0 FormDate(T21->DTMOV,.F.)
Indica_Mov C 001 0 T21->TPMOV
Clie_Forn  C 014 0 T21->CLIFOR
NrDocumto  C 010 0 T21->DOC
Serie      C 005 0 T21->SERIE
DtMoviment C 008 0 FormDate(T21->DTMOV,.F.)
Grupo      N 006 0 0
Sequencia  N 003 0 T21->SEQUEN
NrSeqTanq  N 005 0 0
NrTanque   C 020 0 T21->TANQUE
Quantidade N 015 3 T21->QTDE


[T22 COMPLEMENTO DA NOTA FISCAL - MEDICAMENTOS ]
(ARQ) _aTotal[30]+".220"
(PRE) T22->(dbSeek(""))
DtReferenc C 008 0 FormDate(T22->DTMOV,.F.)
Indica_Mov C 001 0 T22->TPMOV
Clie_Forn  C 014 0 T22->CLIFOR
NrDocumto  C 010 0 T22->DOC
Serie      C 005 0 T22->SERIE
DtMoviment C 008 0 FormDate(T22->DTMOV,.F.)
Grupo      N 006 0 0
Sequencia  N 003 0 T22->SEQUEN
NrSeqMedic N 005 0 0
NrLote     C 045 0 T22->LOTE
Quantidade N 012 3 T22->QTDLOT
DataFabric C 008 0 FormDate(T22->DTFAB,.F.)
DataValida C 008 0 FormDate(T22->DTVAL,.F.)
IndBaseICM C 001 0 T22->REFBAS
TpProduto  C 001 0 T22->TPPROD
VlrTabelad N 015 2 T22->PRECO


[T23 COMPLEMENTO DA NOTA FISCAL - ARMAS DE FOGO ]
(ARQ) _aTotal[30]+".230"
(PRE) T23->(dbSeek(""))
DtReferenc C 008 0 FormDate(T23->DTMOV,.F.)
Indica_Mov C 001 0 T23->TPMOV
Clie_Forn  C 014 0 T23->CLIFOR
NrDocumto  C 010 0 T23->DOC
Serie      C 005 0 T23->SERIE
DtMoviment C 008 0 FormDate(T23->DTMOV,.F.)
Grupo      N 006 0 0
Sequencia  N 003 0 T23->SEQUEN
SeqArma    N 005 0 0
IndTpArma  C 002 0 T23->TPARMA
SerieArma  C 045 0 T23->SEARMA
DescCompl  C 065 0 T23->DESCR
SerieCano  C 045 0 SPACE(45)


[T24 COMPLEMENTO DA NOTA FISCAL - VEICULOS NOVOS ]
(ARQ) _aTotal[30]+".240"
(PRE) T24->(dbSeek(""))
DtReferenc C 008 0 FormDate(T24->DTMOV,.F.)
Indica_Mov C 001 0 T24->TPMOV
Clie_Forn  C 014 0 T24->CLIFOR
NrDocumto  C 010 0 T24->DOC
Serie      C 005 0 T24->SERIE
DtMoviment C 008 0 FormDate(T24->DTMOV,.F.)
Grupo      N 006 0 0
Sequencia  N 003 0 T24->SEQUEN
SeqVeiculo N 005 0 0
TpOperacao C 002 0 T24->TPOPER
CNPJConces C 017 0 T24->CNPJCO
UFConcess  C 002 0 T24->UFCO
Chassi     C 065 0 T24->CHASSI


[T25 COMPLEMENTO DA NOTA FISCAL - OBSERVAÇÕES DO DOCUMENTO FISCAL ]
(ARQ) _aTotal[30]+".250"
(PRE) T25->(dbSeek(""))
DtReferenc C 008 0 FormDate(T25->DTMOV,.F.)
Indica_Mov C 001 0 T25->TPMOV
Clie_Forn  C 014 0 T25->CLIFOR
NrDocumto  C 010 0 T25->DOC
Serie      C 005 0 T25->SERIE
CodObs     C 006 0 T25->COBOBS
TextoCompl C 800 0 T25->DESCR


[T25 COMPLEMENTO DA NOTA FISCAL - OUTRAS OBRIGAÇÕES TRIBUTARIAS, AJUSTES E INFORMAÇÕES DE VALORES PROVENIENTES DE DOCUMENTO FISCAL ]
(ARQ) _aTotal[30]+".251"
(PRE) T25->(dbSeek(""))
DtReferenc C 008 0 FormDate(T25->DTMOV,.F.)
Indica_Mov C 001 0 T25->TPMOV
Clie_Forn  C 014 0 T25->CLIFOR
NrDocumto  C 010 0 T25->DOC
Serie      C 005 0 T25->SERIE
Desativado C 010 0 SPACE(10)
CodAjuste  C 010 0 T25->CODLAN
DescComple C 800 0 T25->DESCR
CodItem    C 014 0 T25->CODPRO
BaseICMS   N 015 2 T25->BASEIC
PctICMS    N 007 2 T25->ALIQIC
ValorICMS  N 015 2 T25->VLRICM
OutrosVals N 015 2 0
NumOrdenac C 018 0 T25->NUMORD
CodObserv  C 006 0 T25->COBOBS



//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Cadastros (bloco 0)                                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

[SA1 CLIENTES / FORNECEDORES (PARTICIPANTES)]
(PRE) SA1->(dbSetOrder(1))
(PRE) SA1->(MsSeek(xFilial("SA1")))
(PREREG) SA1->A1_FILIAL == xFilial("SA1")
(PREREG) ASCAN(_aTotal[55],"SA1"+xFilial('SA1')+SA1->A1_COD+SA1->A1_LOJA)>0
DtAtualiza C 008 0 FormDate(MV_PAR02,.F.)
Categoria  C 002 0 " 1"
Codigo     C 028 0 SA1->A1_CGC
CPF_CNPJ   C 014 0 SA1->A1_CGC
InscEstad  C 014 0 SA1->A1_INSCR
InscMunic  C 014 0 SA1->A1_INSCRM
Emitente   C 070 0 SA1->A1_NOME
NomeFantas C 070 0 SA1->A1_NREDUZ
Logradouro C 070 0 FisGetEnd(SA1->A1_END)[1]
Numero     C 012 0 FisGetEnd(SA1->A1_END)[3]
Complement C 045 0 FisGetEnd(SA1->A1_END)[4]
Bairro     C 020 0 SA1->A1_BAIRRO
Município  C 050 0 SA1->A1_MUN
UF         C 002 0 SA1->A1_EST
CEP        C 008 0 SA1->A1_CEP
Desativado C 005 0 "00000"
CodMunZF   C 010 0 SA1->A1_CODMUN
CodSistema N 001 0 0
CodigoPais C 012 0 SA1->A1_CODPAIS
ContribICM C 001 0 IIF(SA1->A1_CONTRIB=="1","S","N")
CodINCRA   C 020 0 SPACE(20)
Grupo      N 004 0 0
RegCACEL   N 001 0 0
TipoPessoa C 001 0 SA1->A1_PESSOA
Suframa    C 015 0 SA1->A1_SUFRAMA
ZonaFranca N 009 0 0
PIS_PASEP  N 011 0 0
CEP_Caixa  N 008 0 0
CaixaPosta N 020 0 Val(SA1->A1_CXPOSTA)
InscINSS   N 012 0 0
Telefone   C 010 0 SA1->A1_DDD+SA1->A1_TEL
Fax        C 010 0 SA1->A1_DDD+SA1->A1_FAX
CodMunicip C 007 0 UfCodIBGE(SA1->A1_EST)+SA1->A1_COD_MUN
DtIniVig   C 008 0 "0101"+Str(Year(MV_PAR01),4)
//DtIniVig   C 008 0 FormDate(SA1->A1_DTINIV,.F.)


[SA2 CLIENTES / FORNECEDORES (PARTICIPANTES)]
(PRE) SA2->(dbSetOrder(1)) 
(PRE) SA2->(MsSeek(xFilial("SA2")))
(PREREG) SA2->A2_FILIAL == xFilial("SA2")
(PREREG) ASCAN(_aTotal[55],"SA2"+xFilial('SA2')+SA2->A2_COD+SA2->A2_LOJA)>0
DtAtualiza C 008 0 FormDate(MV_PAR02,.F.)
Categoria  C 002 0 " 2"
Codigo     C 028 0 SA2->A2_CGC
CPF_CNPJ   C 014 0 SA2->A2_CGC
InscEstad  C 014 0 SA2->A2_INSCR
InscMunic  C 014 0 SA2->A2_INSCRM
Emitente   C 070 0 SA2->A2_NOME
NomeFantas C 070 0 SA2->A2_NREDUZ
Logradouro C 070 0 FisGetEnd(SA2->A2_END)[1]
Numero     C 012 0 FisGetEnd(SA2->A2_END)[3]
Complement C 045 0 FisGetEnd(SA2->A2_END)[4]
Bairro     C 020 0 SA2->A2_BAIRRO
Município  C 050 0 SA2->A2_MUN
UF         C 002 0 SA2->A2_EST
CEP        C 008 0 SA2->A2_CEP
Desativado C 005 0 "00000"
CodMunZF   C 010 0 SA2->A2_CODMUN
CodSistema N 001 0 0
CodigoPais C 012 0 SA2->A2_CODPAIS
ContribICM C 001 0 IIF(Empty(SA2->A2_INSCR) .Or. "ISEN"$SA2->A2_INSCR,"N","S")
CodINCRA   C 020 0 SPACE(20)
Grupo      N 004 0 0
RegCACEL   N 001 0 0
TipoPessoa C 001 0 SA2->A2_TIPO
Suframa    C 015 0 SPACE(15)
ZonaFranca N 009 0 0
PIS_PASEP  N 011 0 0
CEP_Caixa  N 008 0 0
CaixaPosta N 020 0 Val(SA2->A2_CX_POST)
InscINSS   N 012 0 0
Telefone   C 010 0 SA2->A2_DDD+SA2->A2_TEL
Fax        C 010 0 SA2->A2_DDD+SA2->A2_FAX
CodMunicip C 007 0 UfCodIBGE(SA2->A2_EST)+SA2->A2_COD_MUN
DtIniVig   C 008 0 "0101"+Str(Year(MV_PAR01),4)
//DtIniVig   C 008 0 FormDate(SA2->A2_DTINIV,.F.)


[SA4 CLIENTES / FORNECEDORES (PARTICIPANTES)]
(ARQ) _aTotal[30]+".801"
(PRE) SA4->(dbSetOrder(1)) 
(PRE) SA4->(MsSeek(xFilial("SA4")))
(PREREG) SA4->A4_FILIAL == xFilial("SA4")
(PREREG) ASCAN(_aTotal[56],SA4->A4_COD)>0
DtAtualiza C 008 0 FormDate(MV_PAR02,.F.)
Categoria  C 002 0 " 2"
Codigo     C 028 0 SA4->A4_CGC
CPF_CNPJ   C 014 0 SA4->A4_CGC
InscEstad  C 014 0 SA4->A4_INSEST
InscMunic  C 014 0 SPACE(14)
Emitente   C 070 0 SA4->A4_NOME
NomeFantas C 070 0 SA4->A4_NREDUZ
Logradouro C 070 0 FisGetEnd(SA4->A4_END)[1]
Numero     C 012 0 FisGetEnd(SA4->A4_END)[3]
Complement C 045 0 FisGetEnd(SA4->A4_END)[4]
Bairro     C 020 0 SA4->A4_BAIRRO
Município  C 050 0 SA4->A4_MUN
UF         C 002 0 SA4->A4_EST
CEP        C 008 0 SA4->A4_CEP
Desativado C 005 0 "00000"
CodMunZF   C 010 0 SPACE(10)
CodSistema N 001 0 0
CodigoPais C 012 0 SA4->A4_CODPAIS
ContribICM C 001 0 IIF(Empty(SA4->A4_INSEST) .Or. "ISEN"$SA4->A4_INSEST,"N","S")
CodINCRA   C 020 0 SPACE(20)
Grupo      N 004 0 0
RegCACEL   N 001 0 0
TipoPessoa C 001 0 RetPessoa(SA4->A4_CGC)
Suframa    C 015 0 SPACE(15)
ZonaFranca N 009 0 0
PIS_PASEP  N 011 0 0
CEP_Caixa  N 008 0 0
CaixaPosta N 020 0 0
InscINSS   N 012 0 0
Telefone   C 010 0 SA4->A4_DDD+SA4->A4_TEL
Fax        C 010 0 SA4->A4_DDD+SA4->A4_TEL
CodMunicip C 007 0 UfCodIBGE(SA4->A4_EST)+SA4->A4_COD_MUN
DtIniVig   C 008 0 "0101"+Str(Year(MV_PAR01),4)
Desativado N 007 0 0
Desativado N 006 0 0


[XXX MONTA HISTORICO PARTICIPANTES]
(PRE) MontHist(_aTotal[55],_aTotal[56],,aFilsCalc)

 
[T91I HISTORICO DE PARTICIPANTE]
(ARQ) _aTotal[30]+".91"
(PRE) DbGoTop()
CodParti   C 028 0 T91I->CODPART
DatInVig   C 008 0 T91I->DATINVI
CatParti   C 001 0 T91I->CATPART
NomeCampo  C 030 0 T91I->NOMECPO
ValCamAlf  C 070 0 T91I->VALOALF
ValCamNum  N 018 0 T91I->VALONUM
ValCamDat  C 008 0 T91I->VALDATA
DatUlAlte  C 008 0 FormDate(T91I->DATALTE,.F.)
ProcAlte   C 020 0 T91I->PROCALT
UsuaAlte   C 015 0 T91I->USUALTE
ComplAlf   C 030 0 T91I->COMPALF


[SB1 PRODUTOS ]
(ARQ) _aTotal[30]+".75"
(PRE) _aTotal[60] := { {"ME","00"},{"MP","01"},{"PI","06"},{"PA","04"},{"MC","07"},{"MO","09"} }
(PRE) _aTotal[61] := 0
(PRE) _aTotal[62] := "99"
(PRE) SB1->(dbSetOrder(1))
(PRE) SB1->(MsSeek(xFilial("SB1")))
(PREREG) SB1->B1_FILIAL == xFilial("SB1")
(PREREG) ASCAN(_aTotal[57],SB1->B1_COD)>0
(PREREG) (_aTotal[61] := ASCAN(_aTotal[60],{|x| x[1]==SB1->B1_TIPO}),.T.)
(PREREG) (_aTotal[62] := IIF(_aTotal[61]>0,_aTotal[60][_aTotal[61]][2],"99"),.T.)         
Tipo   	   C 002 0 SPACE(2)
DataInic   C 008 0 FormDate(MV_PAR01,.F.)
DataFim    C 008 0 FormDate(MV_PAR02,.F.)
CodProduto C 014 0 Iif(Len(AllTrim(SB1->B1_COD))>14,SubStr(SB1->B1_COD,Len(AllTrim(SB1->B1_COD))-14+1,Len(AllTrim(SB1->B1_COD))),SB1->B1_COD)
NCM        C 008 0 Left(SB1->B1_POSIPI,8)
Descricao  C 053 0 SB1->B1_DESC
Unidade    C 006 0 SB1->B1_UM
SitTribut  C 003 0 SB1->B1_ORIGEM+SB1->B1_CLASFIS
AliqIPI	   N 005 2 SB1->B1_IPI
AliqICMS   N 005 2 SB1->B1_PICM
ReducBase  N 005 2 0
BaseICMS   N 012 2 0
Incentivad C 001 0 SPACE(1)
ClasFiscal C 010 0 SB1->B1_POSIPI
ProdutoSE  N 005 0 0
TipProduto N 005 0 1
NrClasAval N 004 0 0
ClassDIEF  N 003 0 0
CodGenItem N 006 0 Val(Iif(Empty(SB1->B1_CODISS),Left(SB1->B1_POSIPI,2),"00"))
CodBarras  C 016 0 SB1->B1_CODBAR
CdAnterior C 014 0 SB1->B1_CODANT
CodigoEX   C 003 0 SB1->B1_EX_NCM
Desativado C 003 0 "000"
Desativado N 010 4 0
TipoItem   C 002 0 _aTotal[62]
CodServISS N 004 0 Val(SB1->B1_CODISS)
CodEnqIPI  C 003 0 SPACE(3)
CodCombANP C 010 0 SPACE(10)
DtVigen    C 008 0 FormDate(SB1->B1_VIGENC,.F.)
CodBarra   C 255 0 SB1->B1_CODBAR  
CodProduto C 060 0 SB1->B1_COD   
Desativado N 004 0 0


[XXX MONTA HISTORICO PRODUTO]
(PRE) MontHist(,,_aTotal[57], aFilsCalc)


[T92I HISTORICO DE PRODUTOS]
(ARQ) _aTotal[30]+".92"
(PRE) DbGoTop()
Desativado C 014 0 ""
DtVigen    C 008 0 T92I->DTVIGEN
NomeCampo  C 030 0 T92I->NOMECPO
ValCampAlf C 070 0 T92I->VLCPOALF
ValCampNum N 018 0 T92I->VLCPONUM
ValCampDat C 008 0 T92I->VLCPODAT
DataUltima C 008 0 FormDate(T92I->DATULT,.F.)
ProcUltima C 020 0 T92I->PROCULT
UsuaUltima C 015 0 T92I->USUAULT
CodAntItem C 060 0 T92I->CODANTIT
CodProduto C 060 0 T92I->CODPROD


[SB1 FATORES DE CONVERSÃO ]
(ARQ) _aTotal[30]+".180"
(PRE) _aTotal[90] := {"SB1",""}
(PRE) _aTotal[91] := "B1_FILIAL='"+xFilial("SB1")+"' AND B1_SEGUM <> '' AND B1_CONV > 0 "
(PRE) _aTotal[92] := "B1_FILIAL='"+xFilial("SB1")+"' .And. !Empty(B1_SEGUM) .And. B1_CONV > 0 "
(PRE) FsQuery(_aTotal[90],1,_aTotal[91],_aTotal[92],SB1->(IndexKey()),,,,,,,aFilsCalc)
Desativado C 014 0 ""
UnidConv   C 003 0 SB1->B1_SEGUM
FatorConv  N 016 6 SB1->B1_CONV
CodProduto C 020 0 SB1->B1_COD
(POS) FsQuery(_aTotal[90],2)


[SAH UNIDADE DE MEDIDA ]
(ARQ) _aTotal[30]+".140"
(PRE) SAH->(dbSetOrder(1)) 
(PRE) SAH->(MsSeek(xFilial("SAH")))
(PREREG) SAH->AH_FILIAL == xFilial("SAH")
CodigoUM   C 003 0 SAH->AH_UNIMED
Descricao  C 255 0 SAH->AH_DESCPO


[SF4 NATUREZA DE OPERAÇÃO ]
(ARQ) _aTotal[30]+".150"
(PRE) SF4->(dbSetOrder(1)) 
(PRE) SF4->(MsSeek(xFilial("SF4")))
(PREREG) SF4->F4_FILIAL == xFilial("SF4")
Codigo     C 010 0 SF4->F4_CODIGO
Descrição  C 200 0 SF4->F4_TEXTO
CFOP       C 018 0 SF4->F4_CF
NTCIAP     C 001 0 "N"
NFCIAP     C 001 0 SF4->F4_CIAP
AtIniCred  C 001 0 "N"
CVAtivo    C 001 0 SF4->F4_ATUATF


[CCE INFORMACOES COMPLEMENTARES DO DOCUMENTO FISCAL ]
(ARQ) _aTotal[30]+".160"
(PRE) CCE->(dbSetOrder(1)) 
(PRE) CCE->(MsSeek(xFilial("CCE")))
(PREREG) CCE->CCE_FILIAL == xFilial("CCE")
CodInformC N 006 0 Val(CCE->CCE_COD)
Informacao C 100 0 CCE->CCE_DESCR


[CC8 OBSERVAÇÕES DO DOCUMENTO FISCAL ]
(ARQ) _aTotal[30]+".170"
(PRE) CC8->(dbSetOrder(1)) 
(PRE) CC8->(MsSeek(xFilial("CC8")))
(PREREG) CC8->CC8_FILIAL == xFilial("CC8")
CodInformC C 006 0 CC8->CC8_CODIGO
Informacao C 100 0 CC8->CC8_DESCR


//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Inventario (bloco H)                                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
[XXX INVENTARIO]
[XXX INVENTARIO]
(PRE) FsEstInv(_aTotal[77], 1, .T., .F., MV_PAR02,,,,,,,,,,aFilsCalc, .T.)


[INV INVENTARIO]
(ARQ) _aTotal[30]+".74"
(PRE) SB1->(dbSetOrder(1))
(PRE) SA1->(dbSetOrder(3))
(PRE) SA2->(dbSetOrder(3))
(PRE) dbGoTop()
(PREREG) (SB1->(MsSeek(xFilial("SB1")+INV->CODIGO)))
(PREREG) (_aTotal[25] := SA1->(DbSeek(xFilial("SA1")+Alltrim(INV->CNPJ))),.T.)
(PREREG) (SA2->(DbSeek(xFilial("SA2")+Alltrim(INV->CNPJ))),.T.)
Dt_Invent  C 008 0 FormDate(MV_PAR02,.F.)
Indicador  C 001 0 Iif (INV->SITUACA=="2", "2", Iif (INV->SITUACA=="3", "1", "0"))
Desativado C 020 0 ""
Quantidade N 014 3 INV->QUANT
Vl_Total   N 015 2 INV->CUSTO
CNPJ       C 014 0 INV->CNPJ
InscEstad  C 014 0 IF(_aTotal[25], SA1->A1_INSCR, SA2->A2_INSCR)
UF         C 002 0 IF(_aTotal[25], SA1->A1_EST, SA2->A2_EST)
NCMercosul C 010 0 SB1->B1_POSIPI
PrecoUnit  N 013 6 (INV->CUSTO / INV->QUANT)
Observacao C 050 0 SPACE(50)
NaturEstoq C 020 0 Tabela("02",SB1->B1_TIPO,.F.)
LocalEstoq C 010 0 SB1->B1_LOCPAD
Categoria  C 001 0 IF(_aTotal[25], "1", "2")
CodPartic  C 014 0 INV->CNPJ
Desativado C 025 0 ""
CodProduto C 060 0 INV->CODIGO
ContaContb C 030 0 SPACE(25)
(POS) FsEstInv (_aTotal[77],2)

