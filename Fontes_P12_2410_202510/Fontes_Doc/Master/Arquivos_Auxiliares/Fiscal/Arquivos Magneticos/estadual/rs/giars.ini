?{"Nome do Arquivo INI","GIARS.INI"}
?{"MP10 Descricao Completa do Arquivo Magnetico","Guia de Informacao e Apuracao de ICMS do estado do Rio Grande do Sul."}
?{"A Quem se Destina","Aos contribuintes do ICMS do Estado do Rio Grande do Sul."}
?{"Objetivo","Validar e transferir a Secretaria de Estado da Fazenda do Rio Grande do Sul um conjunto de informacoes relativas ao ICMS, extraidos dos documentos fiscais emitidos pelos contribuintes do Rio Grande do Sul."}
?{"Prazo de Entrega","Mensal - Todo dia 12."}
?{"Aplicativo Disponibilizado pelo Fisco","GIA"}
?{"Versao do Aplicativo Contemplada pelo Protheus","8.3.4"}
?{"Legislação Contemplada pelo Protheus","Instrução Normativa 045/98, alterada pela IN/DRP 061/03."}
?{"Comentarios",""}
[XXX Inicializacao]
(PRE) GIARSSX1()
(PRE) _aTotal[01] := MV_PAR01
(PRE) _aTotal[02] := MV_PAR02
(PRE) _aTotal[11] := MV_PAR04
(PRE) _aTotal[12] := MV_PAR05
(PRE) _aTotal[13] := GetNewPar ("MV_QACMP09","")
(PRE) _aTotal[99] := pergunte("GIARS",.T.)
(PRE) _aTotal[03] := MV_PAR01
(PRE) _aTotal[04] := MV_PAR02
(PRE) _aTotal[05] := MV_PAR03
(PRE) _aTotal[06] := MV_PAR04
(PRE) _aTotal[07] := MV_PAR05
(PRE) _aTotal[08] := MV_PAR06
(PRE) _aTotal[09] := MV_PAR07
(PRE) _aTotal[10] := MV_PAR08
(PRE) _aTotal[18] := MV_PAR09
(PRE) _aTotal[19] := MV_PAR10
(PRE) _aTotal[30] := 0
(PRE) _aTotal[34] := MV_PAR11
(PRE) _aTotal[35] := MV_PAR12
(PRE) _aTotal[36] := MV_PAR13
(PRE) _aTotal[37] := MV_PAR14
(PRE) _aTotal[25] := MV_PAR15
(PRE) _aTotal[27] := MV_PAR16
(PRE) _aTotal[38] := MV_PAR17
(PRE) _aTotal[98] := 1
(PRE) _aTotal[94] := 0
(PRE) _aTotal[77] := 0
(PRE) _aTotal[76] := 0
(PRE) _aTotal[75] := 0
(PRE) _aTotal[74] := 0
(PRE) _aTotal[72] := 0
(PRE) _aTotal[71] := 0
(PRE) _aTotal[70] := 0
(PRE) _aTotal[69] := 0
(PRE) _aTotal[68] := 0
(PRE) _aTotal[67] := 0
(PRE) _aTotal[66] := 0
(PRE) _aTotal[65] := 0
(PRE) _aTotal[64] := 0
(PRE) _aTotal[63] := 0
(PRE) _aTotal[62] := 0
(PRE) _aTotal[61] := 0
(PRE) _aTotal[60] := 0
(PRE) _aTotal[59] := 0
(PRE) _aTotal[58] := 0
(PRE) _aTotal[57] := 0
(PRE) _aTotal[56] := 0
(PRE) _aTotal[55] := 0
(PRE) _aTotal[54] := 0
(PRE) _aTotal[53] := 0
(PRE) _aTotal[52] := 0
(PRE) _aTotal[48] := 0
(PRE) _aTotal[47] := 0
(PRE) _aTotal[46] := 0
(PRE) _aTotal[45] := 0
(PRE) _aTotal[44] := 0
(PRE) _aTotal[43] := 0
(PRE) _aTotal[42] := 0
(PRE) _aTotal[41] := 0
(PRE) _aTotal[80] := 0
(PRE) _aTotal[115]:= 0
(PRE) _aTotal[116]:= 0
(PRE) _aTotal[117]:= 0
(PRE) _aTotal[101]:= ResumeF3("IC",_aTotal[01],_aTotal[02],_aTotal[38],.F.,.T.,1,.F.,2,Nil,Nil,_aTotal[95],_aTotal[96],"",.T.,"ICM",.F.,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,Nil,.T.)
(PRE) _aTotal[97] := _aTotal[101][1]
(PRE) _aTotal[102]:= _aTotal[101][2]
(PRE) GIARSIC("ICM")
(PRE) _aTotal[103]:= 0
(PRE) _aTotal[92] := FisApur("IC",val(Substr(DTOS(_aTotal[02]),1,4)),val(Substr(DTOS(_aTotal[02]),5,2)),2,0,_aTotal[38],.F.,{},1,.F.,"")
(PRE) _aTotal[89] := FisApur("IC",val(Substr(DTOS(_aTotal[02]),1,4)),val(Substr(DTOS(_aTotal[02]),5,2)),2,0,_aTotal[38],.F.,{},1,.T.,"OTR")
(PRE) _aTotal[91] := FisApur("ST",val(Substr(DTOS(_aTotal[02]),1,4)),val(Substr(DTOS(_aTotal[02]),5,2)),2,0,_aTotal[38],.F.,{},1,.F.,"")
(PRE) _aTotal[117]:= FisApur("ST",val(Substr(DTOS(_aTotal[02]),1,4)),val(Substr(DTOS(_aTotal[02]),5,2)),2,0,_aTotal[38],.F.,{},1,.T.,"OST")
(PRE) _aTotal[73] := ResumeF3("IC",_aTotal[01],_aTotal[02],_aTotal[38],.F.,.T.,1,.F.,2,Nil,Nil,{},{},"",.F.,"",.F.)
(PRE) _aTotal[33] := ResumeF3("IP",_aTotal[01],_aTotal[02],_aTotal[38],.F.,.T.,1,.F.,2,Nil,Nil,{},{},"",.F.,"",.F.)
(PRE) _aTotal[14]:= 0
(PRE) _aTotal[15]:= 0
(PRE) _aTotal[16]:= 0
(PRE) _aTotal[17]:= 0
(PRE) _aTotal[111]:= 0
(PRE) _aTotal[113]:= 0
(PRE) GIARSXVI(_aTotal[01], _aTotal[02])
(PRE) _aTotal[114]:= GetNewPar("MV_GIACHP","")
(PRE) aEval(_aTotal[92], {|x| _aTotal[69] += Iif(Substr(Alltrim(x[4]),1,6)=="006.00" .and. Substr(Alltrim(x[1]),1,3)=="006",x[3],0)})
(PRE) aEval(_aTotal[92], {|a| _aTotal[65] += Iif(Substr(Alltrim(a[4]),1,6)=="002.00" .and. Substr(Alltrim(a[1]),1,3)=="002",a[3],0)})
(PRE) aEval(_aTotal[92], {|y| _aTotal[64] += Iif(Substr(Alltrim(y[1]),1,3)=="009",y[3],0)})
(PRE) aEval(_aTotal[91], {|b| _aTotal[61] += Iif(Substr(Alltrim(b[1]),1,3)=="016",b[3],0)})
(PRE) aEval(_aTotal[91], {|k| _aTotal[48] += Iif(Substr(Alltrim(k[1]),1,3)=="006",k[3],0)})
(PRE) aEval(_aTotal[91], {|j| _aTotal[47] += Iif(Substr(Alltrim(j[4]),1,6)=="007.00" .and. Substr(Alltrim(j[1]),1,3)=="007",j[3],0)})
(PRE) aEval(_aTotal[91], {|i| _aTotal[46] += Iif(Substr(Alltrim(i[1]),1,3)=="010",i[3],0)})
(PRE) aEval(_aTotal[91], {|l| _aTotal[45] += Iif(Substr(Alltrim(l[1]),1,3)=="001",l[3],0)})
(PRE) aEval(_aTotal[91], {|m| _aTotal[44] += Iif(Substr(Alltrim(m[4]),1,6)=="002.00" .and. Substr(Alltrim(m[1]),1,3)=="002",m[3],0)})
(PRE) aEval(_aTotal[91], {|n| _aTotal[43] += Iif(Substr(Alltrim(n[1]),1,3)=="005",n[3],0)})
(PRE) aEval(_aTotal[73], {|z| _aTotal[67] += Iif(ValType(z[4])=="N".and. alltrim(z[1])$_aTotal[13],z[4],0)})
(PRE) aEval(_aTotal[73], {|w| _aTotal[72] += Iif(ValType(w[4])=="N".and. Substr(alltrim(w[1]),1,1)=="3",w[4],0)})
(PRE) aEval(_aTotal[73], {|d| _aTotal[59] += Iif(ValType(d[4])=="N".and. Substr(alltrim(d[1]),2,2)=="91",d[4],0)})
(PRE) aEval(_aTotal[73], {|e| _aTotal[58] += Iif(ValType(e[4])=="N".and. Substr(alltrim(e[1]),2,2)=="97",e[4],0)})
(PRE) aEval(_aTotal[33], {|f| _aTotal[57] += Iif(ValType(f[11])=="N".and. Substr(alltrim(f[1]),1,1)=="1",f[11]-f[4]-f[46],0)})
(PRE) aEval(_aTotal[33], {|g| _aTotal[56] += Iif(ValType(g[11])=="N".and. Substr(alltrim(g[1]),1,1)=="5",g[11]-g[4]-g[46],0)})
(PRE) aEval(_aTotal[33], {|h| _aTotal[55] += Iif(ValType(h[11])=="N".and. Substr(alltrim(h[1]),1,1)=="2",h[11]-h[4]-h[46],0)})
(PRE) aEval(_aTotal[33], {|m| _aTotal[54] += Iif(ValType(m[11])=="N".and. Substr(alltrim(m[1]),1,1)=="6",m[11]-m[4]-m[46],0)})
(PRE) aEval(_aTotal[33], {|n| _aTotal[53] += Iif(ValType(n[11])=="N".and. Substr(alltrim(n[1]),1,1)=="3",n[11]-n[4]-n[46],0)})
(PRE) aEval(_aTotal[33], {|o| _aTotal[52] += Iif(ValType(o[11])=="N".and. Substr(alltrim(o[1]),1,1)=="7",o[11]-o[4]-o[46],0)})
(PRE) _aTotal[106] := GIARSX(val(Substr(DTOS(_aTotal[02]),5,2)), val(Substr(DTOS(_aTotal[02]),1,4)), _aTotal[01], _aTotal[02] )
(PRE) _aTotal[50] := _aTotal[106][1]
(PRE) _aTotal[49] := _aTotal[106][2]
(PRE) _aTotal[90] := GIARSIV(_aTotal[02])
(PRE) _aTotal[105] := GIARSVAB()
(PRE) _aTotal[100] := _aTotal[105][1]
(PRE) _aTotal[104] := _aTotal[105][2]
(PRE) _aTotal[51] := GetNewPar("MV_GIAVCIE","")
(PRE) _aTotal[93] := GetNewPar("MV_GIABCIO","1116/1117/2116/2117/5116/5117/6116/6117/")
(PRE) _aTotal[29] := {{"001",0,.F.},{"002",0,.F.},{"003",0,.F.},{"004",0,.F.},{"099",0,.F.},{"900",0,.F.}}
(PRE) _aTotal[28] := {{"001",0,.F.},{"002",0,.F.},{"003",0,.F.},{"099",0,.F.}}
(PRE) _aTotal[32] := 0
(PRE) _aTotal[31] := 0
(PRE) (Iif(GetNewPar ("MV_USASPED",.F.),  GIARSLanc( _aTotal[01], _aTotal[02], "CRP", @_aTotal[31] ,@_aTotal[32])   , .T. ) , .T.)
(PRE) (Iif(_aTotal[32]>0 .And. _aTotal[32]<=_aTotal[65], _aTotal[65]-=_aTotal[32], .T. ),.T. )
(PRE) (Iif(_aTotal[31]>0 .And. _aTotal[31]<=_aTotal[69], _aTotal[69]-=_aTotal[31], .T. ),.T. )

(LEG) "(1)- Selecionado para Entrega Completa (S/N)"

[SX6 Consideracao de mais de um parametro para o mesmo fim do parametro MV_GIAVCIE]
(PRE) SX6->(DbSetOrder (1))
(PRE) SX6->(DbSeek (xFilial ("SX6")+"MV_GIAX"))
(PREREG) !SX6->(Eof ()) .And. "MV_GIAX"$SX6->X6_VAR
(PREREG) (_aTotal[51] += SX6->X6_CONTEUD, .T.)

[SX6 Consideracao de mais de um parametro para o mesmo fim do parametro MV_GIABCIO]
(PRE) SX6->(DbSetOrder (1))
(PRE) SX6->(DbSeek (xFilial ("SX6")+"MV_BCIO"))
(PREREG) !SX6->(Eof ()) .And. "MV_BCIO"$SX6->X6_VAR
(PREREG) (_aTotal[93] += SX6->X6_CONTEUD, .T.)

[XXX Observacoes]
(IMP){.T.,31,4, "SEQ08"}
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 SM0->M0_INSC
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "OBS"
SEQ09      C 080 0 "00"+SPACE(78)
(CONT) _aTotal[77]+=1
(POS)

[XXX Contribuinte]
(IMP){.T.,31,4, "SEQ08"}
(CMP){{"SEQ09","CNPJ"},{"SEQ10","Razao Social"},{"SEQ11","Telefone"},{"SEQ12","1  Selecionado para Entrega Completa (S/N)"},{"SEQ13","Codigo de Entrega GIA"}}                                                    
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 SM0->M0_INSC
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "XDC"
SEQ09      C 014 0 aFISFILL(Num2Chr(Val(SM0->M0_CGC),14,0),14)
SEQ10      C 050 0 aFISFILL(SM0->M0_NOMECOM,50)
SEQ11      C 012 0 StrZero(FisGetTel(SM0->M0_TEL)[2],2)+StrZero(FisGetTel(SM0->M0_TEL)[3],9)
SEQ12      C 001 0 Iif (_aTotal[19] == 1,"S","N")
SEQ13      C 006 0 RetChar(_aTotal[08],.T.,.F.,.F.,.T.,.F.,6,.F.)
(CONT) _aTotal[77]+=1
(POS)

[ICM Anexo I]
(IMP){.T.,31,4, "SEQ08"}
(CMP){{"SEQ11","ValorContabil"},{"SEQ12","BaseCalculo"},{"SEQ13","Credito"},{"SEQ14","Isentas"},{"SEQ15","Outras"},{"SEQ16","Excluidas"}}
(PRE) ICM->(dbGotop())
(PRE) _aTotal[77] :=0
(PREREG)  Substr(Alltrim(ICM->CFOP),1,1)$"1#2#3" .and. _aTotal[99]
(PREREG) !(Alltrim(ICM->CFOP)$"1601|1602|1605")
(PREREG) (_aTotal[74]+= IIF(Substr(Alltrim(ICM->CFOP),1,1)$"12",ICM->VALICM,0), .T.)
(PREREG) _aTotal[113] := ICM->(BASEICM-VALCONT)
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 SM0->M0_INSC
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X01 "
SEQ09      C 002 0 "01"
SEQ10      C 004 0 Substr(Alltrim(ICM->CFOP),1,4)
SEQ11      N 013 2 ICM->VALCONT
SEQ12      N 013 2 ICM->BASEICM
SEQ13      N 013 2 IIF(Substr(Alltrim(ICM->CFOP),1,1)$"12",ICM->VALICM,0)
SEQ14      N 013 2 ICM->ISENICM
SEQ15      N 013 2 ICM->OUTRICM
SEQ16      N 016 2 ICM->VLEXCLRS + IIf(_aTotal[113]>0,_aTotal[113],0)
(CONT) _aTotal[77]+=1
(POS)

[AJU Anexo I.c]
(IMP){.T.,31,4, "SEQ08"}
(CMP){{"SEQ10","CFOP"},{"SEQ11","Cod"},{"SEQ12","Valor"},{"SEQ13","Especificacao"}}
(PRE) _aTotal[89] :=0
(PRE) AJU->(dbGotop())
(PREREG) (Left(AJU->CFOP,1)<="3")
(PREREG) _aTotal[113] := AJU->VALAJU
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 SM0->M0_INSC
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X01C"
SEQ09      C 002 0 StrZero(AJU->SEQAJU,2)
SEQ10      C 004 0 Substr(Alltrim(AJU->CFOP),1,4)
SEQ11      C 003 0 AJU->CODAJU
SEQ12      N 013 2 AJU->VALAJU
SEQ13      C 060 0 AJU->ESPAJU
SEQ14      C 010 0 "0000000000"
(CONT) _aTotal[89]+=1
(POS)

[SF3 Anexo II]
(IMP){.T.,31,4, "SEQ08"}
(CMP){{"SEQ10","CGC/TE"},{"SEQ11","Codigo"},{"SEQ12","ValorCredito"}}
(PRE) _aTotal[99]
(PRE) _aTotal[78] :=0
(PRE) SA2->(dbSetOrder(1))
(PRE) _aTotal[107] := {"SF3",""}
(PRE) _aTotal[108] := "F3_FILIAL, F3_CLIEFOR, F3_LOJA, SUM(F3_TRFICM) F3_TRFICM"
//--Clausula "WHERE" para selecao dos registros:
(PRE) _aTotal[109] := "F3_FILIAL = '" + xFilial("SF3") + "' AND "
(PRE) _aTotal[109] += "F3_ENTRADA BETWEEN '" + DTOS(_aTotal[01]) + "' AND '" + DTOS(_aTotal[02]) + "' AND "
(PRE) _aTotal[109] += "F3_CFO IN ('1601','1602','1605') AND "
(PRE) _aTotal[109] += "F3_TRFICM > 0 AND F3_DTCANC = ' ' "
//--Instrucao de filtro p/ IndRegua():
(PRE) _aTotal[110] := "F3_FILIAL == '" + xFilial("SF3") + "' .And. "
(PRE) _aTotal[110] += "DTOS(F3_ENTRADA) >= '"+ DTOS(_aTotal[01]) +"' .And. "
(PRE) _aTotal[110] += "DTOS(F3_ENTRADA) <= '"+ DTOS(_aTotal[02]) +"' .And. "
(PRE) _aTotal[110] += "SubStr(SF3->F3_CFO, 1, 3)$'1601|1602|1605'  .And. "
(PRE) _aTotal[110] += "F3_TRFICM > 0 .And. F3_DTCANC = ' ' "

(PRE) FsQuery(_aTotal[107], 1, _aTotal[109], _aTotal[110], "F3_FILIAL,F3_CLIEFOR,F3_LOJA",,,_aTotal[108],"F3_FILIAL,F3_CLIEFOR,F3_LOJA")
(PRE) DbGoTop()

(PREREG) SA2->(MsSeek(xFilial("SA2")+SF3->F3_CLIEFOR+SF3->F3_LOJA))
(PREREG) (_aTotal[71]+= SF3->F3_TRFICM, .T.)
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 SM0->M0_INSC
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X02 "
SEQ09      C 002 0 "01"
SEQ10      C 010 0 Substr(Alltrim(SA2->A2_INSCR),1,10)
SEQ11      C 003 0 "004"
SEQ12      C 013 0 RetChar(Str(SF3->F3_TRFICM,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
(CONT) _aTotal[78]+=1
(POS) FsQuery(_aTotal[107], 2)

[CRP Anexo III]
(IMP){.T.,31,4, "SEQ08"}
(CMP){{"SEQ10","Codigo"},{"SEQ11","ValorCredito"}}
(PRE) _aTotal[88] :=0
(PRE) CRP->(dbGotop())
(PREREG) _aTotal[99]
(PREREG) CRP->CRDPRES > 0
(PREREG) (_aTotal[103]+= CRP->CRDPRES, .T.)
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 SM0->M0_INSC
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X03 "
SEQ09      C 002 0 "01"
SEQ10      C 003 0 CRP->TABELA
SEQ11      C 013 0 RetChar(Str(CRP->CRDPRES,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ12      N 012 0 IIF(CRP->TABELA=="020",Val(Substr(_aTotal[114],1,12)),0)
(CONT) _aTotal[88]+=1
(POS)

[GIC Anexo IV]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ12","ValorDevido"},{"SEQ13","ValorPago"}}
(PRE) _aTotal[79] :=0
(PRE) GIC ->(dbGotop())
(PREREG) _aTotal[99]
(PREREG) _aTotal[70]+= (GIC->VLPAG)-(GIC->VLDEV), .T.)
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 SM0->M0_INSC
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X04 "
SEQ09      C 002 0 "01"
SEQ10      C 010 0 GIC->PERAPU
SEQ11      C 008 0 GIC->VENCTO
SEQ12      C 013 0 RetChar(Str(GIC->VLDEV,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ13      C 013 0 RetChar(Str(GIC->VLPAG,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
(CONT) _aTotal[79]+= 1
(POS)

[ICM Anexo V]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ11","ValorContabil"},{"SEQ12","BaseCalculo"},{"SEQ13","Debito"},{"SEQ14","Isentas"},{"SEQ15","Outras"},{"SEQ16","Excluidas"}}
(PRE) ICM->(dbGotop())
(PRE) _aTotal[80] :=0
(PREREG)  _aTotal[99]
(PREREG)  Substr(Alltrim(ICM->CFOP),1,1)$"5#6#7" .And. !Substr(Alltrim(ICM->CFOP),1,4)$_aTotal[13]
(PREREG) !(Alltrim(ICM->CFOP)$"5601|5602|5605")
(PREREG) (_aTotal[68]+=ICM->VALICM, .T.) 
(PREREG) _aTotal[113] := ICM->(BASEICM-VALCONT)
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X05 "
SEQ09      C 002 0 "01"
SEQ10      C 004 0 Substr(Alltrim(ICM->CFOP),1,4)
SEQ11      N 013 2 ICM->VALCONT
SEQ12      N 013 2 ICM->BASEICM
SEQ13      N 013 2 ICM->VALICM
SEQ14      N 013 2 ICM->ISENICM
SEQ15      N 013 2 ICM->OUTRICM
SEQ16      N 016 2 ICM->VLEXCLRS + IIf(_aTotal[113]>0,_aTotal[113],0)
(CONT) _aTotal[80]+=1
(POS) _aTotal[113] := 0
(POS)

[VAB Anexo Va]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ10","CFOP"},{"SEQ11","COD"},{"SEQ12","ValorSaida"}}
(PRE) _aTotal[81] :=0 
(PRE) VAB->(dbGotop())
(PREREG)  _aTotal[99]
(PREREG)  VAB->ISENICM > 0 .and. Substr(Alltrim(VAB->CFOP),1,1)$"5#6#7" .And. !Substr(Alltrim(VAB->CFOP),1,4)$_aTotal[13]
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X05A"
SEQ09      C 002 0 "01"
SEQ10      C 004 0 Substr(Alltrim(VAB->CFOP),1,4)
SEQ11      C 003 0 VAB->TABELA
SEQ12      C 013 0 RetChar(Str(VAB->ISENICM,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
(CONT) _aTotal[81]+=1
(POS)

[VAB Anexo Vb]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ10","CFOP"},{"SEQ11","COD"},{"SEQ12","ValorSaida"}}
(PRE) _aTotal[82] :=0
(PRE) VAB->(dbGotop())
(PREREG)  _aTotal[99]
(PREREG)  VAB->OUTRICM > 0 .and. Substr(Alltrim(VAB->CFOP),1,1)$"5#6#7" .And. !Substr(Alltrim(VAB->CFOP),1,4)$_aTotal[13]
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X05B"
SEQ09      C 002 0 "01"
SEQ10      C 004 0 Substr(Alltrim(VAB->CFOP),1,4)
SEQ11      C 003 0 VAB->TABELA
SEQ12      C 013 0 RetChar(Str(VAB->OUTRICM,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
(CONT) _aTotal[82]+=1
(POS)

[AJU Anexo Vc]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ10","CFOP"},{"SEQ11","Cod"},{"SEQ12","Valor"},{"SEQ13","Especificacao"}}
(PRE) _aTotal[101] :=0
(PRE) AJU->(dbGotop())
(PREREG) (Left(AJU->CFOP,1)>="5")
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 SM0->M0_INSC
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X05C"
SEQ09      C 002 0 StrZero(AJU->SEQAJU,2)
SEQ10      C 004 0 Substr(Alltrim(AJU->CFOP),1,4)
SEQ11      C 003 0 AJU->CODAJU
SEQ12      N 013 2 AJU->VALAJU
SEQ13      C 060 0 AJU->ESPAJU
SEQ14      C 010 0 "0000000000"
(CONT) _aTotal[101]+=1
(POS)

[SF3 Anexo VI]
(IMP){.T.,31,4, "SEQ08"}
(CMP){{"SEQ10","CGC/TE"},{"SEQ11","COD"},{"SEQ12","ValorCredito"}}
(PRE) _aTotal[99]
(PRE) _aTotal[83] :=0
(PRE) SA1->(dbSetOrder(1))
(PRE) _aTotal[107] := {"SF3",""}
(PRE) _aTotal[108] := "F3_FILIAL, F3_CLIEFOR, F3_LOJA, SUM(F3_TRFICM) F3_TRFICM"
//--Clausula "WHERE" para selecao dos registros:
(PRE) _aTotal[109] := "F3_FILIAL = '" + xFilial("SF3") + "' AND "
(PRE) _aTotal[109] += "F3_ENTRADA BETWEEN '" + DTOS(_aTotal[01]) + "' AND '" + DTOS(_aTotal[02]) + "' AND "
(PRE) _aTotal[109] += "F3_CFO IN ('5601','5602','5605') AND "
(PRE) _aTotal[109] += "F3_TRFICM > 0 AND F3_DTCANC = ' ' "
//--Instrucao de filtro p/ IndRegua():
(PRE) _aTotal[110] := "F3_FILIAL == '" + xFilial("SF3") + "' .And. "
(PRE) _aTotal[110] += "DTOS(F3_ENTRADA) >= '"+ DTOS(_aTotal[01]) +"' .And. "
(PRE) _aTotal[110] += "DTOS(F3_ENTRADA) <= '"+ DTOS(_aTotal[02]) +"' .And. "
(PRE) _aTotal[110] += "SubStr(SF3->F3_CFO, 1, 4)$'5601|5602|5605'  .And. "
(PRE) _aTotal[110] += "F3_TRFICM > 0 .And. F3_DTCANC = ' ' "

(PRE) FsQuery(_aTotal[107], 1, _aTotal[109], _aTotal[110], "F3_FILIAL,F3_CLIEFOR,F3_LOJA",,,_aTotal[108] ,"F3_FILIAL,F3_CLIEFOR,F3_LOJA")
(PRE) DbGoTop()
(PREREG) (_aTotal[66]+=SF3->F3_TRFICM, .T.)
(PREREG) SA1->(MsSeek(xFilial("SA1")+SF3->F3_CLIEFOR+SF3->F3_LOJA))
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X06 "
SEQ09      C 002 0 "01"
SEQ10      C 010 0 RetChar(Substr(Alltrim(SA1->A1_INSCR),1,10),.T.,.F.,.F.,.T.,.F.,10,.F.)
SEQ11      C 003 0 "103"
SEQ12      C 013 0 RetChar(Str(SF3->F3_TRFICM,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)

(CONT) _aTotal[83]+=1
(POS) FsQuery(_aTotal[107], 2)
(POS)
[ICM ValorST Acumulado para VII]
(PRE) ICM->(dbGotop())
(PREREG)  _aTotal[14]+= Iif(ICM->CFOP<"5",ICM->ICMSRET,0)
(PREREG)  _aTotal[30]+= Iif(ICM->CFOP=="5",ICM->ICMSRET,0)
(POS)

[XXX Anexo VII]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ11","OutrosCreditos"},{"SEQ13","TotalCreditos"},{"SEQ15","OutrosDebitos"},{"SEQ17","TotalDebitos"}}
(PREREG)  Alltrim(SM0->M0_CODIGO)==Alltrim(cEmpAnt) .And. Alltrim(SM0->M0_CODFIL)==Alltrim(cFilAnt) .and. _aTotal[99] .and. _aTotal[10]==1   
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X07 "
SEQ09      C 002 0 "01"
SEQ10      C 013 0 RetChar(Str(_aTotal[14],14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ11      C 013 0 RetChar(Str(_aTotal[47],14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ12      C 060 0 Iif(_aTotal[47] > 0,"Outros Creditos",Space(60))
SEQ13      C 013 0 RetChar(Str(_aTotal[46],14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ14      C 013 0 RetChar(Str(_aTotal[45],14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ15      C 013 0 RetChar(Str(_aTotal[44],14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ16      C 060 0 Iif(_aTotal[44] > 0,"Outros Debitos",Space(60))
SEQ17      C 013 0 RetChar(Str(_aTotal[30],14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
(POS)

[ICM Anexo VIIa]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ10","CFOP"},{"SEQ11","BaseCalculo"},{"SEQ12","Crédito"}}
(PRE) ICM->(dbGotop())
(PRE) _aTotal[84] :=0
(PREREG)  _aTotal[99] .and. _aTotal[10]==1
(PREREG)  ICM->BASERET > 0 .and. ICM->ICMSRET > 0 .and. Substr(Alltrim(ICM->CFOP),1,1)$"1|2"
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X07A"
SEQ09      C 002 0 "01"
SEQ10      C 004 0 Substr(Alltrim(ICM->CFOP),1,4)
SEQ11      C 013 0 RetChar(Str(ICM->BASERET,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ12      C 013 0 RetChar(Str(ICM->ICMSRET,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
(CONT) _aTotal[84]+=1
(POS)

[ICM Anexo VIIb]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ10","CFOP"},{"SEQ11","BaseCalculo"},{"SEQ12","Débito"}}
(PRE) ICM->(dbGotop())
(PRE) _aTotal[85] :=0
(PREREG)  _aTotal[99] .and. _aTotal[10]==1
(PREREG)  ICM->BASERET > 0 .and. ICM->ICMSRET > 0 .and. Substr(Alltrim(ICM->CFOP),1,1)$"5|7" 
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X07B"
SEQ09      C 002 0 "01"
SEQ10      C 004 0 Substr(Alltrim(ICM->CFOP),1,4)
SEQ11      C 013 0 RetChar(Str(ICM->BASERET,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ12      C 013 0 RetChar(Str(ICM->ICMSRET,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
(CONT) _aTotal[85]+=1
(POS)

[PAG Anexo VIII]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ12","ICMS Proprio"},{"SEQ13","ICMS Subs."},{"SEQ14","CGC / TE"},{"SEQ15","ICMS Ampara"},{"SEQ16","ICMS-St Ampara"}}
(PRE) PAG->(DbGotop())
(PRE) _aTotal[86] :=0
(PREREG)  _aTotal[99]
(PREREG) (_aTotal[63]+= PAG->VLST + PAG->VLICM + PAG->VALFECP + PAG->VFECPST, .T.)
(PREREG) (_aTotal[41]+= PAG->VLICM, .T.)
(PREREG) (_aTotal[115] += PAG->VALFECP, .T.) 
(PREREG) (_aTotal[116] += PAG->VFECPST, .T.)
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X08 "
SEQ09      C 002 0 "01"
SEQ10      C 004 0 Substr(Dtos(_aTotal[01]),7,2)+ Substr(Dtos(_aTotal[02]),7,2)
SEQ11      C 008 0 PAG->VENCTO
SEQ12      C 013 0 RetChar(Str(PAG->VLICM+PAG->VALFECP,14,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ13      C 013 0 RetChar(Str(PAG->VLST+PAG->VFECPST,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ14      C 010 0 RetChar(Substr(Alltrim(_aTotal[09]),1,10),.T.,.F.,.F.,.T.,.F.,10,.F.)
SEQ15      C 013 0 RetChar(Str(PAG->VALFECP,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ16      C 013 0 RetChar(Str(PAG->VFECPST,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
(CONT) _aTotal[86]+= 1
(POS)

[GIA Anexo X]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ12","ICMS Proprio"},{"SEQ13","ICMS Subs."},{"SEQ14","CGC / TE"},{"SEQ15","ICMS Ampara"},{"SEQ16","ICMSST Ampara"}}
(PRE) GIA->(dbGotop())
(PRE) _aTotal[87] :=0 
(PREREG)  _aTotal[99] .And. _aTotal[18]==1
(PREREG) (_aTotal[115] += GIA->VALFECP, .T.) 
(PREREG) (_aTotal[116] += GIA->VFECPST, .T.)       
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X10 "
SEQ09      C 002 0 "01"
SEQ10      C 004 0 Substr(Dtos(_aTotal[01]),7,2)+ Substr(Dtos(_aTotal[02]),7,2)
SEQ11      C 008 0 GIA->VENCTO
SEQ12      C 013 0 RetChar(Str(GIA->VLICM+GIA->VALFECP,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ13      C 013 0 RetChar(Str(GIA->VLST+GIA->VFECPST,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ14      C 010 0 RetChar(Substr(Alltrim(_aTotal[09]),1,10),.T.,.F.,.F.,.T.,.F.,10,.F.)
SEQ15      C 013 0 RetChar(Str(GIA->VALFECP,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ16      C 013 0 RetChar(Str(GIA->VFECPST,14,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
(CONT) _aTotal[87]+=1
(POS)

[OTR Anexo XIV]
(PRE) _aTotal[16] := 0
(PRE) OTR->(dbGoTop())
(PREREG) Alltrim(OTR->CODIGO) == "006" .And. Alltrim(OTR->SUBCOD) <> "006.00"
(PREREG) Alltrim(OTR->CODIGO) == "006" .And. (!"PRESUMIDO"$UPPER(Alltrim(OTR->DESCR)) .And. !"004"$UPPER(Alltrim(OTR->DESCR)))
(PREREG) _aTotal[16] += 1
(PREREG) (IIF("001"$OTR->DESCR,_aTotal[28][1][2]+= OTR->VALOR, IIF("002"$OTR->DESCR, _aTotal[28][2][2]+= OTR->VALOR,IIF("003"$OTR->DESCR,_aTotal[28][3][2]+= OTR->VALOR,_aTotal[28][4][2]+= OTR->VALOR))))

[OTR Anexo XIV]
(PRE) OTR->(dbGoTop())
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ10","Cod"},{"SEQ11","Vl. Credito"},{"SEQ12","Descr."}}
(PREREG) Alltrim(OTR->CODIGO) == "006" .And. Alltrim(OTR->SUBCOD) <> "006.00"
(PREREG) Alltrim(OTR->CODIGO) == "006" .And. (!"PRESUMIDO"$UPPER(Alltrim(OTR->DESCR)) .And. !"004"$UPPER(Alltrim(OTR->DESCR)))
(PREREG) (IIF("001"$OTR->DESCR,_aTotal[28][1][3]== .F., IIF("002"$OTR->DESCR, _aTotal[28][2][3]==.F.,IIF("003"$OTR->DESCR,_aTotal[28][3][3]== .F.,_aTotal[28][4][3]==.F.))))
(PREREG) (IIF("001"$OTR->DESCR,_aTotal[28][1][3]:= .T., IIF("002"$OTR->DESCR, _aTotal[28][2][3]:=.T.,IIF("003"$OTR->DESCR,_aTotal[28][3][3]:= .T.,_aTotal[28][4][3]:=.T.))))
(PREREG) _aTotal[111] += IIF("001"$OTR->DESCR,_aTotal[28][1][2] , IIF("002"$OTR->DESCR, _aTotal[28][2][2],IIF("003"$OTR->DESCR,_aTotal[28][3][2],_aTotal[28][4][2])))
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X14 "
SEQ09      C 002 0 "01"
SEQ10      N 003 0 (Iif("001"$OTR->DESCR,001, IIF("002"$OTR->DESCR,002, IIF("003"$OTR->DESCR,003,099))))
SEQ11      C 013 0 RetChar(str( (IIF("001"$OTR->DESCR,_aTotal[28][1][2] , IIF("002"$OTR->DESCR, _aTotal[28][2][2],IIF("003"$OTR->DESCR,_aTotal[28][3][2],_aTotal[28][4][2])))),11,2),.T.,.F.,.F.,.T.,.F.,13,.F.)  
SEQ12      C 060 0 OTR->DESCR
(POS)

[OTR Anexo XV]
(PRE) _aTotal[17] := 0
(PRE) OTR->(dbGoTop())
(PREREG) Alltrim(OTR->CODIGO) == "002" .And. Alltrim(OTR->SUBCOD) <> "002.00" .OR. Alltrim(OTR->CODIGO) == "900" .And. Alltrim(OTR->SUBCOD) <> "900.00"
(PREREG) Alltrim(OTR->CODIGO) == "002" .And. (!"RESPONSABILIDADE"$UPPER(Alltrim(OTR->DESCR)) .And. !"103"$UPPER(Alltrim(OTR->DESCR))) .OR. Alltrim(OTR->CODIGO) == "900" .And. Alltrim(OTR->SUBCOD) <> "900.00"
(PREREG) _aTotal[17] += 1
(PREREG) (IIF("001"$OTR->DESCR,_aTotal[29][1][2]+= OTR->VALOR, IIF("002"$OTR->DESCR, _aTotal[29][2][2]+= OTR->VALOR,IIF("003"$OTR->DESCR,_aTotal[29][3][2]+= OTR->VALOR, IIF("004"$OTR->DESCR,_aTotal[29][4][2]+= OTR->VALOR, IIF("900"$OTR->CODIGO,_aTotal[29][6][2]+= OTR->VALOR,_aTotal[29][5][2]+= OTR->VALOR))))))

[OTR Anexo XV]
(PRE) OTR->(dbGoTop())
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ10","Cod"},{"SEQ11","Vl. Debito"},{"SEQ12","Descr."}}
(PREREG) Alltrim(OTR->CODIGO) == "002" .And. Alltrim(OTR->SUBCOD) <> "002.00" .OR. Alltrim(OTR->CODIGO) == "900" .And. Alltrim(OTR->SUBCOD) <> "900.00"
(PREREG) Alltrim(OTR->CODIGO) == "002" .And. (!"RESPONSABILIDADE"$UPPER(Alltrim(OTR->DESCR)) .And. !"103"$UPPER(Alltrim(OTR->DESCR))) .OR. Alltrim(OTR->CODIGO) == "900" .And. Alltrim(OTR->SUBCOD) <> "900.00"
(PREREG) (IIF("001"$OTR->DESCR,_aTotal[29][1][3]== .F., IIF("002"$OTR->DESCR, _aTotal[29][2][3]==.F.,IIF("003"$OTR->DESCR,_aTotal[29][3][3]== .F.,IIF("004"$OTR->DESCR,_aTotal[29][4][3]== .F.,IIF("900"$OTR->CODIGO,_aTotal[29][6][3]== .F.,_aTotal[29][5][3]==.F.)))))) 
(PREREG) (IIF("001"$OTR->DESCR,_aTotal[29][1][3]:= .T., IIF("002"$OTR->DESCR, _aTotal[29][2][3]:=.T.,IIF("003"$OTR->DESCR,_aTotal[29][3][3]:= .T.,IIF("004"$OTR->DESCR,_aTotal[29][4][3]:= .T.,IIF("900"$OTR->CODIGO,_aTotal[29][6][3]:= .T.,_aTotal[29][5][3]:=.T.))))))
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X15 "
SEQ09      C 002 0 "01"
SEQ10      N 003 0 (Iif("001"$OTR->DESCR,001, IIF("002"$OTR->DESCR,002, IIF("003"$OTR->DESCR,003,IIF("004"$OTR->DESCR,004,IIF("900"$OTR->CODIGO,007,099))))))
SEQ11      C 013 0 RetChar(str((IIF("001"$OTR->DESCR,_aTotal[29][1][2], IIF("002"$OTR->DESCR, _aTotal[29][2][2],IIF("003"$OTR->DESCR,_aTotal[29][3][2],IIF("004"$OTR->DESCR,_aTotal[29][4][2],IIF("900"$OTR->CODIGO,_aTotal[29][6][2],_aTotal[29][5][2])))))),11,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ12      C 060 0 OTR->DESCR
(POS)

[OST Anexo XV]   
(PRE) OST->(dbGoTop())
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ10","Cod"},{"SEQ11","Vl. Debito"},{"SEQ12","Descr."}}   
(PREREG) Alltrim(OST->CODIGO) == "901" .And. Alltrim(OST->SUBCOD) <> "901.00"
SEQ01      C 004 0 "****"
SEQ02      C 002 0 "08"
SEQ03      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
SEQ04      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
SEQ05      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
SEQ06      C 010 0 Substr(alltrim(SM0->M0_INSC),1,10)
SEQ07      C 004 0 RetChar(str(_aTotal[98]+= 1,4),.T.,.F.,.F.,.T.,.F.,4,.F.)
SEQ08      C 004 0 "X15 "
SEQ09      C 002 0 "01"
SEQ10      N 003 0 008
SEQ11      C 013 0 RetChar(str((OST->VALOR),11,2),.T.,.F.,.F.,.T.,.F.,13,.F.)
SEQ12      C 060 0 OTR->DESCR
(POS)


[XVI Anexo XVI]
(IMP){.T.,31 ,4, "SEQ08"}
(CMP){{"SEQ05","Per"},{"SEQ09","NT"},{"SEQ13","Mun"}, {"SEQ14","Val"}}
(PRE) XVI->(dbGoTop())
(PREREG) _aTotal[99]
SEQ01      C 004 0 XVI->SEQ01
SEQ02      C 002 0 XVI->SEQ02
SEQ03      C 002 0 XVI->SEQ03
SEQ04      C 002 0 XVI->SEQ04
SEQ05      N 006 0 XVI->SEQ05
SEQ06      C 010 0 XVI->SEQ06
SEQ07      N 004 0 XVI->SEQ07
SEQ08      C 004 0 XVI->SEQ08
SEQ09      C 002 0 XVI->SEQ09
SEQ10      C 008 0 XVI->SEQ10
SEQ11      C 016 0 XVI->SEQ11
SEQ12      C 002 0 XVI->SEQ12
SEQ13      C 003 0 XVI->SEQ13
SEQ14      N 016 2 XVI->SEQ14
(POS)

[SFA Campo 35 - Mercadorias destinadas ao Ativo Permanente]
(PRE) _aTotal[20] := {"SFA",""}
(PRE) _aTotal[21] := "FA_FILIAL='"+xFilial("SFA")+"' And FA_DATA>='"+Dtos(_aTotal[01])+"' And FA_DATA<='"+Dtos(_aTotal[02])+"'"
(PRE) _aTotal[22] := "FA_FILIAL=='"+xFilial("SFA")+"' .And. Dtos(FA_DATA)>='"+Dtos(_aTotal[01])+"' .And. Dtos(FA_DATA)<='"+Dtos(_aTotal[02])+"'"
(PRE) _aTotal[23] := IndexKey()
(PRE) _aTotal[24] := 0
(PRE) FsQuery(_aTotal[20],1,_aTotal[21],_aTotal[22],_aTotal[23])
(PRE) dbGoTop()
(POSREG) _aTotal[24] += FA_VALOR
(POS) FsQuery(_aTotal[20],2)


[XXX Cabecalho/Quadros ABCE]
(ORD) TOP
(PRE) _aTotal[26] := Iif( _aTotal[25]>1, GIARSQE(Iif(_aTotal[25]==2,"A","E"), _aTotal[27]), {0,0,0,0,0,0,0,0} )
(PRE) _aTotal[62] := (_aTotal[68]+_aTotal[67]+_aTotal[65]+_aTotal[32])-(_aTotal[74]+_aTotal[72]+_aTotal[69])-(_aTotal[76]+_aTotal[41])-_aTotal[64]
(PRE) _aTotal[62] := If(_aTotal[62]>0,_aTotal[62],0)
(PRE) _aTotal[42] := _aTotal[43]-_aTotal[46]-_aTotal[75] 
(PRE) _aTotal[42] := Iif(_aTotal[42] > 0 .and. _aTotal[10] == 1,_aTotal[42],0) 
(PRE) _aTotal[112] := (_aTotal[68] + _aTotal[67] + _aTotal[32] + _aTotal[66] + (_aTotal[65]-_aTotal[66])) - (_aTotal[74] + _aTotal[72] + _aTotal[71]+ _aTotal[103]+ _aTotal[70]+ _aTotal[111]) - (_aTotal[41]) - _aTotal[60] - _aTotal[64]
(PRE) _aTotal[60] := Iif(_aTotal[112]<0,ABS(_aTotal[112]),0)
(PRE) _aTotal[112] := If(_aTotal[112]>0,_aTotal[112],0)
(PREREG)  Alltrim(SM0->M0_CODIGO)==Alltrim(cEmpAnt) .And. AllTrim(SM0->M0_CODFIL)==Alltrim(cFilAnt) .and. _aTotal[99]
00001      C 004 0 "****"
00002      C 002 0 "08"
00003      C 008 0 "00000000"
00004      C 001 0 "N"
00005      C 002 0 Substr(Dtos(_aTotal[01]),7,2)
00006      C 002 0 Substr(Dtos(_aTotal[02]),7,2)
00007      C 006 0 Substr(DTOS(_aTotal[02]),5,2)+Substr(DTOS(_aTotal[02]),1,4)
00008      C 010 0 SM0->M0_INSC
00009      C 004 0 "0001"
00010      C 004 0 "ABCE"
SEQ01      C 015 0 RetChar(Str(_aTotal[74],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ02      C 015 0 RetChar(Str(_aTotal[72],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ03      C 015 0 RetChar(Str(_aTotal[71],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ04      C 015 0 RetChar(Str(_aTotal[103],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ05      C 015 0 RetChar(Str(_aTotal[70],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ06      C 015 0 RetChar(Str(_aTotal[111],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ07      C 015 0 RetChar(Str(_aTotal[74]+_aTotal[72]+_aTotal[69]+_aTotal[103],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.) 
SEQ08      C 015 0 RetChar(Str(_aTotal[68],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ09      C 015 0 RetChar(Str(_aTotal[67],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ10      C 015 0 RetChar(Str(_aTotal[32],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ11      C 015 0 RetChar(Str(_aTotal[66],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ12      C 015 0 "000000000000000"
SEQ13      C 015 0 RetChar(Str(_aTotal[65]-_aTotal[66],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ14      C 015 0 RetChar(Str(_aTotal[68]+_aTotal[67]+_aTotal[65]+_aTotal[32],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)  
SEQ15      C 001 0 If(_aTotal[10]==1,"S","N")
SEQ16      C 015 0 RetChar(Str(_aTotal[64],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ18      C 015 0 "000000000000000"
SEQ20      C 015 0 RetChar(Str(_aTotal[63]+_aTotal[76]+_aTotal[75],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ21      C 015 0 "000000000000000"
SEQ22      C 015 0 RetChar(Str(_aTotal[42],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ23      C 015 0 RetChar(Str(_aTotal[112],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ25      C 015 0 IIf(_aTotal[18]==1 .And. GIA->VLICM > 0,RetChar(Str(GIA->VLICM,13,2),.T.,.F.,.F.,.T.,.F.,15,.F.),"000000000000000")
SEQ26      C 015 0 "000000000000000" 
SEQ27      C 015 0 RetChar(Str(_aTotal[61],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ28      C 015 0 RetChar(Str(_aTotal[60],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.) 
SEQ29      C 015 0 IIf(_aTotal[18]==1 .And. GIA->VLICM > 0,RetChar(Str(_aTotal[62],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.),"000000000000000")
SEQ31      C 015 0 RetChar(Str(_aTotal[04],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ32      C 006 0 RetChar(Str(_aTotal[05],6),.T.,.F.,.F.,.T.,.F.,6,.F.)
SEQ33      C 015 0 RetChar(Str(_aTotal[06],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ37      C 015 0 "000000000000000"
SEQ38      C 015 0 "000000000000000"
SEQ39      C 015 0 "000000000000000"
SEQ40      C 015 0 "000000000000000"
SEQ41      C 015 0 "000000000000000"
SEQ42      C 015 0 "000000000000000"
SEQ43      C 015 0 RetChar(Str(_aTotal[57]+_aTotal[55]+_aTotal[53],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
SEQ44      C 015 0 RetChar(Str(_aTotal[56]+_aTotal[54]+_aTotal[52],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
00011      C 015 0 RetChar(Str(_aTotal[76],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
00012      C 015 0 RetChar(Str(_aTotal[75],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
00013      C 001 0 If(_aTotal[18]==1 .And. GIA->VLICM > 0,"S","N")
SEQ45      C 016 0 RetChar(Str(_aTotal[26][1],16,2),.T.,.F.,.F.,.T.,.F.,16,.F.)
SEQ46      C 016 0 RetChar(Str(_aTotal[26][2],16,2),.T.,.F.,.F.,.T.,.F.,16,.F.)
SEQ47      C 016 0 RetChar(Str(_aTotal[26][3],16,2),.T.,.F.,.F.,.T.,.F.,16,.F.)
SEQ48      C 016 0 RetChar(Str(_aTotal[26][4],16,2),.T.,.F.,.F.,.T.,.F.,16,.F.)
SEQ49      C 016 0 RetChar(Str(_aTotal[26][5],16,2),.T.,.F.,.F.,.T.,.F.,16,.F.)
SEQ50      C 016 0 RetChar(Str(_aTotal[26][6],16,2),.T.,.F.,.F.,.T.,.F.,16,.F.)
SEQ51      C 016 0 RetChar(Str(_aTotal[26][7],16,2),.T.,.F.,.F.,.T.,.F.,16,.F.)
SEQ52      C 016 0 RetChar(Str(_aTotal[26][8],16,2),.T.,.F.,.F.,.T.,.F.,16,.F.)
ANX01      C 003 0 RetChar(str(_aTotal[77],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX02      C 003 0 RetChar(str(_aTotal[78],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX03      C 003 0 RetChar(str(_aTotal[88],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX3A      C 003 0 "000"
ANX04      C 003 0 RetChar(str(_aTotal[79],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX05      C 003 0 RetChar(str(_aTotal[80],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX5A      C 003 0 RetChar(str(_aTotal[81],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX5B      C 003 0 RetChar(str(_aTotal[82],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX5C      C 003 0 RetChar(str(_aTotal[101],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX06      C 003 0 RetChar(str(_aTotal[83],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX07      C 003 0 Iif(_aTotal[10] == 1,"001","000")
ANX7A      C 003 0 RetChar(str(_aTotal[84],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX7B      C 003 0 RetChar(str(_aTotal[85],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX08      C 003 0 RetChar(str(_aTotal[86],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX09      C 003 0 "000"
ANX10      C 003 0 RetChar(str(_aTotal[87],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX14      C 003 0 RetChar(str(_aTotal[16],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX15      C 003 0 RetChar(str(_aTotal[17],3),.T.,.F.,.F.,.T.,.F.,3,.F.)
ANX16      C 003 0 "000"
00032      C 001 0 Iif(_aTotal[34] == 1,"S","N")
00033      C 001 0 Iif(_aTotal[35] == 1,"S","N")
00034      C 001 0 Iif(_aTotal[36] == 1,"S","N")
00035      C 001 0 Iif(_aTotal[37] == 1,"S","N")
SEQ24      C 015 0 RetChar(Str(_aTotal[115]+_aTotal[116],13,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
00037      C 015 0 RetChar(Str(0,14,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
00038      C 015 0 RetChar(Str(0,14,2),.T.,.F.,.F.,.T.,.F.,15,.F.)
(POSREG)
(POS)

[XXX Encerramento]
(PRE) dbSelectArea("ICM")
(PRE) dbCloseArea()
(PRE) Ferase(_aTotal[97]+GetDBExtension())
(PRE) Ferase(_aTotal[97]+OrdBagExt())
(PRE) dbSelectArea("GIC")
(PRE) dbCloseArea()
(PRE) Ferase(_aTotal[90]+GetDBExtension())
(PRE) Ferase(_aTotal[90]+OrdBagExt())
(PRE) dbSelectArea("GIA")
(PRE) dbCloseArea()
(PRE) Ferase(_aTotal[50]+GetDBExtension())
(PRE) Ferase(_aTotal[50]+OrdBagExt())
(PRE) dbSelectArea("PAG")
(PRE) dbCloseArea()
(PRE) Ferase(_aTotal[49]+GetDBExtension())
(PRE) Ferase(_aTotal[49]+OrdBagExt())
(PRE) dbSelectArea("VAB")
(PRE) dbCloseArea()
(PRE) Ferase(_aTotal[100]+GetDBExtension())
(PRE) Ferase(_aTotal[100]+OrdBagExt())
(PRE) dbSelectArea("NFSF3")
(PRE) dbCloseArea()
(PRE) Ferase(_aTotal[102]+GetDBExtension())
(PRE) Ferase(_aTotal[102]+OrdBagExt())
(PRE) dbSelectArea("CRP")
(PRE) dbCloseArea()
(PRE) Ferase(_aTotal[104]+GetDBExtension())
(PRE) Ferase(_aTotal[104]+OrdBagExt())
(PRE) dbSelectArea("SA1")
