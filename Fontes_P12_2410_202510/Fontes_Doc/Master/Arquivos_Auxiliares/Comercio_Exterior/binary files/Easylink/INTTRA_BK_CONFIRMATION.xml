<?xml version="1.0" encoding="ISO-8859-1" ?>
<EASYLINK>
   <SERVICE>
      <ID>002</ID>
      <XMLEX>cNomFile</XMLEX>
      <INSERT_FIELDS Activated = "Y"/>
      <DATA_SELECTION>
         <!--Gravação da tabela do I-Monitor-->
         <ALIAS_01>"EYM"</ALIAS_01>
         <CMD_01>EYM->(DbGoTo(WKEYM1->WK_RECNO))</CMD_01>
         <CMD_02>EYM->(RecLock("EYM",.F.))</CMD_02>
         <EYM_STATUS ISFIELD = "'S'">"D"</EYM_STATUS>
         <!--Identificação do Documento XML -->
         <EYM_ID_DOC ISFIELD = '"S"'>#TAGEX Message\Header\DocumentIdentifier#</EYM_ID_DOC>
         <REF_NUM>#TAGEX Message\MessageBody\MessageProperties\ReferenceInformation:ReferenceType#</REF_NUM>
         <FOR_01
            REPL = '"1"'
            INI = "1"
            TO = "Len(#TAG REF_NUM#)"
            VAR = "'nInc'"
            STEP = "1">
            <IF_01 COND = '#TAG REF_NUM#[nInc] == "ShipperIdentifyingNumber"'>
               <EYM_PROC ISFIELD = '"S"'>#TAGEX Message\MessageBody\MessageProperties\ReferenceInformation#[nInc]</EYM_PROC>
            </IF_01>
            <IF_02 COND = '#TAG REF_NUM#[nInc] == "INTTRABookingNumber"'>
               <EYM_BKINTT ISFIELD = '"S"'>#TAGEX Message\MessageBody\MessageProperties\ReferenceInformation#[nInc]</EYM_BKINTT>
            </IF_02>
            <IF_03 COND = '#TAG REF_NUM#[nInc] == "BookingNumber"'>
               <EYM_BOOK ISFIELD = '"S"'>#TAGEX Message\MessageBody\MessageProperties\ReferenceInformation#[nInc]</EYM_BOOK>
            </IF_03>
         </FOR_01>
         <!--Status do Retorno -->
         <EYM_ST_MES ISFIELD = '"S"'>AllTrim(#TAGEX Message\MessageBody\MessageProperties\ShipmentID\Shipmentidentifier:MessageStatus#)</EYM_ST_MES>
         <EYM_DATABK ISFIELD = '"S"'>SToD(Left(#TAGEX Message\MessageBody\MessageProperties\DateTime#, 8))</EYM_DATABK>
         <EYM_HORABK ISFIELD = '"S"'>SubStr(#TAGEX Message\MessageBody\MessageProperties\DateTime#, 9, 2) + ":" + SubStr(#TAGEX Message\MessageBody\MessageProperties\DateTime#, 11, 2)</EYM_HORABK>
         <ALIAS_02>"EEC"</ALIAS_02>
         <ORDER_02>1</ORDER_02>
         <SEEK_02>xFilial("EEC")+AvKey(EYM->EYM_PROC, "EEC_PREEMB")</SEEK_02>
         <CMD_03>EEC->(RecLock("EEC", .F.))</CMD_03>
         <!--Data de Geração do Booking -->
         <EEC_DTFCPR ISFIELD = '"S"'>SToD(Left(#TAGEX Message\MessageBody\MessageProperties\DateTime#, 8))</EEC_DTFCPR>
         <!--Número da Viagem -->
         <EEC_VIAGEM ISFIELD = '"S"'>#TAGEX Message\MessageBody\MessageProperties\TransportationDetails\ConveyanceInformation\VoyageTripNumber#</EEC_VIAGEM>
         <!--Tipo da Localidade -->
         <TIPO_LOC>#TAGEX Message\MessageBody\MessageProperties\TransportationDetails\Location:LocationType#</TIPO_LOC>
         <!--Tipo do código da Localidade -->
         <TIPO_COD_LOC>#TAGEX Message\MessageBody\MessageProperties\TransportationDetails\Location\LocationCode:Agency#</TIPO_COD_LOC>
         <!--Código da Localidade -->
         <COD_LOC>#TAGEX Message\MessageBody\MessageProperties\TransportationDetails\Location\LocationCode#</COD_LOC>
         <ALIAS_03>"EXL"</ALIAS_03>
         <ORDER_03>1</ORDER_03>
         <SEEK_03>xFilial("EXL")+EEC->EEC_PREEMB</SEEK_03>
         <CMD_04>EXL->(RecLock("EXL",.F.))</CMD_04>
         <!--Atualiza a via de transporte -->
         <CMD_05>FRM102AtuVia(#TAG TIPO_LOC#, #TAG TIPO_COD_LOC#, #TAG COD_LOC#)</CMD_05>
         <FOR_02
            REPL = '"1"'
            INI = "1"
            TO = "Len(#TAG REF_NUM#)"
            VAR = "'nInc'"
            STEP = "1">
            <IF_01 COND = '#TAG REF_NUM#[nInc] == "INTTRABookingNumber"'>
               <!--Número de Referencia do Booking no Inttra -->
               <EXL_BKRFIN>#TAGEX Message\MessageBody\MessageProperties\ReferenceInformation#[nInc]</EXL_BKRFIN>
            </IF_01>
            <IF_02 COND = '#TAG REF_NUM#[nInc] == "BookingNumber"'>
               <!--Número do Referencia do Booking no Armador (Reserva de Praça) -->
               <EXL_BOOK>#TAGEX Message\MessageBody\MessageProperties\ReferenceInformation#[nInc]</EXL_BOOK>
            </IF_02>
         </FOR_02>
         <!--Tipo de Movimento -->
         <TIPO_MOV>#TAGEX Message\MessageBody\MessageProperties\HaulageDetails:MovementType#</TIPO_MOV>
         <!--Tipo de Movimento -->
         <IF_01 COND = '#TAG TIPO_MOV# == "PortToPort"'>
            <IF_01 COND = "EXL_TIPMOV != '1'">
               <EXL_TIPMOV ISFIELD = '"S"'>"1"</EXL_TIPMOV>
            </IF_01>
         </IF_01>
         <IF_02 COND = '#TAG TIPO_MOV# == "DoorToPort"'>
            <IF_01 COND = "EXL_TIPMOV != '2'">
               <EXL_TIPMOV ISFIELD = '"S"'>"2"</EXL_TIPMOV>
            </IF_01>
         </IF_02>
         <IF_03 COND = '#TAG TIPO_MOV# == "PortToDoor"'>
            <IF_01 COND = "EXL_TIPMOV != '3'">
               <EXL_TIPMOV ISFIELD = '"S"'>"3"</EXL_TIPMOV>
            </IF_01>
         </IF_03>
         <IF_04 COND = '#TAG TIPO_MOV# == "DoorToDoor"'>
            <IF_01 COND = "EXL_TIPMOV != '4'">
               <EXL_TIPMOV ISFIELD = '"S"'>"4"</EXL_TIPMOV>
            </IF_01>
         </IF_04>
         <!--Tipos de Datas Relacionadas à Localidade -->
         <TIPO_DATA_LOC>#TAGEX Message\MessageBody\MessageProperties\TransportationDetails\Location:LocationType#</TIPO_DATA_LOC>
         <!--Datas Relacionadas à Localidade -->
         <DATA_LOC>#TAGEX Message\MessageBody\MessageProperties\TransportationDetails\Location\DateTime#</DATA_LOC>
         <CMD_06>Frm102AtuDatas(#TAG TIPO_DATA_LOC#, #TAG DATA_LOC#)</CMD_06>
         <!--Destrava os arquivos -->
         <CMD_06>EYM->(MsUnlock())</CMD_06>
         <CMD_07>EEC->(MsUnlock())</CMD_07>
         <CMD_08>EXL->(MsUnlock())</CMD_08>
         <!--Comentários Referentes ao Booking -->
         <EXL_CBKCOM ISFIELD = "'S'">MSMM(,AVSX3("EXL_BKCOM",3),,#TAGEX Message\MessageBody\MessageProperties\Instructions\ShipmentComments#,1,,,"EXL","EXL_CBKCOM")</EXL_CBKCOM>
      </DATA_SELECTION>
      <DATA_SEND>
         <SEND>''</SEND>
      </DATA_SEND>
      <DATA_RECEIVE>
         <SRV_STATUS>.T.</SRV_STATUS>
      </DATA_RECEIVE>
   </SERVICE>
</EASYLINK>
