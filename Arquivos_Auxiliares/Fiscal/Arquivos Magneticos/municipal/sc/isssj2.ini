?{"Nome do Arquivo INI","ISSSJ2.INI"}
?{"Descrição Completa do Arquivo MagnÉtico","ISS Digital - Declaração Mensal de Serviços 2 "}
?{"A Quem se Destina","Prestadores e Tomadores de Serviços, seja de direito público ou privado, inscritos no município de São José - SC"}
?{"Objetivo","Emissão da Guia de Recolhimento de ISS com código de barras; Recibo de Retenção na Fonte; Livro Fiscal Eletrônico; Declaração Digital de Serviços para ser entregue ao fisco municipal."}
?{"Prazo de Entrega","Até o dia 20 do mês subsequente á ocorrência do fato gerador."}
?{"Aplicativo Disponibilizado pelo Fisco","ISS DIGITAL"}
?{"Versao do Aplicativo Contemplada pela Microsiga",""}
?{"Comentarios",""}

[XXX Inicializacao]
(PRE) _aTotal[01] := MV_PAR01
(PRE) _aTotal[02] := MV_PAR02
(PRE) _aTotal[06] := Alltrim(Upper(GetNewPar("MV_CIDADE","")))
(PRE) _aTotal[07] := cFilAnt
(PRE) _aTotal[08] := cEmpAnt

(PRE) _aTotal[96] := {}
(PRE) _aTotal[97] := {}
(PRE) _aTotal[98] := {}
(PRE) _aTotal[99] := {}

[XXX Montagem do CFP Utilizado pela rotina - PRINCIPAL]
(PRE) aAdd (_aTotal[98], "Processamento do ISS Digital 2 - São José-SC")
(PRE) aAdd (_aTotal[98], "")
(PRE) aAdd (_aTotal[98], "Preencha corretamente as informações solicitadas.")
(PRE) aAdd (_aTotal[98], "Informações necessárias para o preenchimento automático do ISS Digital - Declaração Mensal de Serviços 2 - São José - SC.")

[XXX Montagem do CFP Utilizado pela rotina - COMPLEMENTAR]
(PRE) aAdd (_aTotal[99], {})
(PRE) aAdd (_aTotal[99][1], "Processamento do ISS Digital - São José-SC")
(PRE) aAdd (_aTotal[99][1], "Informações necessárias para geração do ISS Digital.")
(PRE) aAdd (_aTotal[99][1], {})
(PRE) aAdd (_aTotal[99][1][3], {1,"Tipo de Declaração? ",,,,,,})
(PRE) aAdd (_aTotal[99][1][3], {3,,,,,{"P - Serviços Prestados","T - Serviços Tomados"},,})
(PRE) aAdd (_aTotal[99][1][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[99][1][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[99][1][3], {1,"Código nacional de cidades? ",,,,,,})
(PRE) aAdd (_aTotal[99][1][3], {3,,,,,{"1 - IBGE","2 - SIAFI"},,})
          
[XXX Chamada do Wizard]
(PRE) _aTotal[97] := xMagWizard( _aTotal[98] , _aTotal[99] , "ISSSJ")
(PRE) Iif(_atotal[97], xMagLeWiz ("ISSSJ", @_aTotal[96], .T.), Nil)
(PRE) lAbtMT950	:= !_atotal[97]

[XXX Seleciona as informacoes dos movimentos do periodo]
(PRE) _aTotal[91] := ISSSJTMP(_aTotal[01],_aTotal[02],Substr(_aTotal[96][1][1],1,1))

[SM0 Registro 1 - Declaração]
(PRE) SM0->(dbGotop())
(PREREG) _aTotal[07] == SM0->M0_CODFIL .and. _aTotal[08] == SM0->M0_CODIGO
IDENTREG   C 001 0 "1"
TIPO       C 001 0 Substr(_aTotal[96][1][1],1,1)
CIDADE     C 001 0 Substr(_aTotal[96][1][2],1,1)
INSCR      C 014 0 SM0->M0_CGC 
NOME       C 050 0 SM0->M0_NOME
DATAINI    C 008 0 DataInt(MV_PAR01)
DATAFIM    C 008 0 DataInt(MV_PAR02)

[SJ2 Registro 2 - Documentos - Prestadores/Tomadores]
(PRE) SJ2->(dbGotop())
IDENTREG   C 001 0 "2"
INSCR      C 014 0 SJ2->INSCR
NOME       C 050 0 SJ2->NOME
SERIENF    C 006 0 SJ2->SDOC
NFINI      C 009 0 SJ2->NFINI
NFFIM      C 009 0 SJ2->NFFIM
EMISSAO    C 008 0 StrZero(Day(SJ2->EMISSAO),2)+StrZero(Month(SJ2->EMISSAO),2)+StrZero(Year(SJ2->EMISSAO),4)
TIPO       C 001 0 SJ2->TIPOREC
SITUACAO   C 001 0 SJ2->SITUACAO
VLRBRUTO   N 015 2 SJ2->VLRBRUTO
LOCALIZA   C 001 0 SJ2->LOCALIZA
CIDADE     C 007 0 SJ2->CIDADE 
{SJ3 Registro 3 - Serviços}
(PRE) SJ3->(DbGotop())
(PRE) SJ3->(DbSeek(SJ2->ID_CAB))
(PREREG) SJ2->ID_CAB==SJ3->ID_CAB
IDENTREG   C 001 0 "3"
CNAE       C 007 0 SJ3->ATIVID
VLRSERV    N 015 2 SJ3->VALSERV

[XXX Excluindo tabelas temporarias]
(PRE) SJDelArq(_aTotal[91])

