#IFNDEF LINUX            
                                                                                                    
	DLL FUNCTION InicializaSerial 	LOCALNAME DW_ABRESER PARAMTYPE PASCAL (iPorta AS INTEGER) AS BOOLEAN LIB "APET.DLL" //Função responsável pela abertura da porta serial.                                  
	DLL FUNCTION FechaSerial		LOCALNAME DW_FECHSER PARAMTYPE PASCAL () AS BOOLEAN LIB "APET.DLL" //Função responsável pelo fechamento da porta serial.
	DLL FUNCTION PortName			LOCALNAME DW_PORNAME PARAMTYPE PASCAL () AS INTEGER LIB "APET.DLL" //Função responsável por retornar o nome da porta serial que está sendo utilizada pela DLL.
	DLL FUNCTION InicializaDll		LOCALNAME DW_INICDLL PARAMTYPE PASCAL (pPath AS PCHAR) AS BOOLEAN LIB "APET.DLL" //Função responsável por inicializar parâmetros internos da dll.
	DLL FUNCTION ResetAutomacao 	LOCALNAME DW_RESEOPE PARAMTYPE PASCAL () AS BOOLEAN LIB "APET.DLL" //Reset na automação em caso de troca de bomba, ou local dos pontos.
	DLL FUNCTION VersaoDll 			LOCALNAME DW_VERSDLL PARAMTYPE PASCAL () AS PCHAR LIB "APET.DLL" //Consulta a versão da biblioteca APET.dll.
	DLL FUNCTION VersaoAutomacao	LOCALNAME DW_VERFIRM PARAMTYPE PASCAL (iEndereco AS INTEGER) AS PCHAR LIB "APET.DLL" //Consulta a versão do firmware APET.
	DLL FUNCTION AutomacaoNumSerie	LOCALNAME DW_NUMSERI PARAMTYPE PASCAL (iEndereco AS INTEGER) AS PCHAR LIB "APET.DLL" //Consulta o número de série do APET.
	DLL FUNCTION ConfiguracaoLaco 	LOCALNAME DW_CONFLAC PARAMTYPE PASCAL (iEndereco AS INTEGER, pConfig AS PCHAR) AS BOOLEAN LIB "APET.DLL" //Retorna dados de configuração dos laços.
	DLL FUNCTION ConfigLacoST 		LOCALNAME DW_RETDSTR PARAMTYPE PASCAL (iEndereco AS INTEGER) AS PCHAR LIB "APET.DLL" //Retorna dados de configuração dos laços em formato string.
	DLL FUNCTION ConfigurarLaco 	LOCALNAME DW_CONFLCB PARAMTYPE PASCAL (iEndereco AS INTEGER, iTipoBomba AS INTEGER, iNumPonto AS INTEGER) AS BOOLEAN LIB "APET.DLL" //Configura número de pontos e tipo de bomba do laço 1.
	DLL FUNCTION ConfigurarLacoRef	LOCALNAME DW_CONLCB1 PARAMTYPE PASCAL (iEndereco AS INTEGER, iTipoBomba AS INTEGER, iNumPonto AS INTEGER, nLaco AS INTEGER) AS BOOLEAN LIB "APET.DLL" //Configura número de pontos e tipo de bomba dos laços.
	DLL FUNCTION AlteraModoPonto 	LOCALNAME DW_MODOPER PARAMTYPE PASCAL (iEndereco AS INTEGER, iPonto AS INTEGER, iModoPonto AS INTEGER) AS BOOLEAN LIB "APET.DLL" //Envia comando para modificar o modo de operação do ponto.
	DLL FUNCTION AlteraPreco 		LOCALNAME DW_MODPBIC PARAMTYPE PASCAL (iEndereco AS INTEGER, iNumBico AS INTEGER, iPreco AS LONG) AS BOOLEAN LIB "APET.DLL" //Envia comando para modificar o preço do bico.
	DLL FUNCTION LePreco 			LOCALNAME DW_LEVALUN PARAMTYPE PASCAL (iEndereco AS INTEGER, iNumBico AS INTEGER) AS LONG LIB "APET.DLL" //Lê o valor do preço unitário do bico.
	DLL FUNCTION LeEncerrante 		LOCALNAME DW_CONVENC PARAMTYPE PASCAL (iEndereco AS INTEGER, iNumBico AS INTEGER) AS LONG LIB "APET.DLL" //Consulta o valor do encerrante no bico.
	DLL FUNCTION LeAbast 			LOCALNAME DW_LEABSTE PARAMTYPE PASCAL (iEndereco AS INTEGER, cSTRAbast AS PCHAR) AS BOOLEAN LIB "APET.DLL" //Faz a leitura do primeiro abastecimento pendente no buffer e incrementa o ponteiro para a próxima posição de memória.
	DLL FUNCTION LeSTAbast			LOCALNAME DW_LEABSTR PARAMTYPE PASCAL (iEndereco AS INTEGER) AS PCHAR LIB "APET.DLL" //Faz a leitura de abastecimento com retorno em string.
	DLL FUNCTION LeMensagem 		LOCALNAME DW_RETFMSG PARAMTYPE PASCAL () AS PCHAR LIB "APET.DLL" //Retorna uma mensagem da fila de mensagens da automação.
	DLL FUNCTION AutorizaAbast 		LOCALNAME DW_PERABAS PARAMTYPE PASCAL (iEndereco AS INTEGER, iNumBico AS INTEGER, pAutoriza AS PCHAR) AS BOOLEAN LIB "APET.DLL" //Permite que o bico realize um abastecimento.
	DLL FUNCTION PreDeterminacao	LOCALNAME DW_PEPREAB PARAMTYPE PASCAL (iEndereco AS INTEGER, iNumBico AS INTEGER, iQuantidade AS LONG, pStr AS PCHAR) AS BOOLEAN LIB "APET.DLL" //Permite que seja predeterminado um abastecimento.

#ELSE     

	DLL FUNCTION InicializaSerial 	LOCALNAME DW_ABRESER PARAMTYPE PASCAL (iPorta AS INTEGER) AS BOOLEAN LIB "APET.SO" //Função responsável pela abertura da porta serial.                                  
	DLL FUNCTION FechaSerial		LOCALNAME DW_FECHSER PARAMTYPE PASCAL () AS BOOLEAN LIB "APET.SO" //Função responsável pelo fechamento da porta serial.
	DLL FUNCTION PortName			LOCALNAME DW_PORNAME PARAMTYPE PASCAL () AS INTEGER LIB "APET.SO" //Função responsável por retornar o nome da porta serial que está sendo utilizada pela DLL.
	DLL FUNCTION InicializaDll		LOCALNAME DW_INICDLL PARAMTYPE PASCAL (pPath AS PCHAR) AS BOOLEAN LIB "APET.SO" //Função responsável por inicializar parâmetros internos da dll.
	DLL FUNCTION ResetAutomacao 	LOCALNAME DW_RESEOPE PARAMTYPE PASCAL () AS BOOLEAN LIB "APET.SO" //Reset na automação em caso de troca de bomba, ou local dos pontos.
	DLL FUNCTION VersaoDll 			LOCALNAME DW_VERSDLL PARAMTYPE PASCAL () AS PCHAR LIB "APET.SO" //Consulta a versão da biblioteca APET.dll.
	DLL FUNCTION VersaoAutomacao	LOCALNAME DW_VERFIRM PARAMTYPE PASCAL (iEndereco AS INTEGER) AS PCHAR LIB "APET.SO" //Consulta a versão do firmware APET.
	DLL FUNCTION AutomacaoNumSerie	LOCALNAME DW_NUMSERI PARAMTYPE PASCAL (iEndereco AS INTEGER) AS PCHAR LIB "APET.SO" //Consulta o número de série do APET.
	DLL FUNCTION ConfiguracaoLaco 	LOCALNAME DW_CONFLAC PARAMTYPE PASCAL (iEndereco AS INTEGER, pConfig AS PCHAR) AS BOOLEAN LIB "APET.SO" //Retorna dados de configuração dos laços.
	DLL FUNCTION ConfigLacoST 		LOCALNAME DW_RETDSTR PARAMTYPE PASCAL (iEndereco AS INTEGER) AS PCHAR LIB "APET.SO" //Retorna dados de configuração dos laços em formato string.
	DLL FUNCTION ConfigurarLaco 	LOCALNAME DW_CONFLCB PARAMTYPE PASCAL (iEndereco AS INTEGER, iTipoBomba AS INTEGER, iNumPonto AS INTEGER) AS BOOLEAN LIB "APET.SO" //Configura número de pontos e tipo de bomba do laço 1.
	DLL FUNCTION ConfigurarLacoRef	LOCALNAME DW_CONLCB1 PARAMTYPE PASCAL (iEndereco AS INTEGER, iTipoBomba AS INTEGER, iNumPonto AS INTEGER, nLaco AS INTEGER) AS BOOLEAN LIB "APET.SO" //Configura número de pontos e tipo de bomba dos laços.
	DLL FUNCTION AlteraModoPonto 	LOCALNAME DW_MODOPER PARAMTYPE PASCAL (iEndereco AS INTEGER, iPonto AS INTEGER, iModoPonto AS INTEGER) AS BOOLEAN LIB "APET.SO" //Envia comando para modificar o modo de operação do ponto.
	DLL FUNCTION AlteraPreco 		LOCALNAME DW_MODPBIC PARAMTYPE PASCAL (iEndereco AS INTEGER, iNumBico AS INTEGER, iPreco AS LONG) AS BOOLEAN LIB "APET.SO" //Envia comando para modificar o preço do bico.
	DLL FUNCTION LePreco 			LOCALNAME DW_LEVALUN PARAMTYPE PASCAL (iEndereco AS INTEGER, iNumBico AS INTEGER) AS LONG LIB "APET.SO" //Lê o valor do preço unitário do bico.
	DLL FUNCTION LeEncerrante 		LOCALNAME DW_CONVENC PARAMTYPE PASCAL (iEndereco AS INTEGER, iNumBico AS INTEGER) AS LONG LIB "APET.SO" //Consulta o valor do encerrante no bico.
	DLL FUNCTION LeAbast 			LOCALNAME DW_LEABSTE PARAMTYPE PASCAL (iEndereco AS INTEGER, cSTRAbast AS PCHAR) AS BOOLEAN LIB "APET.SO" //Faz a leitura do primeiro abastecimento pendente no buffer e incrementa o ponteiro para a próxima posição de memória.
	DLL FUNCTION LeSTAbast			LOCALNAME DW_LEABSTR PARAMTYPE PASCAL (iEndereco AS INTEGER) AS PCHAR LIB "APET.SO" //Faz a leitura de abastecimento com retorno em string.
	DLL FUNCTION LeMensagem 		LOCALNAME DW_RETFMSG PARAMTYPE PASCAL () AS PCHAR LIB "APET.SO" //Retorna uma mensagem da fila de mensagens da automação.
	DLL FUNCTION AutorizaAbast 		LOCALNAME DW_PERABAS PARAMTYPE PASCAL (iEndereco AS INTEGER, iNumBico AS INTEGER, pAutoriza AS PCHAR) AS BOOLEAN LIB "APET.SO" //Permite que o bico realize um abastecimento.
	DLL FUNCTION PreDeterminacao	LOCALNAME DW_PEPREAB PARAMTYPE PASCAL (iEndereco AS INTEGER, iNumBico AS INTEGER, iQuantidade AS LONG, pStr AS PCHAR) AS BOOLEAN LIB "APET.SO" //Permite que seja predeterminado um abastecimento.

#ENDIF   

Function APET(cFunction, aParams, cDelimit, cFimStr)
    
    Local oRet		:= Nil							//Retorno da dll 
    Local cRet 		:= ""
	Local cBuffer 	:= ""                       	//Retorno da funcao
	Local cParam1	:= ""							//Variavel auxiliar
	Local cParam2	:= ""                         	//Variavel auxiliar
	Local cParam3	:= ""							//Variavel auxiliar
	Local cParam4	:= ""							//Variavel auxiliar
	Local cParam5	:= ""							//Variavel auxiliar
	Local nParam1 	:= 0							//Variavel auxiliar
	Local nParam2 	:= 0							//Variavel auxiliar
	Local nParam3 	:= 0							//Variavel auxiliar
	Local nParam4 	:= 0 							//Variavel auxiliar    


	//Executa o comando selecionado
	Do Case
		
		Case cFunction == Upper("InicializaSerial") 
			nParam1 := val(aParams[3])
			oRet := DW_ABRESER(nParam1) 
			IF oRet == .T.
	   			cRet := "T"
	   		else
	   			cRet := "F" 
	   		EndIF
			cBuffer := cRet + cFimStr//Chr(2)

		Case cFunction == Upper("FechaSerial")
	   		oRet := DW_FECHSER()  
	   		IF oRet == .T.
	   			cRet := "T"
	   		else
	   			cRet := "F" 
	   		EndIF
	   		cBuffer := cRet + cFimStr//Chr(2)    
	   		
	   	Case cFunction == Upper("PortName")
	   		oRet := DW_PORNAME()
	   		cBuffer := AllTrim(Str(oRet)) + cFimStr//Chr(2)  
	   		
	   	Case cFunction == Upper("InicializaDll") 
	   		cParam1 := DoEncode(aParams[3])
	   		oRet := DW_INICDLL(cParam1)   
	   		
	   		IF oRet == .T.
	   			cRet := "T"
	   		else
	   			cRet := "F" 
	   		EndIF

	   		cBuffer := cRet + cFimStr//Chr(2)
	   		
	   	Case cFunction == Upper("ResetAutomacao")
	   		oRet := DW_RESEOPE()  
	   		IF oRet == .T.
	   			cRet := "T"
	   		else
	   			cRet := "F" 
	   		EndIF
	   		cBuffer := cRet + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("VersaoDll")
	   		cRet := DW_VERSDLL()
	   		cBuffer := Alltrim(cRet) + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("VersaoAutomacao") 
		   	nParam1 := val(aParams[3])
	   		cRet := DW_VERFIRM(nParam1)
	   		cBuffer := Alltrim(cRet) + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("AutomacaoNumSerie") 
		   	nParam1 := val(aParams[3])
	   		cRet := DW_NUMSERI(nParam1)
	   		cBuffer := AllTrim(cRet) + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("ConfiguracaoLaco")   
		   	nParam1 := val(aParams[3])    
		   	cParam1 := DoEncode(aParams[4])
	   		oRet := DW_CONFLAC(nParam1, cParam1) 
	   		
	   		IF oRet == .T.
	   			cRet := "T"
	   		else
	   			cRet := "F" 
	   		EndIF    
	   		
	   		cBuffer := cRet + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("ConfigLacoST") 
	   		nParam1 := val(aParams[3]) 
	   		cRet := DW_RETDSTR(nParam1)
	   		cBuffer := AllTrim(cRet) + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("ConfigurarLaco")
		   	nParam1 := val(aParams[3])
		   	nParam2 := val(aParams[4])
		   	nParam3 := val(aParams[5]) 
			oRet := DW_CONFLCB(nParam1, nParam2, nParam3) 
			
			IF oRet == .T.
	   			cRet := "T"
	   		else                             	
	   			cRet := "F"                          
	   		EndIF
	   		
	   		cBuffer := cRet + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("ConfigurarLacoRef") 
	   		nParam1 := val(aParams[3])
		   	nParam2 := val(aParams[4])
		   	nParam3 := val(aParams[5])
		   	nParam4 := val(aParams[6])
	   		oRet := DW_CONLCB1(nParam1, nParam2, nParam3, nParam4)
	   		
	   		IF oRet == .T.
	   			cRet := "T"
	   		else
	   			cRet := "F" 
	   		EndIF
	   		
	   		cBuffer := cRet + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("AlteraModoPonto") 
	   		nParam1 := val(aParams[3])
		   	nParam2 := val(aParams[4])
		   	nParam3 := val(aParams[5])
	   		oRet := DW_MODOPER(nParam1, nParam2, nParam3)
	   		
	   		IF oRet == .T.
	   			cRet := "T"
	   		else                                
	   			cRet := "F" 
	   		EndIF
	   		
	   		cBuffer := cRet + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("AlteraPreco") 
		   	nParam1 := val(aParams[3])
		   	nParam2 := val(aParams[4])
		    nParam3 := Doencode(aParams[5])
		  
	   		oRet := DW_MODPBIC(nParam1, nParam2, nParam4)
	   		IF oRet == .T.
	   			cRet := "T"
	   		else
	   			cRet := "F" 
	   		EndIF                                         
	   		cBuffer := cRet + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("LePreco")  
	   		nParam1 := val(aParams[3])
		   	nParam2 := val(aParams[4])                   
	   		cRet := DW_LEVALUN(nParam1, nParam2)
	   		cBuffer := str(cRet) + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("LeEncerrante") 
	   		nParam1 := val(aParams[3])
		   	nParam2 := val(aParams[4])
	   		cRet := DW_CONVENC(nParam1, nParam2)
	   		cBuffer := str(cRet) + cFimStr//Chr(2)
	   		
	   	
	   	Case cFunction == Upper("LeAbast")
	   		nParam1 := val(aParams[3])    
		   	cParam1 := DoEncode(aParams[4])
	   		oRet := DW_LEABSTE(nParam1, cParam1)
	   		cBuffer := AllTrim(Str(oRet)) + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("LeSTAbast")
	   		nParam1 := val(aParams[3])
	   		cRet := DW_LEABSTR(nParam1)
	   		cBuffer := AllTRIM(cRet) + cFimStr//Chr(2)

	   	Case cFunction == Upper("LeMensagem")
	   		cRet := DW_RETFMSG()
	   		cBuffer := AllTrim(cRet) + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("AutorizaAbast") 
		   	nParam1 := val(aParams[3])
		   	nParam2 := val(aParams[4])
	   		cParam1 := DoEncode(aParams[5])
		   	oRet := DW_PERABAS(nParam1, nParam2, cParam1)
		   	IF oRet == .T.
	   			cRet := "T"
	   		else
	   			cRet := "F" 
	   		EndIF
	   		cBuffer := cRet + cFimStr//Chr(2)
	   	
	   	Case cFunction == Upper("PreDeterminacao") 
	   		nParam1 := val(aParams[3])
		   	nParam2 := val(aParams[4])
		   	nParam3 := val(aParams[5])
	   		cParam1 := DoEncode(aParams[6])
	   		oRet := DW_PEPREAB(nParam1, nParam2, nParam3, cParam1) 
	   		IF oRet == .T.
	   			cRet := "T"
	   		else
	   			cRet := "F" 
	   		EndIF
	   		cBuffer := cRet + cFimStr//Chr(2)
	   	
	   	Otherwise
			cBuffer := "Function not found in MPAPET.DLL/SO -> "+ cFunction
			MsgStop(cBuffer, "Library MPAPET")
	
	EndCase
	
Return cBuffer
