?{"Nombre del Archivo INI","RET4ACAT.INI"}
?{"Descripción Completa del Archivo Magnético","Retención IR - cuarta categoría"}
?{"A Quien se Destina","Empresas que contratan servicios de profisionales independientes que perciban renta de cuarta categoría y por eso deben declarar las retenciones efectuadas del impuesto sobre la renta en el PDT 601 - Planilla Electrónica."}
?{"Objetivo","Generar los datos sobre la retención de IR - cuarta categoría para el PDT 601 - Planilla Electrónica."}

[XXX Inicialización]
(PRE) _aTotal[001] := {"SFE",""}
(PRE) _aTotal[002] := "A2_FILIAL = '" + xFilial("SA2") + "' and FE_FILIAL = '" + xFilial("SFE") + "' and E2_FILIAL = '" + xFilial("SE2") + "'"
(PRE) _aTotal[002] += " and FE_TIPO = 'R'"
(PRE) _aTotal[002] += " and FE_EMISSAO >= '" + Dtos(MV_PAR01) + "'"
(PRE) _aTotal[002] += " and FE_EMISSAO <= '" + Dtos(MV_PAR02) + "'"
(PRE) _aTotal[002] += " and A2_COD = FE_FORNECE"
(PRE) _aTotal[002] += " and A2_LOJA = FE_LOJA"
(PRE) _aTotal[002] += " and A2_DOMICIL = '1'"
(PRE) _aTotal[002] += " and E2_FORNECE = FE_FORNECE"
(PRE) _aTotal[002] += " and E2_LOJA = FE_LOJA"
(PRE) _aTotal[002] += " and E2_PREFIXO = FE_SERIE"
(PRE) _aTotal[002] += " and E2_NUM = FE_NFISCAL"
(PRE) _aTotal[002] += " and E2_PARCELA = FE_PARCELA"                                                                                          
(PRE) _aTotal[002] += " and SA2.D_E_L_E_T_=''"
(PRE) _aTotal[002] += " and SFE.D_E_L_E_T_=''"
(PRE) _aTotal[002] += " and SE2.D_E_L_E_T_=''"
(PRE) _aTotal[003] := " A2_TIPDOC,A2_CGC,E2_EMISSAO,FE_SERIE,FE_NFISCAL,FE_VALBASE,FE_EMISSAO,FE_RETENC "
(PRE) _aTotal[004] := RetSqlName("SA2") + " SA2," + RetSqlName("SFE") + " SFE," + RetSqlName("SE2") + " SE2"
(PRE) FsQuery(_aTotal[001],1,_aTotal[002],"","","","",_aTotal[003],"",_aTotal[004])

[SFE Retención de impuestos sobre renta de 4a categoría]
(DEL)|MF
(PRE) _aTotal[005] := "0601" + StrZero(Year(MV_PAR02),4) + StrZero(Month(MV_PAR02),2) + If(Empty(SM0->M0_CGC),"0000000000",Alltrim(SM0->M0_CGC)) + ".4ta"
(PRE) SFE->(dbGoTop())
(ARQ) _aTotal[005]
TPDOC      C 002 0 Substr(A2_TIPDOC,1,2)
NRDOC      C 015 0 AllTrim(A2_CGC)
TPCOMPROB  C 001 0 "R"
SERCOMPOB  C 004 0 AllTrim(FE_SERIE)
NRCOMPROB  C 008 0 Substr(FE_NFISCAL,1,8)
MONTOTTL   C 007 2 Alltrim(Str(FE_VALBASE,9,2))
FECHEMIS   C 010 0 Right(E2_EMISSAO,2) + "/" + Substr(E2_EMISSAO,5,2) + "/" + Left(E2_EMISSAO,4)
FECHPAGO   C 010 0 Right(FE_EMISSAO,2) + "/" + Substr(FE_EMISSAO,5,2) + "/" + Left(FE_EMISSAO,4)
RETENCION  C 001 0 If(FE_RETENC<>0,"1","0")

[XXX Cierre]
(PRE) FsQuery(_aTotal[001],2)