#include "tlpp-core.th"
#include "backoffice.reconciliation.useradmingroup.controller.ch"


namespace totvs.protheus.backoffice.reconciliation.useradmingroup
using namespace totvs.protheus.backoffice.reconciliation.util

//-------------------------------------------------------------------
/*/{Protheus.doc} UserAdminGroup
Classe principal de controle, onde é inicializado o EndPoint

@author Totvs
/*/
//-------------------------------------------------------------------
class UserAdminGroup
    public method new()

    @Get("/api/tc/useradmingroup/")
    public method getAllUserAdminGroup()

     @Get("/api/tc/userconfigs/")
    public method getAllUserConfigs()
endclass

//-------------------------------------------------------------------
/*/{Protheus.doc} UserAdminGroup
Metodo construtor

@author Totvs
/*/
//-------------------------------------------------------------------
method new() class UserAdminGroup
return

//-------------------------------------------------------------------
/*/{Protheus.doc} getAllUserAdminGroups
Metodo que retorna as contas contabeis (Consulta padrão)

@author Totvs
/*/
//-------------------------------------------------------------------
method getAllUserAdminGroup() class UserAdminGroup
    Local oService  As Object
    Local oField    As Object
    Local jResposta As Json
    Local lResponse As Logical
    Local cChaveRes As Character
    Local cResponse As Character

    //Inicilaiza variaveis
    oService  := UserAdminGroupService():getInstance()
    oField    := tcTreatsFilter():new()
    jResposta := JsonObject():new()
    lResponse := .F.
    cChaveRes := "message"
    cResponse :=  STR0001 // "Resposta inválida."

    jResposta := oService:getAllUserAdminGroup()

    oRest:setResponse(jResposta)

return

//-------------------------------------------------------------------
/*/{Protheus.doc} getAllUserConfigs
Metodo que retorna as configurações que o usuário tem acesso

@author Totvs
/*/
//-------------------------------------------------------------------
method getAllUserConfigs() class UserAdminGroup
    Local oService  As Object
    Local oField    As Object
    Local jResposta As Json
    Local lResponse As Logical
    Local cChaveRes As Character
    Local cResponse As Character
    Local cRotina   As Character

    //Inicilaiza variaveis
    oService  := UserAdminGroupService():getInstance()
    oField    := tcTreatsFilter():new()
    cRotina   := oRest:getQueryRequest():GetJsonText("routine")
    jResposta := JsonObject():new()
    lResponse := .F.
    cChaveRes := "message"
    cResponse :=  STR0001 // "Resposta inválida."

    If ValType(cRotina)=="C" .And. !Empty(cRotina) .And. cRotina <> "null"
        jResposta:fromJson(oService:getAllUserConfigs(cRotina))
    Else
        cResponse := STR0002 //"Parâmetro routine não informado"
    EndIf

    IIF(ValType(jResposta:GetJsonText("items")) <> "U" .And. jResposta:GetJsonText("items") <> "null",;
        tcAnswerRest(jResposta, .T.),;
        tcSetResponse(lResponse, cChaveRes, cResponse, .F.))

Return
