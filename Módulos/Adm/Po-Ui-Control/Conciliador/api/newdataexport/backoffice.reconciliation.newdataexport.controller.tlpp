#include "tlpp-core.th"

namespace totvs.protheus.backoffice.reconciliation.newdataexport
using namespace totvs.protheus.backoffice.reconciliation.util

//-------------------------------------------------------------------
/*/{Protheus.doc} NewDataExport
Classe principal de controle, onde é inicializado o EndPoint

@author Totvs
/*/
//-------------------------------------------------------------------
class NewDataExport
    public method new()

    @Get("/api/tc/newdataexport/")
    public method getAllNewDataExports()
endclass

//-------------------------------------------------------------------
/*/{Protheus.doc} NewDataExport
Metodo construtor

@author Totvs
/*/
//-------------------------------------------------------------------
method new() class NewDataExport
return

//-------------------------------------------------------------------
/*/{Protheus.doc} getAllNewDataExports
Metodo que inicia a chamada das configuracoes de match do conciliador

@author Totvs
/*/
//-------------------------------------------------------------------
method getAllNewDataExports() class NewDataExport
    Local oService  As Object
    Local cFilBkp   As Character
    Local lResponse As Logical
    Local cChaveRes As Character
    Local cResponse As Character
    Local aResponse As Array

    //Inicilaiza variaveis
    oService  := NewDataExportService():getInstance()
    cFilBkp   := cFilAnt
    lResponse := .F.
    cChaveRes := "message"
    cResponse := "Resposta inválida."
    aResponse := oService:getAllNewDataExport()

    tcGetHeaders()

    IIf(ValType(aResponse) == "J",;
        tcAnswerRest(aResponse, .T.),;
        tcSetResponse(lResponse, cChaveRes, cResponse, .F.))

    FwFreeArray(aResponse)
    FreeObj(oService)

    cFilAnt := cFilBkp
return
