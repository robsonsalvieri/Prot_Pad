#include "tlpp-core.th"
#include "backoffice.reconciliation.allaccessdefinitions.controller.ch"

namespace totvs.protheus.backoffice.reconciliation.allaccessdefinitions
using namespace totvs.protheus.backoffice.reconciliation.util

/*/{Protheus.doc} AllAccessDefinitions
    Classe principal de controle, onde é inicializado o EndPoint
    @author Totvs
    @since 04/04/2022
    @version 12.1.33
    /*/
Class AllAccessDefinitions
    public method new()

    @Get("/api/tc/allaccessdefinitions/")
    public method AllAccessDefinitions()

EndClass

/*/{Protheus.doc} new
    Metodo construtor
    @author Totvs
    @since 04/04/2022
    @version 12.1.33
/*/
Method new() class AllAccessDefinitions
Return 

//-------------------------------------------------------------------
/*/{Protheus.doc} getAllAccountingCalendar
Metodo que inicia a chamada das configuracoes das definições de fechamento
do Fechamento Contabil

@author Totvs
/*/
//-------------------------------------------------------------------
method AllAccessDefinitions() class AllAccessDefinitions
    Local oService  As Object
    Local jResposta As Json
    Local cFilBkp   As Character
    Local nPage     As Numeric
    Local nPageSize As Numeric
    Local lResponse As Logical
    Local cChaveRes As Character
    Local cResponse As Character

    //Inicilaiza variaveis
    oService  := AllAccessDefinitionsSettingService():getInstance()
    jResposta := JsonObject():new()
    cFilBkp   := cFilAnt
    nPage     := 1
    nPageSize := 10
    lResponse := .F.
    cChaveRes := "message"
    cResponse := STR0001 //"Resposta inválida."
    
    tcGetHeaders()

    tcGetPageAndPageSize(@nPage, @nPageSize)

    jResposta:fromJson(oService:getAllAccessDefinitions(nPage, nPageSize))

    IIf(ValType(jResposta:GetJsonText("items")) <> "U",; 
        tcAnswerRest(jResposta, .T.),;    
        tcSetResponse(lResponse, cChaveRes, cResponse, .F.))

    //Restaura empresa e filial
    cFilAnt := cFilBkp

return
