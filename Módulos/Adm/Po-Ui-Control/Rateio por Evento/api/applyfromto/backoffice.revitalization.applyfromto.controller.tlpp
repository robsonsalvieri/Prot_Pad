#include "tlpp-core.th"
#include "backoffice.revitalization.applyfromto.controller.ch"
          
namespace totvs.protheus.backoffice.revitalization.applyfromto
using namespace totvs.protheus.backoffice.reconciliation.util

//-------------------------------------------------------------------
/*/{Protheus.doc} ApplyFromTo
Classe principal de controle, onde é inicializado o EndPoint

@author Totvs
/*/
//-------------------------------------------------------------------
class ApplyFromTo
    public method new()

    @post("/api/ctb/applyfromto/")
    public method applyFromTo()
endclass

//-------------------------------------------------------------------
/*/{Protheus.doc} ApplyFromTo
Metodo construtor

@author Totvs
/*/
//-------------------------------------------------------------------
method new() class ApplyFromTo
return

//-------------------------------------------------------------------
/*/{Protheus.doc} getEntityFieldInfo
Metodo que inicia a chamada dos agrupadores do ativo fixo

@author Totvs
/*/
//-------------------------------------------------------------------
method applyFromTo() class ApplyFromTo
    local oService  as object
    local jResposta as json
    local lResponse as logical
    local cChaveRes as character
    local cResponse as character
    local ojBody    as json   
    ojBody    := JsonObject():new()
    oService  := ApplyFromToService():getInstance()
    jResposta := JsonObject():new()
    cChaveRes := "message"
    cResponse := STR0001 //"Resposta inválida."
     
    ojBody:fromJson(oRest:getBodyRequest())

    jResposta := oService:applyFromTo(ojBody)

    IIF(ValType(jResposta:GetJsonText("items")) <> "U",;
        tcAnswerRest(jResposta, .T.),;          
        tcSetResponse(lResponse, cChaveRes, cResponse, .F.))

    freeObj(oService)
return
