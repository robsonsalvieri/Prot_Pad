#INCLUDE "PROTHEUS.CH"
#INCLUDE "FWLIBVERSION.CH"
#include "totvs.ch"
#include "msobject.ch"
#include "totvs.framework.treports.integratedprovider.th"
#include "tlpp-rest.th"
#include "tlpp-core.th"

namespace totvs.protheus.backoffice.sv.fat.cancellationanddiscounts.treportsintegratedprovider
using namespace totvs.framework.treports.integratedprovider

@totvsFrameworkTReportsIntegratedProvider(active=.F., team="SIGAFAT", tables="SA1,SB1,SBM,SF4,SF1,SD1,SF2,SD2,SE1,DHI,ADK,ACA,AOY,AOV,CT1,CTT", name="Cancelamentos e Descontos por Agrupador", country="BRA")
//-----------------------------------------------------------------------------------
/*/{Protheus.doc} cancellationanddiscountsSmartViewBusinessObjectBRA
Classe para criação do Objeto de Negócio para Relação de Cancelamentos e Descontos por Agrupador.

@author FAT/CRM
@since 13/11/2023
@version 1.0
*/
//-----------------------------------------------------------------------------------  
class cancellationanddiscountsSmartViewBusinessObjectBRA from totvs.protheus.backoffice.sv.fat.cancellationanddiscounts.treportsintegratedprovider.cancellationanddiscountsSmartViewBusinessObject
    
    public method new() as object
    public method preData() as object
    public method processData() as object
    public method preSchema() as object

    protected data aFields as array
    protected data aStruct as array

endclass
 
//-------------------------------------------------------------------
/*{Protheus.doc} new
Método de instância da classe
 
@return object: self
 
@author FAT/CRM
@since 13/11/2023
@version 1.0
*/
//-------------------------------------------------------------------   
method new() class cancellationanddiscountsSmartViewBusinessObjectBRA 
	
    _Super:new()

return self

//-------------------------------------------------------------------
/*{Protheus.doc} preData
Método chamado antes do getData do objeto principal
 
@return object: self:oData
 
@author FAT/CRM
@since 13/11/2023
@version 1.0
*/
//-------------------------------------------------------------------   
method preData() as object class cancellationanddiscountsSmartViewBusinessObjectBRA

    self:cSelectLoc := " ,MIN(SD2.D2_VALINS) INSS, MIN(SD2.D2_VALIMP6) PIS, MIN(SD2.D2_VALIMP5) COFINS, MIN(SD2.D2_VALICM) ISS "

Return self:oData

//-------------------------------------------------------------------
/*{Protheus.doc} processData
Deverá ser chamado no momento do processamento da query
 
@return object: self:oData
 
@author FAT/CRM
@since 13/11/2023
@version 1.0
*/
//-------------------------------------------------------------------    
method processData(nOperLoc as numeric) as object class cancellationanddiscountsSmartViewBusinessObjectBRA

    Do Case
        //-----------------------------------------------------------
        //Operação 1 será utilizado somente para commit dos 
        //campos antes do appendData 
        //Case (nOperLoc == 1)
        //-----------------------------------------------------------
        Case nOperLoc == 1

            self:jItems["D2VALINS"]  := (self:cAlias)->INSS
            self:jItems["D2VALIMP6"] := (self:cAlias)->PIS
            self:jItems["D2VALIMP5"] := (self:cAlias)->COFINS
            self:jItems["D2VALICM"]  := (self:cAlias)->ISS
    EndCase

return

//-------------------------------------------------------------------
/*{Protheus.doc} preSchema
Método chamada antes do getSchema do objeto principal
 
@return object: self:oSchema
 
@author FAT/CRM
@since 13/11/2023
@version 1.0
*/
//-------------------------------------------------------------------   
method preSchema() as object class cancellationanddiscountsSmartViewBusinessObjectBRA

    self:oSchema:addProperty("D2VALINS"		,"Vlr.ICMS"		    ,"number"	,"Vlr.ICMS"	        ,"D2_VALINS"  	)//INSS
	self:oSchema:addProperty("D2VALIMP6"	,"Valor Imp. 5"	    ,"number"	,"Valor Imp. 5"		,"D2_VALIMP6"   )//PIS
	self:oSchema:addProperty("D2VALIMP5"	,"Valor Imp. 6"	    ,"number"	,"Valor Imp. 6"		,"D2_VALIMP5"	)//COFINS
	self:oSchema:addProperty("D2VALICM"		,"Vlr. do INSS"	    ,"number"	,"Vlr. do INSS"	    ,"D2_VALICM"	)//ISS

return self:oSchema
