#INCLUDE "PROTHEUS.CH"
#INCLUDE "FWLIBVERSION.CH"
#include "totvs.ch"
#include "msobject.ch"
#include "totvs.framework.treports.integratedprovider.th"
#include "tlpp-rest.th"
#include "tlpp-core.th"

namespace totvs.protheus.backoffice.sv.fat.sorderconfirmation.treportsintegratedprovider
using namespace totvs.framework.treports.integratedprovider

@totvsFrameworkTReportsIntegratedProvider(active=.F., team="SIGAFAT", tables="SC5,SC6", name="Pré-Nota", country="BRA")

//-------------------------------------------------------------------
/*/{Protheus.doc} sorderconfirmationSmartViewBusinessObjectBRA
Classe para criação do Objeto de Negócio para Resumo de Vendas Brasil

@author FAT/CRM
@since 04/07/2023
@version 1.0
*/
//-------------------------------------------------------------------  
class sorderconfirmationSmartViewBusinessObjectBRA from totvs.protheus.backoffice.sv.fat.sorderconfirmation.treportsintegratedprovider.sorderconfirmationSmartViewBusinessObject
    
    public method new() as object
    public method preData() as object
    public method processData() as object
    public method preSchema() as object
 
    protected data aFields      as array
    protected data aStruct      as array

endclass
 
//-------------------------------------------------------------------
/*{Protheus.doc} new
Método de instância da classe
 
@return object: self
 
@author FAT/CRM
@since 04/07/2023
@version 1.0
*/
//-------------------------------------------------------------------   
method new() class sorderconfirmationSmartViewBusinessObjectBRA 
	
    _Super:new()

return self

//-------------------------------------------------------------------
/*{Protheus.doc} preData
Método chamado antes do getData do objeto principal
 
@return object: self:oData
 
@author FAT/CRM
@since 04/07/2023
@version 1.0
*/
//-------------------------------------------------------------------   
method preData() as object class sorderconfirmationSmartViewBusinessObjectBRA 
	
    //Aqui é adicionada uma condição no where que será utilizado na query do objeto padrão

Return self:oData

//-------------------------------------------------------------------
/*{Protheus.doc} processData
Deverá ser chamado no momento do processamento da query
 
@return object: self:oData
 
@author FAT/CRM
@since 04/07/2023
@version 1.0
*/
//-------------------------------------------------------------------    
method processData(nOperLoc as numeric) as object class sorderconfirmationSmartViewBusinessObjectBRA

     Do Case 
        //---------------------------------------------------
        //Operação 1 será utilizado somente para commit dos 
        //campos antes do appendData 
        //Case (nOperLoc == 1)
        //---------------------------------------------------
                
        //---------------------------------------------------
        //Cálculo de Imposto Localizado
        //Case (nOperLoc == 2) 
        //---------------------------------------------------
        
        //---------------------------------------------------
        //Calcula o preco de lista Brasil
        //---------------------------------------------------
        Case (nOperLoc == 3)
            self:nValMerc  += self:nDesconto

        //---------------------------------------------
		//Tratamento Localizado para o Peso e frete
		//---------------------------------------------
        Case (nOperLoc == 4)          		
            If self:nPesoTot > 0
                MaFisAlt("NF_PESO", self:nPesoTot)
            Endif
            MaFisAlt("NF_FRETE", self:nFrete)
        
        //-------------------------------------------
        //Imprimi o valor localizado do item
        //-------------------------------------------
        Case (nOperLoc == 5)          		
            If self:aCabPed[1] == "P"
                self:nValImp := 0
            Else
                self:nValImp := MaFisRet(self:nItem,"IT_VALIPI")
            Endif

		//-----------------------------------------------
		//Tratamento para CGC localizado
		//-----------------------------------------------
        Case (nOperLoc == 6)
            self:cCGC := "IE: "+self:cInscr

                            
    EndCase

return 

//-------------------------------------------------------------------
/*{Protheus.doc} preSchema
Método chamada antes do getSchema do objeto principal
 
@return object: self:oSchema
 
@author FAT/CRM
@since 04/07/2023
@version 1.0
*/
//-------------------------------------------------------------------   
method preSchema() as object class sorderconfirmationSmartViewBusinessObjectBRA

    //Adição de novos campos personalizados (não existem na tabela)

return self:oSchema
