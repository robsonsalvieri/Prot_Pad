#INCLUDE 'msobject.ch'
#INCLUDE 'topconn.ch'
#INCLUDE 'totvs.framework.treports.integratedprovider.th'
#INCLUDE 'backoffice.sv.fat.salesinvoice.accounting.ch'

namespace custom.faturamento.salesinvoiceaccounting.integratedprovider

//-------------------------------------------------------------------------------
/*{Protheus.doc} PurchasesListTReportsBusinessObject
Classe para creación del Objeto de Negocio de compras para TReports
@author Marcelo Hruschka
@since 29/10/2024
@version 1.0 
*/
//-------------------------------------------------------------------------------

@totvsFrameworkTReportsIntegratedProvider( active=.F., team='SIGAFAT', tables='SF2,CT2,CV3,SE4,SA1', name='Facturas de Venta Conciliada', country='MEX', initialRelease='12.1.2410', customTables='SF2,CT2' )
class salesinvoiceaccountingTReportsBusinessObjectMEX from custom.faturamento.salesinvoiceaccounting.integratedprovider.salesinvoiceaccountingTReportsBusinessObject
	public method new() as object
	public method preData() as object
	public method processData() as object
	public method preSchema() as object
endclass

method new() class salesinvoiceaccountingTReportsBusinessObjectMEX
	_Super:new()
return self

method preData() as object class salesinvoiceaccountingTReportsBusinessObjectMEX
return self:oData

method processData() as object class salesinvoiceaccountingTReportsBusinessObjectMEX

	Local cQuery as character
	Local oExecMEX as object
	Local nX as numeric
    Local cAliasMEX as character

    aFieldsMEX := { 'F2_UUID','F2_FECTIMB','F2_USOCFDI','E4_MPAGSAT','F2_TPDOC','F2_FECANTF','F2_APROFOL','F2_VALADI'}
	aStructMEX := getStrutObj( aFieldsMEX, {} )

	cQuery := "SELECT SF2.F2_UUID,SF2.F2_FECTIMB,SF2.F2_USOCFDI,SF2.F2_TPDOC,SF2.F2_FECANTF,SF2.F2_APROFOL,SF2.F2_VALADI,SE4.E4_MPAGSAT"
	cQuery += "   FROM " + RetSqlName("SF2") + " SF2"
    cQuery += "   LEFT JOIN  " + RetSqlName("SE4") + " SE4 ON E4_FILIAL = ? AND SE4.E4_CODIGO = SF2.F2_COND AND SE4.D_E_L_E_T_ = ?"
	cQuery += "   WHERE SF2.R_E_C_N_O_ = ?
	cQuery := ChangeQuery(cQuery)
	oExecMEX := FwExecStatement():New( cQuery )
	oExecMEX:SetString( 01, xFilial('SE4') )
    oExecMEX:SetString( 02, ' ' )
    oExecMEX:SetString( 03, AllTrim(Str(self:nRecnoSF2)) )
	cAliasMEX := oExecMEX:OpenAlias( )
	For nX := 1 To Len(aStructMEX)
		If ( aStructMEX[nX][3] == 'date' )
			self:jItems[aStructMEX[nX][1]] := totvs.framework.treports.date.dateToTimeStamp( StoD( ( cAliasMEX )->&( aStructMEX[nX][5] ) ) )
		Else
			self:jItems[aStructMEX[nX][1]] := ( cAliasMEX )->&( aStructMEX[nX][5] )
		Endif
	Next

	// fecha tabela
	( cAliasMEX )->( DbCloseArea( ) )
	oExecMEX:Destroy( )
	oExecMEX := Nil

return

method preSchema() as object class salesinvoiceaccountingTReportsBusinessObjectMEX

	Local nX as numeric

	aFieldsMEX := { 'F2_UUID','F2_FECTIMB','F2_USOCFDI','E4_MPAGSAT','F2_TPDOC','F2_FECANTF','F2_APROFOL','F2_VALADI'}
	aStructMEX := getStrutObj( aFieldsMEX, {} )
	For nX := 1 To Len(aStructMEX)
		self:addProperty( aStructMEX[nX][1], aStructMEX[nX][2], aStructMEX[nX][3], aStructMEX[nX][4], aStructMEX[nX][5] )
	Next

return self:oSchema

