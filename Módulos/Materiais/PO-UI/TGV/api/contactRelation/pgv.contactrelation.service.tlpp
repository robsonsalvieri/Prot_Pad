#include 'PROTHEUS.CH'
#include 'tlpp-core.th'

#DEFINE INCLUI 3
#DEFINE ALTERA 4
#DEFINE EXCLUI 5

namespace totvs.protheus.backoffice.contactrelation
using namespace tgv.util
static __instance as object
//------------------------------------------------------------------------------
/*/{Protheus.doc} ContactRelationservice
	disponibiliza um classe de servicos da API salesgoals
	@type class
	@version 12.1.2310
	@author Gabriel Oliveira dos Santos / Squad CRM & Faturamento
	@since 17/11/2022
/*/
//------------------------------------------------------------------------------
class ContactRelationservice
	data jResponse as Json

	public method new()                 as object
	public method getInstance()         as object
	public method saveContactRelation() as json

EndClass

//------------------------------------------------------------------------------
/*/{Protheus.doc} ContactRelationservice::new() as object
	Disponibiliza uma nova intancia do servico salesgoals.
	@type method
	@version 12.1.2310
	@author Gabriel Oliveira dos Santos / Squad CRM & Faturamento
	@since 17/11/2022
	@return object, nova instancia da classe ContactRelationservice
/*/
//------------------------------------------------------------------------------
method new() as object class ContactRelationservice
	::jResponse := jsonObject():New()
Return Self

//------------------------------------------------------------------------------
/*/{Protheus.doc} ContactRelationservice::getInstance() as object
	obtem uma instancia da classe ContactRelationservice
	@type method
	@version 12.1.2310
	@author Gabriel Oliveira dos Santos / Squad CRM & Faturamento
	@since 17/11/2022
	@return object, instancia da classe ContactRelationservice
/*/
//------------------------------------------------------------------------------
method getInstance() as object class ContactRelationservice
	If (__instance == Nil)
		__instance := ContactRelationservice():new()
	EndIf
Return __instance

//-----------------------------------------------------------------------------------------------------------------------------------
/*/{Protheus.doc} ContactRelationservice::getsalesgoals(nPage as Numeric, nPageSize as Numeric, cDate as Character) as json
	Obtem uma lista de salesgoals, seguindo o padrao de campos utilizados 
	@type method
	@version 12.1.2310
	@author Gabriel Oliveira dos Santos / Squad CRM & Faturamento
	@since 17/11/2022
	@param  jcontact  , json      , Body da requisicao http com os dados do relacionamento entre a entidade e o contato
	@param  nOperation, numeric   , Operacao CRUD a ser realizada
	@param  cFilEntity, character , Filial da Entidade do relacionamento com contatos a ser ser excluido
	@param  cEntity   , character , Entidade do relacionamento com contatos a ser ser excluido
	@param  cCodEntity, character , Código identificador do registro da entidade do relacionamento com contatos a ser ser excluido
	@return json, resposta da requisicao formatada em json
/*/
//-----------------------------------------------------------------------------------------------------------------------------------
method saveContactRelation(	jContactRelation As Json, ;
							nOperation       As numeric, ;
							cFilEntity       As character, ;
							cEntity          As character, ;
							cCodEntity       As character ) as json class ContactRelationservice
	local oContactRelation := ContactRelationProtheusData():new()
	Local cContactReBran  	As Character
	Local cContactReBranEnt As Character
	Local cContactReEnt		As Character
	Local cContactReCodEnt	As Character

	::jResponse := JsonObject():New()

	If nOperation <> EXCLUI 
		If jContactRelation['header'] <> NIL
			cContactReBran		:= jContactRelation['header']['branch']				
			cContactReBranEnt	:= jContactRelation['header']['branchentity']		
			cContactReEnt		:= jContactRelation['header']['entity']		
			cContactReCodEnt	:= jContactRelation['header']['codeentity']	
		EndIf
	Else
		cContactReBran      := FwXFilial("AC8")
		cContactReBranEnt	:= cFilEntity
		cContactReEnt		:= cEntity
		cContactReCodEnt	:= cCodEntity
	EndIf

	oContactRelation:saveContactRelation(jContactRelation,nOperation,cContactReBran,cContactReBranEnt,cContactReEnt,cContactReCodEnt)

	oContactRelation:DeActivate()
	FreeObj(oContactRelation)
Return ::jResponse

