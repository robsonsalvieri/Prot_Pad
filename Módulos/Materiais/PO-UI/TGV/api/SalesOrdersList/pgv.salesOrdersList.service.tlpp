#include 'tlpp-core.th'
#include 'tlpp-rest.th'

namespace totvs.protheus.backoffice.pgvSalesOrdersList
using namespace tgv.util

STATIC __instance as Object
STATIC __oActiveData as Object

//------------------------------------------------------------------------------
/*/{Protheus.doc} pgvSalesOrdersListService
	disponibiliza um classe de serviços da API pgvSalesOrdersListService
	@type class
	@version 12.1.2310
	@author Squad CRM & Faturamento
	@since 17/11/2023
/*/
//------------------------------------------------------------------------------
Class pgvSalesOrdersListService
	data jResponse as Json

	public method new() as Object
	public method getInstance() as Object
	public method getInstanceData() as Object
	public method get() as Json

EndClass

//-----------------------------------------------------------------------
/*/{Protheus.doc} pgvSalesOrdersList::new() as object
    Obter uma nova instancia da class pgvSalesOrdersList
    @author Squad CRM & Faturamento
    @since 17/11/2023
    @version 12.1.2310
    @return @return object, retorna uma nova instancia da classe
/*/
//-----------------------------------------------------------------------
Method new() as object class pgvSalesOrdersListService
	::jResponse := JsonObject():new()
Return Self

//------------------------------------------------------------------------------
/*/{Protheus.doc} SalesOrdersListService::getInstance() as object
	obtem uma instancia da classe SalesOrdersListService
	@type method
	@version 12.1.2310
	@author Squad CRM & Faturamento
	@since 17/11/2023
	@return object, instancia da classe SalesOrdersListService
/*/
//------------------------------------------------------------------------------
Method getInstance() as object class pgvSalesOrdersListService
	If (__instance == nil)
		__instance := pgvSalesOrdersListService():new()
	Endif
Return __instance

//------------------------------------------------------------------------------
/*/{Protheus.doc} SalesOrdersListService::getInstanceData() as object
  obtem uma instancia da classe pgvSalesOrdersListProtheusData.
  @type method
  @author Squad CRM & Faturamento
  @since 17/11/2023
  @version 12.1.2310
  @return object, Instancia da classe Data
/*/
//------------------------------------------------------------------------------
Method getInstanceData()  class pgvSalesOrdersListService as object
	If __oActiveData == Nil
		__oActiveData := pgvSalesOrdersListProtheusData():new()
	Endif
Return __oActiveData

//----------------------------------------------------------------------------------------------------------------------------
/*/{Protheus.doc} SalesOrdersListService::getSalesOrdersList(nPage as numeric, nPageSize as numeric,;
	cSalesOrderId as character, cItemId as character, aURLFilter as array, cFields as character, cSort as character) as Json
	Obtem uma lista de itens do Pedido de vendas (SC9).
	@type method
	@version 12.1.2310
	@author Squad CRM & Faturamento
	@since 17/11/2023
	@param nPage        , numeric  , número da página
	@param nPageSize    , numeric  , Quantidade de registros por página
	@param aURLFilter   , array    , Lista de Filtros no padrão do FWAdapterBaseV2
	@param cFields      , character, Lista de campos que devem ser retornados
	@param cSort        , character, Ordernação do Response
	@param dDataDe      , date     , data de
	@param dDataAte     , date     , data até
	@param lCard        , logical  , Indica se é será feito trativa para Card
	@param lBox         , logical  , indica se será feito a tratativa para box
	@param lTotVal      , logical  , indica se será feito a tratativa para valor total
	@param lTotValPeriod, logical  , indica se será feito a tratativa para valor total últimos 7 dias
	@param lTopSellers  , logical  , indica se deve ser feito a tratativa para os top 5 produtos mais vendidos
	@param cStatusFilter, character, filtro de status utilizado pelos endpoints /api/pgv/salesorderslist e /api/pgv/salesorderslist/:dDataDe/:dDataAte
	@return json, resposta da requisição formatada em json
/*/
//----------------------------------------------------------------------------------------------------------------------------
Method get(nPage         as numeric  , nPageSize     as numeric  , aURLFilter  as array   , ;
           cFields       as character, cSort         as character, dDataDe     as date    , ;
		   dDataAte      as date     , lCard         as logical  , lBox        as Logical , ;
		   lTotVal       as Logical  , lTotValPeriod as Logical  , lTopSellers as Logical , ;
		   cStatusFilter as character) as Json class pgvSalesOrdersListService
	Local oData := ::getInstanceData()

	oData:get(nPage, nPageSize, aURLFilter, cFields, cSort, dDataDe , dDataAte, lCard, lBox, lTotVal, lTotValPeriod, lTopSellers, cStatusFilter)

	If oData:lOk
		::jResponse := oData:GetJSONResponse()
	EndIf

	oData:DeActivate()
	FreeObj(oData)
Return ::jResponse

