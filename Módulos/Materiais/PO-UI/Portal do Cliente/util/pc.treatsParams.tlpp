#include 'tlpp-core.th'
#include 'pc.treatsparams.ch'

namespace pc.util

//----------------------------------------------------------------------------
/*/{Protheus.doc} getPageAndPageSize
	Obtem o valor dos parametros Page e PageSize
	@type		function
	@version	12.1.2310
	@author		Lucas Panão / Squad CRM & Faturamento
	@since		09/11/2023
	@param		nPage		, numeric, Número da página que será retornada
	@param		nPageSize	, numeric, Quantidade de registros por pagina
	@sample		getPageAndPageSize(@nPage, @nPageSize)
/*/
//---------------------------------------------------------------------------
function getPageAndPageSize(nPage as Numeric, nPageSize as Numeric)
	If (oRest:getQueryRequest():GetJsonText('pageSize') != 'null')
		nPageSize := Val(oRest:getQueryRequest():GetJsonText('pageSize'))
	Else
		nPageSize := 10
	EndIf

	If (oRest:getQueryRequest():GetJsonText('page') != 'null')
		nPage := Val(oRest:getQueryRequest():GetJsonText('page'))
	Else
		nPage := 1
	Endif
Return Nil

//------------------------------------------------------------------------------
/*/{Protheus.doc} getPathParams
	Retorna um PathParams informado na requisição
	@type		function
	@sample		GetPathParams("dateSync")
	@param		cPathParam	, Character	, Nome/Identificador do PathParam
	@return		Character	, PathParamns
	@author		Lucas Panão / Squad CRM & Faturamento
	@since		09/11/2023
	@version	12.1.2310
/*/
//------------------------------------------------------------------------------
Function getPathParams( cPathParam as Character ) as Character
	Local jPath		:= oRest:getPathParamsRequest()
	Local cRetorno	as Character

	If( jPath != Nil)
		cRetorno := jPath[cPathParam]
	Endif

	FreeObj(jPath)
Return cRetorno

//------------------------------------------------------------------------------
/*/{Protheus.doc} getFilterParam
	Obtem todos os campos utilizados no Select
	@type		function
	@sample		getFilterParam()
	@param		aQueryString, Array, Filtro utilizado no URLFILTER da FWAdapterBaseV2
	@return		Array	, Lista de Campos
	@author		Lucas Panão / Squad CRM & Faturamento
	@since		09/11/2023
	@version	12.1.2310
/*/
//------------------------------------------------------------------------------
Function getFilterParam() as Array
	Local cFilter		:= getQueryParam('FILTER')
	Local aQueryString	:= {}

	If !Empty(cFilter)
		cFilter := FWURIDecode(cFilter)
		aAdd(aQueryString, {"FILTER", DecodeUtf8(cFilter)})
	Endif
	
Return aQueryString

//------------------------------------------------------------------------------
/*/{Protheus.doc} getQueryParam
	Obtem o valor de uma parametro da requisição
	@type		function
	@version	12.1.2310
	@author		Lucas Panão / Squad CRM & Faturamento
	@since		09/11/2023
	@param		cParamName	, character, Nome do Parametro
	@return		character	, Valor do parametro
/*/
//------------------------------------------------------------------------------
Function getQueryParam(cParamName as Character) as Character
	Local cParamText as character

	If oRest:getQueryRequest():GetJsonText(cParamName) != 'null'
		cParamText := oRest:getQueryRequest():GetJsonText(cParamName)
	Endif
Return cParamText

//------------------------------------------------------------------------------
/*/{Protheus.doc} getRequestBody
	Retorna o Body informado na requisição
	@type		function
	@sample		GetRequestBody()
	@return		Json	, JSON contendo o Body da requisição.
	@author		Lucas Panão / Squad CRM & Faturamento
	@since		09/11/2023
	@version	12.1.2310
/*/
//------------------------------------------------------------------------------
Function getRequestBody() as Json
	Local cBody			:= oRest:getBodyRequest()
	Local jBody			as Json
	Local lError 		as Logical

	If Empty(cBody)
		lError := .T.
	Else
		jBody := JsonObject():New()
		jBody:fromJson(DecodeUtf8(cBody))
	EndIf

	If lError
		oRest:setKeyHeaderResponse('Content-Type','application/json; charset=utf-8')
		SetRestFault(403, FWHttpEncode(STR0001) ) //"Não será possivel prosseguir com a requisição, pois o Corpo está invalido."
	Endif
Return jBody

//------------------------------------------------------------------------------
/*/{Protheus.doc} getHeaderRequest
	Obtem o valor de um Header da requisição
	@type		function
	@version	12.1.2410
	@author		Rafael Mota Previdi / Squad CRM & Faturamento
	@since		24/10/2024
	@param		cHeaderName	, character, Nome do Header da Requisição
	@return		cHeaderText , character, Valor do Header da Requisição
/*/
//------------------------------------------------------------------------------
Function getHeaderRequest(cHeaderName as Character) as Character

	Local cHeaderText := "" as Character
	Local jHeader           as Json

	jHeader := oRest:getHeaderRequest()

    If (valtype(jHeader) == 'J')
		cHeaderText := jHeader[cHeaderName]
	EndIf

Return cHeaderText
