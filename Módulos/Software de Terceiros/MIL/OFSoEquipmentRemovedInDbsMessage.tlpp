#include 'totvs.ch'

/*/{Protheus.doc} OFSoEquipmentRemovedInDbsMessage
	Classe que representa uma mensagem de atualizacao de Contact no Protheus para o SO
	
	@type class
	@author Rubens Takahashi
	@since 17/09/2021
/*/
Class OFSoEquipmentRemovedInDbsMessage from OFSoEquipmentCreatedInDbsMessage
	Public Method New() Constructor
	Public Method GetMessageId()
	Public Method Delay()
	Public Method GetBody()
EndClass


/*/{Protheus.doc} New
	Construtor Simpled
	
	@type method
	@author Rubens Takahashi
	@since 17/09/2021dddd
/*/
Method New(oEquipMake) Class OFSoEquipmentRemovedInDbsMessage
	_Super:New(oEquipMake)
	::cName := "EquipmentRemovedInDbs"

	::oSoRequest:Set("VK5_MESSAG", "21")

Return SELF

/*/{Protheus.doc} GetMessageId
	Retorna o nome da mensagem para ser enviada ao SO onde necessário

	@type method
	@author Rubens Takahashi
	@since 17/09/2021
/*/
Method GetMessageId() Class OFSoEquipmentRemovedInDbsMessage
	if valtype(self:cMessageId) == "U"
		self:cMessageId := "equipment-make-" + FWUUIDV4(.t.)
	endif
return self:cMessageId

Method GetBody() Class OFSoEquipmentRemovedInDbsMessage
	Local oJson := self:oEquipment:toJson()
	Local oRemoveBody := JsonObject():New()
	Local oReqBody := OFSoRequestBody():New()
	oRemoveBody["referenceId"] := oJson["referenceId"]
	oReqBody:SetData(oRemoveBody)
	oReqBody:SetName(self:cName)
Return oReqBody


/*/{Protheus.doc} Delay
	atrasa a mensagem por falha de comunicação

	@type method
	@author Vinicius Gati
	@since 19/10/2021
/*/
Method Delay() Class OFSoEquipmentRemovedInDbsMessage
	Local oMsg := OFDMSExitMessage():New()
	local oJson := JsonObject():New()
	oJson['header'] := self:oSoRequest:GetHeader():ToJson()
	oJson['body'] := self:oSoRequest:GetBody():ToJson()
	oMsg:Set("VK6_PAYLOA", oJson:ToJson())
	oMsg:Set("VK6_MSGNAM", OFDMSMessageConstants():ContactUpdatedInDbsMessageName())
	oMsg:Set("VK6_CODVK5", self:oSoRequest:GetId())
	oMsg:SetAtrasada()
Return oMsg:Save()
