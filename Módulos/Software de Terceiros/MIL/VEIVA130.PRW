// ͻ
//  Versao  10     
// ͼ
#include "Veiva130.ch"
#include "Protheus.ch"
/*


Ŀ
Funo     VEIVA130  Autor   Emilton               Data  27/09/01 
Ĵ
Descrio  Cadastro de Opcionais                                      
ٱ


*/
Function VEIVA130

Private aRotina := MenuDef()
Private cCadastro := OemToAnsi(STR0006)  // Cadastro de Opcionais
Private nUsado := 0
Private aCpoMostra := {"VVW_CODMAR","VVW_DESMAR","VVW_CODOPC","VVW_DESOPC","VVW_VALOPC","VVW_SOMAVL"}
//Ŀ
// Endereca a funcao de BROWSE                                  
//
mBrowse( 6, 1,22,75,"VVW")

Return
/*


Ŀ
Funo    VA130Vis   Autor   Emilton               Data  27/09/01 
Ĵ
Descrio  Cadastro de Opcionais - Visualiza                          
ٱ


*/
Function VA130Vis(cAlias,nReg,nOpc)
AxVisual(cAlias,nReg,nOpc,aCpoMostra)
return
/*


Ŀ
Funo     VA130Inc  Autor   Emilton               Data  27/09/01 
Ĵ
Descrio  Cadastro de Opcionais - Inclui                             
ٱ


*/
Function VA130Inc(cAlias,nReg,nOpc)
AxInclui(cAlias,nReg,nOpc,aCpoMostra)
return
/*


Ŀ
Funo     VA130Alt  Autor   Emilton               Data  27/09/01 
Ĵ
Descrio  Cadastro de Opcionais - Altera                             
ٱ


*/
Function VA130Alt(cAlias,nReg,nOpc)
AxAltera(cAlias,nReg,nOpc,aCpoMostra)
return
/*


Ŀ
Funo     VA130Exc  Autor   Emilton               Data  27/09/01 
Ĵ
Descrio  Cadastro de Opcionais - Exclui                             
ٱ


*/
Function VA130Exc(cAlias,nReg,nOpc)
Local aFilAtu    := FWArrFilAtu()
Local aSM0       := FWAllFilial( aFilAtu[3] , aFilAtu[4] , aFilAtu[1] , .f. )
Local cBkpFilAnt := cFilAnt
Local nCont      := 0
Local cFilVV6    := ""
Local cFilVVM    := ""
If FWModeAccess("VVW",3) == "C"
	If Len(aSM0) > 0
		cFilVV6 := "("
		cFilVVM := "("
		For nCont := 1 to Len(aSM0)
			cFilAnt := aSM0[nCont]
			cFilVV6 += "'"+xFilial("VV6")+"',"
			cFilVVM += "'"+xFilial("VVM")+"',"
		Next
		cFilVV6 := left(cFilVV6,len(cFilVV6)-1)+")"
		cFilVVM := left(cFilVVM,len(cFilVVM)-1)+")"
		cFilAnt := cBkpFilAnt
	EndIf
Else
	cFilVV6 += "( '"+xFilial("VV6")+"' )"
	cFilVVM += "( '"+xFilial("VVM")+"' )"
EndIf
If FM_SQL("SELECT COUNT(*) FROM "+RetSQLName("VV6")+" WHERE VV6_FILIAL IN "+cFilVV6+" AND VV6_CODOPC='"+VVW->VVW_CODOPC+"' AND D_E_L_E_T_ = ' '") > 0
	Help("  ",1,"CANCELDEL",,STR0007,4,1)
	Return
EndIf
If FM_SQL("SELECT COUNT(*) FROM "+RetSQLName("VVM")+" WHERE VVM_FILIAL IN "+cFilVVM+" AND VVM_CODOPC='"+VVW->VVW_CODOPC+"' AND D_E_L_E_T_ = ' '") > 0
	Help("  ",1,"CANCELDEL",,STR0008,4,1)
	Return
EndIf
AxDeleta(cAlias,nReg,nOpc,,aCpoMostra)
return

/*


ͻ
Programa  MenuDef   Autor  Emilton              Data   28/09/01   
͹
Desc.      Monta o aRotina                                            
ͼ


*/
Static Function MenuDef()
Local aRotina := {	{ STR0001 ,"axPesqui", 0 , 1},; 	//Pesquisar
					{ STR0002 ,"VA130Vis", 0 , 2},; 	//Visualizar
					{ STR0003 ,"VA130INC", 0 , 3},; 	//Incluir
					{ STR0004 ,"VA130Alt", 0 , 4},; 	//Alterar
					{ STR0005 ,"VA130Exc", 0 , 5}}  	//Excluir
Return aRotina