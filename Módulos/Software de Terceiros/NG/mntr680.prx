#INCLUDE "mntr680.ch"
#INCLUDE "PROTHEUS.CH"

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ MNTR680  ³ Autor ³ Rafael Diogo Richter  ³ Data ³30/01/2007³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Desvio de Consumo de insumos                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ SigaMNT                                                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±± 
±±³         ATUALIZACOES SOFRIDAS DESDE A CONSTRU€AO INICIAL.             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Programador ³ Data   ³ F.O  ³  Motivo da Alteracao                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³            ³        ³      ³                                          ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTR680()

Local oReport
Local aArea := GetArea()

SetKey( VK_F9, { | | NGVersao( "MNTR680" , 1 ) } )

Private nB1 := 15
Private cPerg    := "MNT680"

If FindFunction("TRepInUse") .And. TRepInUse()

   //-- Interface de impressao
   oReport := ReportDef()
	oReport:SetLandscape() //Default paisagem
   oReport:PrintDialog()
Else
   MNTR680R3()
EndIf

RestArea(aArea)

Set Key VK_F9 To

Return .T.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ReportDef ³ Autor ³ Rafael Diogo Richter  ³ Data ³30/01/2007³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Define as secoes impressas no relatorio                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ SigaMNT                                                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±± 
±±³         ATUALIZACOES SOFRIDAS DESDE A CONSTRU€AO INICIAL.             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Programador ³ Data   ³ F.O  ³  Motivo da Alteracao                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³            ³        ³      ³                                          ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function ReportDef() 
Local oReport 
Local oSection1, oSection2
Local oCell, oCell2

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Criacao do componente de impressao                                      ³
//³                                                                        ³
//³TReport():New                                                           ³
//³ExpC1 : Nome do relatorio                                               ³
//³ExpC2 : Titulo                                                          ³
//³ExpC3 : Pergunte                                                        ³
//³ExpB4 : Bloco de codigo que sera executado na confirmacao da impressao  ³
//³ExpC5 : Descricao                                                       ³
//³                                                                        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
oReport := TReport():New("MNTR680",OemToAnsi(STR0006),"MNT680",{|oReport| ReportPrint(oReport)},STR0001+" "+STR0002+" "+STR0003)

Pergunte(oReport:uParam,.F.)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Criacao da secao utilizada pelo relatorio                               ³
//³                                                                        ³
//³TRSection():New                                                         ³
//³ExpO1 : Objeto TReport que a secao pertence                             ³
//³ExpC2 : Descricao da seçao                                              ³
//³ExpA3 : Array com as tabelas utilizadas pela secao. A primeira tabela   ³
//³        sera considerada como principal para a seção.                   ³
//³ExpA4 : Array com as Ordens do relatório                                ³
//³ExpL5 : Carrega campos do SX3 como celulas                              ³
//³        Default : False                                                 ³
//³ExpL6 : Carrega ordens do Sindex                                        ³
//³        Default : False                                                 ³
//³                                                                        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Criacao da celulas da secao do relatorio                                ³
//³                                                                        ³
//³TRCell():New                                                            ³
//³ExpO1 : Objeto TSection que a secao pertence                            ³
//³ExpC2 : Nome da celula do relatório. O SX3 será consultado              ³
//³ExpC3 : Nome da tabela de referencia da celula                          ³
//³ExpC4 : Titulo da celula                                                ³
//³        Default : X3Titulo()                                            ³
//³ExpC5 : Picture                                                         ³
//³        Default : X3_PICTURE                                            ³
//³ExpC6 : Tamanho                                                         ³
//³        Default : X3_TAMANHO                                            ³
//³ExpL7 : Informe se o tamanho esta em pixel                              ³
//³        Default : False                                                 ³
//³ExpB8 : Bloco de código para impressao.                                 ³
//³        Default : ExpC2                                                 ³
//³                                                                        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
oSection1 := TRSection():New(oReport,"Ordem",{"STJ","ST6"})
TRCell():New(oSection1," "						,""		,"Ordem"					,"@!" ,12,/*lPixel*/,{|| nOrdem})
TRCell():New(oSection1,"TJ_PRIORID"			,"STJ"	,"Prior."				,"@!" ,03,/*lPixel*/)
TRCell():New(oSection1,"TJ_CODBEM"			,"STJ"	,"Bem/Localização"	,"@!" ,16,/*lPixel*/)
TRCell():New(oSection1," "						,"ST9"	,"Descrição"			,"@!" ,40,/*lPixel*/,{|| cCodBem})
TRCell():New(oSection1,"TJ_SERVICO"			,"STJ"	,"Serviço"				,"@!" ,06,/*lPixel*/)
TRCell():New(oSection1,"T4_NOME"				,"ST4"	,"Nome"					,"@!" ,40,/*lPixel*/)
TRPosition():New(oSection1,"ST9",1,{|| xFilial("ST9") + STJ->TJ_CODBEM})
TRPosition():New(oSection1,"ST4",1,{|| xFilial("ST4") + STJ->TJ_SERVICO})
//TRPosition():New(oSection1,"STJ",1,{|| xFilial("STJ") + TRB->FAMIBEM})

oSection2 := TRSection():New(oReport,"Detalhes",{"STL"})
oCell := TRCell():New(oSection2,"TL_TAREFA"		,"STL"	,"Tarefa"	,"@!" 				,06,/*lPixel*/,/*{|| code-block de impressao }*/)
oCell := TRCell():New(oSection2,"TL_TIPOREG" 	,"STL"	,"Tipo"		,"@S1" 				,01,/*lPixel*/)
oCell := TRCell():New(oSection2,"TL_CODIGO"		,"STL"	,"Código"	,"@!" 				,nB1+15,/*lPixel*/)
oCell := TRCell():New(oSection2," "			 		," "		,"Nome"		,"@!" 				,40,/*lPixel*/,{|| nNome})
oCell := TRCell():New(oSection2,"TL_QUANREC" 	,"STL"	,"Quant."		,"999"				,04,/*lPixel*/)
oCell := TRCell():New(oSection2,"TL_QUANTID" 	,"STL"	,"Consumo"	,"@E 999,999.99"	,12,/*lPixel*/,{|| R680QTD()})
oCell := TRCell():New(oSection2,"TL_UNIDADE" 	,"STL"	,"Unidade"	,"@!" 				,07,/*lPixel*/)
oCell := TRCell():New(oSection2,"TL_DTINICI" 	,"STL"	,"Dt.Início","99/99/9999" 		,08,/*lPixel*/)
oCell := TRCell():New(oSection2,"TL_HOINICI" 	,"STL"	,"Hr.Início","99:99"		 		,05,/*lPixel*/)
oCell := TRCell():New(oSection2,"TL_DTFIM" 		,"STL"	,"Dt.Fim"	,"99/99/9999" 		,08,/*lPixel*/)
oCell := TRCell():New(oSection2,"TL_HOFIM"	 	,"STL"	,"Hr.Fim"	,"99:99" 			,05,/*lPixel*/)
oCell := TRCell():New(oSection2," " 				,"STL"	,"Bloq."		,"@S3" 				,03,/*lPixel*/,{|| cBloq})
oCell := TRCell():New(oSection2," " 				,"STL"	,"Destino"		,"@S8" 				,08,/*lPixel*/,{|| cDest})
//oCell := TRPosition():New(oSection2,"SB1",1,{|| xFilial("SB1") + TRB->PRODUTO})

Return oReport

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ReportPrint³ Autor ³ Rafael Diogo Richter  ³ Data ³25/01/2007³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Chamada do Relat¢rio                                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ SigaMNT                                                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±± 
±±³         ATUALIZACOES SOFRIDAS DESDE A CONSTRU€AO INICIAL.              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Programador ³ Data   ³ F.O  ³  Motivo da Alteracao                      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³            ³        ³      ³                                           ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function ReportPrint(oReport)
Local oSection1 := oReport:Section(1)
Local oSection2 := oReport:Section(2)
Local nCont

Private nOrdem, nNome, cOrdem := ""
Private cBloq := STR0008 //"Sim"
Private cDest := space(12)

if mv_par04 = 1 .or. mv_par05 = 1 .or. mv_par06 = 1 .or. mv_par07 = 1
    dbSelectArea("STJ")
    dbSetOrder(03)
    dbSeek(xFilial('STJ')+MV_PAR01+MV_PAR02,.T.)
    oReport:SetMeter(LastRec())

    While !Eof() .and. xFilial('STJ') == stj->tj_filial .and. stj->tj_ordem >= mv_par02;
         .and. stj->tj_ordem <= mv_par03

		oReport:IncMeter()

       If stj->tj_tipoos = "B" .or. stj->tj_tipoos = "L"
            nOrdem := stj->tj_ordem
            
	         If stj->tj_tipoos == "B"
					cEstrut := NGLocComp(stj->tj_codbem,"1")
					DbSelectArea("ST9")
					DbSetOrder(1)
					DbSeek(XFILIAL("ST9")+stj->tj_codbem)
					cCodBem := st9->t9_nome
				ElseIf stj->tj_tipoos == "L"
					cEstrut := NGLocComp(stj->tj_codbem,"2")
					DbSelectArea("TAF")
					DbSetOrder(7)
					DbSeek(XFILIAL("TAF")+"X"+"2"+stj->tj_codbem)								
					cCodBem := taf->taf_nomniv
				EndIf
							
            // PROCURA OS DETALHES DO PLANO E ORDEM NO STL

           dbSelectArea("STL")
           dbSetOrder(01)
           dbSeek(xFilial('STL')+nordem+MV_PAR01)
           if found()
              ntiporeg := stl->tl_tiporeg
              While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                  .and. stl->tl_plano == mv_par01
                  if stl->tl_tiporeg == "E"  // ESPECIALISTAS
                       STL->(dbskip())
                       loop
                  endif
						lClose := .F.
						If cOrdem <> nOrdem
							oReport:SkipLine(2)
							oSection1:Init()
							oSection1:PrintLine()
							
							If MV_PAR08 == 1
								If stj->tj_codbem <> cEstrut
									nMaxCarac := 123
									
									nImpCol := oSection2:Cell("TL_TAREFA"):Col()
									If Len(cEstrut) > nMaxCarac
										aLocal := MNTR680QLE(cEstrut)
								  		For nCont := 1 to Len(aLocal)
								  			If nCont == 1
								  				cEstrutAux := STR0025 + aLocal[nCont]  
								  			Else							  					
									  			cEstrutAux := Space(Len(STR0025)) + aLocal[nCont]
									  		EndIf
									  		nImpLin := oReport:Row()                                           
									  		oReport:PrintText(cEstrutAux,nImpLin,nImpCol)
								  			If Len(aLocal) != nCont
								  				oReport:SkipLine()
								 			Endif				
							  			Next nCont
							  		Else
							  			cEstrutAux := STR0025 + cEstrut
							  			
							  			nImpLin := oReport:Row()
								  		oReport:PrintText(cEstrutAux,nImpLin,nImpCol)
						  			EndIf
					  				oReport:SkipLine()
					  			EndIf
					  		Endif
							
							lClose := .T.
							cOrdem := nOrdem
						EndIf
						oSection2:Init()

                 oReport:IncMeter()

                //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                //³ Selecao dos registros conforme os parametros                 ³
                //³ mv_par04     // Produtos                 Sim/Nao             ³
                //³ mv_par05     // Funcionarios             Sim/Nao             ³
                //³ mv_par06     // Ferramentas              Sim/Nao             ³
                //³ mv_par07     // Terceiros                Sim/Nao             ³
                //³ mv_par08     // Imprimir Localização ?   Sim/Nao             ³
                //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

                 // Seleciona as Ferramentas

                 if mv_par06 = 1 .and.  stl->tl_tiporeg == 'F'
                     While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                         .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "F"
                         nproduto := stl->tl_codigo

								 nnome := ""
								 
								 oReport:IncMeter()
                         
                         dbSelectArea("SH4")
                         dbSetOrder(01)
                         dbSeek(xFilial('STL')+substr(nproduto,1,6))
                         if found()
                             nnome := left(sh4->h4_DESCRI,35)
                         endif

                         dbSelectArea("STL")

                         cBloq := STR0008 //"Sim"
								 cDest := space(12)

								 If STL->TL_REPFIM = 'N'
								    cBloq := STR0009 //"Nao"
								 EndIf
								
								 If STL->TL_TIPOREG == 'P'
								 	If STL->TL_destino = 'T'
								       cDest := STR0010 //"Troca"
								   ElseIf STL->TL_destino == 'A'
								       cDest := STR0011 //"Apoio"
								   Else
								       cDest := STR0012 //"Subst."
								   EndIf
								 EndIf
						
								 oSection2:PrintLine()
								 
                         // saltas os consumos utilizadas do produto  ( Val(STL->TL_SEQRELA) <> 0  REALIZADO)
                         STL->(dbskip())                         
                         While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
    	                    .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "F";
        	                .and. stl->tl_codigo == nproduto .and. Alltrim(stl->tl_seqrela) <> "0"
            	            STL->(dbskip())
                	     enddo
                      enddo
                 else
                    if mv_par06 = 2 .and.  stl->tl_tiporeg == 'F'
                        While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                          .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "F"
                              STL->(dbskip())
                        enddo
                    endif
                 endif

                 // Seleciona os Funcionario

                 if mv_par05 = 1 .and. stl->tl_tiporeg == 'M'
                      While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                         .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "M"
                         nproduto := stl->tl_codigo

								 nnome := ""
 								 
 								 oReport:IncMeter()
                         
                         dbSelectArea("ST1")
                         dbSetOrder(01)
                         dbSeek(xFilial('ST1')+substr(nproduto,1,6))
                         if found()
                             nnome := left(st1->t1_nome,35)
                         endif

                         dbSelectArea("STL")

                         cBloq := STR0008 //"Sim"
								 cDest := space(12)

								 If STL->TL_REPFIM = 'N'
								    cBloq := STR0009 //"Nao"
								 EndIf
								
								 If STL->TL_TIPOREG == 'P'
								 	If STL->TL_destino = 'T'
								       cDest := STR0010 //"Troca"
								   ElseIf STL->TL_destino == 'A'
								       cDest := STR0011 //"Apoio"
								   Else
								       cDest := STR0012 //"Subst."
								   EndIf
								 EndIf

								 oSection2:PrintLine()

                         // saltas os consumos utilizadas do produto  ( Val(STL->TL_SEQRELA) <> 0  REALIZADO)
                         STL->(dbskip())
                         While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
    	                    .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "M";
        	                .and. stl->tl_codigo == nproduto .and. Alltrim(stl->tl_seqrela) <> "0"
            	            STL->(dbskip())
                	     enddo
                      enddo
                 else
                     if mv_par05 = 2 .and.  stl->tl_tiporeg == 'M'
                         While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                         .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "M"
                            STL->(dbskip())
                         enddo
                     endif
                 endif

                 // Seleciona os Produtos

                 if mv_par04 = 1 .and.  stl->tl_tiporeg == 'P'
                     While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                         .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "P"
                         nproduto   := stl->tl_codigo

								 nnome := ""
                         
								 oReport:IncMeter()
								 
                         dbSelectArea("SB1")
                         dbSetOrder(01)
                         dbSeek(xFilial('SB1')+nproduto)
                         if found()
                             nnome := left(sb1->b1_desc,35)
                         endif
                         dbSelectArea("STL")


                         cBloq := STR0008 //"Sim"
								 cDest := space(12)

								 If STL->TL_REPFIM = 'N'
								    cBloq := STR0009 //"Nao"
								 EndIf
								
								 If STL->TL_TIPOREG == 'P'
								 	If STL->TL_destino = 'T'
								       cDest := STR0010 //"Troca"
								   ElseIf STL->TL_destino == 'A'
								       cDest := STR0011 //"Apoio"
								   Else
								       cDest := STR0012 //"Subst."
								   EndIf
								 EndIf
								 
								oSection2:PrintLine()

                         // saltas os consumos utilizadas do produto  ( Val(STL->TL_SEQRELA) <> 0  REALIZADO)
                         STL->(dbskip())
                         While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
    	                    .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "P";
        	                .and. stl->tl_codigo == nproduto .and. Alltrim(stl->tl_seqrela) <> "0"
            	            STL->(dbskip())
                	     enddo
                      enddo
                 else
                     if mv_par04 = 2 .and.  stl->tl_tiporeg == 'P'
                         While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                          .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "P"
                             STL->(dbskip())
                         enddo
                     endif
                 endif

                  // Seleciona os Terceiras

                 if mv_par07 = 1 .and. stl->tl_tiporeg == 'T'
                       While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                         .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "T"
                         nproduto   := stl->tl_codigo
								 
								 nnome := ""

								 oReport:IncMeter()

                         dbSelectArea("SA2")
                         dbSetOrder(01)
                         dbSeek(xFilial('SA2')+substr(nproduto,1,6))
                         if found()
                             nnome  := left(sa2->a2_nome,35)
                         endif
                         dbSelectArea("STL")

                         cBloq := STR0008 //"Sim"
								 cDest := space(12)

								 If STL->TL_REPFIM = 'N'
								    cBloq := STR0009 //"Nao"
								 EndIf
								
								 If STL->TL_TIPOREG == 'P'
								 	If STL->TL_destino = 'T'
								       cDest := STR0010 //"Troca"
								   ElseIf STL->TL_destino == 'A'
								       cDest := STR0011 //"Apoio"
								   Else
								       cDest := STR0012 //"Subst."
								   EndIf
								 EndIf

								 oSection2:PrintLine()
								 
                         // saltas os consumos utilizadas do produto  (Val(STL->TL_SEQRELA) <> 0  REALIZADO)
                         STL->(dbskip())
    	                 While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
        	                .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "T";
            	            .and. stl->tl_codigo == nproduto .and. Alltrim(stl->tl_seqrela) <> "0"
                	        STL->(dbskip())
                    	 enddo
                    enddo
                 else
                     if mv_par07 = 2 .and. stl->tl_tiporeg == 'T'
                        While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                          .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "T"
                          STL->(dbskip())
                       enddo
                     endif
                 endif
             enddo
              //If lClose
                 oSection1:Finish()
      		 // EndIf
            oSection2:Finish()
           endif
        endif
        dbSelectArea("STJ")
        dbSkip()
        Loop
    Enddo
endif

RetIndex("STJ")
RetIndex("STL")

Set Filter To
MS_FLUSH()

Return .T.
/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTR690R3 ³ Autor ³ Inacio Luiz Kolling   ³ Data ³ 02/07/97 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Desvio de Consumo de insumos                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ Generico                                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function MNTR680R3()
LOCAL cString    := "STJ"
LOCAL cDesc1     := STR0001 //"Relatorio de apresentacao de consumo previsto para as Ordens de Servico de Manutencao"
LOCAL cDesc2     := STR0002 //"O usuario podera selecionar qual o tipo de insumo deseja analisar, bem como estabelecer"
LOCAL cDesc3     := STR0003 //"um filtro das Ordens de Servico que deseja que seja apresentadas no relatorio."
Local wnrel      := "MNTR680"

PRIVATE aReturn  := { STR0004, 1,STR0005, 2, 2, 1, "",1 } //"Zebrado"###"Administracao"
PRIVATE nLastKey := 0
PRIVATE Titulo
PRIVATE Tamanho  := If(nB1 > 0,"G","M")
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Variaveis utilizadas para parametros!                        ³
//³ mv_par01     // Plano de Manutencao                          ³
//³ mv_par02     // De  Ordem de Servico                         ³
//³ mv_par03     // Ate Ordem de Servico                         ³
//³ mv_par04     // Produtos                 Sim/Nao             ³
//³ mv_par05     // Funcionarios             Sim/Nao             ³
//³ mv_par06     // Ferramentas              Sim/Nao             ³
//³ mv_par07     // Terceiros                Sim/Nao             ³
//³ mv_par08     // Imprimir Localizacao ?   Sim/Nao             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

pergunte(cPerg,.F.)

Titulo   := STR0006 //"Projecao de Consumo Por O.S.  Plano...:"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Envia controle para a funcao SETPRINT                        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
wnrel:=SetPrint(cString,wnrel,cPerg,titulo,cDesc1,cDesc2,cDesc3,.F.,"")
If nLastKey = 27
   Set Filter To
   Return
Endif

SetDefault(aReturn,cString)

If nLastKey = 27
   Set Filter To
   Return
Endif

Titulo   := STR0006+STR0032+mv_par01 //"Projecao de Consumo Por O.S.  Plano...:"

RptStatus({|lEnd| R680Imp(@lEnd,wnRel,titulo,tamanho)},titulo)

Return NIL

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³ R680Imp  ³ Autor ³ Inacio Luiz Kolling   ³ Data ³ 26/06/97 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Chamada do Relat¢rio                                       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTR680                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

Static Function R680Imp(lEnd,wnRel,titulo,tamanho)
LOCAL cRodaTxt  := ""
LOCAL nCntImpr  := 0
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Contadores de linha e pagina                                 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
PRIVATE li := 80 ,m_pag := 1
PRIVATE Cabec1       := " "
PRIVATE Cabec2       := " "
PRIVATE nomeprog     := "MNTR680"
PRIVATE ntipo        := 0
PRIVATE nordem
PRIVATE quebra       := .f.
PRIVATE ctiporeg
PRIVATE nproduto
private achouos      := .f.
private novaordem    := .t.
private totaliza     := .f.
Private lExist	     := .F.

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se deve comprimir ou nao                            ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
nTipo  := IIF(aReturn[4]==1,15,18)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta os Cabecalhos                                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

/*
************************************************************************************************************************************
*<empresa>                                                                                                        Folha..: xxxxx   *
*SIGA /<nome .04                                 <     titulo do relatorio    >                                   DT.Ref.: dd/mm/aa*
*Hora...: xx:xx:xx                                                                                                Emissao: dd/mm/aa*
************************************************************************************************************************************
Tar    Tipo Codigo          Nome                               QTD   Consumo   Uni  Dt. inc.  Ho. Dt. fim  Ho. Dt. Prev. Blq. Dest.
************************************************************************************************************************************
          1         2         3         4         5         6         7         8         9         0         1         2         3
0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012

Ordem..: xxxxxx  Prior..: xxx  Bem..: xxxxxxxxxxxxxxxx xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  Servico..:xxxxxx xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Local..: xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxx xxxx xxxxxxxxxxxxxxx xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx 999 999.999,99 xxx 99/99/99 99:99 99/99/99 99:99 99/99/99 Sim Subst.

*/

if mv_par04 = 1 .or. mv_par05 = 1 .or. mv_par06 = 1 .or. mv_par07 = 1
    dbSelectArea("STJ")
    dbSetOrder(03)
    dbSeek(xFilial('STJ')+MV_PAR01+MV_PAR02,.T.)
    SetRegua(LastRec())

    While !Eof() .and. xFilial('STJ') == stj->tj_filial .and. stj->tj_ordem >= mv_par02;
         .and. stj->tj_ordem <= mv_par03
       If stj->tj_tipoos = "B" .or. stj->tj_tipoos = "L"
            totaliza := .f.
            nordem := stj->tj_ordem

            // PROCURA OS DETALHES DO PLANO E ORDEM NO STL

           dbSelectArea("STL")
           dbSetOrder(01)
           dbSeek(xFilial('STL')+nordem+MV_PAR01)
           if found()
              ntiporeg := stl->tl_tiporeg
              While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                  .and. stl->tl_plano == mv_par01
                  if stl->tl_tiporeg == "E"  // ESPECIALISTAS
                       STL->(dbskip())
                       loop
                  endif

                 IncRegua()
                 If Li > 58
                     Cabec(titulo,Cabec1,Cabec2,nomeprog,tamanho,nTipo)
                     Cabec1()
                 EndIf

                //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                //³ Selecao dos registros conforme os parametros                 ³
                //³ mv_par04     // Produtos                 Sim/Nao             ³
                //³ mv_par05     // Funcionarios             Sim/Nao             ³
                //³ mv_par06     // Ferramentas              Sim/Nao             ³
                //³ mv_par07     // Terceiros                Sim/Nao             ³
                //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

                 nnome  := space(35)
                 tipo   := space(04)
                 // Seleciona as Ferramentas

                 if mv_par06 = 1 .and.  stl->tl_tiporeg == 'F'
                     tipo   := 'Ferr'
                     quebra := .T.
                     lExist := .T.
                     While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                         .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "F"
                         nproduto := stl->tl_codigo
                         store .t. to achouos,totaliza
                         dbSelectArea("SH4")
                         dbSetOrder(01)
                         dbSeek(xFilial('STL')+substr(nproduto,1,6))
                         if found()
                             nnome := left(sh4->h4_DESCRI,35)
                         endif

                         dbSelectArea("STL")
								 
								 vVETHORAS := NGTQUATINS(STL->TL_CODIGO,STL->TL_TIPOREG,STL->TL_USACALE,;
   															 STL->TL_QUANTID,STL->TL_TIPOHOR,STL->TL_DTINICI,;
                  										 STL->TL_HOINICI,STL->TL_DTFIM,STL->TL_HOFIM,STL->TL_UNIDADE)
								 nQTDHORAS := vVETHORAS[2]

                         linhadetalhe(STL->TL_QUANREC,nQTDHORAS,STL->TL_REPFIM,STL->TL_DESTINO,;
                                      STL->TL_DTINICI,STL->TL_TAREFA,STL->TL_UNIDADE,STL->TL_TIPOREG)

                         // saltas os consumos utilizadas do produto  ( Val(STL->TL_SEQRELA) <> 0  REALIZADO)
                         STL->(dbskip())                         
                         While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
    	                    .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "F";
        	                .and. stl->tl_codigo == nproduto .and. Alltrim(stl->tl_seqrela) <> "0"
            	            STL->(dbskip())
                	     enddo
                      enddo
                 else
                    if mv_par06 = 2 .and.  stl->tl_tiporeg == 'F'
                        While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                          .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "F"
                              STL->(dbskip())
                        enddo
                    endif
                 endif

                 // Seleciona os Funcionario

                 if mv_par05 = 1 .and. stl->tl_tiporeg == 'M'
                      tipo   := 'Func'
                      quebra := .t.
                      lExist := .T.
                      While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                         .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "M"
                         nproduto := stl->tl_codigo
                         store .t. to achouos,totaliza
                         dbSelectArea("ST1")
                         dbSetOrder(01)
                         dbSeek(xFilial('ST1')+substr(nproduto,1,6))
                         if found()
                             nnome := left(st1->t1_nome,35)
                         endif

                         dbSelectArea("STL")

								 vVETHORAS := NGTQUATINS(STL->TL_CODIGO,STL->TL_TIPOREG,STL->TL_USACALE,;
   															 STL->TL_QUANTID,STL->TL_TIPOHOR,STL->TL_DTINICI,;
                  										 STL->TL_HOINICI,STL->TL_DTFIM,STL->TL_HOFIM,STL->TL_UNIDADE)
								 nQTDHORAS := vVETHORAS[2]

                         linhadetalhe(STL->TL_QUANREC,nQTDHORAS,STL->TL_REPFIM,;
                                      STL->TL_DESTINO,STL->TL_DTINICI,STL->TL_TAREFA,STL->TL_UNIDADE,STL->TL_TIPOREG)

                         // saltas os consumos utilizadas do produto  ( Val(STL->TL_SEQRELA) <> 0  REALIZADO)
                         STL->(dbskip())
                         While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
    	                    .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "M";
        	                .and. stl->tl_codigo == nproduto .and. Alltrim(stl->tl_seqrela) <> "0"
            	            STL->(dbskip())
                	     enddo
                      enddo
                 else
                     if mv_par05 = 2 .and.  stl->tl_tiporeg == 'M'
                         While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                         .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "M"
                            STL->(dbskip())
                         enddo
                     endif
                 endif

                 // Seleciona os Produtos

                 if mv_par04 = 1 .and.  stl->tl_tiporeg == 'P'
                     tipo   := 'Prod'
                     quebra := .t.
                     lExist := .T.
                     While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                         .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "P"
                         nproduto   := stl->tl_codigo
                         store .t. to achouos,totaliza
                         dbSelectArea("SB1")
                         dbSetOrder(01)
                         dbSeek(xFilial('SB1')+nproduto)
                         if found()
                             nnome := left(sb1->b1_desc,35)
                         endif
                         dbSelectArea("STL")

								 vVETHORAS := NGTQUATINS(STL->TL_CODIGO,STL->TL_TIPOREG,STL->TL_USACALE,;
   															 STL->TL_QUANTID,STL->TL_TIPOHOR,STL->TL_DTINICI,;
                  										 STL->TL_HOINICI,STL->TL_DTFIM,STL->TL_HOFIM,STL->TL_UNIDADE)
								 nQTDHORAS := vVETHORAS[2]

                         linhadetalhe(STL->TL_QUANREC,nQTDHORAS,STL->TL_REPFIM,;
                                      STL->TL_DESTINO,STL->TL_DTINICI,STL->TL_TAREFA,STL->TL_UNIDADE,STL->TL_TIPOREG)

                         // saltas os consumos utilizadas do produto  ( Val(STL->TL_SEQRELA) <> 0  REALIZADO)
                         STL->(dbskip())
                         While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
    	                    .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "P";
        	                .and. stl->tl_codigo == nproduto .and. Alltrim(stl->tl_seqrela) <> "0"
            	            STL->(dbskip())
                	     enddo
                      enddo
                 else
                     if mv_par04 = 2 .and.  stl->tl_tiporeg == 'P'
                         While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                          .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "P"
                             STL->(dbskip())
                         enddo
                     endif
                 endif

                  // Seleciona os Terceiras

                 if mv_par07 = 1 .and. stl->tl_tiporeg == 'T'
                       tipo   := 'Terc'
                       quebra := .T.
                       lExist := .T.
                       While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                         .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "T"
                         nproduto   := stl->tl_codigo
                         store .t. to achouos,totaliza
                         dbSelectArea("SA2")
                         dbSetOrder(01)
                         dbSeek(xFilial('SA2')+substr(nproduto,1,6))
                         if found()
                             nnome  := left(sa2->a2_nome,35)
                         endif
                         dbSelectArea("STL")

								 vVETHORAS := NGTQUATINS(STL->TL_CODIGO,STL->TL_TIPOREG,STL->TL_USACALE,;
   															 STL->TL_QUANTID,STL->TL_TIPOHOR,STL->TL_DTINICI,;
                  										 STL->TL_HOINICI,STL->TL_DTFIM,STL->TL_HOFIM,STL->TL_UNIDADE)
								 nQTDHORAS := vVETHORAS[2]

                         linhadetalhe(STL->TL_QUANREC,nQTDHORAS,STL->TL_REPFIM,;
                                      STL->TL_DESTINO,STL->TL_DTINICI,STL->TL_TAREFA,STL->TL_UNIDADE,STL->TL_TIPOREG)

                         // saltas os consumos utilizadas do produto  (Val(STL->TL_SEQRELA) <> 0  REALIZADO)
                         STL->(dbskip())
    	                 While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
        	                .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "T";
            	            .and. stl->tl_codigo == nproduto .and. Alltrim(stl->tl_seqrela) <> "0"
                	        STL->(dbskip())
                    	 enddo
                    	 
                    enddo
                 else
                     if mv_par07 = 2 .and. stl->tl_tiporeg == 'T'
                        While !STL->(Eof()) .and. xFilial('STL') == stl->tl_filial .and. stl->tl_ordem == nordem;
                          .and. stl->tl_plano == mv_par01 .and. stl->tl_tiporeg == "T"
                          STL->(dbskip())
                       enddo
                     endif
                 endif
             enddo
             if totaliza
                quebraordem()
             endif
             novaordem := .t.
           endif
        endif
        dbSelectArea("STJ")
        dbSkip()
        Loop
    Enddo
    Roda(nCntImpr,cRodaTxt,Tamanho)
endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Devolve a condicao original do arquivo principam             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If !lExist
	Help(" ",1,"NGTDADIMP") //"Nao existem dados para imprimir..."###"ATENCAO"
	RetIndex("STJ")
	RetIndex("STL")
Else
	Set Filter To
	Set device to Screen

	If aReturn[5] = 1
   		Set Printer To
   		dbCommitAll()
   		OurSpool(wnrel)
	Endif 
EndIf
MS_FLUSH()
Return NIL

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³ LINHADETALHE³ Autor ³ Inacio Luiz Kolling   ³ Data ³ 26/06/97 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Chamada do Relat¢rio                                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTR680                                                       ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function linhadetalhe(recurso,consumo,bloqueio,destino,dataprevista,tarefa,unidade,tipo)
Local desbloqueio := STR0008 //"Sim"
Local desdestino  := space(12)
Local aLocal := {}
Local nCont

if bloqueio = 'N'
    desbloqueio := STR0009 //"Nao"
endif

if STL->TL_TIPOREG == 'P'
   if STL->TL_destino = 'T'
       desdestino := STR0010 //"Troca"
   elseif STL->TL_destino == 'A'
       desdestino := STR0011 //"Apoio"
   else
       desdestino := STR0012 //"Subst."
   endif
endif

if novaordem
   somalinha()
   @li,001 Psay STR0013+nordem+STR0014+STJ->TJ_PRIORID //"Ordem..:"###" Prior..:"
    
   If stj->tj_tipoos == "B"
	   @li,031 Psay STR0015+stj->tj_codbem //"Bem..:"
	   
	   dbSelectArea("ST9")
   	dbSetOrder(01)
   	if DbSeek(xFilial('ST9')+stj->tj_codbem)
      	@li,055 Psay substr(st9->t9_nome,1,32)
   	endif 
	elseif stj->tj_tipoos == "L"
		@li,031 Psay STR0025+stj->tj_codbem//"Local: "
		
		DbSelectArea("TAF")
		DbSetOrder(7)
		if DbSeek(xfilial("TAF")+"X"+"2"+stj->tj_codbem)
			@li,055 Psay substr(taf->taf_nomniv,1,32)
		Endif
	endif
	
   @li,089 Psay STR0016+stj->tj_servico //"Servico..:"
   dbSelectArea("ST4")
   dbSetOrder(01)
   if dbSeek(xFilial('ST4')+stj->tj_servico)
      @li,106 Psay substr(st4->t4_nome,1,27)
   endif
   
   If MV_PAR08 == 1
		If stj->tj_tipoos == "B"
			cBem := NGLocComp(stj->tj_codbem,"1")
		ElseIf stj->tj_tipoos == "L"
			cBem := NGLocComp(stj->tj_codbem,"2")
		EndIf
	
		If	stj->tj_codbem <> cBem
			Somalinha()
			@ li,001 Psay STR0025 //"Local..: "
			
			nMaxCarac := 117
				
			If Len(cBem) > nMaxCarac 
		  		aLocal := MNTR680QLE(cBem)
		  		
		  		For nCont := 1 to Len(aLocal) 
		  			@ Li,014 Psay aLocal[nCont]
		  			If Len(aLocal) != nCont
		  				SomaLin()
		 			Endif				
				Next nCont
				
			Else
		   	@ Li,014 Psay cBem
			EndIf
		EndIf
	Endif
  
   novaordem := .f.
endif
Somalinha()

@li,001 Psay tarefa picture '@S6'
@li,008 Psay tipo picture '@S4'
@li,013 Psay stl->tl_codigo  picture '@S'+AllTrim(STR(nB1+15))
@li,025+nB1 Psay nnome    //       picture '@S35'
@li,061+nB1 Psay recurso         picture "999"            // quantidade de recurso
@li,060+nB1 Psay consumo         picture "@E 999,999.99"  // quantidade de consumo
@li,075+nB1 Psay unidade         picture '@S3'

@li,084+nB1 Psay stl->tl_dtinici picture '99/99/9999'
@li,095+nB1 Psay stl->tl_hoinici picture '99:99'
@li,105+nB1 Psay stl->tl_dtfim   picture '99/99/9999'
@li,116+nB1 Psay stl->tl_hofim   picture '99:99'

if tipo != "T"
   @li,124+nB1 Psay desbloqueio    picture '@S3'
Endif
@li,130+nB1 Psay desdestino     picture '@S8'
return

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³ Fun‡…o   ³ SomaLinha³ Autor ³ NG Informatica Ltda   ³ Data ³   /06/97 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Descri‡…o³ Incrementa Linha e Controla Salto de Pagina                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Sintaxe  ³ SomaLinha()                                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTR680        !                                           ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/

static Function Somalinha()
    Li++
    If Li > 58
        Cabec(titulo,cabec1,cabec2,nomeprog,tamanho,nTipo)
        Cabec1()
        Somalinha()
        Somalinha()
    EndIf
return

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³ Fun‡…o   ³ Cabec1   ³ Autor ³ NG Informatica Ltda   ³ Data ³   /06/97 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Descri‡…o³ Cabecalho do relatorio                                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTR680        !                                           ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Static Function Cabec1()

   	Local nRep := 142+If(nB1 > 0,Round((nB1/5)*3,3),0)
	
   @prow()+1,000 Psay Replicate("*",nRep)
   @prow()+1,001 Psay STR0017+Space((18-Len(STR0017))+5+nB1)+STR0018//"Tarefa Tipo Codigo"##"Nome                               Quant. Consumo  Unidade Dt.Início  Hr.Início  Dt.Fim    Hr.Fim  Bloqueio Destino"
   @prow()+1,000 Psay Replicate("*",nRep)
   li := prow()
return

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³ Fun‡…o   ³ QUEBRQORDEM ³ Autor ³ NG Informatica Ltda   ³ Data ³   /06/97 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Descri‡…o³ Cabecalho do relatorio                                        ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTR680        !                                              ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Static Function quebraordem()
   Somalinha()
   Somalinha()
return

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³ Fun‡…o   ³ R680QTD  ³ Autor ³ Ricardo Dal Ponte     ³ Data ³ 22/05/07 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Descri‡…o³ Transforma a quantidade do campo tl_quantid                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTR680                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/

Function R680QTD()
nQTDSTL := 0
vVETHORAS := NGTQUATINS(STL->TL_CODIGO,STL->TL_TIPOREG,STL->TL_USACALE,;
								STL->TL_QUANTID,STL->TL_TIPOHOR,STL->TL_DTINICI,;
                  		STL->TL_HOINICI,STL->TL_DTFIM,STL->TL_HOFIM,STL->TL_UNIDADE)
nQTDSTL := vVETHORAS[2]
Return nQTDSTL


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MNTR680   ºAutor  ³Microsiga           º Data ³  09/06/10   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Quebra de linha para estruturas de localização maiores      º±±
±±º          ³que a disponibilidade de caracteres da linha.               º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function MNTR680QLE(cEstrut) // MNTR 120 Quebra LInha

Local nAT			:=	0	// Quantidade de caracteres ate o '>'
Local nAuxAT		:=	0	//	Quantidade total de carcteres ja verificados
Local aAuxEstrut	:=	{} // Array que recebe as localizacoes - cada posicao diferente corresponde a outra linha

While Len(cEstrut) > nMaxCarac
	nAT := AT	(">",cEstrut)
	If nAT == 0
		Exit
	EndIf
	If nAT > nMaxCarac
		aAdd(aAuxEstrut,SubStr(cEstrut,1,nMaxCarac))
		cEstrut := SubStr(cEstrut,(nMaxCarac+1))
		nAT := AT(">",cEstrut)
		If nAT == 0
			Exit
		EndIf
		While nAT > nMaxCarac
			aAdd(aAuxEstrut,SubStr(cEstrut,1,nMaxCarac))
			cEstrut := SubStr(cEstrut,(nMaxCarac+1))
			nAT := AT(">",cEstrut)
			If nAT == 0
				Exit
			EndIf
		End
	EndIf
	aAdd(aAuxEstrut,SubStr(cEstrut,1,(nAT+1)))
	cEstrut := SubStr(cEstrut,(nAT+2))
	nAuxAT := nAT
	While nAuxAT < nMaxCarac
		nAT := AT(">",cEstrut)
		If nAT == 0
			Exit
		EndIf
		nAuxAT += (nAT+1)
		If nAuxAT < nMaxCarac
			aAuxEstrut[Len(aAuxEstrut)] += SubStr(cEstrut,1,(nAT+1))
			cEstrut := SubStr(cEstrut,(nAT+2))
		EndIf
	End
End

If Len(cEstrut) > 0
	If (Len(aAuxEstrut[Len(aAuxEstrut)]) + Len(cEstrut)) < nMaxCarac
		aAuxEstrut[Len(aAuxEstrut)] += cEstrut
	Else
		aAdd(aAuxEstrut,cEstrut)
	EndIf
EndIf

Return aAuxEstrut