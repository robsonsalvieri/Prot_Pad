#INCLUDE "MNTC605.CH"
#INCLUDE "PROTHEUS.CH"

//---------------------------------------------------------------------
/*/{Protheus.doc} MNTC605
Consulta Geral Manutencao do Bem

@author Inacio Luiz Kolling
@since 02/08/97
@type function
/*/
//---------------------------------------------------------------------
FUNCTION MNTC605(cBem) 

    Local aNGBEGINPRM
    Local aALIAS
    Local i

    If !FindFunction( 'MNTAmIIn' ) .Or. MNTAmIIn( 19, 95 )

        aNGBEGINPRM := NGBEGINPRM()

        PRIVATE aRotina := MenuDef()

        //Ŀ
        // Define o cabecalho da tela de baixas                         
        //

        cCADASTRO := OEMTOANSI(STR0005) //"Manutencoes do Bem"
        PRIVATE cONSHISTO := .T.
        PRIVATE cONSPROGR := 'MNTC605'
        PRIVATE lMOSTRA   := .T.

        If cBem <> Nil
            DbSelectArea( "ST9" )
            DbSetOrder( 01 )
            DbSeek( xFilial( "ST9" ) + cBem )
        Set Filter to xFilial( "ST9" ) = ST9->T9_FILIAL .and. cBem  = ST9->T9_CODBEM
        EndIf	    
        MBROWSE(6,1,22,75,"ST9")
        //Ŀ
        // Desativa tecla F12                                             
        //
        SET KEY VK_F12 TO

        DBSELECTAREA("STF")
        DBSETORDER(1)
        aALIAS:={"STF"}
        FOR i:=1 TO LEN(aALIAS)
            DBSELECTAREA(aALIAS[i])
            DBSETORDER(1)
        NEXT i
        If cBem <> Nil
            Set Filter to
        EndIf
        DBSELECTAREA("STI")

        //Ŀ
        // Devolve variaveis armazenadas (NGRIGHTCLICK)                          
        //
        NGRETURNPRM(aNGBEGINPRM)

    EndIf

RETURN .T.

//---------------------------------------------------------------------
/*/{Protheus.doc} MNC605CON
Manutenes do bem

@author Inacio Luiz Kolling
@since 02/07/97
@return Nil
/*/
//---------------------------------------------------------------------
FUNCTION MNC605CON()

    Local cOldRot

    If FindFunction( 'MNTC605A' )

        //-----------------------------------------------------
		// Apresenta menu de forma padro
		//-----------------------------------------------------
        MNTC605A()
    
    Else
        
        PRIVATE cCADASTRO := OEMTOANSI(STR0005) //"Manutencoes do Bem"

        cOldRot  := aCLONE(aROTINA)
        aROTINA := {{STR0001,"AXPesqui"  , 0, 1},; //"Pesquisar"
                    {STR0002,"MNC600FOLD", 0, 2}}  //"Visualizar"

        M->T9_CODBEM := ST9->T9_CODBEM
        DBSELECTAREA("STF")
        DBSETORDER(1)

        cKEY   := M->T9_CODBEM
        bWHILE := {|| !EOF() .AND. STF->TF_CODBEM == M->T9_CODBEM}
        bFOR   := {|| TF_FILIAL  == xFILIAL("STF") }
        NGCONSULTA("TRBF",cKEY,bWHILE,bFOR,aROTINA,{})
        DBSELECTAREA("STF")
        DBSETORDER(1)
        aROTINA := aCLONE(cOldRot)

    EndIf

Return

/*/


Ŀ
Funo    MNTCDEPE   Autor  Inacio Luiz Kolling    Data  02/08/97 
Ĵ
Descrio  Monta um browse com as Dependencia   da manutencao         
Ĵ
 Uso       MNTC605                                                    
ٱ


/*/
FUNCTION MNTCDEPE()
LOCAL OLDDETALHE

PRIVATE cCADASTRO := OEMTOANSI(STR0008) //"Dependencia da Manutencao"
OLDDETALHE := aCLONE(aROTINA)  

aROTINA    := {		{STR0001,"AXPesqui" , 0, 1},; //"Pesquisar"
                	{STR0002,"NGCAD01", 0, 2}} //"visualizar" 

M->T5_CODBEM  := ST5->T5_CODBEM
M->T5_SERVICO := ST5->T5_SERVICO
M->T5_SEQRELA := ST5->T5_SEQRELA
M->T5_TAREFA  := ST5->T5_TAREFA
DBSELECTAREA("STM")
DBSETORDER(1)

cKEY   := M->T5_CODBEM+M->T5_SERVICO+M->T5_SEQRELA+M->T5_TAREFA
bWHILE := {|| !EOF()                            .AND.;
              STM->TM_CODBEM  == M->T5_CODBEM  .AND.;
    	      STM->TM_SERVICO == M->T5_SERVICO .AND.;
              STM->TM_SEQRELA == M->T5_SEQRELA .AND.;
              STM->TM_TAREFA  == M->T5_TAREFA}
bFOR   := {|| TM_FILIAL  == xFILIAL("STM")}

NGCONSULTA("TRBM",cKEY,bWHILE,bFOR,aROTINA)
DBSELECTAREA("STM")
DBSETORDER(1)
aROTINA := aCLONE(OLDDETALHE)
RETURN

/*/


Ŀ
Programa  MenuDef    Autor  Ricardo Dal Ponte      Data 29/11/2006
Ĵ
Descrio  Utilizacao de menu Funcional                               
                                                                      
                                                                      
Ĵ
Retorno   Array com opcoes da rotina.                                 
Ĵ
ParametrosParametros do array a Rotina:                               
          1. Nome a aparecer no cabecalho                             
          2. Nome da Rotina associada                                 
          3. Reservado                                                
          4. Tipo de Transao a ser efetuada:                        
          		1 - Pesquisa e Posiciona em um Banco de Dados           
              2 - Simplesmente Mostra os Campos                       
              3 - Inclui registros no Bancos de Dados                 
              4 - Altera o registro corrente                          
              5 - Remove o registro corrente do Banco de Dados        
          5. Nivel de acesso                                          
          6. Habilita Menu Funcional                                  
Ĵ
   DATA    Programador   Manutencao efetuada                         
Ĵ
                                                                     
ٱ


/*/

Static Function MenuDef()

Local aROTINA := {{STR0001,"AxPesqui" , 0, 1},;     //"Pesquisar"
                    {STR0002,"NG080FOLD", 0, 2},;    //"Visualizar"
                    {STR0003,"MNC605CON", 0, 3, 0},; //"Manutencao"
                    {STR0004,"MNC510HIS", 0, 4, 0}}  //"Historico"
Return(aRotina)
