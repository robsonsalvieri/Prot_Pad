#INCLUDE "MNTA230.ch"
#INCLUDE "PROTHEUS.CH"
#INCLUDE "FWADAPTEREAI.CH" // Integração via Mensagem Única
#define cCORFA COLOR CLR_HRED
#define cCORBL COLOR CLR_HBLUE

/*/

ATENCAO: NOVO FORMADO COM OBJETOS.

ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230   ³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Monta a esquema GET                                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230
Local oDlg4

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Guarda conteudo e declara variaveis padroes ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local aNGBEGINPRM := NGBEGINPRM()
Local oPanel
Local aSMenu

If (NGCADICBASE("TQC_PROGRA","D","TQC",.F.) .And. NGCADICBASE("TQD_PROGRA","D","TQD",.F.))
	asMenu := NGRIGHTCLICK("MNTA230")
EndIf

Private cFORMA  := Space(LEN(TQ0->TQ0_DESENH)), cBEM    := Space(LEN(ST9->T9_CODBEM))
Private cBEMNOM := Space(LEN(ST9->T9_NOME)),    cFORNOM := Space(Len(ST6->T6_NOME))
Private cCUSTOB := Space(LEN(ST9->T9_CCUSTO)),cCENTRAB := Space(Len(ST9->T9_CENTRAB))
Private cCALENB := Space(LEN(ST9->T9_CALENDA))
Private nPOSCONT,nPOSCON2,nOP230 := 2,nMONTAG := 1                // numericas
Private lTEMCONT,lTEMCON2,lCHKCON1,lCHKCON2                       // logicas
Private dDTDATEM := dDataBase                                     // datas
Private cBEMME   := cBEM,cMONTAG := STR0001,cHORALE1,cHORALE2     // strings //"Rodados"
Private cCODIFAM := Space(Len(st9->t9_codfami)),oMenu,lSH1 := .F.

Private cHRTIME   := SubStr(Time(),1,5) //Hora do Sistema
Private cHRTIME1M := MTOH(HTOM(cHRTIME)+1) //Hora do Sistema + 1 minuto para a troca de localizacao na estrutura

// Nao mexer
Private lFrota := .f.  // USADO NO MNTA098.PRX

Store  '  :  ' To cHORALE1,cHORALE2
Store 0        To nPOSCONT,nPOSCON2
Store .f.      To lTEMCONT,lTEMCON2,lCHKCON1,lCHKCON2

DEFINE MSDIALOG oDlg4 TITLE OemToAnsi(STR0004) From 11,15 To 27,80 OF oMainWnd COLOR CLR_BLACK,CLR_WHITE//"Esquema de Rodado"

	oPanel := TPanel():New(0, 0, Nil, oDlg4, Nil, .T., .F., Nil, Nil, 0, 0, .T., .F. )
		oPanel:Align := CONTROL_ALIGN_ALLCLIENT

	   @ 0.7,2  say OemtoAnsi(STR0005) Of oPanel //"Bem"
	   @ 0.5,4  MSget cBEM     Picture "@!"  VALID MNTA230EST(cBEM) F3 "ST9" SIZE 60,10 HASBUTTON Of oPanel
	   @ 0.5,12 MSget cBEMNOM  Picture "@!" SIZE 150,10 WHEN .F. Of oPanel

	   @ 1.7,2  say OemtoAnsi(STR0006) Of oPanel//"Esquema"
	   @ 1.5,5  MSget cFORMA   Picture "@!" SIZE 30,10  When .f. Of oPanel
	   @ 1.5,9  MSget cFORNOM  Picture "@!" SIZE 150,10 WHEN .F. Of oPanel

	   @ 2.7,2  say OemtoAnsi(STR0007) Of oPanel//"Data Mov"
	   @ 2.5,5  MSget dDTDATEM Picture "99/99/9999" VALID NAOVAZIO() SIZE 45,10 HASBUTTON Of oPanel

	   @ 2.7,11 say OemtoAnsi(STR0008) Of oPanel//"Contador 1"
	   @ 2.5,15 MSget nPOSCONT Picture "999999999";
	         VALID MNTA230VCO(nPOSCONT,1) When lTEMCONT Of oPanel

	   @ 2.7,22 say OemtoAnsi(STR0009) Of oPanel//"Hora Leitura"
	   @ 2.5,27 Msget cHORALE1 Picture "99:99" SIZE 10,08 WHEN lTEMCONT;
	         VALID MNTA230HIS(nPOSCONT,cHORALE1,1,.T.) Of oPanel

	   @ 3.7,11 say OemtoAnsi(STR0010) Of oPanel//"Contador 2"
	   @ 3.5,15 MSget nPOSCON2 Picture "999999999";
	        VALID MNTA230VCO(nPOSCON2,2) When lTEMCON2 Of oPanel

	   @ 3.7,22 say OemtoAnsi(STR0009) Of oPanel//"Hora Leitura"
	   @ 3.5,27 Msget cHORALE2 Picture "99:99" SIZE 10,08 WHEN lTEMCON2;
	         VALID MNTA230HIS(nPOSCON2,cHORALE2,2,.T.) Of oPanel

	   @ 3.9,2 To 7.4,13.5 LABEL STR0011 OF oPanel //"Apresentar o Esquema Por"
	   @ 65,23 RADIO oRAD VAR nMONTAG ITEMS STR0001,STR0012,STR0013 3D SIZE 78,10 Of oPanel //"Rodados"###"Rodados / Localizacoes"###"Rodados / Familias"

	If Len(aSMenu) > 0
		NGPOPUP(aSMenu,@oMenu,oPanel)
		oPanel:bRClicked := { |o,x,y| oMenu:Activate(x,y,oPanel)}
	EndIf

ACTIVATE MSDIALOG oDlg4 ON INIT EnchoiceBar(oDlg4,{||nOP230:=1,If(!MNTA230TOK(),nOP230 := 2,oDlg4:End())},{||oDlg4:End()}) CENTERED

If nOP230 == 1
   MNTA230GET(cBEM,dDTDATEM,nPOSCONT,nPOSCON2,nMONTAG,cHORALE1,cHORALE2)
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Retorna conteudo de variaveis padroes       ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
NGRETURNPRM(aNGBEGINPRM)

Return NIL

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230VCO³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Consistencia dos contadores ( GET )                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ mnta230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function MNTA230VCO(nCONTG,nTIPG)
lCHKCON1 := If(nTIPG = 1,.F.,lCHKCON1)
lCHKCON2 := If(nTIPG = 2,.F.,lCHKCON2)
If !Positivo(nCONTG) .Or. !Naovazio(nCONTG) .Or. !CHKPOSLIM(cBEM,nCONTG,nTIPG)
   Return .f.
Endif
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230TOK³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Consistencia Final dos contadores                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ mnta230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function MNTA230TOK()
If lTEMCONT .And. !lCHKCON1
   If !MNTA230HIS(nPOSCONT,cHORALE1,1,.f.)
     Return .f.
   Endif
Endif
If lTEMCON2 .And. !lCHKCON2
   If !MNTA230HIS(nPOSCON2,cHORALE2,2,.f.)
     Return .f.
   Endif
Endif
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230HIS³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Consistencia dos contadores ( gets / final )                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ mnta230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function MNTA230HIS(nCONTAD,cVHORCON,nTIP,lCHKTIP)
If !NGVALHORA(cVHORCON,.T.)
   Return .f.
Endif
If !NGCHKHISTO(cBEM,dDTDATEM,nCONTAD,cVHORCON,nTIP,,.T.)
   Return .f.
Endif
If !NGVALIVARD(cBEM,nCONTAD,dDTDATEM,cVHORCON,nTIP,.t.)
   Return .f.
Endif
If lCHKTIP
   If nTIP = 1
      lCHKCON1 := .T.
   Elseif nTIP = 2
      lCHKCON2 := .T.
   Endif
Endif
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230GET³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Monta da estrutura                                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ mnta230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230GET(cVBEMF,dDATAEM,nCONT,nCONT2,nDESIG,cVHESP1,cVHESP2)

	Local cGERAPREV := AllTrim(GETMv("MV_NGGERPR"))
	Local nOpca := 0, i,lAllOk,cCampo, nX, nY, cCaption, cPict, cValid, cF3
	Local cWhen, nLargSay, nLargGet, uConteudo, oSay, oGet,oBar,lOk,oScroll
	Local cAliasTRBY := GetNextAlias()
	Local cAliasTRBZ := GetNextAlias()
	Local cBlkGet,cBlkWhen,cBlkVld, oSaveGetdad := Nil, aSvRot := Nil
	Local XI,LT,CT,XW,XX,XP,XY,YX,YK,XK,M,ZZ,nCL,nLC,nj
	Local nPOSCST9, nPOSCTPE
	Local lLanHRet := NGHISTRETR(cVBEMF,dDATAEM,cVHESP1,1,xFilial("STP"))
	Local oScrollBox, oDlge
	Local oTempTRBY
	Local oTempTRBZ
	Local lGFrota   := MNTA220FR()
	Local lPIMSINT	:= SuperGetMV("MV_PIMSINT",.F.,.F.)
	Local lMain	    := .F.
	Local oTempSTC  := Nil

	//Variaveis utilizadas no MNTA098
	//---------------------
	Private aOrdStruct	:= {} //Array utilizado para adicionar 'filhos' da estrutura para controle da árvore ordenada.
	Private cTRB981 	:= GetNextAlias()
	// lTipMod recebe somente o valor de lFrota, pois trabalha com valor chumbado de .F.(default da rotina), Utilizado no processo do tipo modelo TODOS
	Private lTipMod     := lFrota
	//---------------------
	Private lVolta  	:=.f. ,bSet15,bSet24,oDlg

	cLineOk := "AllwaysTrue()"
	cAllOk  := "AllwaysTrue()"
	nCOunt  := 0
	nOpcx   := 3
	oGets   := {}
	aC      := {}

	Dbselectarea("ST9")
	Dbsetorder(1)
	If !Dbseek(xFilial('ST9')+cVBEMF)
		msginfo(STR0014+Alltrim(cVBEMF)+STR0015,STR0016) //"Bem "###" Nao Cadastrado "###"ATENCAO"
		Return .f.
	Endif

	cBEM    := cVBEMF
	cFORMA  := ST9->T9_CODFAMI
	cBEMNOM := ST9->T9_NOME

	Dbselectarea("TQ0")
	Dbsetorder(1)
	If !Dbseek( xFilial('TQ0')+cFORMA)
		msginfo(STR0017+cFORMA+STR0018,STR0016) //"Esquema padrao  "###"  Nao cadastrado"###"ATENCAO"
		Return .f.
	Endif

	Dbselectarea("ST6")
	Dbsetorder(1)
	Dbseek(xFilial('ST6')+cFORMA)
	cFORNOM := ST6->T6_NOME

	Dbselectarea("TQ1")
	Dbsetorder(1)
	If !Dbseek( xFilial('TQ1')+TQ0->TQ0_DESENH)
		msginfo(STR0019+cFORMA,STR0016) //"Nao Existe Itens Para Esquema de Rodado  "###"ATENCAO"
		Return .f.
	Endif

	// TempTable com a situação atual do pai da estrutura
	aDBFY := STC->(DbStruct())
	aAdd(aDBFY,{"TC_CONTRO","C",01,0}) // Tipo de Controle do compenente (S,P,I,N)

	oTempTRBY := FWTemporaryTable():New( cAliasTRBY , aDBFY )
	oTempTRBY:AddIndex( "1", {"TC_CODBEM","TC_COMPONE"} )
	oTempTRBY:AddIndex( "2", {"TC_COMPONE","TC_CODBEM"} )
	oTempTRBY:Create()

	// Arquivo temporario com a situação atual do pai após a gravação do STC
	aDBFZ := STC->(DbStruct())
	aAdd(aDBFZ,{"TC_CONTRO","C",01,0}) // Tipo de Controle do compenente (S,P,I,N)

	oTempTRBZ := FWTemporaryTable():New( cAliasTRBZ , aDBFZ )
	oTempTRBZ:AddIndex( "1", {"TC_CODBEM","TC_COMPONE"} )
	oTempTRBZ:AddIndex( "2", {"TC_COMPONE","TC_CODBEM"} )
	oTempTRBZ:Create()

	dbSelectArea("STC")
	nTAMCC := Len(STC->TC_CODBEM)
	aDBFXY := STC->(DbStruct())
	aAdd(aDBFXY,{"TC_FAMBEM" ,"C",nTAMCC,0})
	aAdd(aDBFXY,{"TC_FAMCOMP","C",nTAMCC,0})

	vINDXTRBX := {{"TC_CODBEM","TC_COMPONE"},{"TC_COMPONE","TC_CODBEM"},{"TC_FAMBEM","TC_FAMCOMP"}}
	oTempSTC  := NGFwTmpTbl(cTRB981,aDBFXY,vINDXTRBX)

	MNTA098PAI("B",cVBEMF)

	dDTDATA   := dDATAEM
	nPOSCST9  := nCONT
	nPOSCTPE  := nCONT2
	cPNEUROD  := Space(LEN(ST9->T9_CODBEM))
	cSTRINGT9 := Space(LEN(ST9->T9_CODBEM))
	cPNEUOLD  := Space(LEN(ST9->T9_CODBEM))
	cBEMSTC   := SPACE(LEN(ST9->T9_CODBEM))
	cNOMCAU   := Space(Len(st8->t8_nome))
	cMOTIVE   := Space(Len(stz->tz_causa))
	cCODIFAM  := Space(Len(st9->t9_codfami))
	cFAMISTC  := SPACE(LEN(ST9->T9_CODFAMI))

	lSH1      := .F.
	lCARESTP  := .F.
	aARRAESTP := {}
	aARRAPTQ1 := {}
	aARRAYSTC := {}
	aBEMLOC   := {}
	aARRAYTRB := {}
	aNOMEVAR  := {}
	aDESIGNE  := {}
	aCOLLINH  := {}
	nDESIGM   := nDESIG

	// Verifica as localizações do desenho do rodado
	DbSelectArea("TQ1")
	While !Eof() .And. TQ1->TQ1_FILIAL == xFILIAL("TQ1") .And. TQ1->TQ1_DESENH == TQ0->TQ0_DESENH

		Aadd(aARRAPTQ1,{TQ1->TQ1_QTDPNE,TQ1->TQ1_LOCPN1,TQ1->TQ1_LOCPN2,;
			            TQ1->TQ1_LOCPN3,TQ1->TQ1_LOCPN4,TQ1->TQ1_LOCPN5,;
			            TQ1->TQ1_LOCPN6,TQ1->TQ1_LOCPN7,TQ1->TQ1_LOCPN8,;
			            TQ1->TQ1_LOCPN9,TQ1->TQ1_LOCPN0,TQ1->TQ1_EIXO,;
			            TQ1->TQ1_FAMIL1,TQ1->TQ1_FAMIL2,TQ1->TQ1_FAMIL3,;
			            TQ1->TQ1_FAMIL4,TQ1->TQ1_FAMIL5,TQ1->TQ1_FAMIL6,;
			            TQ1->TQ1_FAMIL7,TQ1->TQ1_FAMIL8,TQ1->TQ1_FAMIL9,;
			            TQ1->TQ1_FAMIL0})

		Aadd(aARRAYSTC,{TQ1->TQ1_QTDPNE,cBEMSTC,cBEMSTC,cBEMSTC,cBEMSTC,;
			            cBEMSTC,cBEMSTC,cBEMSTC,cBEMSTC,cBEMSTC,cBEMSTC,;
			            TQ1->TQ1_EIXO,cFAMISTC,cFAMISTC,cFAMISTC,cFAMISTC,;
			            cFAMISTC,cFAMISTC,cFAMISTC,cFAMISTC,cFAMISTC,cFAMISTC})

		Dbselectarea("TQ1")
		DbSkip()
	End

	nAUXEIXO := Len(aARRAPTQ1)

	// Verifica os componetes da estrutura
	aBEM := NGCOMPEST(cBEM,'B',.F.,.F.)
	If Len(aBEM) == 0
		msginfo(STR0020,STR0016) //"Este bem nao tem estrutura.."###"ATENCAO"
		Return .f.
	Endif

	aBEMLOC := {}

	// Localização na estrutura
	For xi := 1 to Len(aBEM)
		Dbselectarea("ST9")
		Dbsetorder(1)
		If Dbseek(XFILIAL("ST9")+aBEM[xi])
			Dbselectarea("STC")
			Dbsetorder(3)
			If Dbseek(XFILIAL("STC")+aBEM[xi])
				While !Eof() .And. stc->tc_filial = Xfilial('STC') .And.;
						stc->tc_compone = aBEM[xi]
					If !Empty(STC->TC_LOCALIZ) .And. STC->TC_TIPOEST = 'B'
						Aadd(aBEMLOC,{STC->TC_LOCALIZ,aBEM[xi],Space(Len(stz->tz_causa)),st9->t9_codfami,stc->tc_codbem})
						Exit
					Endif
					Dbskip()
				End
			Endif
		Endif
	Next

	aARRAYTRB := {}

	// Monta a estrutura do esquema de rodado com os rodados
	For LT := 1 to Len(aARRAPTQ1)
		For CT := 2 to 11
			cLOC    := ALLTRIM(aARRAPTQ1[LT][CT])
			cBEMSTC := cSTRINGT9
			cBEMPAI := cSTRINGT9
			If !Empty(cLOC)
				nPOS := ASCAN(aBEMLOC,{|x| x[1]+x[4] == aARRAPTQ1[LT][CT]+aARRAPTQ1[LT][CT+11]})
				If nPOS > 0
					cBEMSTC := aBEMLOC[nPOS][2]
					cBEMPAI := aBEMLOC[nPOS][5]
					aARRAYSTC[LT][CT]   := cBEMSTC
					aARRAYSTC[LT][CT+11] := aBEMLOC[nPOS][4]
				Endif

				If CT >= 2 .AND. CT <= 11
					cLOCTRB := cLOC+SPACE(LEN(STC->TC_LOCALIZ)-LEN(cLOC))
					Aadd(aARRAYTRB,{cLOCTRB,SPACE(8),cBEMSTC,aARRAPTQ1[LT][CT+11],cBEMPAI})
				Endif
			Endif
		Next CT
	Next LT

	aARRAYINI := Aclone(aARRAYTRB)
	aARRAYCOL := {175,105,95,70,36,1}
	nCOL      := If(nAUXEIXO < 7,aARRAYCOL[nAUXEIXO],0)
	nCOLX     := nCOL - 1
	cTIPODEG  := STR0001 //"RODADOS"
	nMaxPe    := 0

	For xw := 1 to nAUXEIXO

		cEIX   := Alltrim(Str(xw,3))
		vPNUEI := {}
		vDESIG := {}
		nMaxPe := Max(nMaxPe,aARRAYSTC[xw,1])

		For zz := 1 To aARRAYSTC[xw][1]
			cPNEI := If(zz = 10,Str(zz,2),Str(zz,1))
			cVARP := Space(10)
			cVARP := Alltrim('P'+cPNEI+'E'+cEIX)
			Public &(cVARP) := aARRAYSTC[XW][zz+1]

			nPOST := ASCAN(aARRAYTRB,{|x| x[1] == aARRAPTQ1[xw][zz+1]})
			If nPOST > 0
				aARRAYTRB[nPOST][2] := cVARP
			Endif

			Aadd(vPNUEI,cVARP)
			Aadd(vDESIG,aARRAYTRB[nPOST][1])
		Next zz

		Aadd(aNOMEVAR,vPNUEI)
		Aadd(aDESIGNE,vDESIG)

	Next xw

	nopce    := 0
	cREADVAR := SPACE(8)

	vVQE := If(nDESIGM = 1,{45,40,35,30,25,20,15,10,5,0},{80,70,60,50,50,40,40,15,20,0})

	// 1
	l11 := If(nDESIGM = 1,95-vVQE[nMaxPe],137-vVQE[nMaxPe])

	// 2
	l21 := If(nDESIGM = 1,82-vVQE[nMaxPe] ,114-vVQE[nMaxPe])
	l22 := If(nDESIGM = 1,107-vVQE[nMaxPe],162-vVQE[nMaxPe])

	// 3
	l31 := If(nDESIGM = 1,80-vVQE[nMaxPe] ,119-vVQE[nMaxPe])
	l32 := If(nDESIGM = 1,95-vVQE[nMaxPe] ,142-vVQE[nMaxPe])
	l33 := If(nDESIGM = 1,110-vVQE[nMaxPe],165-vVQE[nMaxPe])

	// 4
	l41 := If(nDESIGM = 1,67-vVQE[nMaxPe] ,91-vVQE[nMaxPe])
	l42 := If(nDESIGM = 1,82-vVQE[nMaxPe] ,114-vVQE[nMaxPe])
	l43 := If(nDESIGM = 1,107-vVQE[nMaxPe],162-vVQE[nMaxPe])
	l44 := If(nDESIGM = 1,122-vVQE[nMaxPe],185-vVQE[nMaxPe])

	// 5
	l51 := If(nDESIGM = 1,65-vVQE[nMaxPe] ,96-vVQE[nMaxPe])
	l52 := If(nDESIGM = 1,80-vVQE[nMaxPe] ,119-vVQE[nMaxPe])
	l53 := If(nDESIGM = 1,95-vVQE[nMaxPe] ,142-vVQE[nMaxPe])
	l54 := If(nDESIGM = 1,110-vVQE[nMaxPe],165-vVQE[nMaxPe])
	l55 := If(nDESIGM = 1,125-vVQE[nMaxPe],188-vVQE[nMaxPe])

	// 6
	l61 := If(nDESIGM = 1,52-vVQE[nMaxPe] ,68-vVQE[nMaxPe])
	l62 := If(nDESIGM = 1,67-vVQE[nMaxPe] ,91-vVQE[nMaxPe])
	l63 := If(nDESIGM = 1,82-vVQE[nMaxPe] ,114-vVQE[nMaxPe])
	l64 := If(nDESIGM = 1,107-vVQE[nMaxPe],162-vVQE[nMaxPe])
	l65 := If(nDESIGM = 1,122-vVQE[nMaxPe],185-vVQE[nMaxPe])
	l66 := If(nDESIGM = 1,137-vVQE[nMaxPe],208-vVQE[nMaxPe])

	// 7
	l71 := If(nDESIGM = 1,50-vVQE[nMaxPe] ,73-vVQE[nMaxPe])
	l72 := If(nDESIGM = 1,65-vVQE[nMaxPe] ,96-vVQE[nMaxPe])
	l73 := If(nDESIGM = 1,80-vVQE[nMaxPe] ,119-vVQE[nMaxPe])
	l74 := If(nDESIGM = 1,95-vVQE[nMaxPe] ,142-vVQE[nMaxPe])
	l75 := If(nDESIGM = 1,110-vVQE[nMaxPe],165-vVQE[nMaxPe])
	l76 := If(nDESIGM = 1,125-vVQE[nMaxPe],188-vVQE[nMaxPe])
	l77 := If(nDESIGM = 1,140-vVQE[nMaxPe],211-vVQE[nMaxPe])

	// 8
	l81 := If(nDESIGM = 1,37-vVQE[nMaxPe] ,45-vVQE[nMaxPe])
	l82 := If(nDESIGM = 1,52-vVQE[nMaxPe] ,68-vVQE[nMaxPe])
	l83 := If(nDESIGM = 1,67-vVQE[nMaxPe] ,91-vVQE[nMaxPe])
	l84 := If(nDESIGM = 1,82-vVQE[nMaxPe] ,114-vVQE[nMaxPe])
	l85 := If(nDESIGM = 1,107-vVQE[nMaxPe],162-vVQE[nMaxPe])
	l86 := If(nDESIGM = 1,122-vVQE[nMaxPe],185-vVQE[nMaxPe])
	l87 := If(nDESIGM = 1,137-vVQE[nMaxPe],208-vVQE[nMaxPe])
	l88 := If(nDESIGM = 1,152-vVQE[nMaxPe],231-vVQE[nMaxPe])

	// 9
	l91 := If(nDESIGM = 1,35-vVQE[nMaxPe] ,50-vVQE[nMaxPe])
	l92 := If(nDESIGM = 1,50-vVQE[nMaxPe] ,73-vVQE[nMaxPe])
	l93 := If(nDESIGM = 1,65-vVQE[nMaxPe] ,96-vVQE[nMaxPe])
	l94 := If(nDESIGM = 1,80-vVQE[nMaxPe] ,119-vVQE[nMaxPe])
	l95 := If(nDESIGM = 1,95-vVQE[nMaxPe] ,142-vVQE[nMaxPe])
	l96 := If(nDESIGM = 1,110-vVQE[nMaxPe],165-vVQE[nMaxPe])
	l97 := If(nDESIGM = 1,125-vVQE[nMaxPe],188-vVQE[nMaxPe])
	l98 := If(nDESIGM = 1,140-vVQE[nMaxPe],211-vVQE[nMaxPe])
	l99 := If(nDESIGM = 1,155-vVQE[nMaxPe],234-vVQE[nMaxPe])

	// 10
	l01 := If(nDESIGM = 1,22-vVQE[nMaxPe] ,22-vVQE[nMaxPe])
	l02 := If(nDESIGM = 1,37-vVQE[nMaxPe] ,45-vVQE[nMaxPe])
	l03 := If(nDESIGM = 1,52-vVQE[nMaxPe] ,68-vVQE[nMaxPe])
	l04 := If(nDESIGM = 1,67-vVQE[nMaxPe] ,91-vVQE[nMaxPe])
	l05 := If(nDESIGM = 1,82-vVQE[nMaxPe] ,114-vVQE[nMaxPe])
	l06 := If(nDESIGM = 1,107-vVQE[nMaxPe],162-vVQE[nMaxPe])
	l07 := If(nDESIGM = 1,122-vVQE[nMaxPe],185-vVQE[nMaxPe])
	l08 := If(nDESIGM = 1,137-vVQE[nMaxPe],208-vVQE[nMaxPe])
	l09 := If(nDESIGM = 1,152-vVQE[nMaxPe],231-vVQE[nMaxPe])
	l00 := If(nDESIGM = 1,167-vVQE[nMaxPe],254-vVQE[nMaxPe])

	For xx := 1 to nAUXEIXO

		lSTEPEI := If(Alltrim(aARRAYSTC[xx][6]) == STR0031,.t.,.f.)
		nCOL    := If(lSTEPEI,nCOL - 1,nCOL)

		If aARRAYSTC[xx][1] = 1
			Aadd(aC,{aNOMEVAR[xx][1] ,{l11 ,nCOL},aDESIGNE[xx,1],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aCOLLINH,{nCOL,l11})
		ElseIf aARRAYSTC[xx][1] = 2
			Aadd(aC,{aNOMEVAR[xx][1] ,{l21 ,nCOL},aDESIGNE[xx,1],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][2] ,{l22 ,nCOL},aDESIGNE[xx,2],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aCOLLINH,{nCOL,l21,l22})

		ElseIf aARRAYSTC[xx][1] = 3
			Aadd(aC,{aNOMEVAR[xx][1] ,{l31 ,nCOL},aDESIGNE[xx,1],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][2] ,{l32 ,nCOL},aDESIGNE[xx,2],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][3] ,{l33 ,nCOL},aDESIGNE[xx,3],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aCOLLINH,{nCOL,l31,l32,l33})

		ElseIf aARRAYSTC[xx][1] = 4
			Aadd(aC,{aNOMEVAR[xx][1] ,{l41 ,nCOL},aDESIGNE[xx,1],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][2] ,{l42 ,nCOL},aDESIGNE[xx,2],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][3] ,{l43 ,nCOL},aDESIGNE[xx,3],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][4] ,{l44 ,nCOL},aDESIGNE[xx,4],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aCOLLINH,{nCOL,l41,l42,l43,l44})

		ElseIf aARRAYSTC[xx][1] = 5
			Aadd(aC,{aNOMEVAR[xx][1] ,{l51 ,nCOL},aDESIGNE[xx,1],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][2] ,{l52 ,nCOL},aDESIGNE[xx,2],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][3] ,{l53 ,nCOL},aDESIGNE[xx,3],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][4] ,{l54 ,nCOL},aDESIGNE[xx,4],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][5] ,{l55 ,nCOL},aDESIGNE[xx,5],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aCOLLINH,{nCOL,l51,l52,l53,l54,l55})

		ElseIf aARRAYSTC[xx][1] = 6
			Aadd(aC,{aNOMEVAR[xx][1] ,{l61 ,nCOL},aDESIGNE[xx,1],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][2] ,{l62 ,nCOL},aDESIGNE[xx,2],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][3] ,{l63 ,nCOL},aDESIGNE[xx,3],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][4] ,{l64 ,nCOL},aDESIGNE[xx,4],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][5] ,{l65 ,nCOL},aDESIGNE[xx,5],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][6] ,{l66 ,nCOL},aDESIGNE[xx,6],"@!"  ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aCOLLINH,{nCOL,l61,l62,l63,l64,l65,l66})

		ElseIf aARRAYSTC[xx][1] = 7
			Aadd(aC,{aNOMEVAR[xx][1]  ,{l71 ,nCOL},aDESIGNE[xx,1],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][2]  ,{l72 ,nCOL},aDESIGNE[xx,2],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][3]  ,{l73 ,nCOL},aDESIGNE[xx,3],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][4]  ,{l74 ,nCOL},aDESIGNE[xx,4],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][5]  ,{l75 ,nCOL},aDESIGNE[xx,5],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][6]  ,{l76 ,nCOL},aDESIGNE[xx,6],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][7]  ,{l77 ,nCOL},aDESIGNE[xx,7],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aCOLLINH,{nCOL,l71,l72,l73,l73,l74,l76,l77})

		ElseIf aARRAYSTC[xx][1] = 8
			Aadd(aC,{aNOMEVAR[xx][1]  ,{l81 ,nCOL},aDESIGNE[xx,1],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][2]  ,{l82 ,nCOL},aDESIGNE[xx,2],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][3]  ,{l83 ,nCOL},aDESIGNE[xx,3],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][4]  ,{l84 ,nCOL},aDESIGNE[xx,4],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][5]  ,{l85 ,nCOL},aDESIGNE[xx,5],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][6]  ,{l86 ,nCOL},aDESIGNE[xx,6],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][7]  ,{l87 ,nCOL},aDESIGNE[xx,7],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][8]  ,{l88 ,nCOL},aDESIGNE[xx,8],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aCOLLINH,{nCOL,l81,l82,l83,l84,l85,l86,l87,l88})

		ElseIf aARRAYSTC[xx][1] = 9
			Aadd(aC,{aNOMEVAR[xx][1]  ,{l91 ,nCOL},aDESIGNE[xx,1],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][2]  ,{l92 ,nCOL},aDESIGNE[xx,2],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][3]  ,{l93 ,nCOL},aDESIGNE[xx,3],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][4]  ,{l94 ,nCOL},aDESIGNE[xx,4],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][5]  ,{l95 ,nCOL},aDESIGNE[xx,5],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][6]  ,{l96 ,nCOL},aDESIGNE[xx,6],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][7]  ,{l97 ,nCOL},aDESIGNE[xx,7],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][8]  ,{l98 ,nCOL},aDESIGNE[xx,8],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][9]  ,{l99 ,nCOL},aDESIGNE[xx,9],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aCOLLINH,{nCOL,l91,l92,l93,l94,l95,l96,l97,l98,l99})

		ElseIf aARRAYSTC[xx][1] = 10
			Aadd(aC,{aNOMEVAR[xx][1]  ,{l01 ,nCOL},aDESIGNE[xx,1],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][2]  ,{l02 ,nCOL},aDESIGNE[xx,2],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][3]  ,{l03 ,nCOL},aDESIGNE[xx,3],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][4]  ,{l04 ,nCOL},aDESIGNE[xx,4],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][5]  ,{l05 ,nCOL},aDESIGNE[xx,5],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][6]  ,{l06 ,nCOL},aDESIGNE[xx,6],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][7]  ,{l07 ,nCOL},aDESIGNE[xx,7],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][8]  ,{l08 ,nCOL},aDESIGNE[xx,8],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][9]  ,{l09 ,nCOL},aDESIGNE[xx,9],"@!" ,"MNTA230BE(cBEM)","NGB",,58})
			Aadd(aC,{aNOMEVAR[xx][10] ,{l00 ,nCOL},aDESIGNE[xx,10],"@!","MNTA230BE(cBEM)","NGB",,58})
			Aadd(aCOLLINH,{nCOL,l01,l02,l03,l04,l05,l06,l07,l08,l09,l00})
		Endif
		nCOL := nCOL + 65
	Next xx

	cTIPODE2 := STR0001 //"RODADOS"
	If nDESIGM = 2
		cTIPODE2 := STR0021 //"LOCALIZACAO"
	ElseIf nDESIGM = 3
		cTIPODE2 := STR0022 //"FAMILIA"
	Endif

	cTiTel  := STR0024+"..: "+ALLTRIM(cBEM)+" - "+Alltrim(cBEMNOM)
	cBEMPAI := cVBEMF

	DEFINE MSDIALOG odlge TITLE OemToAnsi(cTiTel) FROM 0,0 To 428,779 Pixel

		@ 14,5   BUTTON STR0025 SIZE 35,10 PIXEL ACTION MNTA230FBE(cREADVAR)        //"&Visualizar"
		@ 14,45  BUTTON STR0026 SIZE 25,10 PIXEL ACTION MNTA230RO()                 //"&Rodizio"
		@ 14,75  BUTTON STR0027 SIZE 30,10 PIXEL ACTION MNTA230ES()                 //"&Disponivel"
		@ 14,110 BUTTON STR0028 SIZE 45,10 PIXEL ACTION MNTA220DES(TQ0->TQ0_DESENH,IF(lGFrota,TQ0->TQ0_TIPMOD,NIL)) //"&Esquema Padrao"
		@ 14,160 BUTTON STR0112 SIZE 25,10 PIXEL ACTION NGESTVITRB((cTRB981),220,335,STR0113) //"E&strutura"#"Estrutura do Bem"

		@ 1.2,28 SAY STR0029  //"Area Transf."
		@ 1.1,33 MSGET cPNEUROD Picture '@!' SIZE 70,9 WHEN .F.

		oScrollBox := TScrollBox():new(odlge,27,00,187,390,.T.,.T.,.T.)

		For nCL := 1 To Len(aCOLLINH)
			If aARRAYSTC[nCL][1] > 1
				nINCOL := If(aARRAYSTC[nCL][1] = 2,26,27)
				For nLC := 2 To Len(aCOLLINH[nCL])-1
					@ aCOLLINH[nCL,nLC]+9,aCOLLINH[nCL,1]+25 To aCOLLINH[nCL,nLC+1]+.5,aCOLLINH[nCL,1]+nINCOL Of oScrollbox pixel
				Next nLC
			Endif
		Next nCL

		If nDESIGM <> 1
			For nCL := 1 To Len(aCOLLINH)
				nINCOL := aCOLLINH[nCL][1]
				For XP := 2 To Len(aCOLLINH[nCL])
					@ aCOLLINH[nCL,XP]+10,nINCOL To aCOLLINH[nCL,XP]+21,nINCOL+25 Of oScrollbox pixel
				Next nLC
			Next nCL
		Endif

		For XP := 1 to Len(aC)
			cCampo   := aC[XP,1]
			nX       := aC[XP,2,1]  // LINHA
			nY       := aC[XP,2,2]  // COLUNA
			cCaption := Iif(Empty(aC[XP,3])," ",aC[XP,3])
			cPict    := Iif(Empty(aC[XP,4]),Nil,aC[XP,4])
			cValid   := Iif(Empty(aC[XP,5]),".t.",aC[XP,5])
			cF3      := Iif(Empty(aC[XP,6]),NIL,aC[XP,6])
			cWhen    := Iif(aC[XP,7]==NIL,".t.",Iif(aC[XP,7],".t.",".f."))
			cWhen    := Iif(!(Str(nOpcx,1,0)$"346"),".f.",cWhen)
			nSIZE    := Iif(Empty(aC[XP,8]),Nil,aC[XP,8])
			cBlkGet  := "{ | u | If( PCount() == 0, "+cCampo+","+cCampo+":= u ) }"
			cBlKVld  := "{|| "+cValid+"}"
			cBlKWhen := "{|| MNTA230WHE()}"
			//Retirado da Classe TGet pois nao funciona com o HASBUTTON
			//oGet     := TGet():New( nX, nY,&cBlKGet,oScrollBox,nSIZE,,cPict,&(cBlkVld),,,,.F.,,.T.,,.F.,&(cBlkWhen),.F.,.F.,,.F.,.F.,cF3,(cCampo))
			@ nX,nY  MsGet oGet Var (cCampo) OF oScrollBox Picture cPict SIZE nSIZE,10 F3 cF3 HASBUTTON PIXEL
			oGet:cReadVar := (cCampo)
			oGet:Buffer   := &(cCampo)
			oGet:bSetGet  := &(cBlkGet)
			oGet:bValid   := &(cBlKVld)
			oGet:bWhen    := &(cBlKWhen)
			Aadd(oGets,oGet)
		Next XP

		For nCL := 1 To Len(aARRAYSTC)
			cCaption := If(aARRAYSTC[nCL,12] = STR0102,aARRAYSTC[nCL,12],;
				Alltrim(aARRAYSTC[nCL,12])+CHR(167)+" "+STR0103)
			cBlKSay1 := "{|| OemToAnsi('"+cCaption+"')}"
			oSay     := TSay():New(aCOLLINH[nCL,2]-8,aCOLLINH[nCL,1]+2,&cBlkSay1,oScrollBox,,, .F., .F., .F., .T.,CLR_HBLUE,,,, .F., .F., .F., .F., .F. )
			nLargSay := GetTextWidth(0,cCaption) / 1.8
			cCaption := oSay:cCaption

			If nDESIGM <> 1
				nItq1 := If(nDESIGM = 2,1,12)
				For XP := 1 To aARRAYSTC[nCL,1]
					nINCOL    := aCOLLINH[nCL][1]
					cCaption  := aARRAPTQ1[nCL,XP+nItq1]
					cBlKSay2  := "{|| OemToAnsi('"+cCaption+"')}"
					oSay2     := TSay():New(aCOLLINH[nCL,XP+1]+12.5,nINCOL+2,&cBlkSay2,oScrollBox,,, .F., .F., .F., .T.,CLR_HRED,,,, .F., .F., .F., .F., .F. )
					nLargSay2 := GetTextWidth(0,cCaption) / 1.8
					cCaption  := oSay2:cCaption
				Next XP
			Endif
		Next nCL

		NGPOPUP(aSMenu,@oMenu)
		oDlge:bRClicked      := { |o,x,y| oMenu:Activate(x,y,oDlge)}
		oScrollBox:bRClicked := { |o,x,y| oMenu:Activate(x,y,oScrollBox)}

	ACTIVATE MSDIALOG odlge Centered ON INIT MNTA230BAR(odlge,{||nopce:=1,If(!MNTA230FIM(),nopce := 0,odlge:End())},{||odlge:End()})

	If nopce == 1

		If lTEMCONT .And. nPOSCST9 > 0
			NGTRETCON(cVBEMF,dDATAEM,nPOSCST9,cVHESP1,1,,.T.)
		Endif

		If lTEMCON2 .And. nPOSCTPE > 0
			NGTRETCON(cVBEMF,dDATAEM,nPOSCTPE,cVHESP2,2,,.F.)
		Endif

		// VERIFICA SE HOUVE ALTERACAO NA ESTRUTURA
		lALTEST := .F.

		For xy := 1 to Len(aARRAYINI)
			nPOSX := ASCAN(aARRAYTRB,{|x| x[3] == aARRAYINI[xy][3]})
			If nPOSX = 0
				lALTEST := .T.
				Exit
			Else
				If aARRAYINI[xy][1] <> aARRAYTRB[nPOSX][1]
					lALTEST := .T.
					Exit
				Endif
			Endif
		Next xy

		If !lALTEST

			oTempTRBY:Delete()
			oTempTRBZ:Delete()
			oTempSTC:Delete()

			Return
		Endif

		//Retorna o bem pai de toda a estrutura
		cBEMPEST := NGBEMPAI(cVBEMF)
		cBEMPEST := If(Empty(cBEMPEST),cVBEMF,cBEMPEST)

		//Alimenta o arquivo temporario com os componentes que fazem parte da
		//estrutura do bem pai antes do Rodizio
		DbSelectArea("ST9")
		nREGST998 := Recno()

		M98ARQTRB(cAliasTRBY,cBEMPEST,.T.)

		DbSelectArea("ST9")
		DbGoto(nREGST998)

		aBENSSAIDA := {}
		aBENSENTRA := {}

		// verifica os rodados deletados e troca de localiza‡ao
		aARDELSTC := {}
		aARTROLOC := {}
		If Len(aARRAYINI) > 0
			For xy := 1 To len(aARRAYINI)
				If !Empty(aARRAYINI[xy,3])
					nPOS3 := ASCAN(aARRAYTRB,{|x| x[3] == aARRAYINI[xy][3]})
					If nPOS3 = 0
						Aadd(aARDELSTC,aARRAYINI[xy])
					Else
						If aARRAYINI[xy][1] <> aARRAYTRB[nPOS3][1]
							nPOS4 := ASCAN(aBEMLOC,{|x| x[2] == aARRAYINI[xy][3]})
							Aadd(aARTROLOC,{aARRAYINI[xy,3],aARRAYTRB[nPOS3][1],;
								aARRAYINI[xy][1],aBEMLOC[nPOS4][3],;
								aARRAYINI[xy,5]})
						Endif
					Endif
				Endif
			Next xy
		Endif

		// deleta os rodados do STC e baixa do STZ que sairam da estrutura
		For yx := 1 To Len(aARDELSTC)
			cBEMPCOM := If(Empty(aARDELSTC[yx,5]),cBEM,aARDELSTC[yx,5])
			Dbselectarea("STC")
			Dbsetorder(1)
			If Dbseek(Xfilial("STC")+cBEMPCOM+aARDELSTC[yx][3])
				Dbselectarea("STZ")
				Dbsetorder(1)
				If Dbseek(XFILIAL("STZ")+aARDELSTC[yx][3]+'E')
					While !Eof() .And. STZ->TZ_FILIAL == xFILIAL('STZ') .AND.;
							STZ->TZ_CODBEM == aARDELSTC[yx][3] .And. STZ->TZ_TIPOMOV = 'E'
						If Empty(STZ->TZ_DATASAI)
							nPOS4 := ASCAN(aBEMLOC,{|x| x[2] == aARDELSTC[yx][3]})
							RecLock("STZ",.F.)
							STZ->TZ_TIPOMOV := 'S'
							STZ->TZ_DATASAI := dDTDATA
							//STZ->TZ_HORASAI := If(Alltrim(cHORALE1) = ":",time(),cHORALE1)
							STZ->TZ_HORASAI := If(Alltrim(cHORALE1) = ":",cHRTIME,cHORALE1)
							STZ->TZ_CONTSAI := nPOSCST9
							STZ->TZ_CAUSA   := aBEMLOC[nPOS4,3]
							MsUnLock("STZ")

							Aadd(aBENSSAIDA,{STZ->TZ_CODBEM,Recno()})

							Dbselectarea("ST9")
							Dbsetorder(1)
							If Dbseek(xFILIAL("ST9")+aARDELSTC[yx][3])
								RecLock("ST9",.F.)
								ST9->T9_ESTRUTU := "N"
								MsUnLock('ST9')
							Endif
							Exit
						Endif
						Dbskip()
					End
				Endif
				Reclock("STC",.f.)
				Dbdelete()
				MsUnlock('STC')
			Endif
		Next yx

		// baixa do STZ os compomente que trocam de localiza‡ao
		For yk := 1 To Len(aARTROLOC)
			Dbselectarea("STZ")
			Dbsetorder(1)
			If Dbseek(XFILIAL("STZ")+aARTROLOC[yk][1]+'E')
				While !Eof() .And. STZ->TZ_FILIAL == xFILIAL('STZ') .AND.;
						STZ->TZ_CODBEM == aARTROLOC[yk][1] .And. STZ->TZ_TIPOMOV = 'E'
					If Empty(STZ->TZ_DATASAI) .And. STZ->TZ_LOCALIZ = aARTROLOC[yk][3]
						RecLock("STZ",.F.)
						STZ->TZ_TIPOMOV := 'S'
						STZ->TZ_DATASAI := dDTDATA
						STZ->TZ_CONTSAI := nPOSCST9
						//STZ->TZ_HORASAI := If(Alltrim(cHORALE1) = ":",time(),cHORALE1)
						STZ->TZ_HORASAI := If(Alltrim(cHORALE1) = ":",cHRTIME,cHORALE1)
						STZ->TZ_CAUSA   := aARTROLOC[yk][4]
						MsUnLock("STZ")

						Aadd(aBENSSAIDA,{STZ->TZ_CODBEM,Recno()})

						Exit
					Endif
					Dbskip()
				End
			Endif

			Dbselectarea("STC")
			Dbsetorder(1)
			If Dbseek(XFILIAL("STC")+aARTROLOC[yk][5]+aARTROLOC[yk][1])
				RecLock("STC",.F.)
				Dbdelete()
				MsUnLock("STC")
			Endif
		Next yk

		//Identifica a utilização de MSDialog
		lMain := Type( "oMainWnd" ) == "O"

		// Atualiza a estrutura STC com os componentes novos
		For m := 1 to len(aARRAYTRB)
			If !Empty(aARRAYTRB[m][3])
				cBEMPCOM := If(Empty(aARRAYTRB[m,5]),cBEM,aARRAYTRB[m,5])
				Dbselectarea("STC")
				Dbsetorder(1)
				If !Dbseek(XFILIAL("STC")+cBEMPCOM+aARRAYTRB[m][3])
					Reclock("STC",.T.)
					STC->TC_FILIAL  := XFILIAL("STC")
					STC->TC_CODBEM  := cBEMPCOM
					STC->TC_COMPONE := aARRAYTRB[m][3]
					STC->TC_LOCALIZ := aARRAYTRB[m][1]
					STC->TC_TIPOEST := 'B'
					STC->TC_DATAINI := dDTDATA
					MsUnlock('STC')

					Dbselectarea("ST9")
					Dbsetorder(1)
					If Dbseek(xFILIAL("ST9")+aARRAYTRB[m][3])

						RecLock("ST9",.F.)
						ST9->T9_ESTRUTU := "S"
						MsUnLock("ST9")

						If ST9->T9_MOVIBEM = "S" .And. ST9->T9_CCUSTO <> cCUSTOB
							RecLock("ST9",.F.)
							ST9->T9_CCUSTO  := cCUSTOB
							ST9->T9_CENTRAB := cCENTRAB
							ST9->T9_CALENDA := cCALENB
							MsUnLock('ST9')

							//Atualiza o centro de custo no ativo fixo
							NGATUATF(ST9->T9_CODIMOB,ST9->T9_CCUSTO)

							DbselectArea("TPN")
							DbsetOrder(1)
							RecLock("TPN",.T.)
							TPN->TPN_FILIAL := xFILIAL("TPN")
							TPN->TPN_CODBEM := aARRAYTRB[m][3]
							TPN->TPN_DTINIC := dDTDATEM
							TPN->TPN_HRINIC := If(Alltrim(cHORALE1) = ":",cHRTIME,cHORALE1)
							TPN->TPN_CCUSTO := cCUSTOB
							TPN->TPN_CTRAB  := cCENTRAB
							TPN->TPN_UTILIZ := "U"
							TPN->TPN_POSCON := nPOSCONT
							TPN->TPN_POSCO2 := nPOSCON2
							MsUnLock("TPN")

							//Funcao de integracao com o PIMS atraves do EAI
							If lPIMSINT .And. FindFunction("NGIntPIMS")
								NGIntPIMS("TPN",TPN->(RecNo()),3)
							EndIf

							//----------------------------------------------------
							// Integração via mensagem única do cadastro de Bem
							//----------------------------------------------------
							If FindFunction("MN080INTMB") .And. MN080INTMB(ST9->T9_CODFAMI)

								DbSelectArea( "ST9" )

								// Define array private que será usado dentro da integração
								aParamMensUn    := Array( 4 )
								aParamMensUn[1] := Recno() // Indica numero do registro
								aParamMensUn[2] := 4       // Indica tipo de operação que esta invocando a mensagem unica
								aParamMensUn[3] := .F.     // Indica que se deve recuperar dados da memória
								aParamMensUn[4] := 1       // Indica se deve inativar o bem (1 ativo,2 - inativo)

								lMuEquip := .F.
								bBlock := { || FWIntegDef( "MNTA080",EAI_MESSAGE_BUSINESS,TRANS_SEND,Nil ) }

								If lMain
									MsgRun( "Aguarde integração com backoffice...","Equipment",bBlock )
								Else
									Eval( bBlock )
								EndIf

							EndIf
						Endif
					Endif

					cTEMCONT := st9->t9_temcont
					Dbselectarea("ST9")
					nREGST9 := Recno()
					Dbselectarea("ST9")
					Dbsetorder(1)
					Dbseek(xFILIAL("ST9")+cBEM)
					cTEMCPAI := st9->t9_temcont
					Dbgoto(nREGST9)

					Dbselectarea("STZ")
					RecLock("STZ",.T.)
					STZ->TZ_FILIAL  := xFILIAL('STZ')
					STZ->TZ_CODBEM  := aARRAYTRB[m][3]
					STZ->TZ_BEMPAI  := cBEMPCOM
					STZ->TZ_TIPOMOV := 'E'
					//STZ->TZ_DATAMOV := dDTDATA
					//STZ->TZ_HORAENT := If(Alltrim(cHORALE1) = ":",time(),cHORALE1)

					nPOSX := ASCAN(aARRAYINI,{|x| x[3] == aARRAYTRB[m][3]})
					If nPOSX > 0 //Componente que trocou de localizacao
						If aARRAYTRB[m][1] <> aARRAYINI[nPOSX][1]
							STZ->TZ_HORAENT := If(Alltrim(cHORALE1) = ":",cHRTIME1M,MTOH(HTOM(SubStr(cHORALE1,1,5))+1))
							If STZ->TZ_HORAENT = "24:00"
								STZ->TZ_HORAENT := "00:00"
							EndIf
							If STZ->TZ_HORAENT = "00:00"
								STZ->TZ_DATAMOV := dDTDATA + 1

								DbSelectArea("STC")
								Reclock("STC",.F.)
								STC->TC_DATAINI := STZ->TZ_DATAMOV
								MsUnlock("STC")

							Else
								STZ->TZ_DATAMOV := dDTDATA
							EndIf
						EndIf
					Else

						STZ->TZ_HORAENT := If(Alltrim(cHORALE1) = ":",cHRTIME,cHORALE1)
						STZ->TZ_DATAMOV := dDTDATA
					EndIf

					STZ->TZ_POSCONT := nPOSCST9
					STZ->TZ_LOCALIZ := aARRAYTRB[m][1]
					STZ->TZ_TEMCONT := cTEMCONT
					STZ->TZ_TEMCPAI := cTEMCPAI
					//Verificar se o bem tem 1º contador
					If cTEMCONT <> "N"
						STZ->TZ_HORACO1 := cHORALE1
					EndIf
					//Verificar se o bem tem 2º contador
					If NGIFDBSEEK('TPE',aARRAYTRB[m][3],1)
						STZ->TZ_HORACO2 := cHORALE2
					EndIf
					DbSelectArea("STZ")
					MsUnLock("STZ")

					Aadd(aBENSENTRA,{STZ->TZ_CODBEM,Recno()})

				Else
					If STC->TC_LOCALIZ <> aARRAYTRB[m][1]
						Reclock("STC",.f.)
						STC->TC_LOCALIZ := aARRAYTRB[m][1]
						MsUnlock('STC')
					Endif
				Endif
			Endif
		Next m

		// Atualiza STZ com os rodados com nova localizacao
		For xk := 1 To Len(aARTROLOC)
			cBEMPCOM := If(Empty(aARTROLOC[xk,5]),cBEM,aARTROLOC[xk,5])
			Dbselectarea("ST9")
			Dbsetorder(1)
			nREGST9 := Recno()
			Dbseek(xFILIAL("ST9")+aARTROLOC[xk][1])
			cTEMCONT := st9->t9_temcont
			Dbseek(xFILIAL("ST9")+cBEMPCOM)
			cTEMCPAI := st9->t9_temcont
			Dbgoto(nREGST9)

			Dbselectarea("STZ")
			Dbsetorder(1)
			If !Dbseek(XFILIAL("STZ")+aARTROLOC[xk][1]+'E')
				RecLock("STZ",.T.)
				STZ->TZ_FILIAL  := xFILIAL('STZ')
				STZ->TZ_CODBEM  := aARTROLOC[xk][1]
				STZ->TZ_BEMPAI  := cBEMPCOM
				STZ->TZ_TIPOMOV := 'E'
				//STZ->TZ_DATAMOV := dDTDATA
				STZ->TZ_POSCONT := nPOSCST9
				STZ->TZ_LOCALIZ := aARTROLOC[xk][2]
				//STZ->TZ_HORAENT := If(Alltrim(cHORALE1) = ":",time(),cHORALE1)
				STZ->TZ_HORAENT := If(Alltrim(cHORALE1) = ":",cHRTIME1M,MTOH(HTOM(SubStr(cHORALE1,1,5))+1))
				If STZ->TZ_HORAENT = "24:00"
					STZ->TZ_HORAENT := "00:00"
				EndIf
				If STZ->TZ_HORAENT = "00:00
					STZ->TZ_DATAMOV := dDTDATA + 1

					Dbselectarea("STC")
					Dbsetorder(1)
					If Dbseek(xFILIAL("STC")+cBEMPCOM+aARTROLOC[xk][1])
						RecLock("STC",.F.)
						STC->TC_DATAINI := STZ->TZ_DATAMOV
						MsUnLock("STC")
					EndIf

				Else
					STZ->TZ_DATAMOV := dDTDATA
				EndIf
				STZ->TZ_TEMCONT := cTEMCONT
				STZ->TZ_TEMCPAI := cTEMCPAI
				//Verificar se o bem tem 1º contador
				If cTEMCONT <> "N"
					STZ->TZ_HORACO1 := cHORALE1
				EndIf
				//Verificar se o bem tem 2º contador
				If NGIFDBSEEK('TPE',aARTROLOC[xk][1],1)
					STZ->TZ_HORACO2 := cHORALE2
				EndIf
				Dbselectarea("STZ")
				MsUnLock("STZ")

				Aadd(aBENSENTRA,{STZ->TZ_CODBEM,Recno()})

			Endif
		Next xk

		//Retorna a estrutura padrao do bem pai e informacao dos componentes que recebem contador
		DbSelectArea("ST9")
		DbSetOrder(01)
		Dbseek(xfilial("ST9")+cBEMPEST)
		cCODFAM230 := ST9->T9_CODFAMI+Space(Len(ST9->T9_CODBEM)-Len(ST9->T9_CODFAMI))
		lFrota230 := NGVERUTFR()
		cTIPMOD230 := If(lFrota230,ST9->T9_TIPMOD,Nil)
		aESTFAM230 := NGCOMPEST(cCODFAM230,"F",.T.,.F.,.T.,Nil,Nil,cTIPMOD230)

		// Le array com os itens de saida
		For ny := 1 To Len(aBENSSAIDA)

			DbSelectArea("STZ")
			DbGoto(aBENSSAIDA[ny][2])

			Dbselectarea("ST9")
			DbSetOrder(01)
			If Dbseek(xFILIAL("ST9")+aBENSSAIDA[ny][1])

				//Verifica se o componente e um step
				lREPAS230 := .T.

				//-------------------------------------------
				cPaiSup := ""
				lEnd := .F.

				DbSelectArea("ST9")
				DbSetOrder(01)
				Dbseek(xfilial("ST9")+cVBEMF)
				cCodPai := ST9->T9_CODBEM
				cFamP230 := ST9->T9_CODFAMI+Space(Len(ST9->T9_CODBEM)-Len(ST9->T9_CODFAMI))
				cLocP230 := ""

				Dbseek(xFILIAL("ST9")+aBENSSAIDA[ny][1])
				cCodCom := ST9->T9_CODBEM
				cFamC230 := ST9->T9_CODFAMI+Space(Len(ST9->T9_CODBEM)-Len(ST9->T9_CODFAMI))
				cLocC230 := STZ->TZ_LOCALIZ

				//Se bem bem pai deste componente também é filho de outro componente na estrutura,
				//busca sua localização
				dbSelectArea("STC")
				nRecNo := STC->(RecNo())
				dbSetOrder(03)
				If dbSeek(xFilial("STC")+cCodPai)
					cLocP230 := STC->TC_LOCALIZ
					cPaiSup := STC->TC_CODBEM
				EndIf
				dbGoTo(nRecNo)

				nPOSF230 := 0
				If Len(aESTFAM230) > 0
					nPOSF230 := aSCAN(aESTFAM230,{|x| cFamC230+cLocC230 = x[1]+x[2].And.;
						cFamP230+cLocP230 = x[6]+x[7]})
				EndIf

				If nPOSF230 > 0
					If aESTFAM230[nPOSF230,3] = "N"
						lREPAS230 := .F.
					EndIf
				ElseIf !Empty(cPaiSup)
					While !lEnd
						//se nao encontrou, busca estruturas padrao dos pais imediatos, ate o topo da estrutura
						cTpMod2 := NGSEEK('ST9',cCodPai,1,'T9_TIPMOD')
						cFamPa2 := NGSEEK('ST9',cCodPai,1,'T9_CODFAMI')+Space(Len(st9->t9_codbem)-Len(st9->t9_codfami))
						aESTFAM2 := NGCOMPEST(cFamPa2,"F",.T.,.F.,.T.,Nil,Nil,cTpMod2)

						//sobe um nivel na estrutura
						cCodCom := cCodPai
						cCodPai := cPaiSup

						//executa busca na nova estrutura padrao
						nPOSF230 := aSCAN(aESTFAM2,{|x| cFamC230+cLocC230 = x[1]+x[2] .And.;
							cFamP230+cLocP230 = x[6]+x[7]})
						If nPOSF230 > 0
							lREPAS230 := (aESTFAM2[nPOSF230,3] != "N")
							lEnd := .T.
						Else
							//Se bem bem pai deste componente também é filho de outro componente na estrutura:
							dbSelectArea("STC")
							nRecNo := STC->(RecNo())
							dbSetOrder(03)
							If dbSeek(xFilial("STC")+cCodPai)
								cLocP230 := STC->TC_LOCALIZ
								cPaiSup := STC->TC_CODBEM
							Else
								lEnd := .T.
							EndIf
							dbSelectArea("STC")
							dbGoTo(nRecNo)
						EndIf
					EndDo
				EndIf
				//-------------------------------------------

				If lREPAS230
					// Procura no arq. TRBY quem ‚ o pai do componente na estrutura e acessa o ST9 para obter
					// o contador e alterar o contador no STZ
					DbSelectArea(cAliasTRBY)
					DbSetOrder(02)
					If DbSeek(aBENSSAIDA[ny][1])
						If (cAliasTRBY)->TC_CONTRO <> "N"

							//Procura o bem pai do componente
							cVBEMPAI98 := NGTBEMPTE(aBENSSAIDA[ny][1],cAliasTRBY)

							If !Empty(cVBEMPAI98)
								DbSelectArea("ST9")
								DbSetOrder(01)
								If DbSeek(xFilial("ST9")+cVBEMPAI98)

									DbSelectArea("STZ")
									DbGoto(aBENSSAIDA[ny][2])
									nCONT2TRBY := STZ->TZ_CONTSA2

									DbSelectArea("TPE")
									DbSetOrder(01)
									If DbSeek(xFilial("TPE")+cVBEMPAI98)
										nCONT2TRBY := TPE->TPE_POSCON
										If !DbSeek(xFilial("TPE")+aBENSSAIDA[ny][1])
											nCONT2TRBY := STZ->TZ_CONTSA2
										EndIf
									EndIf

									DbSelectArea("STZ")
									RecLock("STZ",.F.)
									STZ->TZ_CONTSAI := nPOSCST9
									STZ->TZ_CONTSA2 := nCONT2TRBY
									MsUnLock()
								EndIf
							EndIf
						EndIf
					EndIf
				Else
					nCONT2TRBY := 0
					DbSelectArea("TPE")
					DbSetOrder(01)
					If DbSeek(xFilial("TPE")+aBENSSAIDA[ny][1])
						nCONT2TRBY := TPE->TPE_POSCON
					EndIf

					DbSelectArea("STZ")
					DbGoto(aBENSSAIDA[ny][2])
					RecLock("STZ",.F.)
					STZ->TZ_CONTSAI := nPOSCST9
					STZ->TZ_CONTSA2 := nCONT2TRBY
					MsUnLock()
				EndIf
			EndIf
		Next ny

		//Alimenta o arquivo temporario com os componentes que fazem parte da
		//estrutura do bem pai apos o Rodizio
		M98ARQTRB(cAliasTRBZ,cBEMPEST,.T.)

		// Le array com os itens de entrada
		For nx := 1 To Len(aBENSENTRA)

			DbSelectArea("STZ")
			DbGoto(aBENSENTRA[nx][2])

			Dbselectarea("ST9")
			DbSetOrder(01)
			If Dbseek(xFILIAL("ST9")+aBENSENTRA[nx][1])

				//Verifica se o componente e um step
				lREPAS230 := .T.

				//-------------------------------------------
				cPaiSup := ""
				lEnd := .F.

				DbSelectArea("ST9")
				DbSetOrder(01)
				Dbseek(xfilial("ST9")+cVBEMF)
				cCodPai := ST9->T9_CODBEM
				cFamP230 := ST9->T9_CODFAMI+Space(Len(ST9->T9_CODBEM)-Len(ST9->T9_CODFAMI))
				cLocP230 := ""

				Dbseek(xFILIAL("ST9")+aBENSENTRA[nx][1])
				cCodCom := ST9->T9_CODBEM
				cFamC230 := ST9->T9_CODFAMI+Space(Len(ST9->T9_CODBEM)-Len(ST9->T9_CODFAMI))
				cLocC230 := STZ->TZ_LOCALIZ

				//Se bem bem pai deste componente também é filho de outro componente na estrutura,
				//busca sua localização
				dbSelectArea("STC")
				nRecNo := STC->(RecNo())
				dbSetOrder(03)
				If dbSeek(xFilial("STC")+cCodPai)
					cLocP230 := STC->TC_LOCALIZ
					cPaiSup := STC->TC_CODBEM
				EndIf
				dbGoTo(nRecNo)

				nPOSF230 := 0
				If Len(aESTFAM230) > 0
					nPOSF230 := aSCAN(aESTFAM230,{|x| cFamC230+cLocC230 = x[1]+x[2].And.;
						cFamP230+cLocP230 = x[6]+x[7]})
				EndIf

				If nPOSF230 > 0
					If aESTFAM230[nPOSF230,3] = "N"
						lREPAS230 := .F.
					EndIf
				ElseIf !Empty(cPaiSup)
					While !lEnd
						//se nao encontrou, busca estruturas padrao dos pais imediatos, ate o topo da estrutura
						cTpMod2 := NGSEEK('ST9',cCodPai,1,'T9_TIPMOD')
						cFamPa2 := NGSEEK('ST9',cCodPai,1,'T9_CODFAMI')+Space(Len(st9->t9_codbem)-Len(st9->t9_codfami))
						aESTFAM2 := NGCOMPEST(cFamPa2,"F",.T.,.F.,.T.,Nil,Nil,cTpMod2)

						//sobe um nivel na estrutura
						cCodCom := cCodPai
						cCodPai := cPaiSup

						//executa busca na nova estrutura padrao
						nPOSF230 := aSCAN(aESTFAM2,{|x| cFamC230+cLocC230 = x[1]+x[2] .And.;
							cFamP230+cLocP230 = x[6]+x[7]})
						If nPOSF230 > 0
							lREPASS := (aESTFAM2[nPOSF230,3] != "N")
							lEnd := .T.
						Else
							//Se bem bem pai deste componente também é filho de outro componente na estrutura:
							dbSelectArea("STC")
							nRecNo := STC->(RecNo())
							dbSetOrder(03)
							If dbSeek(xFilial("STC")+cCodPai)
								cLocP230 := STC->TC_LOCALIZ
								cPaiSup := STC->TC_CODBEM
							Else
								lEnd := .T.
							EndIf
							dbSelectArea("STC")
							dbGoTo(nRecNo)
						EndIf
					EndDo
				EndIf
				//-------------------------------------------

				If lREPAS230
					// Procura no arq. TRBZ que ‚ o pai do componente na estrutura e acessa o ST9 e para obter
					// o contador e alterar o contador no STZ
					DbSelectArea(cAliasTRBZ)
					DbSetOrder(02)
					If DbSeek(aBENSENTRA[nx][1])
						If (cAliasTRBZ)->TC_CONTRO <> "N"

							nREGTRBZ := Recno()

							//Procura o bem pai do componente na estrutura
							cVBEMPAI98 := NGTBEMPTE(aBENSENTRA[nx][1],cAliasTRBZ)

							DbSelectArea(cAliasTRBZ)
							DbGoto(nREGTRBZ)

							DbSelectArea("ST9")
							DbSetOrder(01)
							If DbSeek(xFilial("ST9")+cVBEMPAI98)

								DbSelectArea("STZ")
								DbGoto(aBENSENTRA[nx][2])
								nCONT1TRBZ := nPOSCST9
								nCONT2TRBZ := nPOSCTPE

								lCONT2 := .F.
								DbSelectArea("TPE")
								DbSetOrder(01)
								If DbSeek(xFilial("TPE")+cVBEMPAI98)
									lCONT2     := .T.
									nCONT2TRBZ := nPOSCTPE
									If !DbSeek(xFilial("TPE")+aBENSENTRA[nx][1])
										lCONT2     := .F.
										nCONT2TRBZ := nPOSCTPE
									EndIf
								EndIf

								DbSelectArea("STZ")
								RecLock("STZ",.F.)
								STZ->TZ_POSCONT := nPOSCST9
								STZ->TZ_POSCON2 := nCONT2TRBZ
								MsUnLock()

								If nCONT1TRBZ > 0
									DbSelectArea("ST9")
									DbSetOrder(01)
									If DbSeek(xFilial("ST9")+STZ->TZ_CODBEM)

										//Inclui registro de entrada na estrutura para componente controlado por Pai da estrutura
										//ou Imediato e Contador Proprio
										If ST9->T9_TEMCONT == "S"
											NGTRETCON(STZ->TZ_CODBEM,STZ->TZ_DATAMOV,nCONT1TRBZ,STZ->TZ_HORAENT,1,,.T.)
										ElseIf ST9->T9_TEMCONT == "P" .Or. ST9->T9_TEMCONT == "I"
											NGTRETCON(cVBEMPAI98,STZ->TZ_DATAMOV,nCONT1TRBZ,STZ->TZ_HORAENT,1,,.T.)
										EndIf

									EndIf
								EndIf

								If nCONT2TRBZ > 0
									DbSelectArea("TPE")
									DbSetOrder(01)
									If DbSeek(xFilial("TPE")+STZ->TZ_CODBEM)

										//Inclui registro de entrada na estrutura para componente controlado por Pai da estrutura
										//ou Imediato e Contador Proprio
										If (cAliasTRBZ)->TC_CONTRO == "S"
											NGTRETCON(STZ->TZ_CODBEM,STZ->TZ_DATAMOV,nCONT2TRBZ,STZ->TZ_HORAENT,2,,.T.)
										ElseIf (cAliasTRBZ)->TC_CONTRO == "P" .Or. (cAliasTRBZ)->TC_CONTRO == "I"
											NGTRETCON(cVBEMPAI98,STZ->TZ_DATAMOV,nCONT2TRBZ,STZ->TZ_HORAENT,2,,.T.)
										EndIf

									EndIf
								EndIf
							EndIf
						EndIf
					EndIf
				Else
					nCONT2TRBZ := 0
					DbSelectArea("TPE")
					DbSetOrder(01)
					If DbSeek(xFilial("TPE")+aBENSENTRA[nx][1])
						nCONT2TRBZ := nPOSCTPE
					EndIf

					DbSelectArea("STZ")
					DbGoto(aBENSENTRA[nx][2])
					RecLock("STZ",.F.)
					STZ->TZ_POSCONT := nPOSCST9
					STZ->TZ_POSCON2 := nCONT2TRBZ
					MsUnLock()
				EndIf
			EndIf
		Next nx

		//GERA O.S AUTOMATICA POR CONTADOR
		If (cGERAPREV = "S" .Or. cGERAPREV = "C") .And. (!Empty(nPOSCST9) .Or. !Empty(nPOSCTPE))
			If NGCONFOSAUT(cGERAPREV)
				NGGEROSAUT(cBEM,If(!Empty(nPOSCST9),nPOSCST9,nPOSCTPE))
			EndIf
		EndIf

		If ExistBlock("MNTA2301")
			ExecBlock("MNTA2301",.F.,.F.)
		Endif

		If Len(aBensSaida) > 0 .And. lLanHRet
			vVetSai := Array(Len(aARRAYINI))
			Afill(vVetSai,Space(Len(st9->t9_codbem)))
			vVetEnt := Aclone(vVetSai)

			// Componente que sairam

			For xy := 1 To len(aBensSaida)
				nPOS3 := ASCAN(aARRAYINI,{|x| x[3] == aBensSaida[xy][1]})
				If nPOS3 > 0
					vVetSai[nPOS3] := aBensSaida[xy][1]
				Endif
			Next xy

			// Componente que entraram
			For xy := 1 To len(aBensEntra)
				nPOS3 := ASCAN(aARRAYTRB,{|x| x[3] == aBensEntra[xy][1]})
				If nPOS3 > 0
					vVetEnt[nPOS3] := aBensEntra[xy][1]
				Endif
			Next xy
			cFilBem := STP->TP_FILIAL

			NGREFMOVR(cBem,vVetEnt,vVetSai,dDATAEM,cVHESP1,nPOSCST9,cFilBem)

		Endif

	EndIf

	oTempTRBY:Delete()
	oTempTRBZ:Delete()
	oTempSTC:Delete()

Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230BAR³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Altera o menu de op‡äes                                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTA230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230BAR(oDlg,bOk,bCancel)
DEFINE BUTTONBAR oBar SIZE 25,25 3D TOP OF oDlg
DEFINE BUTTON oBtnCalc RESOURCE "S4WB008N" OF oBar GROUP ACTION Calculadora() //TOOLTIP OemToAnsi(STR0032) //"Calculadora..."
oBtnCalc:cToolTip := OemToAnsi(STR0032)//"Calculadora..."
DEFINE BUTTON oBtnLeg RESOURCE "S4WB009N" OF oBar ACTION MNTA230LEG() //TOOLTIP OemToAnsi(STR0033) //"Legenda..."
oBtnLeg:cToolTip := OemToAnsi(Capital(STR0086))//"Legenda"
DEFINE BUTTON oBtnImp RESOURCE "S4WB010N" OF oBar ACTION MNTA230IMT(cBEM,aARRAPTQ1,aARRAYTRB) //TOOLTIP OemToAnsi(STR0034) //"Impressao da Estrutura..."
oBtnImp:cToolTip := OemToAnsi(STR0038)//"Imprimir"
DEFINE BUTTON oBtnHelp RESOURCE "S4WB016N" OF oBar GROUP ACTION HelProg() //TOOLTIP OemToAnsi(STR0035) //"Help de Programa..."
oBtnHelp:cToolTip := OemToAnsi(STR0035)//"Help"
DEFINE BUTTON oBtOk RESOURCE "OK" OF oBar GROUP ACTION (lLoop:=lVolta,lOk:=Eval(bOk)) //TOOLTIP "Ok"
oBtOk:cToolTip := OemToAnsi("OK")
SetKEY(15,oBtOk:bAction)
DEFINE BUTTON oBtCan RESOURCE "CANCEL" OF oBar ACTION (lLoop:=.f.,Eval(bCancel),MNTA230BOF(bSet15,bSet24,.T.)) //TOOLTIP OemToAnsi("Cancelar")
oBtCan:cToolTip := OemToAnsi("Cancelar")

SetKEY(24,oBtCan:bAction)
oDlg:bSet15 := oBtOk:bAction
oDlg:bSet24 := oBtCan:bAction
oBar:bRClicked := {|| AllwaysTrue()}
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230IMT³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Selecao de impressao da legenda                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTA230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230IMT(cBEM,aARRAPTQ1,aARRAYTRB)
nTGIOPL := 1
tg_bOk  := tb_bCancel := nil
tg_oDlg := oSend( MSDialog(), "New", 9, 0, 18, 31,;
           STR0036,,,.F.,,,,,oMainWnd,.F.,,,.F.) //"Quanto a Legenda ?"
  oSEND(TRadMenu(),"New",20,25,{STR0037,STR0038},bSETGET(nTGIOPL),tg_oDlg,,,; //"Nao Imprimir"###"Imprimir"
                   ,,,,,70,12,,,.T., .T.)

   tg_bOk     := {||oSend(tg_oDlg,"End")}
   tg_bCancel := {||nTGIOPL:=0,oSend(tg_oDlg,"End")}
   tg_bInit   := {|| EnchoiceBar(tg_oDlg,tg_bOk,tg_bCancel) }

oSend(tg_oDlg,"Activate",,,,.T.,,, tg_bInit )

IF nTGIOPL # 0
   MNTA230IMP(cBEM,aARRAPTQ1,aARRAYTRB,nTGIOPL)
   tg_lRet := .T.
Endif
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230LEG³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Legenda                                                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTA230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230LEG()
Local aBEMLEG := {}
Local aDESIGM := {}
Local aDESIGF := {},ww
Local nCOLIE  := 11
Local nCOLFE  := 48

For ww := 1 To Len(aARRAYTRB)
   Dbselectarea("ST9")
   Dbsetorder(1)
   Dbseek(xFilial('ST9')+aARRAYTRB[ww][3])
   If !Empty(aARRAYTRB[ww][3])
      Aadd(aBEMLEG,{aARRAYTRB[ww][3],Substr(st9->t9_nome,1,30)})
   Endif
Next ww

cTITLEG := STR0039 //" RODADOS"
nCOLLIS := 110//54
lSOMA   := .f.
nCOLBO  := If(nDESIGM = 1,175,320)
nLININ  := 27
nLINBO  := 10.5
lAVANCA := .t.
lVOLTA  := .f.

MNTA230ZOO(aBEMLEG,aDESIGM,aDESIGF,nCOLIE,nCOLFE,nLININ)

Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230ZOO³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Monta o zoom                                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTA230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function MNTA230ZOO(aBEMLEG,aDESIGM,aDESIGF,nCOLIE,nCOLFE,nLININ)
Local oLISTBOX
Local oBrw, oBrw1, n := 1, ny := 1
Local oDlgy

DEFINE DIALOG oDlgy FROM nLININ,nCOLIE TO 42,nCOLFE+12 TITLE cTITLEG
   @.25,0.5 listbox oBrw fields aBEMLEG[n][1],aBEMLEG[n][2];
      headers STR0042, STR0043; //"Codigo"###"Descricao"
      fieldsizes 53,92;
      of odlgy size 187,nCOLLIS

      oBrw:bGotop    := { || n := 1 }
      oBrw:bGoBottom := { || n := eval( oBrw:bLogicLen ) }
      oBrw:bSkip     := { | nwant, nold | nold := n , n += nwant,;
      n := max( 1, min( n, eval( oBrw:bLogicLen ))),;
      n - nOld }
      oBrw:bLogicLen := { || len(aBEMLEG) }
      oBrw:cAlias    := "Array"
ACTIVATE DIALOG oDlgy CENTERED
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230BOF³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Set o botäes                                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTA230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230BOF(bSet15,bSet24,lOk)
DEFAULT lOk := .t.
IF lOk
   SetKey(15,bSet15)
   SetKey(24,bSet24)
Endif
Return .T.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230EST³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Consistencia do Bem e Estrutura                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230EST(cVBEM)
Local cMENSA := Space(1)
Store  '  :  ' To cHORALE1,cHORALE2
Store .f.      To lTEMCONT,lTEMCON2,lCHKCON1,lCHKCON2
Store 0        To nPOSCONT,nPOSCON2

Dbselectarea("TPE")
Dbsetorder(1)
IF Dbseek(XFILIAL("TPE")+cVBEM)
   lTEMCON2 := .T.
   cHORALE2 := Time()
   nPOSCON2 := TPE->TPE_POSCON
Endif

Dbselectarea("ST9")
Dbsetorder(1)
IF !Dbseek(XFILIAL("ST9")+cVBEM)
   cMENSA := STR0045 //"Este Bem nao esta cadastrado..."
Else
   If ST9->T9_SITBEM = 'I'
      MsgInfo(STR0014+Alltrim(cVBEM)+STR0046,STR0016) //"Bem "###" esta inativo.."###"ATENCAO"
      Return .f.
   Endif
   If ST9->T9_SITBEM = 'T'
      MsgInfo(STR0014+Alltrim(cVBEM)+STR0115,STR0016) //"Bem "###" foi transferido."###"ATENCAO"
      Return .f.
   Endif
   cCUSTOB  := ST9->T9_CCUSTO
   cCENTRAB := ST9->T9_CENTRAB
   cCALENB  := ST9->T9_CALENDA
   cHORALE1 := Time()
   cBEMNOM  := ST9->T9_NOME
   cFORMA   := ST9->T9_CODFAMI
   lTEMCONT := If(ST9->T9_TEMCONT = 'S',.T.,.F.)
   nPOSCONT := ST9->T9_POSCONT
   lRefresh := .t.
   Dbselectarea("ST6")
   Dbsetorder(1)
   Dbseek(XFILIAL("ST6")+cFORMA)
   cFORNOM := ST6->T6_NOME

   Dbselectarea("STC")
   Dbsetorder(1)
   IF !Dbseek(XFILIAL("STC")+cVBEM)
      cMENSA := STR0047 //"Este Bem nao tem estrutura...."
   Else
      Dbselectarea("TQ0")
      Dbsetorder(1)
      If !Dbseek(xFilial('TQ0')+cFORMA)
          cMENSA := STR0048+cFORMA+STR0049 //"Esquema padrao "###" Nao Cadastrada"
      Else
         Dbselectarea("TQ1")
         Dbsetorder(1)
         If !Dbseek( xFilial('TQ1')+cFORMA)
            cMENSA := STR0050+cFORMA //"Nao Existe Itens Para Esquema de Rodado "
         Endif
      Endif
   Endif
Endif
If !Empty(cMENSA)
   Msginfo(cMENSA,STR0016) //"ATENCAO"
   Return .f.
Endif
Return .T.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230RO ³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Consistencia do Rodizio de rodados                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230RO()
If Empty(&cREADVAR)
   MsGstop(STR0051) //"Nao foi informado o rodado para o rodizio ( Area de Transferencia ).."
   Return .f.
Endif

If !Empty(cPNEUROD)
   MsGstop(STR0052) //"Ja existe rodado na Area de Transferencia."
   Return .f.
Endif

cPNEUT := &(cREADVAR)
nPOSA    := ASCAN(aARRAYTRB,{|x| x[3] == cPNEUT})
cMTRANS  := STR0053+alltrim(aARRAYTRB[nPOSA][3])+chr(13); //"Rodado "
           +STR0054+aARRAYTRB[nPOSA][1] //"Localizacao Atual   "

nPOSB := ASCAN(aBEMLOC,{|x| x[2] == cPNEUT})
If nPOSB > 0 .And. Empty(aBEMLOC[nPOSB][3])
   nopre := MNTA230MTV(cMTRANS,1)
   If nopre = 1
      Return .t.
   Endif
   aBEMLOC[nPOSB][3] := cMOTIVE
Endif

cPNEUROD    := &(cREADVAR)
&(cREADVAR) := cSTRINGT9

nPOS := ASCAN(aARRAYTRB,{|x| x[2] == cREADVAR})
If nPOS > 0
   aARRAYTRB[nPOS][3] := cSTRINGT9
Endif

lRefresh := .t.

cREADVAR := SPACE(8)

Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230ES ³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Consistencia Para Estoque                                   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230ES()
Local nPOS, nPOSB

If Empty(&cREADVAR)
   MsGstop(STR0055) //"Nao foi informado o rodado para a disponibilizacao..."
   Return .f.
Endif
cMTRANS := Space(1)
nPOS := ASCAN(aARRAYTRB,{|x| x[2] == cREADVAR})
If nPOS > 0
   nPOSB := ASCAN(aBEMLOC,{|x| x[2] == aARRAYTRB[nPOS][3]})
   If nPOSB > 0
      nOpcb := MNTA230MTV(cMTRANS,2)
      If nOpcb = 1
         Return .f.
      Endif
      aBEMLOC[nPOSB][3] := cMOTIVE
   Endif

   cVAR := aARRAYTRB[nPOS][2]
   &(cVAR) := cSTRINGT9
   aARRAYTRB[nPOS][3] := cSTRINGT9

Endif
cREADVAR := SPACE(8)
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230MTV³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Informa o Motivo do tranferˆncia e/ou estoque               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230MTV(cVMENSA,nTIPT)
Local cCABEC1 := Space(1)
Local nLINF   := If (Empty(cVMENSA),23.5,25.5)
Local nopcmo  := 1
Local oPnlPai
Local oDlgx

If nTIPT = 1
   cCABEC1 := STR0056 //"Movimento para Area de Transferˆncia"
ElseIf nTIPT = 2
   cCABEC1 := STR0057+Alltrim(&cREADVAR) //"Disponibilizacao do Rodado "
Else
   cCABEC1 := STR0058 //"Transferˆncia de Rodado"
Endif

cNOMCAU := Space(Len(st8->t8_nome))
cMOTIVE := Space(Len(stz->tz_causa))
lMOSTRE := .T.

DEFINE MSDIALOG oDlgx TITLE OemToAnsi(cCABEC1) From 18,20 To nLINF,70 OF oMainWnd
	oPnlPai := TPanel():New(0,0,,oDlgx,,,,,CLR_WHITE,0,0,.F.,.F.) //TPANEL PAI
		oPnlPai:Align := CONTROL_ALIGN_ALLCLIENT

  If Empty(cVMENSA)
     @1,1   say OemtoAnsi(STR0059) OF oPnlPai//"Motivo"
     @1,3.5 MSget cMOTIVE Picture "@!" OF oPnlPai VALID NGPMOTIVO(cMOTIVE) F3 "STN" SIZE 35,10 HASBUTTON
     @1,8   MSget cNOMCAU Picture "@!" OF oPnlPai SIZE 120,10 WHEN lMOSTRE
  Else
     @1,1 say OemtoAnsi(cVMENSA) OF oPnlPai
     @2,1   say OemtoAnsi(STR0059) OF oPnlPai //"Motivo"
     @2,3.5 MSget cMOTIVE Picture "@!" OF oPnlPai VALID NGPMOTIVO(cMOTIVE) F3 "STN" SIZE 35,10 HASBUTTON
     @2,8   MSget cNOMCAU Picture "@!" OF oPnlPai SIZE 120,10 WHEN lMOSTRE
  Endif

ACTIVATE MSDIALOG oDlgx CENTERED ON INIT EnchoiceBar(oDlgx,{||nopcmo:=2,oDlgx:End()},{||nopcmo:=1,oDlgx:End()})
Return nopcmo

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230BE ³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Consistencia Do rodado na Estrutura                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230BE(cBEM)
LocaL Z := 0
Local cVARDE   := Readvar()
Local cVPNEU   := &(cVARDE)
LocaL nPOSF    := ASCAN(aARRAYTRB,{|x| x[2] == READVAR()})
Local cPNEUOLD := If(nPOSF > 0 ,aARRAYTRB[nPOSF][3],Space(Len(st9->t9_codbem)))
cCODIFAM := If(nPOSF > 0 ,aARRAYTRB[nPOSF][4],Space(Len(st9->t9_codfami)))
cREADVAR := READVAR()

If Empty(cVPNEU)
   Return .t.
Endif

Dbselectarea("ST9")
Dbsetorder(1)
IF !Dbseek(XFILIAL("ST9")+cVPNEU)
   MSGSTOP(STR0045) //"Este Bem nao esta cadastrado..."
   RETURN .F.
ElseIf ST9->T9_SITBEM = 'I'
   MsgInfo(STR0014+Alltrim(cVPNEU)+STR0046,STR0016) //"Bem "###" esta inativo.."###"ATENCAO"
   &(cREADVAR) := cPNEUOLD
   lRefresh := .t.
   Return .t.
ElseIf ST9->T9_SITBEM = 'T'
   MsgInfo(STR0014+Alltrim(cVPNEU)+STR0115,STR0016) //"Bem "###" foi transferido."###"ATENCAO"
   &(cREADVAR) := cPNEUOLD
   lRefresh := .t.
   Return .t.
ElseIf cBEM = cVPNEU
   MsgInfo(STR0014+Alltrim(cVPNEU)+" "+STR0108,STR0016) //"Bem "###"e pai do Esquema do Rodado.","###"ATENCAO"
   &(cREADVAR) := cPNEUOLD
   lRefresh := .t.
   Return .t.
Endif

cREADVAR := READVAR()
nPOS := ASCAN(aARRAYTRB,{|x| x[2] == cREADVAR})

If nPOS > 0 .AND. aARRAYTRB[nPOS][3] == cVPNEU
    Return .t.
Endif

If cCODIFAM <> st9->t9_codfami
   MsgInfo(STR0060+st9->t9_codfami+STR0061+chr(13)+chr(13); //"O rodado da familia "###" nao podera ser"
          +STR0062,STR0063) //"considerado por divergir do esquema padrao."###"NAO CONFORMIDADE"
   &(cREADVAR) := cPNEUOLD
   lRefresh := .t.
   Return .t.
Endif

If cPNEUROD == cVPNEU .AND. !Empty(cPNEUROD) .and. Empty(cPNEUOLD)

   If !MSGYESNO(STR0053+alltrim(cVPNEU)+STR0064+chr(13)+chr(13); //"Rodado "###"  atualmente esta na area de transferencia."
               +STR0065+aARRAYTRB[nPOS][1]+STR0066+chr(13)+chr(13)+chr(13); //"Esta sendo transferido para a localizacao  "###"."
               +STR0067) //"Confirma ?"

       &(cREADVAR) := cSTRINGT9
       lRefresh := .t.
       cREADVAR := cSTRINGT9
       Return .t.
   Endif

   cPNEUROD := cSTRINGT9
   lRefresh := .t.
   aARRAYTRB[nPOS][3] := cVPNEU
   Return .t.
Endif

If Empty(aARRAYTRB[nPOS][3])
   nPOS2 := ASCAN(aARRAYTRB,{|x| x[3] == cVPNEU})
   If nPOS2 > 0
      cMTRANS := STR0053+alltrim(aARRAYTRB[nPOS2][3])+chr(13); //"Rodado "
                 +STR0068+aARRAYTRB[nPOS2][1]+chr(13); //"Localizacao Atual "
                 +STR0069+aARRAYTRB[nPOS][1]+chr(13)+chr(13)+chr(13) //"Localizacao Nova  "

      nPOSB := ASCAN(aBEMLOC,{|x| x[2] == cVPNEU})
      If nPOSB > 0 .And. Empty(aBEMLOC[nPOSB][3])
         nopre := MNTA230MTV(cMTRANS,3)
         If nopre = 1
            &(cREADVAR) := cSTRINGT9
            lRefresh := .t.
            cREADVAR := cSTRINGT9
            Return .t.
         Endif
         aBEMLOC[nPOSB][3] := cMOTIVE
      Else
         If !MSGYESNO(cMTRANS+STR0067) //"Confirma ?"
            &(cREADVAR) := cSTRINGT9
            lRefresh := .t.
            cREADVAR := cSTRINGT9
            Return .t.
         Endif
      Endif

      cVAR1    := aARRAYTRB[nPOS][2]
      cVAR2    := aARRAYTRB[nPOS2][2]
      &(cVAR2) := aARRAYTRB[nPOS][3]
      aARRAYTRB[nPOS][3]  := aARRAYTRB[nPOS2][3]
      aARRAYTRB[nPOS2][3] := cSTRINGT9
      &(cVAR2) := cSTRINGT9
      lRefresh := .t.
      cREADVAR := SPACE(8)
      Return .T.
   Endif
Endif

cMENSAB := Space(1)
For Z := 1 to len(aARRAYTRB)
   If aARRAYTRB[Z][3] = cVPNEU
      cMENSAB := STR0070 //"Ja foi informado este rodado para o esquema de rodado..."
      Exit
   Endif
Next

If Empty(cMENSAB)
   Dbselectarea("STC")
   Dbsetorder(3)
   If Dbseek(Xfilial("STC")+cVPNEU)
      If ASCAN(aBEMLOC,{|x| x[2] == cVPNEU}) = 0
         cMENSAB := STR0071 //"Bem informado ja faz parte de uma outra estrutura.."
      Endif
   Endif
Endif

If !Empty(cMENSAB)
   MsgInfo(cMENSAB,STR0016) //"ATENCAO"
   &(cREADVAR) := cPNEUOLD
   lRefresh := .t.
   Return .F.
Endif

nPOSB := ASCAN(aBEMLOC,{|x| x[2] == cPNEUOLD})
If nPOSB > 0 .And. Empty(aBEMLOC[nPOSB][3])
   cMTRANS := STR0053+Alltrim(cPNEUOLD)+chr(13); //"Rodado "
             +STR0072+aARRAYTRB[nPOSB][1]+chr(13); //"Localizacao  "
             +STR0073+cVPNEU //"Esta sendo trocado pelo rodado "
   nopre := MNTA230MTV(cMTRANS,3)
   If nopre = 1
      &(cREADVAR) := cPNEUOLD
      lRefresh := .t.
      Return .t.
   Endif
   aBEMLOC[nPOSB][3] := cMOTIVE
Endif

aARRAYTRB[nPOS][3] := cVPNEU
cREADVAR := SPACE(8)

Return .T.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230FIM³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Consistencia Final                                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230FIM()
Local yy,yx,yz
Local cFORMABE := tq0->tq0_DESENH+Space(Len(stc->tc_codbem)-Len(tq0->tq0_DESENH))
If !lCARESTP
   Dbselectarea("STC")
   Dbsetorder(1)
   If Dbseek(Xfilial("STC")+cFORMABE)
      While !eof() .and. stc->tc_filial = xfilial('STC');
         .and. stc->tc_codbem = cFORMABE
         If stc->tc_tipoest == 'F'
            Aadd(aARRAESTP,{stc->tc_localiz,stc->tc_obrigat})
         Endif
         dbskip()
      End
      lCARESTP := .t.
   Endif
Endif

For yy := 1 to len(aARRAYTRB)
   nPOS4 := ASCAN(aARRAESTP,{|x| x[1] == aARRAYTRB[yy][1]})
   If nPOS4 > 0
      If Empty(aARRAYTRB[yy][3]) .And. aARRAESTP[nPOS4][2] = 'S'
           MsgInfo(STR0074,STR0063) //"Nao foi informado rodado para a localizacao  "###"NAO CONFORMIDADE"
         Return .f.
      Endif
   Endif
Next yy

cHRTROCL := If(Alltrim(cHORALE1) = ":",cHRTIME1M,MTOH(HTOM(SubStr(cHORALE1,1,5))+1))  //Hora da entrada para o comp que trocou de localizacao
If cHRTROCL = "24:00"
   cHRTROCL := "00:00"
EndIf
dDTROCLO := If(Alltrim(cHRTROCL) = "00:00",dDTDATA+1,dDTDATA)              //Data da entrada para o comp que trocou de localizacao
cHORAESA := If(Alltrim(cHORALE1) = ":",cHRTIME,Substr(cHORALE1,1,5))                   //Hora para o componente que saiu ou entrou na estrutura

//Le a estrutura final
For yx := 1 To Len(aARRAYTRB)

   If !Empty(aARRAYTRB[yx][3])
      nPOSX := ASCAN(aARRAYINI,{|x| x[3] == aARRAYTRB[yx][3]})
      If nPOSX > 0 //Componente ja existente na estrutura

         If aARRAYINI[nPOSX ][1] <> aARRAYTRB[yx][1] ///Troco de Localizacao

            //Consiste a movimentacao do componente valida para a saida da localizacao inicial
            If !NGCONSTZ(aARRAYTRB[yx][3],dDTDATA,cHORAESA, ,aARRAYINI[nPOSX ][1])
               Return .F.
            EndIf

            //Consiste a movimentacao do componente valida para a entrada da localizacao final
            If !NGCONSTZ(aARRAYTRB[yx][3],dDTROCLO,cHRTROCL,"E",aARRAYTRB[yx][1])
               Return .F.
            EndIf
         EndIf
      Else //Componente novo adicionado na estrutura

         //Consiste a movimentacao do componente valida para a entrada na estrutura
         If !NGCONSTZ(aARRAYTRB[yx][3],dDTDATA,cHORAESA,"E",aARRAYTRB[yx][1])
            Return .F.
         EndIf

      Endif
   EndIf

Next yx

//Le a estrutura inicial
For yz := 1 To Len(aARRAYINI)

   If !Empty(aARRAYINI[yz][3])
      nPOSX := ASCAN(aARRAYTRB,{|x| x[3] == aARRAYINI[yz][3]})
      If nPOSX = 0 //Componente que saiu da estrutura inicial

         //Consiste a movimentacao do componente valida para a saida
         If !NGCONSTZ(aARRAYINI[yz][3],dDTDATA,cHORAESA, ,aARRAYINI[yz][1])
            Return .F.
         EndIf

      EndIf
   EndIf

Next yz

Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230WHE³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Inicializa a vari vel de leitura ( get )                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230WHE(lVARM)
cPNEUOLD := &(READVAR())
IF !Empty(READVAR()) .and. Empty(cREADVAR)
    cREADVAR := READVAR()
Endif
nPOSF := ASCAN(aARRAYTRB,{|x| x[2] == READVAR()})
cCODIFAM := If(nPOSF > 0 ,aARRAYTRB[nPOSF][4],Space(Len(st9->t9_codfami)))
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230FBE³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Visualiza‡Æo do bem ( cadastro )                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230FBE(cREADVAR)
Local cVIBEM := &(cREADVAR)
If Empty(cVIBEM)
   MsgInfo(STR0075,STR0016) //"Nao foi informado o bem para visualizar"###"ATENCAO"
   Return .f.
Endif
aRotina := {{STR0076 ,"AxPesqui",0,1},; //"Pesquisar"
            {STR0077,"NGCAD01",0,2}} //"Visualizar"
cCadastro := OemtoAnsi(STR0078) //"Bens"
Dbselectarea("ST9")
Dbsetorder(1)
Dbseek(XFILIAL("ST9")+cVIBEM)
NGCAD01('ST9',recno(),2)
cREADVAR := SPACE(8)
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³NGPMOTIVO ³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Consistˆncia do motivo do rodizio                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function NGPMOTIVO(cVMOTIVO)
lMOSTRE := .T.
cNOMCAU := Space(Len(st8->t8_nome))
lRefresh := .t.
If !ExistCpo('ST8',cVMOTIVO)
   Return .f.
Endif
Dbselectarea("ST8")
Dbsetorder(1)
Dbseek(XFILIAL("ST8")+cVMOTIVO)
If ST8->T8_TIPO <> 'C'
   MsgInfo(STR0079,STR0016) //"Motivo devera ser do tipo CAUSA"###"ATENCAO"
   Return .f.
Endif
cNOMCAU  := st8->t8_nome
lRefresh := .t.
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230IMP³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ImpressÆo do esquema de rodado                              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTA230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230IMP(cVBEMPAI,aAREXIOS,aARTRB,nLEGEN)
Local oPrint
Local i      := 1
Local x      := 0
Local cMENSA := Space(1),xi,lt,ct
Private lin  := 0
Private oFont11,oFont14,oFont17
Private lTIPAG := "P" ,nLINHAM := 2500, nCOLUAM := 3100

Dbselectarea("ST9")
Dbsetorder(1)
If !Dbseek(xFilial('ST9')+cVBEMPAI)
    cMENSA := STR0080 //"Bem Nao Cadastrada"
Endif

Dbselectarea("STC")
Dbsetorder(1)
If !Dbseek( xFilial('STC')+cVBEMPAI)
   If Empty(cMENSA)
      cMENSA := STR0081 //"Estrutura do Bem Nao Cadastrada"
   Endif
Endif

Dbselectarea("TQ0")
Dbsetorder(1)
If !Dbseek( xFilial('TQ0')+ST9->T9_CODFAMI)
   If Empty(cMENSA)
       cMENSA := STR0082 //"Esquema Padrao Nao Cadastrado"
   Endif
Endif

Dbselectarea("TQ1")
Dbsetorder(1)
If !Dbseek( xFilial('TQ1')+TQ0->TQ0_DESENH)
   If Empty(cMENSA)
      cMENSA := STR0050+cVFORMA //"Nao Existe Itens Para Esquema de Rodado "
   Endif
Endif

If !Empty(cMENSA)
   MsgInfo(cMENSA,STR0016) //"ATENCAO"
   Return .f.
Endif

If aAREXIOS <> NIL
   aAREIXO := Aclone(aAREXIOS)
   aARESTB := Aclone(aARTRB)
Else
   // MONTA IMPRESSAO EXTRA SOMENTE COM O CODIGO DO BEM COM PARAMETRO
   aARESTP := {}
   aAREIXO := {}
   aARYSTC := {}
   cBEMMP := SPACE(LEN(ST9->T9_CODBEM))

   // VERIFICA AS LOCALIZACOES DO DESENHO DO RODADO

   While !EOF() .And. TQ1->TQ1_FILIAL == xFILIAL("TQ0");
      .And. TQ1->TQ1_DESENH == TQ0->TQ0_DESENH
      Aadd(aAREIXO,{TQ1->TQ1_QTDPNE,TQ1->TQ1_LOCPN1,TQ1->TQ1_LOCPN2,;
                    TQ1->TQ1_LOCPN3,TQ1->TQ1_LOCPN4,TQ1->TQ1_LOCPN5,;
                    TQ1->TQ1_LOCPN6,TQ1->TQ1_LOCPN7,TQ1->TQ1_LOCPN8,;
                    TQ1->TQ1_LOCPN9,TQ1->TQ1_LOCPN0,TQ1->TQ1_EIXO,;
                    TQ1->TQ1_FAMIL1,TQ1->TQ1_FAMIL2,TQ1->TQ1_FAMIL3,;
                    TQ1->TQ1_FAMIL4,TQ1->TQ1_FAMIL5,TQ1->TQ1_FAMIL6,;
                    TQ1->TQ1_FAMIL7,TQ1->TQ1_FAMIL8,TQ1->TQ1_FAMIL9,;
                    TQ1->TQ1_FAMIL0})

      Aadd(aARYSTC,{TQ1->TQ1_QTDPNE,cBEMSTC,cBEMSTC,cBEMSTC,cBEMSTC,;
                    cBEMSTC,cBEMSTC,cBEMSTC,cBEMSTC,cBEMSTC,cBEMSTC,;
                    TQ1->TQ1_EIXO,cFAMISTC,cFAMISTC,cFAMISTC,cFAMISTC,;
                    cFAMISTC,cFAMISTC,cFAMISTC,cFAMISTC,cFAMISTC,;
                    cFAMISTC})
      Dbselectarea("TQ1")
      DbSkip()
   End

   // VERIFICA OS COMPONETES DA ESTRUTURA

   aBEMEST := NGCOMPEST(cVBEMPAI,'B',.F.,.F.)
   If Len(aBEMEST) == 0
      msginfo(STR0020,STR0016) //"Este Bem nao tem estrutura.."###"ATENCAO"
      Return .f.
   Endif

   // LOCALIZACAO NA ESTRUTURA
   aBEMESTLOC := {}
   For xi := 1 to Len(aBEMEST)
      Dbselectarea("ST9")
      Dbsetorder(1)
      If Dbseek(XFILIAL("ST9")+aBEMEST[xi])
         Dbselectarea("STC")
         Dbsetorder(3)
         If Dbseek(XFILIAL("STC")+aBEMEST[xi])
            While !Eof() .And. stc->tc_filial = Xfilial('STC') .And.;
               stc->tc_compone = aBEMEST[xi]
               If !Empty(STC->TC_LOCALIZ) .And. STC->TC_TIPOEST = 'B'
                  Aadd(aBEMESTLOC,{STC->TC_LOCALIZ,aBEMEST[xi],Space(Len(stz->tz_causa)),st9->t9_codfami})
                  Exit
               Endif
               Dbskip()
            End
         Endif
      Endif
   Next

   aARESTB := {}

   // MONTA A ESTRUTURA DA ESQUEMA DE RODADO COM OS RODADOS
   For LT := 1 to Len(aAREIXO)
      For CT := 2 to 11
          cLOC    := ALLTRIM(aAREIXO[LT][CT])
          cBEMSTC := cSTRINGT9
          If !Empty(cLOC)
              nPOS := ASCAN(aBEMESTLOC,{|x| x[1]+x[4] == aAREIXO[LT][CT]+aAREIXO[LT][CT+9]})
              If nPOS > 0
                  cBEMSTC := aBEMLOC[nPOS][2]
                  aARRAYSTC[LT][CT]   := cBEMSTC
                  aARRAYSTC[LT][CT+9] := aBEMLOC[nPOS][4]
              Endif

              If CT >= 2 .AND. CT <= 11
                 cLOCTRB := cLOC+SPACE(LEN(STC->TC_LOCALIZ)-LEN(cLOC))
                 Aadd(aARESTB,{cLOCTRB,SPACE(8),cBEMSTC,aAREIXO[LT][CT+11]})
              Endif

          Endif
      Next CT
   Next LT
Endif

oFont11 := TFont():New("Arial",11,11,,.F.,,,,.T.,.F.)
oFont14 := TFont():New("Arial",14,14,,.T.,,,,.T.,.F.)
oFont17 := TFont():New("Arial",17,17,,.T.,,,,.T.,.F.)
oFont18 := TFont():New("Arial",18,18,,.T.,,,,.T.,.F.)

oPrint  := TMSPrinter():New( OemToAnsi(STR0083)) //"Impressao do Esquema de Rodado"
oPrint:SetlandScape() // Paisagem
MNTA230IM2(oPrint,@i,@lin,cVBEMPAI,nLEGEN)
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230IM2³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ImpressÆo do rodado                                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTA230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function MNTA230IM2(oPrint,i,lin,cVBEMP,nVLEG)
Local XL := 0,hh,h2,h3,nPAG := 1,lPRINC := .T.
Local vVet := If (nDESIGM = 1,{1,2,3,4,5,6,7,8,9,0},;
                              {1,2,3,4,5,6,7,8,9,0})
cCOR     := CLR_HRED
cCOR2    := CLR_BLUE
cTIPODIM := STR0001 //"RODADOS"
cTIPODFA := If (nDESIGM = 2,STR0021,STR0022) //"LOCALIZACAO"###"FAMILIA"
cNOMBEM  := Alltrim(NGSEEK("ST9",cVBEMP,1,"ST9->T9_NOME"))
nTAMARP  := Len(aAREIXO)
nCOLP2   := 30
nLINHA   := 710
nUTLIN   := 0
chora   := "         "+STR0093+" "+Dtoc(date())+"  "+Time()
nLISOMA  := 0

nMaxPe   := 0

nL01     := 320
nL02     := 470
nL03     := 620
nL04     := 770
nL05     := 920
nL06     := 1070
nL07     := 1220
nL08     := 1370
nL09     := 1520
nL10     := 1670
nL11     := 1820
cTitRel  := STR0084+Alltrim(st9->t9_codbem)+" - "+cNOMBEM
For xl := 1 to nTAMARP
   If lPRINC
      lPRINC := .F.
      oPrint:StartPage()
      oPrint:Say(020,0040,cTitRel,oFont14)

      oPrint:Box(100,390,200,760)
      oPrint:Say(115,040,STR0085,oFont14) //"Apresentacao   "
      oPrint:Say(125,402,cTIPODIM,oFont11)

      cPAGI := STR0104+" "+Str(nPAG,2)+"    "+chora
      oPrint:Say(125,2000,cPAGI,oFont14)
      If nDESIGM <> 1
         oPrint:Box(209,392,280,690)
         oPrint:Say(220,402,cTIPODFA,oFont11,,cCOR)
      Endif
   Endif

   If nCOLP2 > 2550
      nLINHA := 710
      nCOLP2 := 30
      nPAG   += 1
      nUTLIN := 0
      oPrint:EndPage()
      oPrint:StartPage()
      cPAGI := STR0104+" "+Str(nPAG,2)+"    "+chora
      oPrint:Say(125,2000,cPAGI,oFont14)
   Endif

   cNOEIXO := If(Alltrim(aAREIXO[xl][12]) = STR0031,STR0031,;
                 Alltrim(aAREIXO[xl][12])+" "+CHR(176)+" "+STR0103)

   If aAREIXO[xl][1] = 1
      nPN1 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][2]})
      If nDESIGM = 1
         MNTA220BX(oPrint,@i,@lin,nL06-20,85,370,1)
         oPrint:Say(nL06-85      ,nCOLP2+5,cNOEIXO,oFont14)
         oPrint:Say(nL06,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         nUTLIN := Max(nUTLIN,1050)
      Else
         oPrint:Say(nL06+140 ,nCOLP2+7,cNOEIXO,oFont14)
         MNTA220BX(oPrint,@i,@lin,nL01+952,85,380,1)
         oPrint:Say(nL01+972,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1034,85,210,1)
         oPrint:Say(nL01+1049,nCOLP2  ,aARESTB[nPN1,If(nDESIGM = 2,1,4)],oFont11,,cCOR)
         nUTLIN := Max(nUTLIN,1450)
      Endif
   ElseIf aAREIXO[xl][1] = 2
      nPN1 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][2]})
      nPN2 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][3]})
      If nDESIGM = 1
         MNTA220BX(oPrint,@i,@lin,nL05-20,85,370,1)
         MNTA220BX(oPrint,@i,@lin,nL07-20,85,370,1)
         MNTA220EI1(oPrint,@i,@lin,nL05+65,nL05+280,1,1,170,nLISOMA)
         oPrint:Say(nL05-85      ,nCOLP2+100,cNOEIXO,oFont14)
         oPrint:Say(nL05,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         oPrint:Say(nL07,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         nUTLIN := Max(nUTLIN,1250)
      Else
         oPrint:Say(nL05+140 ,nCOLP2+100,cNOEIXO,oFont14)
         MNTA220BX(oPrint,@i,@lin,nL01+802,85,380,1)
         oPrint:Say(nL01+822,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+884,85,210,1)
         oPrint:Say(nL01+899,nCOLP2  ,aARESTB[nPN1,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         // DIVISOR
         MNTA220EI1(oPrint,@i,@lin,nL01+969,nL01+1119,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1119,85,380,1)
         oPrint:Say(nL01+1139,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1201,85,210,1)
         oPrint:Say(nL01+1216,nCOLP2  ,aARESTB[nPN2,If(nDESIGM = 2,1,4)],oFont11,,cCOR)
         nUTLIN := Max(nUTLIN,1650)
      Endif
   ElseIf aAREIXO[xl][1] = 3
      nPN1 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][2]})
      nPN2 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][3]})
      nPN3 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][4]})
      If nDESIGM = 1
         MNTA220BX(oPrint,@i,@lin,nL05-20,85,370,2)
         MNTA220BX(oPrint,@i,@lin,nL07-20,85,370,1)
         MNTA220EI1(oPrint,@i,@lin,nL05+65,nL05+130,2,1,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL06+62,nL06+130,2,1,170,nLISOMA)
         oPrint:Say(nL05-85      ,nCOLP2+100,cNOEIXO,oFont14)
         oPrint:Say(nL05,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         oPrint:Say(nL06,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         oPrint:Say(nL07,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         nUTLIN := Max(nUTLIN,1250)
      Else
         oPrint:Say(nL05+100,nCOLP2+100,cNOEIXO,oFont14)
         MNTA220BX(oPrint,@i,@lin,nL01+761,85,380,1)
         oPrint:Say(nL01+781,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+843,85,210,1)
         oPrint:Say(nL01+858,nCOLP2  ,aARESTB[nPN1,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+927,nL01+952,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+952,85,380,1)
         oPrint:Say(nL01+972,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1034,85,210,1)
         oPrint:Say(nL01+1049,nCOLP2  ,aARESTB[nPN2,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1118,nL01+1143,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1143,85,380,1)
         oPrint:Say(nL01+1163,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1225,85,210,1)
         oPrint:Say(nL01+1240,nCOLP2  ,aARESTB[nPN3,If(nDESIGM = 2,1,4)],oFont11,,cCOR)
         nUTLIN := Max(nUTLIN,1650)
      Endif
   ElseIf aAREIXO[xl][1] = 4
      nPN1 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][2]})
      nPN2 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][3]})
      nPN3 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][4]})
      nPN4 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][5]})
      If nDESIGM = 1
         MNTA220BX(oPrint,@i,@lin,nL04-20,85,370,2)
         MNTA220BX(oPrint,@i,@lin,nL07-20,85,370,2)
         MNTA220EI1(oPrint,@i,@lin,nL04+65,nL04+125,2,1,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL05+57,nL05+280,2,1,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL07+65,nL07+125,2,1,170,nLISOMA)
         oPrint:Say(nL04-85      ,nCOLP2+100,cNOEIXO,oFont14)
         oPrint:Say(nL04,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         oPrint:Say(nL05,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         oPrint:Say(nL07,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         oPrint:Say(nL08,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         nUTLIN := Max(nUTLIN,1455)
      Else
         oPrint:Say(nL04+100 ,nCOLP2+100,cNOEIXO,oFont14)
         MNTA220BX(oPrint,@i,@lin,nL01+611,85,380,1)
         oPrint:Say(nL01+631,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+693,85,210,1)
         oPrint:Say(nL01+708,nCOLP2  ,aARESTB[nPN1,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+777,nL01+802,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+802,85,380,1)
         oPrint:Say(nL01+822,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+884,85,210,1)
         oPrint:Say(nL01+899,nCOLP2  ,aARESTB[nPN2,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         // DIVISOR
         MNTA220EI1(oPrint,@i,@lin,nL01+969,nL01+1119,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1119,85,380,1)
         oPrint:Say(nL01+1139,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1201,85,210,1)
         oPrint:Say(nL01+1216,nCOLP2  ,aARESTB[nPN3,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1285,nL01+1310,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1310,85,380,1)
         oPrint:Say(nL01+1330,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1392,85,210,1)
         oPrint:Say(nL01+1407,nCOLP2  ,aARESTB[nPN4,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         nUTLIN := Max(nUTLIN,1855)
      Endif
   ElseIf aAREIXO[xl][1] = 5
      nPN1 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][2]})
      nPN2 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][3]})
      nPN3 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][4]})
      nPN4 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][5]})
      nPN5 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][6]})
      If nDESIGM = 1
         MNTA220BX(oPrint,@i,@lin,nL04-20,85,370,2)
         MNTA220BX(oPrint,@i,@lin,nL06-20,85,370,1)
         MNTA220BX(oPrint,@i,@lin,nL07-20,85,370,2)
         MNTA220EI1(oPrint,@i,@lin,nL04+65,nL04+130,2,1,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL05+58,nL05+130,2,1,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL06+65,nL06+130,2,2,170,nLISOMA)
         oPrint:Say(nL04-85      ,nCOLP2+100,cNOEIXO,oFont14)
         oPrint:Say(nL04,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         oPrint:Say(nL05,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         oPrint:Say(nL06,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         oPrint:Say(nL07,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         oPrint:Say(nL08,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         anUTLIN := Max(nUTLIN,1450)
      Else
         oPrint:Say(nL04+60,nCOLP2+100,cNOEIXO,oFont14)
         MNTA220BX(oPrint,@i,@lin,nL01+570,85,380,1)
         oPrint:Say(nL01+590,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+652,85,210,1)
         oPrint:Say(nL01+667,nCOLP2  ,aARESTB[nPN1,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+736,nL01+761,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+761,85,380,1)
         oPrint:Say(nL01+781,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+843,85,210,1)
         oPrint:Say(nL01+858,nCOLP2  ,aARESTB[nPN2,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+927,nL01+952,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+952,85,380,1)
         oPrint:Say(nL01+972,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1034,85,210,1)
         oPrint:Say(nL01+1049,nCOLP2  ,aARESTB[nPN3,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1118,nL01+1143,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1143,85,380,1)
         oPrint:Say(nL01+1163,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1225,85,210,1)
         oPrint:Say(nL01+1240,nCOLP2  ,aARESTB[nPN4,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1309,nL01+1334,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1334,85,380,1)
         oPrint:Say(nL01+1354,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1416,85,210,1)
         oPrint:Say(nL01+1431,nCOLP2  ,aARESTB[nPN5,If(nDESIGM = 2,1,4)],oFont11,,cCOR)
         nUTLIN := Max(nUTLIN,1850)
      Endif
   ElseIf aAREIXO[xl][1] = 6
      nPN1 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][2]})
      nPN2 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][3]})
      nPN3 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][4]})
      nPN4 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][5]})
      nPN5 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][6]})
      nPN6 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][7]})
      If nDESIGM = 1
         MNTA220BX(oPrint,@i,@lin,nL03-20,85,370,3)
         MNTA220BX(oPrint,@i,@lin,nL07-20,85,370,3)
         MNTA220EI1(oPrint,@i,@lin,nL03+65,nL03+130,2,2,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL05+50,nL05+280,2,1,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL07+65,nL07+130,2,2,170,nLISOMA)
         oPrint:Say(nL03-85      ,nCOLP2+100,cNOEIXO,oFont14)
         oPrint:Say(nL03,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         oPrint:Say(nL04,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         oPrint:Say(nL05,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         oPrint:Say(nL07,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         oPrint:Say(nL08,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         oPrint:Say(nL09,nCOLP2  ,aARESTB[nPN6,3],oFont11)
         nUTLIN := Max(nUTLIN,1550)
      Else
         oPrint:Say(nL03+60 ,nCOLP2+100,cNOEIXO,oFont14)
         MNTA220BX(oPrint,@i,@lin,nL01+420,85,380,1)
         oPrint:Say(nL01+440,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+502,85,210,1)
         oPrint:Say(nL01+517,nCOLP2  ,aARESTB[nPN1,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+586,nL01+611,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+611,85,380,1)
         oPrint:Say(nL01+631,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+693,85,210,1)
         oPrint:Say(nL01+708,nCOLP2  ,aARESTB[nPN2,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+777,nL01+802,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+802,85,380,1)
         oPrint:Say(nL01+822,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+884,85,210,1)
         oPrint:Say(nL01+899,nCOLP2  ,aARESTB[nPN3,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         // DIVISOR
         MNTA220EI1(oPrint,@i,@lin,nL01+969,nL01+1119,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1119,85,380,1)
         oPrint:Say(nL01+1139,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1201,85,210,1)
         oPrint:Say(nL01+1216,nCOLP2  ,aARESTB[nPN4,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1285,nL01+1310,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1310,85,380,1)
         oPrint:Say(nL01+1330,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1392,85,210,1)
         oPrint:Say(nL01+1407,nCOLP2  ,aARESTB[nPN5,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1476,nL01+1501,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1501,85,380,1)
         oPrint:Say(nL01+1521,nCOLP2  ,aARESTB[nPN6,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1583,85,210,1)
         oPrint:Say(nL01+1598,nCOLP2  ,aARESTB[nPN6,If(nDESIGM = 2,1,4)],oFont11,,cCOR)
         nUTLIN := Max(nUTLIN,1950)
      Endif
   ElseIf aAREIXO[xl][1] = 7
      nPN1 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][2]})
      nPN2 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][3]})
      nPN3 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][4]})
      nPN4 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][5]})
      nPN5 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][6]})
      nPN6 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][7]})
      nPN7 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][8]})
      If nDESIGM = 1
         MNTA220BX(oPrint,@i,@lin,nL03-20,85,370,3)
         MNTA220BX(oPrint,@i,@lin,nL06-20,85,370,1)
         MNTA220BX(oPrint,@i,@lin,nL07-20,85,370,3)
         MNTA220EI1(oPrint,@i,@lin,nL03+65,nL03+130,2,2,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL05+58,nL05+130,2,1,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL06+65,nL06+130,2,3,170,nLISOMA)
         oPrint:Say(nL03-85      ,nCOLP2+100,cNOEIXO,oFont14)
         oPrint:Say(nL03,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         oPrint:Say(nL04,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         oPrint:Say(nL05,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         oPrint:Say(nL06,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         oPrint:Say(nL07,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         oPrint:Say(nL08,nCOLP2  ,aARESTB[nPN6,3],oFont11)
         oPrint:Say(nL09,nCOLP2  ,aARESTB[nPN7,3],oFont11)
         nUTLIN := Max(nUTLIN,1750)
      Else
         oPrint:Say(nL03+20 ,nCOLP2+100,cNOEIXO,oFont14)
         MNTA220BX(oPrint,@i,@lin,nL01+380,85,380,1)
         oPrint:Say(nL01+390,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+462,85,210,1)
         oPrint:Say(nL01+477,nCOLP2  ,aARESTB[nPN1,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+545,nL01+570,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+570,85,380,1)
         oPrint:Say(nL01+590,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+652,85,210,1)
         oPrint:Say(nL01+667,nCOLP2  ,aARESTB[nPN2,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+736,nL01+761,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+761,85,380,1)
         oPrint:Say(nL01+781,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+843,85,210,1)
         oPrint:Say(nL01+858,nCOLP2  ,aARESTB[nPN3,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+927,nL01+952,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+952,85,380,1)
         oPrint:Say(nL01+972,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1034,85,210,1)
         oPrint:Say(nL01+1049,nCOLP2  ,aARESTB[nPN4,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1118,nL01+1143,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1143,85,380,1)
         oPrint:Say(nL01+1163,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1225,85,210,1)
         oPrint:Say(nL01+1240,nCOLP2  ,aARESTB[nPN5,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1309,nL01+1334,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1334,85,380,1)
         oPrint:Say(nL01+1354,nCOLP2  ,aARESTB[nPN6,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1416,85,210,1)
         oPrint:Say(nL01+1431,nCOLP2  ,aARESTB[nPN6,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1500,nL01+1525,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1525,85,380,1)
         oPrint:Say(nL01+1545,nCOLP2  ,aARESTB[nPN7,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1607,85,210,1)
         oPrint:Say(nL01+1622,nCOLP2  ,aARESTB[nPN7,If(nDESIGM = 2,1,4)],oFont11,,cCOR)
         nUTLIN := Max(nUTLIN,2150)
      Endif

   ElseIf aAREIXO[xl][1] = 8
      nPN1 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][2]})
      nPN2 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][3]})
      nPN3 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][4]})
      nPN4 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][5]})
      nPN5 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][6]})
      nPN6 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][7]})
      nPN7 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][8]})
      nPN8 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][9]})
      If nDESIGM = 1
         MNTA220BX(oPrint,@i,@lin,nL02-20,85,370,4)
         MNTA220BX(oPrint,@i,@lin,nL07-20,85,370,4)
         MNTA220EI1(oPrint,@i,@lin,nL02+65,nL02+130,2,3,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL05+45,nL05+280,2,1,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL07+65,nL07+130,2,3,170,nLISOMA)
         oPrint:Say(nL02-85      ,nCOLP2+100,cNOEIXO,oFont14)
         oPrint:Say(nL02,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         oPrint:Say(nL03,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         oPrint:Say(nL04,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         oPrint:Say(nL05,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         oPrint:Say(nL07,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         oPrint:Say(nL08,nCOLP2  ,aARESTB[nPN6,3],oFont11)
         oPrint:Say(nL09,nCOLP2  ,aARESTB[nPN7,3],oFont11)
         oPrint:Say(nL10,nCOLP2  ,aARESTB[nPN8,3],oFont11)
         nUTLIN := Max(nUTLIN,1950)
      Else
         oPrint:Say(nL02+20 ,nCOLP2+100,cNOEIXO,oFont14)
         MNTA220BX(oPrint,@i,@lin,nL01+230,85,380,1)
         oPrint:Say(nL01+250,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+312,85,210,1)
         oPrint:Say(nL01+327,nCOLP2  ,aARESTB[nPN1,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+395,nL01+420,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+420,85,380,1)
         oPrint:Say(nL01+440,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+502,85,210,1)
         oPrint:Say(nL01+517,nCOLP2  ,aARESTB[nPN2,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+586,nL01+611,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+611,85,380,1)
         oPrint:Say(nL01+631,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+693,85,210,1)
         oPrint:Say(nL01+708,nCOLP2  ,aARESTB[nPN3,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+777,nL01+802,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+802,85,380,1)
         oPrint:Say(nL01+822,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+884,85,210,1)
         oPrint:Say(nL01+899,nCOLP2  ,aARESTB[nPN4,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         // DIVISOR
         MNTA220EI1(oPrint,@i,@lin,nL01+969,nL01+1119,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1119,85,380,1)
         oPrint:Say(nL01+1139,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1201,85,210,1)
         oPrint:Say(nL01+1216,nCOLP2  ,aARESTB[nPN5,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1285,nL01+1310,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1310,85,380,1)
         oPrint:Say(nL01+1330,nCOLP2  ,aARESTB[nPN6,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1392,85,210,1)
         oPrint:Say(nL01+1407,nCOLP2  ,aARESTB[nPN6,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1476,nL01+1501,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1501,85,380,1)
         oPrint:Say(nL01+1521,nCOLP2  ,aARESTB[nPN7,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1583,85,210,1)
         oPrint:Say(nL01+1598,nCOLP2  ,aARESTB[nPN7,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1667,nL01+1692,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1692,85,380,1)
         oPrint:Say(nL01+1717,nCOLP2  ,aARESTB[nPN8,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1779,85,210,1)
         oPrint:Say(nL01+1794,nCOLP2  ,aARESTB[nPN8,If(nDESIGM = 2,1,4)],oFont11,,cCOR)
         nUTLIN := Max(nUTLIN,2350)
      Endif
   ElseIf aAREIXO[xl][1] = 9
      nPN1 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][2]})
      nPN2 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][3]})
      nPN3 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][4]})
      nPN4 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][5]})
      nPN5 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][6]})
      nPN6 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][7]})
      nPN7 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][8]})
      nPN8 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][9]})
      nPN9 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][10]})
      If nDESIGM = 1
         MNTA220BX(oPrint,@i,@lin,nL02-20,85,370,4)
         MNTA220BX(oPrint,@i,@lin,nL06-20,85,370,5)
         MNTA220EI1(oPrint,@i,@lin,nL02+65,nL02+130,2,4,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL05+65,nL05+130,2,5,170,nLISOMA)
         oPrint:Say(nL02-85      ,nCOLP2+100,cNOEIXO,oFont14)
         oPrint:Say(nL02,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         oPrint:Say(nL03,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         oPrint:Say(nL04,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         oPrint:Say(nL05,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         oPrint:Say(nL06,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         oPrint:Say(nL07,nCOLP2  ,aARESTB[nPN6,3],oFont11)
         oPrint:Say(nL08,nCOLP2  ,aARESTB[nPN7,3],oFont11)
         oPrint:Say(nL09,nCOLP2  ,aARESTB[nPN8,3],oFont11)
         oPrint:Say(nL10,nCOLP2  ,aARESTB[nPN9,3],oFont11)
         nUTLIN := Max(nUTLIN,2150)
      Else
         oPrint:Say(nL02-20  ,nCOLP2+100,cNOEIXO,oFont14)
         MNTA220BX(oPrint,@i,@lin,nL01+190,85,380,1)
         oPrint:Say(nL01+200,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+270,85,210,1)
         oPrint:Say(nL01+290,nCOLP2  ,aARESTB[nPN1,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+355,nL01+380,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+380,85,380,1)
         oPrint:Say(nL01+390,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+462,85,210,1)
         oPrint:Say(nL01+477,nCOLP2  ,aARESTB[nPN2,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+545,nL01+570,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+570,85,380,1)
         oPrint:Say(nL01+590,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+652,85,210,1)
         oPrint:Say(nL01+667,nCOLP2  ,aARESTB[nPN3,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+736,nL01+761,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+761,85,380,1)
         oPrint:Say(nL01+781,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+843,85,210,1)
         oPrint:Say(nL01+858,nCOLP2  ,aARESTB[nPN4,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+927,nL01+952,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+952,85,380,1)
         oPrint:Say(nL01+972,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1034,85,210,1)
         oPrint:Say(nL01+1049,nCOLP2  ,aARESTB[nPN5,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1118,nL01+1143,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1143,85,380,1)
         oPrint:Say(nL01+1163,nCOLP2  ,aARESTB[nPN6,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1225,85,210,1)
         oPrint:Say(nL01+1240,nCOLP2  ,aARESTB[nPN6,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1309,nL01+1334,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1334,85,380,1)
         oPrint:Say(nL01+1354,nCOLP2  ,aARESTB[nPN7,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1416,85,210,1)
         oPrint:Say(nL01+1431,nCOLP2  ,aARESTB[nPN7,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1500,nL01+1525,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1525,85,380,1)
         oPrint:Say(nL01+1545,nCOLP2  ,aARESTB[nPN8,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1607,85,210,1)
         oPrint:Say(nL01+1622,nCOLP2  ,aARESTB[nPN8,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1691,nL01+1716,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1716,85,380,1)
         oPrint:Say(nL01+1736,nCOLP2  ,aARESTB[nPN8,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1798,85,210,1)
         oPrint:Say(nL01+1813,nCOLP2  ,aARESTB[nPN8,If(nDESIGM = 2,1,4)],oFont11,,cCOR)
         nUTLIN := Max(nUTLIN,2550)
      Endif

   ElseIf aAREIXO[xl][1] = 10
      nPN1 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][2]})
      nPN2 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][3]})
      nPN3 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][4]})
      nPN4 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][5]})
      nPN5 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][6]})
      nPN6 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][7]})
      nPN7 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][8]})
      nPN8 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][9]})
      nPN9 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][10]})
      nPN0 := ASCAN(aARESTB,{|x| x[1] == aAREIXO[xl][11]})

      If nDESIGM = 1
         MNTA220BX(oPrint,@i,@lin,nL01-20,85,370,5)
         MNTA220EI1(oPrint,@i,@lin,nL01+65,nL01+130,2,4,170,nLISOMA)
         MNTA220EI1(oPrint,@i,@lin,nL05+45,nL05+280,2,1,170,nLISOMA)
         MNTA220BX(oPrint,@i,@lin,nL07-20,85,370,5)
         MNTA220EI1(oPrint,@i,@lin,nL07+65,nL07+130,2,4,170,nLISOMA)
         oPrint:Say(nL01-85      ,nCOLP2+100,cNOEIXO,oFont14)
         oPrint:Say(nL01,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         oPrint:Say(nL02,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         oPrint:Say(nL03,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         oPrint:Say(nL04,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         oPrint:Say(nL05,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         oPrint:Say(nL07,nCOLP2  ,aARESTB[nPN6,3],oFont11)
         oPrint:Say(nL08,nCOLP2  ,aARESTB[nPN7,3],oFont11)
         oPrint:Say(nL09,nCOLP2  ,aARESTB[nPN8,3],oFont11)
         oPrint:Say(nL10,nCOLP2  ,aARESTB[nPN9,3],oFont11)
         oPrint:Say(nL11,nCOLP2  ,aARESTB[nPN0,3],oFont11)
         nUTLIN := Max(nUTLIN,2350)
      Else
         oPrint:Say(nL01-15      ,nCOLP2+100,cNOEIXO,oFont14)

         MNTA220BX(oPrint,@i,@lin,nL01+40,85,380,1)
         oPrint:Say(nL01+50,nCOLP2  ,aARESTB[nPN1,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+120,85,210,1)
         oPrint:Say(nL01+140,nCOLP2  ,aARESTB[nPN1,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+205,nL01+230,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+230,85,380,1)
         oPrint:Say(nL01+250,nCOLP2  ,aARESTB[nPN2,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+312,85,210,1)
         oPrint:Say(nL01+327,nCOLP2  ,aARESTB[nPN2,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+395,nL01+420,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+420,85,380,1)
         oPrint:Say(nL01+440,nCOLP2  ,aARESTB[nPN3,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+502,85,210,1)
         oPrint:Say(nL01+517,nCOLP2  ,aARESTB[nPN3,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+586,nL01+611,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+611,85,380,1)
         oPrint:Say(nL01+631,nCOLP2  ,aARESTB[nPN4,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+693,85,210,1)
         oPrint:Say(nL01+708,nCOLP2  ,aARESTB[nPN4,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+777,nL01+802,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+802,85,380,1)
         oPrint:Say(nL01+822,nCOLP2  ,aARESTB[nPN5,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+884,85,210,1)
         oPrint:Say(nL01+899,nCOLP2  ,aARESTB[nPN5,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         // DIVISOR
         MNTA220EI1(oPrint,@i,@lin,nL01+969,nL01+1119,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1119,85,380,1)
         oPrint:Say(nL01+1139,nCOLP2  ,aARESTB[nPN6,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1201,85,210,1)
         oPrint:Say(nL01+1216,nCOLP2  ,aARESTB[nPN6,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1285,nL01+1310,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1310,85,380,1)
         oPrint:Say(nL01+1330,nCOLP2  ,aARESTB[nPN7,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1392,85,210,1)
         oPrint:Say(nL01+1407,nCOLP2  ,aARESTB[nPN7,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1476,nL01+1501,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1501,85,380,1)
         oPrint:Say(nL01+1521,nCOLP2  ,aARESTB[nPN8,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1583,85,210,1)
         oPrint:Say(nL01+1598,nCOLP2  ,aARESTB[nPN8,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1667,nL01+1692,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1692,85,380,1)
         oPrint:Say(nL01+1717,nCOLP2  ,aARESTB[nPN9,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1779,85,210,1)
         oPrint:Say(nL01+1794,nCOLP2  ,aARESTB[nPN9,If(nDESIGM = 2,1,4)],oFont11,,cCOR)

         MNTA220EI1(oPrint,@i,@lin,nL01+1866,nL01+1893,2,1,170,nLISOMA)

         MNTA220BX(oPrint,@i,@lin,nL01+1893,85,380,1)
         oPrint:Say(nL01+1913,nCOLP2  ,aARESTB[nPN0,3],oFont11)
         MNTA220BX(oPrint,@i,@lin,nL01+1975,85,210,1)
         oPrint:Say(nL01+1990,nCOLP2  ,aARESTB[nPN0,If(nDESIGM = 2,1,4)],oFont11,,cCOR)
         nUTLIN := Max(nUTLIN,2750)
      Endif
   Endif
   nCOLP2 := nCOLP2 + 420
Next xl

If nVLEG = 2
   nLIN := nUTLIN+70
   If nLIN > 2350
      nPAG   += 1
      nUTLIN := 0
      oPrint:EndPage()
      oPrint:StartPage()
      cPAGI := STR0104+" "+Str(nPAG,2)+"    "+chora
      oPrint:Say(10,2000,cPAGI,oFont14)
      nLIN := 60
   Endif

   // GERAR UMA MATRIZ COM OS DESENHO

   If nDESIGM <> 1
      cDESIGF := If(nDESIGM = 2,STR0021,STR0022) //"LOCALIZACAO","FAMILIA"
      aDESIGF := {}
      For h2 := 1 To Len(aARESTB)
         cCODESIG := If(nDESIGM = 2,aARESTB[h2][1],aARESTB[h2][4])
         If ASCAN(aDESIGF,{|x| x[1] == cCODESIG}) = 0
             Aadd(aDESIGF,{cCODESIG})
          Endif
      Next h2
   Endif

   oPrint:Say(nLIN,040,STR0086,oFont18) //"LEGENDA"

   nLIN := nLIN + 90
   oPrint:Say(nLIN,040,Upper(STR0001),oFont14) //"RODADOS"

   If nDESIGM <> 1
      oPrint:Say(nLIN,1540,Upper(cDESIGF),oFont14,,cCOR)
   Endif

   nLIN := nLIN + 50
   For hh := 1 To Len(aARESTB)
      If nLIN > 2350
         nPAG   += 1
         oPrint:EndPage()
         oPrint:StartPage()
         cPAGI := STR0104+" "+Str(nPAG,2)+"    "+chora
         oPrint:Say(10,2000,cPAGI,oFont14)
         oPrint:Say(40,040,Upper(STR0001),oFont14) //"RODADOS"
         nLIN  := 90
      Endif

      If !Empty(aARESTB[hh][3])
         oPrint:Say(nLIN,040,aARESTB[hh][3],oFont11)
         oPrint:Say(nLIN,402,"- "+NGSEEK("ST9",aARESTB[hh,3],1,"T9_NOME"),oFont11)
      Endif

      If nDESIGM <> 1
         If hh <= Len(aDESIGF)
            oPrint:Say(nLIN,1540,aDESIGF[hh,1],oFont11,,cCOR)
            If nDESIGM = 2
               oPrint:Say(nLIN,1700,"- "+NGSEEK("TPS",aDESIGF[hh,1],1,"TPS_NOME"),oFont11,,cCOR)
            Else
               oPrint:Say(nLIN,1700,"- "+NGSEEK("ST6",aDESIGF[hh,1],1,"T6_NOME"),oFont11,,cCOR)
            Endif
         Endif
      Endif
      nLIN := nLIN + 40
   Next hh
Endif

oPrint:EndPage()
oPrint:Preview()


Return Nil

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230COM³ Autor ³ In cio Luiz Kolling   ³ Data ³25/05/05  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Composicao do compomente da estrutura                       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTA230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230COM()
Local cVARLE := ReadVar()
Local oDlgl

If cVARLE = NIL .Or. Empty(cVARLE)
   MsGstop(STR0087) //"Nao foi selecionado o rodado..."
   Return .t.
Endif
If Empty(&(cVARLE))
   MsGstop(STR0088) //"Rodado nao localizado na estrutura..."
   Return .t.
Endif
nPOSLE := ASCAN(aARRAYTRB,{|x| x[2] == cVARLE})
If nPOSLE > 0
   Dbselectarea("ST9")
   Dbsetorder(1)
   Dbseek(xFilial('ST9')+aARRAYTRB[nPOSLE][3])
   Dbselectarea("TPS")
   Dbsetorder(1)
   Dbseek(xFilial('TPS')+aARRAYTRB[nPOSLE][1])
   Dbselectarea("ST6")
   Dbsetorder(1)
   Dbseek(xFilial('ST6')+aARRAYTRB[nPOSLE][4])
   DEFINE MSDIALOG oDlgl TITLE STR0089 From 30,20 To 34.5,80 OF oMainWnd //"Composicao do rodado do esquema"
   @.2 ,.5 SAY STR0090+Alltrim(aARRAYTRB[nPOSLE][3])+'  -  '+st9->t9_nome //"Rodado.........: "
   @.9 ,.5 SAY STR0091+Alltrim(aARRAYTRB[nPOSLE][4])+'  -  '+st6->t6_nome //"Familia...........: "
   @1.6,.5 SAY STR0092+Alltrim(aARRAYTRB[nPOSLE][1])+'  -  '+tps->tps_nome //"Localiz..........: "
   ACTIVATE MSDIALOG oDlgl CENTERED
Endif
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230BOX³ Autor ³ In cio Luiz Kolling   ³ Data ³04/12/2002³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Monta uma caixa ( box )                                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MNTA230                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230BOX(nLII,nLIF)
@ nLII,nCOL To nLIF,nCOL+6
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230GE1³ Autor ³ In cio Luiz Kolling   ³ Data ³          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Monta a Ligacao dos eixos com dois rodados                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230GE1()
If !lSTEPEI
   nLIE1 := If (nDESIGM = 1,5.6 ,6.85)
   nLIE2 := If (nDESIGM = 1,8.1 ,8.48)
   @ nLIE1,nCOL+3.2 to nLIE2,nCOL+3.4
Endif
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MONTARTRB1³ Autor ³ In cio Luiz Kolling   ³ Data ³          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Monta uma array com as localizacao,var. Get,rodados         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MONTARTRB1(nVPAR,cVPNEU)
nPOST := ASCAN(aARRAYTRB,{|x| x[1] == aARRAPTQ1[XW][nVPAR]})
If nPOST > 0
   aARRAYTRB[nPOST][2] := cVPNEU
Endif
Return .t.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MNTA230GE2³ Autor ³ In cio Luiz Kolling   ³ Data ³          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Monta a Ligacao dos eixos com quatro rodados                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³                                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MNTA230GE2()
If !lSTEPEI
   nLIE11 := If (nDESIGM = 1,4.7 ,5.20)   // prim
   nLIE12 := If (nDESIGM = 1,5.2 ,5.7)
   nLIE21 := If (nDESIGM = 1,5.6 ,6.85)   // seq
   nLIE22 := If (nDESIGM = 1,8.0 ,8.48)
   nLIE31 := If (nDESIGM = 1,8.4 ,9.65)   // ter
   nLIE32 := If (nDESIGM = 1,8.9 ,10.10)
   @ nLIE11,nCOL+3.1 to nLIE12,nCOL+3.4
   @ nLIE21,nCOL+3.1 to nLIE22,nCOL+3.4
   @ nLIE31,nCOL+3.1 to nLIE32,nCOL+3.4
Endif
Return .t.
