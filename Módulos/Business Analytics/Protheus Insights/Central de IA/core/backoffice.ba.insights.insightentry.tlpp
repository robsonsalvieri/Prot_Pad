#Include "tlpp-core.th"
#include 'totvs.ch'

NAMESPACE totvs.protheus.backoffice.ba.insights

Class InsightEntry
    
    Public Data cBranch                As Character
    Public Data cInsightUuid           As Character
    Public Data cMsgUuid               As Character
    Public Data cInsightName           As Character
    Public Data cPayload               As Character
    Public Data cModulo                As Character
    Public Data cKey                   As Character
    Public Data cFilter                As Character
    Public Data cMsgInsight            As Character
    Public Data cDtProcess             As Character
    Public Data cVersaoProcess         As Character
    Public Data cStatus                As Character
    Public Data cDescStatus            As Character
    Public Data cDtReprocess           As Character
    Public Data cVersaoReprocess       As Character
    Public Data cError                 As Character
    
    Public Data dDataDe                As Date
    Public Data dDataAte               As Date

    Public Data lHasError              As Logical

    Public Method New() Constructor
    Public Method Insert(lReprocess As Logical) As Logical
    
EndClass

Method New() Class InsightEntry
    ::cInsightUuid := FWUUIDV1(.T.)
Return Self

Method Insert(lReprocess As Logical) As Logical Class InsightEntry
    
    Local aArea                 As Array
    Local aAreaI21 := {}        As Array
    Local lRet := .F.           As Logical
    
    Default lReprocess := .F.    
    
    aArea := GetArea()

    dbSelectArea("I21")
    aAreaI21 := I21->(GetArea())

    I21->(RecLock("I21", .T.))
        
        I21->I21_FILIAL := xFilial("I21")
        I21->I21_BRANCH := ::cBranch
        I21->I21_UIDINS := ::cInsightUuid
        I21->I21_UIDMSG := ::cMsgUuid
        I21->I21_INSIGT := ::cInsightName
        I21->I21_MODULO := ::cModulo
        I21->I21_PAYLOD := ::cPayload
        I21->I21_KEY    := ::cKey
        I21->I21_FILTER := ::cFilter
        I21->I21_DTDE   := ::dDataDe
        I21->I21_DTATE  := ::dDataAte
        I21->I21_DTPROC := ::cDtProcess
        I21->I21_VSPROC := ::cVersaoProcess
        I21->I21_STATUS := ::cStatus
        I21->I21_DESCST := ::cDescStatus
        
        If lReprocess
            I21->I21_DTREPR := ::cDtReprocess
            I21->I21_VSREPR := ::cVersaoReprocess
        EndIf

    I21->(MsUnlock())

    I21->(RestArea(aAreaI21))
    RestArea(aArea)
    lRet := .T.    

Return lRet
