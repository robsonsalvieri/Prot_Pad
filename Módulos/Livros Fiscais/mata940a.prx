#INCLUDE "PROTHEUS.CH"
#INCLUDE "MATA940A.CH"
Static __cTrbName
Static __cDest

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Programa  ³MATA940   ³ Autor ³Nereu Humberto Jr      ³ Data ³12.12.2002³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Preparacao do meio-magnetico para o Sintegra - CONV 69/02   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³Nenhum                                                      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³Nenhum                                                      ³±±
±±³          ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³   DATA   ³ Programador   ³Manutencao Efetuada                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³          ³               ³                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MATA940a()

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Salva a Integridade dos dados de Entrada                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local aSave:={Alias(),IndexOrd(),Recno()}
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define variaveis                                             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local	nOpc		:=	1
Local 	cTitulo		:=	""
Local 	cText1		:=	""
Local	cText2		:=	""
Local	cText3		:=	""
Local 	aSays		:=	{}
Local 	aButtons	:=	{}
Local 	cCadastro	:=	STR0004 //" LIVROS EM DISQUETE "
Local 	aAreaSm0	:=	SM0->(GetArea ())
Local	nForFilial	:=	0
Local	aFilsCalc	:=	{}
Local	aFilsOk		:=	{}

Private cPerg		:=	"MTA94A"
Private lEnd		:=	.F.
Private lSamePar	:=	.F.
//Valores nProcFil (mv_par01)
//0=Somente filial corrente; 1=Varias filiais em um arquivo; 2=Varias filiais em varios arquivos
Private nProcFil	:=	0
Private lAutomato 	:= IsBlind()

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Janela Principal                                             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
cTitulo	:=	STR0005 //"Arquivo Magn‚tico"
cText1	:=	STR0006 //"Este programa gera arquivo pr‚-formatado dos lan‡amentos fiscais para  entrega"
cText2	:=	STR0007 //"Secretarias de Fazenda Estaduais (SINTEGRA versao 2.4 e posteriores)."
cText3	:=	STR0008 //"Convenio ICMS 31/99."

While .T.
	AADD(aSays,OemToAnsi( ctext1 ) )
	AADD(aSays,OemToAnsi( cText2 ) )
	AADD(aSays,OemToAnsi( cText3 ) )
	AADD(aButtons, { 5,.T.,{|| Pergunte("MTA94F",.T. ) } } )
	AADD(aButtons, { 1,.T.,{|o| nOpc:= 1,o:oWnd:End()}} )
	AADD(aButtons, { 2,.T.,{|o| o:oWnd:End() }} )

	If !lAutomato
		FormBatch( cCadastro, aSays, aButtons )
	EndIf
	
	Do Case
	Case nOpc==1
	
		Pergunte("MTA94F",.F.)
		nProcFil	:= Iif(mv_par01 == 1,Iif(mv_par03 == 1,1,2),0)
		lSamePar	:= (mv_par02 == 1)
		aFilsCalc	:= MatFilCalc(nProcFil>0)
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Processamento por filiais ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		For nForFilial := 1 To Len(aFilsCalc)
			If aFilsCalc[nForFilial,1]
				AADD(aFilsOk,aFilsCalc[nForFilial])
			EndIf
		Next nForFilial
		
		If Empty(aFilsOk)
			Return
		Else
			Pre940aProc(aFilsOk,aAreaSM0)
		EndIf
	
	Case nOpc==3
		Pergunte("MTA94F",.t.)
		Loop
	EndCase
	Exit
End
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Restaura area                                                ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(aSave[1])
dbSetOrder(aSave[2])
MsGoto(aSave[3])

RestArea(aAreaSM0)
cFilAnt := SM0->M0_CODFIL

Return

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³Pre940aProc³ Autor ³ Liber De Esteban     ³ Data ³ 28/08/08 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Funcao de pre-processamento.                               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³aFilsOk - Array com as filiais a serem processadas          ³±±
±±³          ³aAreaSM0 - GetArea do SM0, para restauracao                 ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function Pre940aProc(aFilsOk,aAreaSM0)

Local	nForFilial	:=	0
Local	lCreate 	:= .T.
Local	lPerg		:= .T.

Private aReturn 	:=	{STR0009, 1,STR0010, 2, 2, 1, "",1 } //"Zebrado"###"Administra‡„o"
Private Nomeprog	:=	"MATA940"
Private wnrel	 	:=	NomeProg
Private lcArq088 	:=	existBlock("M940TP88")
Private	nHandle  	:= -1

Private	dDtIni
Private dDtIni2
Private	dDtFim
Private	cDisco
Private	cArqTxt
Private	cEquip
Private	nMeioMag
Private	cDensGrv
Private	cFatBloc
Private	cEstDest
Private	lListEst
Private	cNrLivro
Private	lCupons
Private	cFinalid
Private	nNumReg
Private cCodMun

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Contadores de registros para gravar no registro 90           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Private nReg50	:= 0
Private nReg51	:= 0
Private nReg53	:= 0
Private nReg54	:= 0
Private nReg55	:= 0
Private nReg60	:= 0
Private nReg61	:= 0
Private nReg70	:= 0
Private nReg71	:= 0
Private nReg74	:= 0
Private nReg75 	:= 0
Private nReg88 	:= 0
Private nReg90	:= 1
Private nValMPI	:= 0
Private nValMPF	:= 0
Private nValPAI	:= 0
Private nValPAF	:= 0
Private nValISI	:= 0
Private nValISF	:= 0
Private nValANI	:= 0
Private nValANF	:= 0
Private nReg88C	:= 0
Private nReg88D	:= 0
Private nReg88E	:= 0
Private nReg88M	:= 0
Private nReg88Q	:= 0
Private nVal88St:= 0

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Variaveis para arquivo temporario para armazenar registros   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Private cArq050
Private cArq050A
Private cArq051
Private cArq053
Private cArq054
Private cArq055
Private cArq60M
Private cArq60A
Private cArq60R
Private cArq061
Private cArq61R
Private cArq070
Private cArq071
Private cArq074
Private cArq075
Private cArq088
Private cArqD10
Private cArqAD4
Private cArq08801
Private cArq08802
Private cArq08850
Private cArq088C
Private cArq088D
Private cArq088A
Private cArq088E
Private cArq088M
Private cArq088Q
Private cArq090
Private cArq060M
Private cArq060A
Private cArq060A2
Private cArq060D
Private cArq060I
Private cArq060R
Private cArq076
Private cArq077
Private cArqR88 
Private cArqR82 
Private cArqR83

For nForFilial := 1 To Len(aFilsOk)
	//Posiciona filial para processamento
	cFilAnt := aFilsOk[nForFilial,2]
	SM0->(DbSeek (cEmpAnt+cFilAnt, .T.))
	
	If nForFilial == 1 .Or. nProcFil == 2
		CreateTbl()
		lCreate := .T.
	Else
		lCreate := .F.
	EndIf
	
	Processa({|| a940AProcessa(lCreate,@lPerg) },,,@lEnd)
	
	If nProcFil < 2
		RestArea(aAreaSM0)
		cFilAnt := SM0->M0_CODFIL
	Endif
	
	If nForFilial == len(aFilsOk) .Or. nProcFil == 2
		
		a940AGeraTxt()
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Fecha arquivo texto                                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If nHandle >= 0
			FClose(nHandle)
		Endif
		
		IF __cDest != Nil
			__CopyFIle(__cTrbName,__cDest)
			FERASE(__cTrbName)
		Endif
		
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Gera Listagem                                               ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If !lEnd .AND. !lAutomato
			a940ARelat()
		Endif
	
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Apaga arquivos temporarios               ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		a940ADelArq({ {cArq050,"R50"},{cArq051,"R51"},{cArq053,"R53"},{cArq054,"R54"},{cArq055,"R55"},;
		         {cArq060M,"M60"},{cArq060A,"A60"},{cArq060D,"D60"},{cArq060I,"I60"},{cArq060R,"R60"},;
		         {cArq061,"R61"},{cArq070,"R70"},{cArq071,"R71"},{cArq074,"R74"},{cArq075,"R75"},{cArq076,"R76"},;
		         {cArq077,"R77"},{cArqR88,"R88"},{cArqR82,"R82"},{cArqR83,"R83"},{cArq090,"R90"} })
	
	EndIf
	
Next

Return

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ A940AProcessa                                              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Funcao principal de processamento.                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ lCreate = Flag Indicando criacao dos arquivos temporarios  ³±±
±±³          ³ lPerg = Flag Indicando apresentacao das perguntas          ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
STATIC FUNCTION A940AProcessa(lCreate,lPerg)

Local aAreaSint := GetArea()
Local lQuery    := .F.
Local lFirst    := .T.
Local lCupom    := .T.	
Local nItem     := 0
Local nX        := 0
Local nI        := 0
Local nAliqICM  := 0
Local nPosAliq  := 0
Local nAliqIte  := 0
Local nBRetido  := 0
Local nRedBase  := 0
Local cSitTrib  := ""
Local cSeek     := ""
Local cCNPJ     := ""
Local cIE       := ""
Local cTranspCGC:= ""
Local cTranspIns:= ""
Local cAliasSD1 := "SD1"
Local cAliasSD2 := "SD2"
Local cAliasSF1 := "SF1"
Local cAliasSF2 := "SF2"
Local cAliasSF3 := "SF3"
Local cAliasSF6 := "SF6"
Local cAliasSFI := "SFI"
Local cTranspEst:=	""
Local cChave    := ""
Local cChaveAux := ""
Local cChaveAux2:= ""
Local cQuery    := ""
Local cNcm      := ""
Local cProd     := ""
Local cCpVlPisEn:= ""
Local cCpVlPisSa:= ""
Local aArray71  := ""
Local nValPis   := 0
Local nPsVlPisEn:= 0
Local nPsVlPisSa:= 0
Local aArrayF3  := {}
Local aStruSF3  := {}
Local cSintegra := SuperGetMv("MV_SINTEG")
Local cDesCfop	:= GetDesCFOP()	//Desconsidera Cfop's
Local cCodSEFMG := SuperGetMv("MV_CODSEF")
Local aMovimen  :={}
Local cCfoSint  := ""   
Local lMtaTIP71	:=	ExistBlock("MTATIP71")
Local cCodProd := ""
Local aEstMPI  := {}       
Local aEstMPF  := {}       
Local aEstPAI  := {}
Local aEstPAF  := {}
Local aEstISI  := {}
Local aEstISF  := {}
Local aEstANI  := {}
Local aEstANF  := {}
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define variaveis                                             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local cAlias		:=	Alias()
Local aListBox		:= {}
Local aSel			:= {}
Local aMsg			:= {}
Local aValid		:= {}
Local aConteudo	:= {}
Local aSvConteudo := {}
Local cTitulo1		:= ""
Local cTitulo2		:= ""
Local cSuframa    := "" 
Local nValFrete   := 0
Local cAIDF   		:=GetNewPar("MV_DICAIDF","")
Local aAIDF			:= &(cAIDF)
Local lAIDF 		:= IIf(ValType(aAIDF)=="A",IIf(Len(aAIDF)==2,.T.,.F.),.F.)
Local nSFI			:= 0
Local aTms        := {}
Local nTms        := 0
Local lMtReg71    := Existblock("MTREG71")
Local cAliasDT6   := "DT6"
Local aStru074    := {}
Local aStru088    := {} 
Local aStru082    := {}
Local aStru083    := {}

Local lTms        := IntTms ()
Local aCodRem     := {}
Local cCod_Mun    := ""
Local cCodDP      := StrZero(val(Alltrim(SuperGetMv("MV_CODDP"))),5,0)
Local dDtEntr     := ""

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Carrega Parametros                                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Pergunte(cPerg,lPerg)
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ mv_par01 - Data Inicial                                      ³
//³ mv_par02 - Data Final                                        ³
//³ mv_par03 - Drive Destino                                     ³
//³ mv_par04 - Nome do Arquivo .TXT                              ³
//³ mv_par05 - Equipamento utilizado                             ³
//³ mv_par06 - Meio magnetico utilizado (FITA/DISQUETE)          ³
//³ mv_par07 - Densidade de gravacao                             ³
//³ mv_par08 - Fator de Bloco de gravacao                        ³
//³ mv_par09 - Estado de Orig./Destino                           ³
//³ mv_par10 - Listar Estado                                     ³
//³ mv_par11 - Nr.do Livro                                       ³
//³ mv_par12 - Cupons Fiscais                                    ³
//³ mv_par13 - Entradas/Saidas/Ambos                             ³
//³ mv_par14 - Finalidade                                        ³
//³ mv_par15 - Versao do Validador                               ³
//³ mv_par16 - Codigo Municipio   								 ³
//³ mv_par17 - Centralizadora     								 ³
//³ mv_par18 - Ano AIDF           								 ³
//³ mv_par19 - Numero AIDF        								 ³
//³ mv_par20 - Gerar GAM57 - MG                                  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dDtIni		:=	mv_par01
dDtFim		:=	mv_par02
cDisco		:=	Upper(mv_par03)
cArqTxt		:=	Alltrim(mv_par04)
cEquip		:=	mv_par05
nMeioMag	:=	mv_par06
cDensGrv	:=	mv_par07
cFatBloc	:=	mv_par08
cEstDest	:=	mv_par09
lListEst	:=	(mv_par10==1)
cNrLivro	:=	mv_par11
lCupons		:=	(mv_par12==2)
cFinalid 	:=	str(mv_par14,1)
nNumReg		:=	A940ANumReg(nMeioMag)
cCodMun   	:=  mv_par16
dDtIni2   	:=	dDtIni
If mv_par20 == 1
	lCupons	:=.F.
EndIf

If Empty(cSintegra)
    cCfoSint := "592/695"
Else
    cCfoSint :=cSintegra
Endif

If MV_PAR15 == 3
	A940LoadDIC(@aListBox,@aSel,@aMsg,@aValid)
	aConteudo 	:= AFisLoadCFP("DIC.CFP",aListBox)
	aSvConteudo	:= Aclone(aConteudo)
	cTitulo2  	:= STR0073	//"DIC-SE"
	cTitulo1    := STR0074 //" Configuracao dos codigos das Contas contabeis"
	cTexto1		:= STR0075
	cTexto2		:= STR0076
	If lPerg .AND. !lAutomato
		AFisIns(cTitulo1+" "+cTitulo2,cTexto1,cTexto2,@aListBox,@aConteudo,;
				aSel,aValid,aMsg,"DIC.CFP",cTitulo2,aSvConteudo)	
	EndIf
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Selecao do arquivo SFI por demanda                                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SFI")
dbGoTop()

If mv_par21==1
   GrEstR74(lCreate)
   If mv_par21 == 1 .and. MV_PAR15 == 3 .and. Month(dDtFim) == 1
      dbSelectArea("SB1")
      dbSetOrder(1)
      DbGoTop()

      While !eof()
            cCodProd:= B1_COD
            aEstMPI := IIF(B1_TIPO == "MP" .AND. B1_ORIGEM $ "00/01/10/20/50/51/60/70",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-2,4)+"1231")),"")
            aEstPAI := IIF(B1_TIPO == "PA" .AND. B1_ORIGEM $ "00/01/10/20/50/51/60/70",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-2,4)+"1231")),"")
            aEstISI := IIF(B1_ORIGEM $ "04",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-2,4)+"1231")),"")
            aEstANI := IIF(B1_ORIGEM $ "06",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-2,4)+"1231")),"")            
            aEstMPF := IIF(B1_TIPO == "MP" .AND. B1_ORIGEM $ "00/01/10/20/50/51/60/70",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-1,4)+"1231")),"")
            aEstPAF := IIF(B1_TIPO == "PA" .AND. B1_ORIGEM $ "00/01/10/20/50/51/60/70",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-1,4)+"1231")),"")
            aEstISF := IIF(B1_ORIGEM $ "04",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-1,4)+"1231")),"")
            aEstANF := IIF(B1_ORIGEM $ "06",FsPrdInv(cCodProd,.F.,StoD(strzero(YEAR(dDtFim)-1,4)+"1231")),"")            
            IIF(valtype(aEstMPI)=="A",nValMPI+=aEstMPI[1][2]+aEstMPI[2][2]+aEstMPI[3][2],.T.)
            IIF(valtype(aEstMPF)=="A",nValMPF+=aEstMPF[1][2]+aEstMPF[2][2]+aEstMPF[3][2],.T.)
            IIF(valtype(aEstPAI)=="A",nValPAI+=aEstPAI[1][2]+aEstPAI[2][2]+aEstPAI[3][2],.T.)
            IIF(valtype(aEstPAF)=="A",nValPAF+=aEstPAF[1][2]+aEstPAF[2][2]+aEstPAF[3][2],.T.)
            IIF(valtype(aEstISI)=="A",nValISI+=aEstISI[1][2]+aEstISI[2][2]+aEstISI[3][2],.T.)
            IIF(valtype(aEstISF)=="A",nValISF+=aEstISF[1][2]+aEstISF[2][2]+aEstISF[3][2],.T.)
            IIF(valtype(aEstANI)=="A",nValANI+=aEstANI[1][2]+aEstANI[2][2]+aEstANI[3][2],.T.)
            IIF(valtype(aEstANF)=="A",nValANF+=aEstANF[1][2]+aEstANF[2][2]+aEstANF[3][2],.T.)
            DbSkip()
      EndDo
   EndIf   
Else
	If lCreate
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Registro 074 - Registro de Inventario                                   ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		
		AADD(aStru074,{"A74_DTINVE"	,"D",008,0})
		AADD(aStru074,{"A74_PRODUT"	,"C",014,0})
		AADD(aStru074,{"A74_QUANT"	,"N",013,3})
		AADD(aStru074,{"A74_CUSTO"	,"N",013,2})
		AADD(aStru074,{"A74_SITUAC"	,"C",001,0})
		AADD(aStru074,{"A74_CNPJ"	,"C",014,0})
		AADD(aStru074,{"A74_IE"  	,"C",014,0})
		AADD(aStru074,{"A74_UF"  	,"C",002,0})
		
		cArq074  :=	CriaTrab(aStru074)
		dbUseArea(.T.,__LocalDriver,cArq074,"R74")
		IndRegua("R74",cArq074,"DTOS(A74_DTINVE)")
	EndIf
Endif   

If mv_par26 == 2
//cria tabela R88 detalhe 81
	AADD(aStru088,{"R88_ESTADO"		,"C",002,0})
	AADD(aStru088,{"R88_MUNIC" 		,"C",005,0})
	AADD(aStru088,{"R88_CFOP"		,"C",004,0})
	AADD(aStru088,{"R88_CFOPET"		,"C",002,0})
	AADD(aStru088,{"R88_VALCON"		,"N",013,2})
	AADD(aStru088,{"R88_BASICM"		,"N",013,2})
	AADD(aStru088,{"R88_VALICM"  	,"N",013,2})
	AADD(aStru088,{"R88_ISEICM"  	,"N",013,2})
	AADD(aStru088,{"R88_OUTICM"  	,"N",013,2})
	AADD(aStru088,{"R88_ALQICM"  	,"N",005,2})
	AADD(aStru088,{"R88_ICMRET"  	,"N",013,2})
			
	cArqR88  :=	CriaTrab(aStru088)
	dbUseArea(.T.,__LocalDriver,cArqR88,"R88")
	IndRegua("R88",cArqR88,"R88_ESTADO+R88_MUNIC+R88_CFOP+STRZERO(R88_ALQICM,4)") 
		
	//cria tabela R88 detalhe 82
  	AADD(aStru082,{"R82_IE"		    ,"C",014,0})
	AADD(aStru082,{"R82_DTINCO" 	,"D",008,0})
	AADD(aStru082,{"R82_UF"	  		,"C",002,0})
	AADD(aStru082,{"R82_MODINC"		,"C",002,0})
	AADD(aStru082,{"R82_SERINC"		,"C",TamSx3("D1_SERIE")[1],0})
	AADD(aStru082,{"R82_SDOCC"		,"C",003,0})
	AADD(aStru082,{"R82_NFINC"		,"C",006,0})
	AADD(aStru082,{"R82_CFOPEN"  	,"C",004,0})
	AADD(aStru082,{"R82_ALQINC"  	,"N",005,2})
	AADD(aStru082,{"R82_VLTINC"  	,"N",013,2})
	AADD(aStru082,{"R82_DIFALQ"  	,"N",013,2})
	AADD(aStru082,{"R82_DTDESI"  	,"D",008,0}) 
	AADD(aStru082,{"R82_MODDES"  	,"C",002,0})
	AADD(aStru082,{"R82_SERDES"  	,"C",TamSx3("D2_SERIE")[1],0})
	AADD(aStru082,{"R82_SDOCS"		,"C",003,0})
	AADD(aStru082,{"R82_NFDES"  	,"C",006,0})
	AADD(aStru082,{"R82_CFOPSA"  	,"C",004,0})	
	AADD(aStru082,{"R82_ALQDES"  	,"N",005,2})
	AADD(aStru082,{"R82_VLTDES"  	,"N",013,2})
					
	cArqR82  :=	CriaTrab(aStru082)
	dbUseArea(.T.,__LocalDriver,cArqR82,"R82")
	IndRegua("R82",cArqR82,"R82_IE+DtoC(R82_DTINCO)+R82_UF+R82_MODINC+R82_SERINC+R82_CFOPEN+STRZERO(R82_ALQINC,4)")
	IndRegua("R82",cArqR82,"DtoC(R82_DTDESI)+R82_MODDES+R82_SERDES+R82_CFOPSA+STRZERO(R82_ALQDES,4)")
	
	//cria tabela R88 detalhe 83
  	AADD(aStru083,{"R83_PDV"		,"C",003,0})
	AADD(aStru083,{"R83_SERIE"		,"C",015,0})
	AADD(aStru083,{"R83_VLGTIN"	  	,"N",016,2})
	AADD(aStru083,{"R83_VLGTFI"		,"N",016,2})
	AADD(aStru083,{"R83_DTMOV"		,"D",008,0})
					
	cArqR83  :=	CriaTrab(aStru083)
	dbUseArea(.T.,__LocalDriver,cArqR83,"R83")
	
	IndRegua("R83",cArqR83,"DtoC(R83_DTMOV)+R83_PDV")		
EndIf 

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Processamento dos documentos Fiscais                                    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SF3")
dbSetOrder(1)
ProcRegua(LastRec())
#IFDEF TOP
    If TcSrvType()<>"AS/400"
	    lQuery := .T.
		cAliasSF3 := "SF3_SINTEGRA"
		aStruSF3  := SF3->(dbStruct())
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SF3")+" "
		cQuery += "WHERE F3_FILIAL='"+xFilial("SF3")+"' AND "
		cQuery += "F3_ENTRADA>='"+Dtos(dDtIni)+"' AND "
		cQuery += "F3_ENTRADA<='"+Dtos(dDtFim)+"' AND "	
		If cNrLivro <> "*"
			cQuery += "F3_NRLIVRO ='"+ cNrLivro +"' AND "
		EndIf	
		If !Empty(cDesCfop)
			cQuery += "F3_CFO NOT IN('"+RetPar(cDesCfop)+"') AND "
		Endif
		If !Empty(cEstDest)
			If lListEst
				cQuery += "F3_ESTADO ='"+ cEstDest+"' AND "
			Else
				cQuery += "F3_ESTADO <>'"+ cEstDest+"' AND "
			EndIf
		EndIf			
		If mv_par13 == 1 	//Entrada
			cQuery	+=	"(F3_CFO LIKE '1%' OR F3_CFO LIKE '2%' OR F3_CFO LIKE '3%') AND "
		Elseif mv_par13 == 2 				//Saida
			cQuery	+=	"(F3_CFO LIKE '5%' OR F3_CFO LIKE '6%' OR F3_CFO LIKE '7%') AND "
		Endif            	
		cQuery += "F3_TIPO NOT IN('S') AND "
		If mv_par14 == 4
			cQuery += "F3_TIPO = 'D' AND "
			cQuery += "F3_CFO < '5' AND "
		Endif
		cQuery += "D_E_L_E_T_ = ' ' "
		cQuery += "ORDER BY "+SqlOrder(SF3->(IndexKey()))
	
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSF3)
	
		For nX := 1 To len(aStruSF3)
			If aStruSF3[nX][2] <> "C" 
				TcSetField(cAliasSF3,aStruSF3[nX][1],aStruSF3[nX][2],aStruSF3[nX][3],aStruSF3[nX][4])
			EndIf
		Next nX
		dbSelectArea(cAliasSF3)	
	Else
#ENDIF
	    cIndex    := CriaTrab(NIL,.F.)
	    cCondicao := 'F3_FILIAL=="'+xFilial("SF3")+'".And.'
	   	cCondicao += 'DTOS(F3_ENTRADA)>="'+DTOS(dDtIni)+'".And.DTOS(F3_ENTRADA)<="'+DTOS(dDtFim)+'" '
	    If cNrLivro <> "*"
		    cCondicao += '.And.F3_NRLIVRO ="'+ cNrLivro +'" '
	   	EndIf	
		If !Empty(cDesCfop)
			cCondicao += '.And. !(Alltrim(F3_CFO) $ "'+cDesCfop+'") '
		Endif
	    If !Empty(cEstDest)
		    If lListEst
			    cCondicao += '.And. F3_ESTADO ="'+ cEstDest+'" '
	  		Else
			    cCondicao += '.And. F3_ESTADO <> "'+ cEstDest+'" '
		    EndIf
	    EndIf			
	   	If mv_par13 == 1 	//Entrada
			cCondicao += '.And. Left(F3_CFO,1)$"1,2,3"'
		Elseif mv_par13 == 2 				//Saida
			cCondicao += '.And. Left(F3_CFO,1)$"5,6,7"'
		Endif            	
	    cCondicao += '.And. F3_TIPO <> "S" '
	    If mv_par14 == 4
	 	    cCondicao += '.And. F3_TIPO = "D" '
		    cCondicao += '.And. Substr(F3_CFO,1,1) < "5" '
	    Endif
	    IndRegua(cAliasSF3,cIndex,SF3->(IndexKey()),,cCondicao)
	    nIndex := RetIndex("SF3")
	    dbSelectArea("SF3")
		#IFNDEF TOP 
			dbSetIndex(cIndex+OrdBagExt())
		#ENDIF
	    dbSetOrder(nIndex+1)
	    dbSelectArea(cAliasSF3)
	    ProcRegua(LastRec())
	    dbGoTop()
#IFDEF TOP
	Endif    
#ENDIF

While (cAliasSF3)->(!Eof()) 

	IncProc(STR0004) //"Preparando Base de Dados 1/2"
	    
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica o cliente/fornecedor                                          ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If (SubStr((cAliasSF3)->F3_CFO,1,1)>="5" .And. (cAliasSF3)->F3_TIPO$"BD") .Or.;
	   (SubStr((cAliasSF3)->F3_CFO,1,1)<"5" .And. !(cAliasSF3)->F3_TIPO$"BD")
		
		dbSelectArea("SA2")
		dbSetOrder(1)
		MsSeek(xFilial("SA2")+(cAliasSF3)->F3_CLIEFOR+(cAliasSF3)->F3_LOJA)				
		cCNPJ := A940CNPJ(SA2->A2_CGC,SA2->A2_TIPO)
		cIE   := A940IE(SA2->A2_INSCR)
		cTranspCGC	:=	SA2->A2_CGC
		cTranspIns	:=	aRETDIG(SA2->A2_INSCR,.t.,(cAliasSF3)->F3_ESTADO)
		cTranspEst	:=	SA2->A2_EST
		cSuframa    := "00000000000000"
	    cCodMun 	:= Alltrim(SA2->&(GetNewPar("MV_940FOR")))
	Else
		dbSelectArea("SA1")
		dbSetOrder(1)				
		MsSeek(xFilial("SA1")+(cAliasSF3)->F3_CLIEFOR+(cAliasSF3)->F3_LOJA)
		cCNPJ := A940CNPJ(SA1->A1_CGC,SA1->A1_TIPO)			
		cIE   := A940IE(SA1->A1_INSCR)
		cTranspCGC	:=	SA1->A1_CGC
		cTranspIns	:=	aRETDIG(SA1->A1_INSCR,.t.,(cAliasSF3)->F3_ESTADO)
		cTranspEst	:=	SA1->A1_EST 
		cSuframa    := (strzero(val(SA1->A1_SUFRAMA)))
		cCodMun 	:= Alltrim(SA1->&(GetNewPar("MV_940CLI")))
	EndIf

	If mv_par20==1
	   nPos:=Ascan(aMovimen,{|x|x[1]==ALLTRIM(STR(MONTH((cAliasSF3)->F3_ENTRADA)))+ALLTRIM(STR(YEAR((cAliasSF3)->F3_ENTRADA)))})
	   If nPos==0
		  AADD(aMovimen,{ALLTRIM(STR(MONTH((cAliasSF3)->F3_ENTRADA)))+ALLTRIM(STR(YEAR((cAliasSF3)->F3_ENTRADA))),"OK"})
	   Endif
	Endif

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Gravacao do registro 51                                                ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If (Empty((cAliasSF3)->F3_ESPECIE) .Or. AModNot((cAliasSF3)->F3_ESPECIE)=="01" .Or. AModNot((cAliasSF3)->F3_ESPECIE)=="55") .And.;
			((cAliasSF3)->F3_VALIPI+(cAliasSF3)->F3_ISENIPI+(cAliasSF3)->F3_OUTRIPI)>0 .And. (cAliasSF3)->F3_TIPO <> "L"

		RecLock("R51",.T.)
		R51->A51_CNPJ	:=	cCNPJ
		R51->A51_IE		:=	cIE
		R51->A51_EMISS	:=	(cAliasSF3)->F3_ENTRADA
		R51->A51_UF		:=	(cAliasSF3)->F3_ESTADO
		R51->A51_SERIE	:=	(cAliasSF3)->F3_SERIE
		R51->A51_SDOC		:=	SerieNfId(cAliasSF3,2,"F3_SERIE")
		R51->A51_NFISC	:=	(cAliasSF3)->F3_NFISCAL
		R51->A51_CFOP	:=	(cAliasSF3)->F3_CFO
		R51->A51_VALTOT	:=	(cAliasSF3)->F3_VALCONT
		R51->A51_VALIPI	:=	(cAliasSF3)->F3_VALIPI
		R51->A51_ISENTA	:=	(cAliasSF3)->F3_ISENIPI
		R51->A51_OUTRAS	:=	(cAliasSF3)->F3_OUTRIPI
		R51->A51_SITUAC	:= IIf(("CANCELAD"$(cAliasSF3)->F3_OBSERV .Or.!empty((cAliasSF3)->F3_DTCANC)),"S","N")
		R51->A51_BASIPI := If((cAliasSF3)->F3_BASEIPI>0,(cAliasSF3)->F3_BASEIPI,(cAliasSF3)->F3_VALCONT)

		MsUnlock()
	EndIf
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Gravacao do registro 53                                                ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If 	((cAliasSF3)->F3_BASERET+(cAliasSF3)->F3_ICMSRET) > 0 .And.;
		(cAliasSF3)->F3_TIPO <> "L" .And. (cAliasSF3)->F3_ANTICMS <> "1"            

		RecLock("R53",.T.)
		R53->A53_CNPJ  	:=	cCNPJ
		R53->A53_IE		:=  cIE
		R53->A53_EMISS	:=	(cAliasSF3)->F3_ENTRADA
		R53->A53_UF		:=	(cAliasSF3)->F3_ESTADO
		R53->A53_MODELO	:=	AModNot((cAliasSF3)->F3_ESPECIE)
		R53->A53_SERIE	:=	(cAliasSF3)->F3_SERIE
		R53->A53_SDOC		:=	SerieNfId(cAliasSF3,2,"F3_SERIE")
		R53->A53_NFISC	:=	(cAliasSF3)->F3_NFISCAL
		R53->A53_CFOP	:=	(cAliasSF3)->F3_CFO
		R53->A53_EMIT   :=	IIf((cAliasSF3)->F3_FORMUL=="S".Or.SubStr((cAliasSF3)->F3_CFO,1,1)>="5","P","T")
		R53->A53_BRICMS	:=	(cAliasSF3)->F3_BASERET
		R53->A53_VALRET	:=	(cAliasSF3)->F3_ICMSRET
		R53->A53_DESPES	:=	(cAliasSF3)->F3_DESPESA
		R53->A53_SITUAC	:=	IIf(("CANCELAD"$(cAliasSF3)->F3_OBSERV .Or.!empty((cAliasSF3)->F3_DTCANC)),"S","N")
	    If Subs((cAliasSF3)->F3_CFO,1,1)$"5"
		   nVal88St  +=(cAliasSF3)->F3_ICMSRET
        Endif
		MsUnlock()
	EndIf	
    
	dbSelectArea(cAliasSF3)
	cChave := (cAliasSF3)->F3_NFISCAL+(cAliasSF3)->F3_SERIE+(cAliasSF3)->F3_CLIEFOR+(cAliasSF3)->F3_LOJA
	Aadd(aArrayF3,{;
	(cAliasSF3)->F3_NFISCAL,;  //1
	(cAliasSF3)->F3_SERIE,;      //2
	(cAliasSF3)->F3_CLIEFOR,;    //3
	(cAliasSF3)->F3_LOJA,;       //4
	(cAliasSF3)->F3_CFO,;        //5
	(cAliasSF3)->F3_TIPO,;       //6
	(cAliasSF3)->F3_ESPECIE,;
	(cAliasSF3)->F3_ALIQICM,;
	(cAliasSF3)->F3_PDV,;
	(cAliasSF3)->F3_EMISSAO,;//10
	(cAliasSF3)->F3_ICMSRET,;
	(cAliasSF3)->F3_ISENICM,;
	(cAliasSF3)->F3_DTCANC,;
	(cAliasSF3)->F3_CODISS,;
	(cAliasSF3)->F3_OUTRICM,;
	(cAliasSF3)->F3_VALICM,;
	(cAliasSF3)->F3_VALCONT,;
	(cAliasSF3)->F3_EMISSAO,;//18
	(cAliasSF3)->F3_BASEICM,;
	(cAliasSF3)->F3_OBSERV,;
	(cAliasSF3)->F3_FORMUL,;
	(cAliasSF3)->F3_ESTADO,;
	(cAliasSF3)->F3_DESPESA,;
	(cAliasSF3)->F3_FORMULA,;
	cCodMun,;
	(cAliasSF3)->F3_CONTA,;
	cSuframa,;
	nValFrete,;
	(cAliasSF3)->F3_CFOEXT,;
 	"",;	//30 - Ano da AIDF - DIC-SE
 	"",;						//31 - Numero da AIDF - DIC-SE
 	(cAliasSF3)->F3_BASERET,; //32 - F3_BASERET
 	(cAliasSF3)->F3_FILIAL,; //33 - F3_FILIAL
 	(cAliasSF3)->F3_ENTRADA,;//34 - F3_ENTRADA
 	(cAliasSF3)->F3_ANTICMS,; //35 Antecipacao de ICMS 
 	SerieNfId(cAliasSF3,2,"F3_SERIE") }) //36 - Serie do documento fiscal
 	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Implementacao DIC-SE                                                   ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If lAIDF
		If SF3->(FieldPos(aAIDF[1])) > 0	//Ano da AIDF - DIC-SE
		aArrayF3[Len(aArrayF3)][30] := &(aAIDF[1])
		Endif
		If SF3->(FieldPos(aAIDF[2])) > 0 	//Numero da AIDF - DIC-SE
			aArrayF3[Len(aArrayF3)][31] := &(aAIDF[2])
		Endif
	Endif
	
	dbSkip()
	
	If cChave <> (cAliasSF3)->F3_NFISCAL+(cAliasSF3)->F3_SERIE+(cAliasSF3)->F3_CLIEFOR+(cAliasSF3)->F3_LOJA
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Monta Registro Tipo 54 e Registro Tipo 75 ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If (Empty(aArrayF3[1][7]).Or. AModNot(aArrayF3[1][7])$"01/02/04/55") .And. aArrayF3[1][6] <> "L"

			If Substr(aArrayF3[1][5],1,1)<"5" .And. (Empty(aArrayF3[1][7]) .Or. AModNot(aArrayF3[1][7])=="01" .Or. AModNot(aArrayF3[1][7])=="55")
			    SF1->( dbSetOrder(1) )
				SF1->( MsSeek(xFilial("SF1")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]))

				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ Registro adicional para Frete,Seguro e Outras Despesas       ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				If SF1->(!Eof()) 
					For nI := 1 to 4
						If nI == 4
							aRelImp	   := MaFisRelImp("MT100",{ "SF1" })
							nPsVlPisEn := 0
							nValPis    := 0
							If !Empty( nScanPis := aScan(aRelImp,{|x| x[1]=="SF1" .And. x[3]=="NF_VALPS2"} ) )
								cCpVlPisEn := aRelImp[nScanPis,2]
								nPsVlPisEn := SF1->(FieldPos(cCpVlPisEn))
							EndIf 	
							If !Empty( nPsVlPisEn ) 
								nValPis := SF1->( FieldGet( nPsVlPisEn ) )
							EndIf
						Endif
						If (nI == 1 .And. SF1->F1_FRETE > 0) .Or.;
						   (nI == 2 .And. SF1->F1_SEGURO > 0) .Or.;
						   (nI == 3 .And. SF1->F1_DESPESA > 0) .Or.;
						   (nI == 4 .And. nValPis > 0)
							dbSelectArea("R54")
							If !MsSeek(cCNPJ+aArrayF3[1][2]+aArrayF3[1][1]+IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993"))))
								RecLock("R54",.T.)
								R54->A54_CNPJ    := cCNPJ
								R54->A54_MODELO  := AModNot(aArrayF3[1][7])
								R54->A54_SERIE   := aArrayF3[1][2]
								R54->A54_SDOC    := aArrayF3[1][36]
								R54->A54_NFISC   := aArrayF3[1][1]
								R54->A54_CFOP    := aArrayF3[1][5]
							    R54->A54CFOPEXT :=	aArrayF3[1][29]
								R54->A54_CST     := "   "
								R54->A54_NUMITE  := IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993"))) //Numero do Item (991-Frete;992 -Seguro;999-Outras despesas acessorias;993-PIS/COFINS)
								R54->A54_QUANT   := 1
								R54->A54_VALPRO  := IIf(nI==1,SF1->F1_FRETE,If(nI==2,SF1->F1_SEGURO,If(nI==3,SF1->F1_DESPESA,nValPis)))
								R54->A54_VALDES  := R54->A54_VALPRO
                                R54->A54_ALQICM  := IIf(nI==4,aArrayF3[1][8],0)
								MsUnlock()  

								If mv_par20==1					
									RecLock(cArq088C,.T.)
									(cArq088C)->A88CNFISC	:=	aArrayF3[1][1]
									(cArq088C)->A88CSERIE	:=	aArrayF3[1][2]
									(cArq088C)->A88CSDOC		:=	aArrayF3[1][36]
									(cArq088C)->A88CCNPJ	:=	cCNPJ
									(cArq088C)->A88CMODELO	:=	AModNot(aArrayF3[1][7])
									(cArq088C)->A88CCFOP	:=	aArrayF3[1][5]
									(cArq088C)->A88CNUMITE	:= IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993"))) //Numero do Item (991-Frete;992 -Seguro;999-Outras despesas acessorias;993-PIS/COFINS)
									(cArq088C)->A88CQUANT	:= 	1
									(cArq088C)->A88CBASEST	:=0.00
									(cArq088C)->A88CVALBSR	:=0.00
									(cArq088C)->A88CVALBSC	:=0.00
									MsUnlock()
								Endif
								
							EndIf
					    Endif
					Next	   
				EndIf

				SD1->( dbSetOrder(1))

				#IFDEF TOP
				    If TcSrvType()<>"AS/400"
					    cAliasSD1 := "a940ASD1"
						aStru  := SD1->(dbStruct())
						cQuery := "SELECT * "
						cQuery += "FROM "+RetSqlName("SD1")+" "
						cQuery += "WHERE D1_FILIAL='"+xFilial("SD1")+"' AND "
						cQuery += "D1_DOC='"+aArrayF3[1][1]+"' AND "
						cQuery += "D1_SERIE='"+aArrayF3[1][2]+"' AND "
						cQuery += "D1_FORNECE='"+aArrayF3[1][3]+"' AND "
						cQuery += "D1_LOJA='"+aArrayF3[1][4]+"' AND "
						cQuery += "D1_CF NOT IN('000','999') AND "
							If !Empty(cDesCfop)
								cQuery += "D1_CF NOT IN('"+RetPar(cDesCfop)+"') AND "
							Endif
						cQuery += "D_E_L_E_T_ = ' ' "
						cQuery += "ORDER BY "+SqlOrder(SD1->(IndexKey()))
		
						cQuery := ChangeQuery(cQuery)
						dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSD1,.T.,.T.)
		
						For nX := 1 To len(aStru)
							If aStru[nX][2] <> "C" 
								TcSetField(cAliasSD1,aStru[nX][1],aStru[nX][2],aStru[nX][3],aStru[nX][4])
							EndIf
						Next nX
						dbSelectArea(cAliasSD1)
					Else
				#ENDIF
						(cAliasSD1)->( MsSeek(xFilial("SD1")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]))
				#IFDEF TOP
					EndIf
				#ENDIf

				nItem	:= 1
			   	 	
			    While (cAliasSD1)->(!Eof()).And. (cAliasSD1)->D1_FILIAL +(cAliasSD1)->D1_DOC + (cAliasSD1)->D1_SERIE+(cAliasSD1)->D1_FORNECE+(cAliasSD1)->D1_LOJA==;
				    xFilial("SD1")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]

					//88 - 81
	
					If mv_par26 == 2
				  	    	
						If Alltrim((cAliasSD1)->D1_CF)$"1551/1552/1553/1554/1555/2551/2552/2553/2554/2555/3551/3553" .And. !(cAliasSD1)->D1_TIPO$"BD"
							If !R82->(MsSeek(cIE+DtoC((cAliasSD1)->D1_EMISSAO)+cCodMun+aArrayF3[1][6]+(cAliasSD1)->D1_SERIE+(cAliasSD1)->D1_CF+STRZERO((cAliasSD1)->D1_PICM,4)))	
								RecLock("R82",.T.)
								R82->R82_IE	 	:= cIE 
								R82->R82_DTINCO	:= (cAliasSD1)->D1_EMISSAO
								R82->R82_UF	 	:= aArrayF3[1][22]
								R82->R82_MODINC	:= AModNot(aArrayF3[1][7])       
								R82->R82_SERINC  	:= (cAliasSD1)->D1_SERIE
								R82->R82_SDOCC  	:= SerieNfId(cAliasSD1,2,"D1_SERIE")
								R82->R82_CFOPEN  	:= (cAliasSD1)->D1_CF
								R82->R82_ALQINC	:= (cAliasSD1)->D1_PICM			
							Else
								RecLock("R82",.F.) 
							EndIf
							R82->R82_NFINC 	 := (cAliasSD1)->D1_DOC	 		
							R82->R82_VLTINC	 += (cAliasSD1)->D1_TOTAL
							MsUnlock()
						Else
							If !R88->(MsSeek(aArrayF3[1][22]+cCodMun+(cAliasSD1)->D1_CF+STRZERO((cAliasSD1)->D1_PICM,4)))
						   		RecLock("R88",.T.)     
								R88->R88_ESTADO	 := aArrayF3[1][22]
								R88->R88_MUNIC	 := Iif(!Empty(cCodMun),cCodMun,"00000")
								R88->R88_CFOP	 := (cAliasSD1)->D1_CF       
								R88->R88_ALQICM  := (cAliasSD1)->D1_PICM
							Else
								RecLock("R88",.F.)
							EndIf	
							R88->R88_VALCON += (cAliasSD1)->D1_TOTAL
							R88->R88_BASICM += (cAliasSD1)->D1_BASEICM
							R88->R88_VALICM	+= (cAliasSD1)->D1_VALICM
							R88->R88_ISEICM += aArrayF3[1][12]
							R88->R88_OUTICM += aArrayF3[1][15]
							R88->R88_ICMRET += (cAliasSD1)->D1_ICMSRET
							
							MsUnlock()
						EndIf 
					EndIf						
					
					SF4->(MsSeek(xFilial("SF4")+(cAliasSD1)->D1_TES))
					If SF4->F4_LFICM <> "N" .And. (cAliasSD1)->D1_TOTAL > 0

						SB1->(MsSeek(xFilial("SB1")+(cAliasSD1)->D1_COD))
						nPosAliq := 0
						nAliqIte := 0
						cSitTrib := ""
						//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
						//³Processo utilizado para atribuir os valores de Base de Icms e³
						//³Aliquota de Icms ao Registro 54 conforme Registro 50.        ³
						//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ					 
						A940LoadPro("E",@cNcm,@cProd,(cAliasSD1)->D1_TEC)
			        	If ! ALLTRIM((cAliasSD1)->D1_CF) $ cCfoSint
						    //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
							//³Monta Registro Tipo 75³
							//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
							nAliqICM	:= SuperGETMV("MV_ICMPAD")
							nBRetido	:=(cAliasSD1)->D1_BRICMS/(cAliasSD1)->D1_QUANT
							//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
							//³Situacao Tributaria ³
							//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
							If Empty((cAliasSD1)->D1_CLASFIS)
							  	If !Empty(SF4->F4_SITTRIB)
								    cSitTrib 	:= 	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+SF4->F4_SITTRIB),3,0),3)
						   		Else
							        If len(alltrim(SB1->B1_ORIGEM)) ==2
										cSitTrib 	:=  SB1->B1_ORIGEM+"0"
									Else	
									    cSitTrib 	:= 	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+Substr(SB1->B1_CLASFIS,1,1)+"0"),3,0),3)
							        EndIf
								EndIf	
							Else
								cSitTrib 	:= 	aFISFill(Num2Chr(Val((cAliasSD1)->D1_CLASFIS),3,0),3)
							EndIf
							//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
							//³% de Reducao do ICMS nas Operacoes Internas³
							//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
							nRedBase :=0
							If SF4->F4_BASEICM >=100
								nRedBase :=0
						    ElseIf SF4->F4_BASEICM > 0
							    nRedBase := (100-SF4->F4_BASEICM)
						    Else
							    nRedBase := SF4->F4_BASEICM
						    EndIf		
							
							If Empty((cAliasSD1)->D1_TEC)
	 				    		If len(alltrim(SB1->B1_COD))>14
		                            cSeek	:=(dtos(dDtIni)+dtos(dDtFim)+PADR(cProd,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
							    Else						
	               		            cSeek	:=(dtos(dDtIni)+dtos(dDtFim)+Substr(SB1->B1_COD,1,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
					    		EndIf						
							Else
	       		                cSeek	:=(dtos(dDtIni)+dtos(dDtFim)+PADR(cProd,14)+Substr((cAliasSD1)->D1_TEC,1,8)+(cAliasSD1)->D1_UM+space(4))
							Endif
							//
							//Utilizo informacoes do SWN
							If !Empty((cAliasSD1)->D1_TEC)								
								ImporSWN (cAliasSd1, cCNPJ, cSitTrib, dDTIni, dDTFim, nAliqICM, nBRetido, nRedBase, aArrayF3, cAliasSF3, @nItem)
								//
							Else
								RecLock("R54",.T.)
								R54->A54_CNPJ	:=	cCNPJ
								R54->A54_MODELO	:=	AModNot(aArrayF3[1][7])
								R54->A54_SERIE 	:=	(cAliasSD1)->D1_SERIE
								R54->A54_SDOC 	:=	SerieNfId(cAliasSD1,2,"D1_SERIE")								
								R54->A54_NFISC 	:=	(cAliasSD1)->D1_DOC
								R54->A54_CFOP		:=	(cAliasSD1)->D1_CF
							   R54->A54CFOPEXT 	:=	SF4->F4_CFEXT
								R54->A54_CST   	:=	cSitTrib
								R54->A54_NUMITE	:=	StrZero(nItem,3)
								R54->A54_PRODUT	:=	cProd
								R54->A54_QUANT 	:=	(cAliasSD1)->D1_QUANT
								R54->A54_VALPRO	:=	(cAliasSD1)->D1_TOTAL
								R54->A54_VALDES	:=	(cAliasSD1)->D1_VALDESC
	
								If (cAliasSD1)->D1_ICMSRET > 0	 //IMPOSTO RETIDO - SUBSTITUTO TRIBUTARIO
									R54->A54_BSICM 	:= 0
								Else
									R54->A54_BSICM 	:= (cAliasSD1)->D1_BASEICM
								Endif
															
								R54->A54_BRICMS	:=	(cAliasSD1)->D1_BRICMS
								R54->A54_VALIPI	:=	(cAliasSD1)->D1_VALIPI
								nAliqIte  := (cAliasSD1)->D1_PICM
								If !SF4->F4_ISS $ "N "
									nAliqIte  := 0
								ElseIf SF4->F4_LFICM $ "IO" .And. nRedBase > 0 .And. SF4->F4_CONSUMO == "S"
									nAliqIte  := 0
								ElseIf 	SF4->F4_LFICM $ "IO" .And. nRedBase == 0
									nAliqIte  := 0
								Endif
								nPosAliq := Ascan(aArrayF3,{|x| x[8]==nAliqIte})
								R54->A54_ALQICM	:=	IIf(nPosAliq > 0,aArrayF3[nPosAliq][8],0)
								MsUnlock()
	
								If mv_par20==1
									RecLock(cArq088C,.T.)
									(cArq088C)->A88CNFISC	:=	(cAliasSD1)->D1_DOC
									(cArq088C)->A88CSERIE	:=	(cAliasSD1)->D1_SERIE
									(cArq088C)->A88CSDOC		:=	SerieNfId(cAliasSD1,2,"D1_SERIE")
									(cArq088C)->A88CCNPJ		:=	cCNPJ
									(cArq088C)->A88CMODELO	:=	AModNot(aArrayF3[1][7])
									(cArq088C)->A88CCFOP		:=	(cAliasSD1)->D1_CF
									(cArq088C)->A88CNUMITE	:=	StrZero(nItem,3)
									(cArq088C)->A88CPRODUT	:=	cProd
									(cArq088C)->A88CQUANT	:=	Iif(SF1->F1_TIPO$"C#P#I" .and. (cAliasSD1)->D1_QUANT == 0 ,1,(cAliasSD1)->D1_QUANT)
									(cArq088C)->A88CBASEST	:=	(cAliasSD1)->D1_BRICMS
									(cArq088C)->A88CVALBSR	:=	(cAliasSD1)->D1_ICMSRET
									(cArq088C)->A88CVALBSC	:=	0.00
									MsUnlock()

								Endif   							
								
								If AModNot(aArrayF3[1][7])<>"04" .And. R75->(!dbSeek(cSeek))
						    		RecLock("R75",.T.)
									R75->A75_DTAINI	:=	dDTIni
									R75->A75_DTAFIM	:=	dDTFim
									A940LoadPro("E",@cNcm,@cProd,(cAliasSD1)->D1_TEC)
									R75->A75_PROD	:=cProd
									R75->A75_CODNCM	:=cNcm
									If !Empty((cAliasSD1)->D1_TEC)
									 	R75->A75_DESCR	:=	(cAliasSD1)->D1_COD
										R75->A75_UM    	:=	(cAliasSD1)->D1_UM
										R75->A75_ALQIPI	:=	(cAliasSD1)->D1_IPI
									Else
										R75->A75_DESCR	:=	SB1->B1_DESC
										R75->A75_UM    	:=	SB1->B1_UM
									    R75->A75_ALQIPI	:=	SB1->B1_IPI
									EndIf
									R75->A75_ALQICM	:=	nAliqICM
									R75->A75_BRICMS	:=	nBRetido  	//Base do Retido
									R75->A75_SITTRI	:=	cSitTrib
									R75->A75_REDBSE	:= nRedBase		//Reducao da Base do ICMS
									If MV_PAR15 == 3
										R75->A75_EAN      := SB1->B1_CODBAR
										R75->A75_CODFIS   := &(SuperGetMv("MV_DIC_T06",,"'0850000'"))
									Endif	
									MsUnlock()							 
							    Endif
						    Endif
						    nItem ++
						Endif   
				    Endif
				    (cAliasSD1)->(dbSkip())
				EndDo
        		If lQuery
				    dbSelectArea(cAliasSD1)
					dbCloseArea()
			    Endif
			Else
	    		SF2->( dbSetOrder(1) )
				SF2->( MsSeek(xFilial("SF2")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]))
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ Registro adicional para Frete,Seguro e Outras Despesas       ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				If SF2->(!Eof()) .And. (Empty(aArrayF3[1][7]) .Or. AModNot(aArrayF3[1][7])=="01" .Or. AModNot(aArrayF3[1][7])=="55")
				    For nI := 1 to 4
						If nI == 4
							aRelImp2   := MaFisRelImp("MT100",{ "SF2" })
							nPsVlPisSa := 0
							nValPis    := 0
							If !Empty( nScanPis := aScan(aRelImp2,{|x| x[1]=="SF2" .And. x[3]=="NF_VALPS2"} ) )
								cCpVlPisSa := aRelImp2[nScanPis,2]
								nPsVlPisSa := SF2->(FieldPos(cCpVlPisSa))
							EndIf 	
							If !Empty( nPsVlPisSa ) 
								nValPis := SF2->( FieldGet( nPsVlPisSa ) )
							EndIf
						Endif
			    		If (nI == 1 .And. SF2->F2_FRETE > 0) .Or.;
			    		   (nI == 2 .And. SF2->F2_SEGURO > 0) .Or.;
						   (nI == 3 .And. SF2->F2_DESPESA > 0) .Or.;
						   (nI == 4 .And. nValPis > 0)
						
							dbSelectArea("R54")
							If !MsSeek(cCNPJ+aArrayF3[1][2]+aArrayF3[1][1]+IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993"))))
								RecLock("R54",.T.)
								R54->A54_CNPJ	:=	cCNPJ
								R54->A54_MODELO :=	AModNot(aArrayF3[1][7])	
								R54->A54_SERIE  :=	aArrayF3[1][2]
								R54->A54_SDOC	  :=	aArrayF3[1][36]
								R54->A54_NFISC  :=	aArrayF3[1][1]
								R54->A54_CFOP	:=	aArrayF3[1][5]
							    R54->A54CFOPEXT :=	aArrayF3[1][29]
								R54->A54_CST    := "   "
								R54->A54_NUMITE := 	IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993")))//Numero do Item (991-Frete;999-Outras despesas acessorias;993-PIS/COFINS)
								R54->A54_QUANT  :=	1
								R54->A54_VALPRO := IIf(nI==1,SF2->F2_FRETE,If(nI==2,SF2->F2_SEGURO,If(nI==3,SF2->F2_DESPESA,nValPis)))
								R54->A54_VALDES := R54->A54_VALPRO
								R54->A54_ALQICM	:= IIf(nI==4,aArrayF3[1][8],0)
								MsUnlock()
							Endif	  

							If mv_par20==1					
								RecLock(cArq088C,.T.)
								(cArq088C)->A88CNFISC	:=	aArrayF3[1][1]
								(cArq088C)->A88CSERIE	:=	aArrayF3[1][2]
								(cArq088C)->A88CSDOC		:=	aArrayF3[1][36]								
								(cArq088C)->A88CCNPJ	:=	cCNPJ
								(cArq088C)->A88CMODELO	:=	AModNot(aArrayF3[1][7])
								(cArq088C)->A88CCFOP	:=	aArrayF3[1][5]
								(cArq088C)->A88CNUMITE	:= IIf(nI==1,"991",If(nI==2,"992",If(nI==3,"999","993"))) //Numero do Item (991-Frete;992 -Seguro;999-Outras despesas acessorias;993-PIS/COFINS)
								(cArq088C)->A88CQUANT	:= 	1
								(cArq088C)->A88CBASEST	:=0.00
								(cArq088C)->A88CVALBSR	:=0.00
								(cArq088C)->A88CVALBSC	:=0.00
								MsUnlock()
							Endif														
					    Endif
					Next
				EndIf

				SD2->( dbSetOrder(3) )

				#IFDEF TOP
  					If TcSrvType()<>"AS/400"
						 cAliasSD2 := "a940ASD2"
						 aStru  := SD2->(dbStruct())
						 cQuery := "SELECT * "
						 cQuery += "FROM "+RetSqlName("SD2")+" "
						 cQuery += "WHERE D2_FILIAL='"+xFilial("SD2")+"' AND "
						 cQuery += "D2_DOC='"+aArrayF3[1][1]+"' AND "
						 cQuery += "D2_SERIE='"+aArrayF3[1][2]+"' AND "
						 cQuery += "D2_CLIENTE='"+aArrayF3[1][3]+"' AND "
						 cQuery += "D2_LOJA='"+aArrayF3[1][4]+"' AND "
						 cQuery += "D2_CF NOT IN('000','999') AND "
						 	If !Empty(cDesCfop)
								cQuery += "D2_CF NOT IN('"+RetPar(cDesCfop)+"') AND "
	   						Endif
						 cQuery += "D_E_L_E_T_ = ' ' "
						 cQuery += "ORDER BY "+SqlOrder(SD2->(IndexKey()))
	            	
						 cQuery := ChangeQuery(cQuery)
						 dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSD2,.T.,.T.)
	
						 For nX := 1 To len(aStru)
							 If aStru[nX][2] <> "C" 
								 TcSetField(cAliasSD2,aStru[nX][1],aStru[nX][2],aStru[nX][3],aStru[nX][4])
							 EndIf
						 Next nX
						 dbSelectArea(cAliasSD2)
					Else
  				#ENDIF
						(cAliasSD2)->( MsSeek(xFilial("SD2")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]))
				#IFDEF TOP
					EndIf
				#ENDIF
			   
				nItem	:= 1

			    While (cAliasSD2)->(!Eof()).And. (cAliasSD2)->D2_FILIAL+(cAliasSD2)->D2_DOC+(cAliasSD2)->D2_SERIE+(cAliasSD2)->D2_CLIENTE+(cAliasSD2)->D2_LOJA== ;
					xFilial("SD2")+aArrayF3[1][1]+aArrayF3[1][2]+aArrayF3[1][3]+aArrayF3[1][4]

					If mv_par26 == 2
						If Alltrim((cAliasSD2)->D2_CF)$"5551/5552/5553/5554/5555/6551/6552/6553/6554/6555/7551/7553" 
							If !R82->(MsSeek(DtoC((cAliasSD2)->D2_EMISSAO)+AModNot(aArrayF3[1][7])+(cAliasSD2)->D2_SERIE+(cAliasSD2)->D2_CF+STRZERO((cAliasSD2)->D2_PICM,4)))	
								RecLock("R82",.T.)
								R82->R82_DTDESI	:= (cAliasSD2)->D2_EMISSAO
								R82->R82_MODDES	:= AModNot(aArrayF3[1][7])
								R82->R82_SERDES  := (cAliasSD2)->D2_SERIE
								R82->R82_SDOCS	  := SerieNfId(cAliasSD2,2,"D2_SERIE")
								R82->R82_CFOPSA  := (cAliasSD2)->D2_CF
								R82->R82_ALQDES	 := (cAliasSD2)->D2_PICM
							Else
								RecLock("R82",.F.)
							EndIf
							R82->R82_NFDES 	 := (cAliasSD2)->D2_DOC
							R82->R82_VLTDES	 += (cAliasSD2)->D2_TOTAL
							MsUnlock()
						Else
							If !R88->(MsSeek(aArrayF3[1][22]+cCodMun+(cAliasSD2)->D2_CF+STRZERO((cAliasSD2)->D2_PICM,4)))
						   		RecLock("R88",.T.)     
								R88->R88_ESTADO	 := aArrayF3[1][22]
								R88->R88_MUNIC	 := Iif(!Empty(cCodMun),cCodMun,"00000")
								R88->R88_CFOP	 := (cAliasSD2)->D2_CF       
								R88->R88_ALQICM  := (cAliasSD2)->D2_PICM
							Else
								RecLock("R88",.F.)
							EndIf	
							R88->R88_VALCON += (cAliasSD2)->D2_TOTAL
							R88->R88_BASICM += (cAliasSD2)->D2_BASEICM
							R88->R88_VALICM	+= (cAliasSD2)->D2_VALICM
							R88->R88_ISEICM += aArrayF3[1][12]
							R88->R88_OUTICM += aArrayF3[1][15]
							R88->R88_ICMRET += (cAliasSD2)->D2_ICMSRET
							
							MsUnlock()
						EndIf
					EndIf 					
					
					SF4->(MsSeek(xFilial("SF4")+(cAliasSD2)->D2_TES))

					If SF4->F4_LFICM <> "N" .And. (cAliasSD2)->D2_TOTAL > 0 

						SB1->(MsSeek(xFilial("SB1")+(cAliasSD2)->D2_COD))
						nPosAliq := 0
						nAliqIte := 0
						cSitTrib := ""
					    //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
						//³Processo utilizado para atribuir os valores de Base de Icms e³
						//³Aliquota de Icms ao Registro 54 conforme Registro 50.        ³
						//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ					 
						A940LoadPro("S",@cNcm,@cProd)
			        	If ! ALLTRIM((cAliasSD2)->D2_CF) $ cCfoSint
							//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
							//³Monta Registro Tipo 75³
							//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
							nAliqICM := SuperGETMV("MV_ICMPAD")
							//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
							//³Situacao Tributaria ³
							//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
							If Empty((cAliasSD2)->D2_CLASFIS)
							    If !Empty(SF4->F4_SITTRIB)
								    cSitTrib 	:= 	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+SF4->F4_SITTRIB),3,0),3)
								Else
								    If len(alltrim(SB1->B1_ORIGEM)) ==2
									    cSitTrib	:= SB1->B1_ORIGEM+"0"
								    Else	
								        cSitTrib	:=	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+Substr(SB1->B1_CLASFIS,1,1)+"0"),3,0),3)
								    EndIf
								EndIf	
							Else
							    cSitTrib	:=	aFISFill(Num2Chr(Val((cAliasSD2)->D2_CLASFIS),3,0),3)
						    EndIf
							//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
							//³% de Reducao do ICMS nas Operacoes Internas³
							//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
							nRedBase := 0
				    		If SF4->F4_BASEICM >=100
								nRedBase :=0
							ElseIf SF4->F4_BASEICM > 0
							    nRedBase :=	(100-SF4->F4_BASEICM)
							Else
							    nRedBase :=	SF4->F4_BASEICM
						    Endif

						    cSeek	:= (dtos(dDtIni)+dtos(dDtFim)+PADR(cProd,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
							
							If Empty(aArrayF3[1][7]) .Or. AModNot(aArrayF3[1][7])=="01" .Or. AModNot(aArrayF3[1][7])=="55"
								RecLock("R54",.T.)
								R54->A54_CNPJ	:=	cCNPJ
								R54->A54_MODELO	:=	AModNot(aArrayF3[1][7])
								R54->A54_SERIE	:=	(cAliasSD2)->D2_SERIE
								R54->A54_SDOC		:=	SerieNfId(cAliasSD2,2,"D2_SERIE")
								R54->A54_NFISC	:=	(cAliasSD2)->D2_DOC
								R54->A54_CFOP	:=	(cAliasSD2)->D2_CF
							    R54->A54CFOPEXT :=	SF4->F4_CFEXT
								R54->A54_CST   	:=  cSitTrib
								R54->A54_NUMITE	:=	StrZero(nItem,3)
								R54->A54_PRODUT	:=	cProd
								R54->A54_QUANT	:=	(cAliasSD2)->D2_QUANT
								R54->A54_VALPRO	:=	(cAliasSD2)->D2_TOTAL+(cAliasSD2)->D2_DESCON
								R54->A54_VALDES	:=	(cAliasSD2)->D2_DESCON
								R54->A54_BSICM	:=  (cAliasSD2)->D2_BASEICM
								R54->A54_BRICMS	:=  (cAliasSD2)->D2_BRICMS
								R54->A54_VALIPI	:=  (cAliasSD2)->D2_VALIPI
								nAliqIte  := (cAliasSD2)->D2_PICM
								If !SF4->F4_ISS $ "N "
									nAliqIte  := 0
								ElseIf SF4->F4_LFICM $ "IO" .And. nRedBase > 0 .And. SF4->F4_CONSUMO == "S"
									nAliqIte  := 0
								ElseIf 	SF4->F4_LFICM $ "IO" .And. nRedBase == 0
									nAliqIte  := 0
								Endif
								nPosAliq := Ascan(aArrayF3,{|x| x[8]==nAliqIte})
								R54->A54_ALQICM	:=	IIf(nPosAliq > 0,aArrayF3[nPosAliq][8],0)
								MsUnlock()
			               	
								If mv_par20==1
										RecLock(cArq088C,.T.)
										(cArq088C)->A88CNFISC	:=	(cAliasSD2)->D2_DOC
										(cArq088C)->A88CSERIE	:=	(cAliasSD2)->D2_SERIE
										(cArq088C)->A88CSDOC		:=	SerieNfId(cAliasSD2,2,"D2_SERIE")
										(cArq088C)->A88CCNPJ		:=	cCNPJ
										(cArq088C)->A88CMODELO	:=	AModNot(aArrayF3[1][7])
										(cArq088C)->A88CCFOP	:=	(cAliasSD2)->D2_CF
										(cArq088C)->A88CNUMITE	:=	StrZero(nItem,3)
										(cArq088C)->A88CPRODUT	:=	cProd
										(cArq088C)->A88CQUANT	:=	Iif(SF2->F2_TIPO$"C#P#I" .and. (cAliasSD2)->D2_QUANT == 0 ,1,(cAliasSD2)->D2_QUANT)
										(cArq088C)->A88CBASEST	:=	(cAliasSD2)->D2_BRICMS
										(cArq088C)->A88CVALBSR	:=	(cAliasSD2)->D2_ICMSRET
										(cArq088C)->A88CVALBSC	:=	0.00
										MsUnlock()
								Endif   							
							Endif

							If AModNot(aArrayF3[1][7])<>"04" .And. !(R75->(dbSeek(cSeek)))
								RecLock("R75",.T.)
								R75->A75_DTAINI	:=	dDTIni
								R75->A75_DTAFIM	:=	dDTFim
								A940LoadPro("S",@cNcm,@cProd)
								R75->A75_PROD  	:=  cProd
		       					R75->A75_CODNCM	:=  cNcm
								R75->A75_DESCR	:=	SB1->B1_DESC
								R75->A75_UM    	:=	SB1->B1_UM
								R75->A75_ALQIPI	:=	SB1->B1_IPI
								R75->A75_ALQICM	:=	nAliqICM
								R75->A75_BRICMS	:=	(cAliasSD2)->D2_BRICMS
								R75->A75_SITTRI	:=	cSitTrib
								R75->A75_REDBSE	:= nRedBase		//Reducao da Base do ICMS
								If MV_PAR15 == 3
									R75->A75_EAN      := SB1->B1_CODBAR
									R75->A75_CODFIS   := &(SuperGetMv("MV_DIC_T06",,"'0850000'"))
								Endif	
								MsUnlock()
							Endif	

							If MV_PAR15 == 3 .and. R75->(dbSeek(cSeek))
								If AModNot(aArrayF3[1][7])$"02/04"	//"NFCF#NFP"
									//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
									//³Monta Registro Tipo 61R³
									//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
									cEmiss := ""
									cAliq  := ""
									cEmiss := Substr(DTOS((cAliasSD2)->D2_EMISSAO),5,2)+Substr(DTOS((cAliasSD2)->D2_EMISSAO),1,4)
									If (cArq61R)->(MsSeek(cEmiss+PADR(cProd,14)+str(nAliqICM,5,2)))
										RecLock(cArq61R,.F.)
										(cArq61R)->R61_QUANT	+=	(cAliasSD2)->D2_QUANT
										(cArq61R)->R61_VALOR	+=	(cAliasSD2)->D2_TOTAL+(cAliasSD2)->D2_DESCON
										(cArq61R)->R61_BICMS	+=	(cAliasSD2)->D2_BASEICM
										MsUnlock()
									Else
										RecLock(cArq61R,.T.)
										(cArq61R)->R61_EMISS 	:=	cEmiss
										(cArq61R)->R61_PRODSV	:=	cProd
										(cArq61R)->R61_QUANT	:=	(cAliasSD2)->D2_QUANT
										(cArq61R)->R61_VALOR	:=	(cAliasSD2)->D2_TOTAL+(cAliasSD2)->D2_DESCON
										(cArq61R)->R61_BICMS	:=	(cAliasSD2)->D2_BASEICM
										(cArq61R)->R61_ALIQ		:=	nAliqICM
										MsUnlock()
									Endif	
								EndIf     		
							EndIf

							If AModNot(aArrayF3[1][7]) $ "21,22" .And. aArrayF3[1][6] <> "L" //Notas Fiscais de Comunicacao/Telecomunicacao
						   		RecLock("R77",.T.)
								R77->A77_CNPJ  	:=	cCNPJ
								R77->A77_MODELO	:=	AModNot(aArrayF3[1][7])
								R77->A77_SERIE	:=	Substr((cAliasSD2)->D2_SERIE,1,1)
								R77->A77_SUBSER	:=  Substr((cAliasSD2)->D2_SERIE,2,2)
								R77->A77_NFISC	:=	(cAliasSD2)->D2_DOC  
								R77->A77_CFOP	:=	(cAliasSD2)->D2_CF   
								R77->A77_TIPREC	:= "1"
								R77->A77_NUMITE	:= StrZero(nItem,3)
								R77->A77_PRODUT	:= Left(cProd,11)
								R77->A77_QUANT	:= Iif(SF2->F2_TIPO$"C#P#I" .and. (cAliasSD2)->D2_QUANT == 0 ,1,(cAliasSD2)->D2_QUANT)
								R77->A77_VALPRO	:= (cAliasSD2)->D2_TOTAL+(cAliasSD2)->D2_DESCON
								R77->A77_VALDES	:= (cAliasSD2)->D2_DESCON
								R77->A77_BSICM	:= (cAliasSD2)->D2_BASEICM
								R77->A77_ALQICM	:= (cAliasSD2)->D2_BRICMS
								R77->A77_CNPJMF	:= SM0->M0_CGC
								R77->A77_CODTER	:= (cAliasSD2)->D2_CLIENTE
								MsUnlock()
		            		Endif
							nItem ++
						Endif
	 		    	Endif
	 		    	(cAliasSD2)->(dbSkip())
		 	    EndDo
			    If lQuery
	    		    dbSelectArea(cAliasSD2)
				    dbCloseArea()
		        EndIf 
		    EndIf	
		Endif
        //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	    //³Monta Registro Tipo 61³
	    //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	    If Val(Subs(AllTrim(aArrayF3[1][5]),1,1))>=5
        	If AModNot(aArrayF3[1][7]) $ "02,04,07,13,14,15,16,18,21" .And. aArrayF3[1][6] <> "L" // NF Produtor; NF venda a consumidor
				If R61->(!MsSeek(dTos(aArrayF3[1][18])+aArrayF3[1][2]+strzero(aArrayF3[1][8],5,2)))
				    RecLock("R61",.T.)
					R61->A61_EMISS	:= 	aArrayF3[1][18]
					R61->A61_MODELO :=	AModNot(aArrayF3[1][7])
					R61->A61_SERIE	:=	aArrayF3[1][2]
					R61->A61_SDOC		:=	aArrayF3[1][36]
					R61->A61_NUMINI	:=	aArrayF3[1][1]
					R61->A61_OBS    :=  aArrayF3[1][20]
					R61->A61_SITUAC := IIf(("CANCELAD"$aArrayF3[1][20] .Or.!empty(aArrayF3[1][13])),"S","N")
				Else
				    RecLock("R61",.F.)
				EndIf		
				R61->A61_NUMFIM	:=	aArrayF3[1][1]
				R61->A61_VALTOT	+=	aArrayF3[1][17]
				R61->A61_BSICM	+=	aArrayF3[1][19]
				R61->A61_VALICM	+=	aArrayF3[1][16]
				R61->A61_ISENTA	+= 	aArrayF3[1][12]
				R61->A61_OUTRAS	+= 	aArrayF3[1][15]
				R61->A61_ALQICM := 	aArrayF3[1][8]
				R61->A61_ANOAID := IIf(lAIDF,aArrayF3[1][30],MV_PAR18)
				R61->A61_NUMAID := IIf(lAIDF,aArrayF3[1][31],MV_PAR19)
				R61->A61_CODMUN := aArrayF3[1][25]
				MsUnlock()
			EndIf
		Endif  
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Monta Registro Tipo 70³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If (AModNot(aArrayF3[1][7])$"07#08#09#10#11#57") .And. aArrayF3[1][6] <> "L"

			// Se for uma entrada, o código do município no registro 70 será o do DECLARANTE - informado na wizard.
			If Val(Subs(AllTrim(aArrayF3[1][5]),1,1)) < 5
				cCod_Mun := mv_par16
			Else
				cCod_Mun := aArrayF3[1][25]
			EndIf
			If lTms
				//-- SIGATMS - Transportador: Retorna codigo do Municipio remente ou MV_CODDP se remetente fora do estado de Sergipe.
				aCodRem := TMSInfSol(aArrayF3[1][33], aArrayF3[1][1], aArrayF3[1][2], aArrayF3[1][3], aArrayF3[1][4], .T.)
				If Len(aCodRem) > 0
					cCod_Mun := If(aCodRem[08]=="SE",aCodRem[11],cCodDP)
				Else
					cCod_Mun := cCodDP
				EndIf
			EndIf
			RecLock("R70",.T.)
			R70->A70_CNPJ	:= 	cTranspCGC                                                                            //1
			R70->A70_IE		:=	cTranspIns                                                                            //2
			R70->A70_EMISS	:=	aArrayF3[1][34]                                                                       //3
			R70->A70_UF		:=	cTranspEst                                                                            //4
			R70->A70_MODELO	:=	AModNot(aArrayF3[1][7])  
			If mv_par15 == 3 // DIC-Sergipe                                                                           //5
			   R70->A70_SERIE	:=	FisGetSer(Substr(aArrayF3[1][36],1,1),"70",aArrayF3[1][7])                       //6
			Else
			   R70->A70_SERIE	:=	Substr(aArrayF3[1][36],1,1)                                                       //6
			Endif
			R70->A70_SUBSER	:=	Substr(aArrayF3[1][36],2,2)                                                           //7
			R70->A70_NFISC	:=	aArrayF3[1][1]                                                                        //8
			R70->A70_CFOP	:=	aArrayF3[1][5]                                                                        //9
			R70->A70CFOPEXT	:=	aArrayF3[1][29]                                                                       //10
			R70->A70_VALTOT	:=	aArrayF3[1][17]                                                                       //11
			R70->A70_BSICM	:=	aArrayF3[1][19]                                                                       //12
			R70->A70_VALICM	:=	aArrayF3[1][16]                                                                       //13
			R70->A70_ISENTA	:=	aArrayF3[1][12]                                                                       //14
			R70->A70_OUTRAS	:=	aArrayF3[1][15]                                                                       //15
			R70->A70_CIfFOB	:=	IIf(mv_par15==3,"2","1")                                                              //16                 
			R70->A70_SITUAC	:=	IIf(("CANCELAD"$aArrayF3[1][20] .Or.!empty(aArrayF3[1][13])),"S","N")                 //17
			R70->A70_CODMUN	:=	cCod_Mun                                                                              //18
			R70->A70_ANOAID	:=	IIf(lAIDF,aArrayF3[1][30],MV_PAR18)                                                   //19
			R70->A70_NUMAID	:=	IIf(lAIDF,aArrayF3[1][31],MV_PAR19)                                                   //20
       		R70->A70_ENTRAD :=  aArrayF3[1][34]                                                                        //22 
  
			MsUnlock()
		EndIf
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Monta Registro Tipo 71 atraves de ponto de entrada³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Somente gera registro tipo 71 para      ³
		//³emitentes de conhecimento de transporte.³
		//³Portanto somente Notas Fiscais de Saida.³
		//³Devera gerar registros no arquivo       ³
		//³R71 em funcao do registro lido no       ³
		//³arquivo SF3.                            ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If Substr(aArrayF3[1][5],1,1) >= "5" .And. aArrayF3[1][6] <> "L"
			If lMtaTIP71
				aArray71 := aClone(aArrayF3)
				Execblock("MTATIP71",.F.,.F.,{,aArray71})
			EndIf
		EndIf

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Monta Registro Tipo 71 atraves da Integracao com TMS³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If IntTms() .And. AModNot(aArrayF3[1][7])$"08/09/10/11/26/57" .And. !lMtaTIP71
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³Chama a funcao do TMS que retorna os dados do frete para geracao do registro 71.³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			//--Formato do vetor aRet
			//aRet[1] -- CPF/CNPJ
			//aRet[2] -- UF
			//aRet[3] -- { Inscricao estadual devedor , Inscricao estadual figura 2, Data de emissao da NF, Serie da Nf, Numero da Nf, Valor da nf } 
			aTMS := TMSSinteg(aArrayF3[1][33],aArrayF3[1][1],aArrayF3[1][2])
			
			If Len(aTMS) > 0
				For nTMS := 1 To Len(aTMS[3])
					Reclock("R71",.T.)
					R71->A71_CGCTOM := cCNPJ	//SA1->A1_CGC
					R71->A71_IETOM  := aRetDig(aTMS[3][nTMS][1],.T.)
					R71->A71_DTCONH := aArrayF3[1][18]
					R71->A71_UFTOM  := cTranspEst	//SA1->A1_EST
					R71->A71_MODCON := AModNot(aArrayF3[1][7])
					R71->A71_SERCON := Substr(aArrayF3[1][2],1,1)
					R71->A71_SUBCON := Substr(aArrayF3[1][2],2,2)
					R71->A71_NUMCON := aArrayF3[1][1]
					R71->A71_UFREM  := aTMS[2]
					R71->A71_CGCREM := aTMS[1]
					R71->A71_IEREM  := aRetDig(aTMS[3][nTMS][2],.T.)
					R71->A71_DTNOTA := Stod(aTMS[3][nTMS][3])
					R71->A71_MODNOT := "01"
					R71->A71_SERNOT := Substr(aTMS[3][nTMS][4],1,3)
					R71->A71_NUMNOT := aTMS[3][nTMS][5]
					R71->A71_VALNOT := aTMS[3][nTMS][6]
					MsUnlock()

					If lMtReg71
						Execblock("MTREG71",.F.,.F.,{(cAliasDT6)->DT6_FILDOC, (cAliasDT6)->DT6_DOC, (cAliasDT6)->DT6_SERIE})
					EndIf
				Next
			EndIf
		EndIf
	    
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Monta Registro Tipo 76³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
   		If AModNot(aArrayF3[1][7]) $ "21,22" .And. aArrayF3[1][6] <> "L" .And. Substr(aArrayF3[1][5],1,1) >= "5" //Notas Fiscais de Comunicacao/Telecomunicacao
   			RecLock("R76",.T.)
			R76->A76_CNPJ  	:=	cCNPJ
			R76->A76_IE		:=  cIE
			R76->A76_MODELO	:=	AModNot(aArrayF3[1][7])
			R76->A76_SERIE	:=	Substr(aArrayF3[1][36],1,1)
			R76->A76_SUBSER	:=  Substr(aArrayF3[1][36],2,2)
			R76->A76_NFISC	:=	aArrayF3[1][1]
			R76->A76_CFOP	:=	aArrayF3[1][5]
			R76->A76_TIPREC	:= "1"
			R76->A76_EMISS	:=	aArrayF3[1][10]
			R76->A76_UF		:=	cTranspEst
			R76->A76_VALTOT	:=	aArrayF3[1][17]
			R76->A76_BRICMS	:=	aArrayF3[1][19]
			R76->A76_VALICM	:=	aArrayF3[1][16]
			R76->A76_ISENTA	:=	aArrayF3[1][12]
			R76->A76_OUTRAS	:=	aArrayF3[1][15]
			R76->A76_ALQICM	:=	aArrayF3[1][8]
			R76->A76_SITUAC	:=	IIf(("CANCELAD"$aArrayF3[1][20] .Or.!empty(aArrayF3[1][13])),"S","N")
	 	    R76->A76_CODMUN := aArrayF3[1][25]
			R76->A76_ANOAID := IIf(lAIDF,aArrayF3[1][30],MV_PAR18)
			R76->A76_NUMAID := IIf(lAIDF,aArrayF3[1][31],MV_PAR19)
			R76->A76CFOPEXT	:=  aArrayF3[1][29]
			MsUnlock()
   		Endif
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Gravacao do registro 50                                                ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		For nI := 1 To Len(aArrayF3)
			If (Empty(aArrayF3[nI][7]) .Or.;
		    	AModNot(aArrayF3[nI][7])$"01,06,21,22,55") .And.;
		    	aArrayF3[nI][6] <> "L"  .And.;
	        	!ALLTRIM(aArrayF3[nI][5])$cCfoSint

			    If (cChaveAux == aArrayF3[nI][24]) .Or. nI==1 .Or. cChaveAux2<>Subs(aArrayF3[nI][05],1,4)+AllTrim(Str(aArrayF3[nI][8]))
				      RecLock("R50",.T.)
				      R50->A50_CNPJ   := 	cCNPJ
				      R50->A50_IE     :=	cIE
				      R50->A50_ENTRAD :=	aArrayF3[nI][34]
				      R50->A50_EMISS  :=	aArrayF3[nI][10]
				      R50->A50_UF     :=	aArrayF3[nI][22]
					  R50->A50_MODELO :=  	AModNot(aArrayF3[nI][7])
				 	  R50->A50_SERIE  :=	aArrayF3[nI][2]
				 	  R50->A50_SDOC  :=	aArrayF3[nI][36]
					  R50->A50_NFISC  :=	aArrayF3[nI][1]
					  R50->A50_CFOP   :=	aArrayF3[nI][5]
					  R50->A50CFOPEXT :=	aArrayF3[nI][29]
				 	  R50->A50_EMIT   :=	IIf(aArrayF3[nI][21]=="S".Or.SubStr(aArrayF3[nI][5],1,1)>="5","P","T")
					  R50->A50_ALQICM :=	aArrayF3[nI][8]
					  R50->A50_SITUAC :=	IIf(("CANCELAD"$aArrayF3[nI][20] .Or.!Empty(aArrayF3[nI][13])),"S","N")
				 	  R50->A50_CODMUN := 	aArrayF3[nI][25]
				 	  If R50->A50_EMIT=="P"
					  	 R50->A50_ANOAID := IIf(lAIDF,aArrayF3[nI][30],MV_PAR18)
				 	  	 R50->A50_NUMAID := IIf(lAIDF,aArrayF3[nI][31],MV_PAR19)
				 	  Endif	 
					  MsUnlock()
				Endif	
				RecLock("R50",.F.)
				R50->A50_VALTOT +=	If(aArrayF3[nI][17]==0,aArrayF3[nI][16],aArrayF3[nI][17])
				
				If aArrayF3[nI][11] > 0		//F3_ICMSRET - SUBSTITUTO TRIBUTARIO
					If Left(Alltrim(aArrayF3[nI][5]),1) >= "5" .Or. aArrayF3[nI][35] =="1" 
						R50->A50_BSICM  += aArrayF3[nI][19]	//F3_BASEICM
					Endif
				Else
					R50->A50_BSICM  +=	aArrayF3[nI][19]
				Endif
				
				R50->A50_VALICM +=	aArrayF3[nI][16]
				R50->A50_ISENTO +=	aArrayF3[nI][12]
				R50->A50_OUTRAS +=	aArrayF3[nI][15]
				R50->A50_DESPES += aArrayF3[nI][23]
				MsUnlock()
			EndIf                       
			
			If mv_par15 == 3 .and. aArrayF3[nI][11]>0 .And. mv_par26 <> 2
			   If (aModNot(aArrayF3[nI][7])$"06/22" .And. Subs(aArrayF3[nI][05],1,1)$"123") .Or. (!aModNot(aArrayF3[nI][7])$"06/22")
				  If !(cArq08850)->(MsSeek(cCNPJ+aArrayF3[nI][2]+aArrayF3[nI][1]))							
					 RecLock(cArq08850,.T.)
					 (cArq08850)->A8850CNPJ  := cCNPJ
					 (cArq08850)->A8850EMISS := aArrayF3[nI][10]
					 (cArq08850)->A8850UF    :=	aArrayF3[nI][22]
					 (cArq08850)->A8850MODEL := aModNot(aArrayF3[nI][7])
					 (cArq08850)->A8850SERIE := aArrayF3[nI][2]
					 (cArq08850)->A8850SDOC  := aArrayF3[nI][36]
					 (cArq08850)->A8850NFISC := aArrayF3[nI][1]
					 (cArq08850)->A8850SUFRA := aArrayF3[nI][27]
					 (cArq08850)->A8850OBS   := aArrayF3[nI][20]
					 (cArq08850)->A8850CONTA := aArrayF3[nI][26]
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³Tratamento para contemplar PORTARIA N 292/2008-SEFAZ,         ³
					//³pois se o conteudo for vazio o arquivo nao valida.     		 ³
					//³Os campos foram mantidos para uso futuro caso a SEFAZ solicite³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					 (cArq08850)->A8850VFRET := Replicate("0",13)
					 (cArq08850)->A8850ICFRE := Replicate("0",13)
					 (cArq08850)->A8850VDESP := Replicate("0",13)
					 (cArq08850)->A8850VTOTP := Replicate("0",13)
					 (cArq08850)->A8850NEMPH := Replicate("0",08)
					 (cArq08850)->A8850TPFRE := Replicate("0",01)
				  EndIf
				  MsUnlock()
			   EndIf			
			Endif
			If mv_par20==1
				RecLock(cArq088D,.T.)
				(cArq088D)->A88DCNPJ	:=	cCNPJ
				(cArq088D)->A88DIE		:=	cIE
				(cArq088D)->A88DUF		:=	aArrayF3[nI][22]
				(cArq088D)->A88DMODELO	:=	AModNot(aArrayF3[nI][7])
				(cArq088D)->A88DSERIE	:=	aArrayF3[nI][2]
				(cArq088D)->A88DSDOC		:=	aArrayF3[nI][36]
				(cArq088D)->A88DNFISC	:=	aArrayF3[nI][1]
				(cArq088D)->A88DCFOP  	:=	aArrayF3[nI][5]
				(cArq088D)->A88DEMISS	:=	aArrayF3[nI][18]
				(cArq088D)->A88DENTSAI	:=	aArrayF3[nI][10]
				(cArq088D)->A88DALQICM	:=	aArrayF3[nI][8]
				MsUnlock()
			Endif	
			
			cChaveAux := aArrayF3[nI][24]
			cChaveAux2:= Subs(aArrayF3[nI][05],1,4)+AllTrim(Str(aArrayF3[nI][8]))
		Next
		aArrayF3  := {}
		cChaveAux := ""
		cChaveAux2:= ""
	Endif
	dbSelectArea(cAliasSF3)
EndDo		

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Verifica se a UF do parametro e a mesma da empresa corrente  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ		
If !Empty(cEstDest) .And. SM0->M0_ESTENT <> cEstDest
    lCupom := .F.	//Se o estado for diferente do parametro nao pode ser gerado os registros tipo 60
Endif
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Monta Registro Tipo 60³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ		
If lCupons
	dbSelectArea(cAliasSFI)              
	dbSetOrder(1)
	#IFDEF TOP
	    If TcSrvType()<>"AS/400"
		    cAliasSFI:= "A940aSFI"
		  	lQuery   := .T.
			aStruSFI := SFI->(dbStruct())		
			cQuery := "SELECT * "
			cQuery += "FROM "
			cQuery += RetSqlName("SFI") + " SFI "
			cQuery += "WHERE "
			cQuery += "SFI.FI_FILIAL = '"+xFilial("SFI")+"' AND "
			cQuery += "SFI.FI_DTMOVTO>='"+Dtos(dDtIni)+"' AND "
			cQuery += "SFI.FI_DTMOVTO<='"+Dtos(dDtFim)+"' AND "
			cQuery += "SFI.D_E_L_E_T_ = ' ' "
			cQuery += "ORDER BY "+SqlOrder(SFI->(IndexKey()))
			
			cQuery := ChangeQuery(cQuery)
		    	
			dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSFI)
			
			For nSFI := 1 To Len(aStruSFI)
				If aStruSFI[nSFI][2] <> "C"
					TcSetField(cAliasSFI,aStruSFI[nSFI][1],aStruSFI[nSFI][2],aStruSFI[nSFI][3],aStruSFI[nSFI][4])
				EndIf
			Next nSFI
		Else
	#ENDIF
			dbSelectArea(cAliasSFI)
			cIndex := CriaTrab(,.F.)
			cKey := IndexKey()	
			cFilter := 'FI_FILIAL == "'+xFilial("SFI")+'" .And. (Dtos(FI_DTMOVTO) >= "'+Dtos(dDtIni)+'" .And. Dtos(FI_DTMOVTO) <= "'+Dtos(dDtFim)+'")'
			IndRegua(cAliasSFI,cIndex,cKey,,cFilter,"Selecionando Registros...")
			dbGotop()
	#IFDEF TOP
		Endif
	#ENDIF	
	dbSelectArea(cAliasSFI)		

	While (cAliasSFI)->(!Eof())	
		If !M60->(MsSeek(DTOS((cAliasSFI)->FI_DTMOVTO)+StrZero(Val((cAliasSFI)->FI_PDV),3))) .And. mv_par26 <> 2
			RecLock("M60",.T.)
			M60->M60_EMISS  := (cAliasSFI)->FI_DTMOVTO
			M60->M60_NUMFAB := (cAliasSFI)->FI_SERPDV
			M60->M60_PDV    := STRZERO(VAL((cAliasSFI)->FI_PDV),3)
			M60->M60_MODELO := "2D" 
			M60->M60_NUMINI := (cAliasSFI)->FI_NUMINI
			M60->M60_NUMFIM := (cAliasSFI)->FI_NUMFIM														
			M60->M60_REDUCZ := (cAliasSFI)->FI_NUMREDZ
			M60->M60_CRO   	:= Val(PADR((cAliasSFI)->FI_CRO,3))
			M60->M60_VENDA 	:= IIF(MV_PAR15<>3,(cAliasSFI)->FI_GTINI,(cAliasSFI)->FI_VALCON+(cAliasSFI)->FI_DESC+(cAliasSFI)->FI_CANCEL)
		    M60->M60_GERAL	:= (cAliasSFI)->FI_GTFINAL
			MsUnlock()
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Totaliza cupons fiscais pela Situacao Tributaria             ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If (cAliasSFI)->FI_SUBTRIB > 0
				RecLock("A60",.T.)
				A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
				A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
				A60->A60_SITTRI	:=	"F"
				A60->A60_VALOR	:=	(cAliasSFI)->FI_SUBTRIB
				A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
				MsUnlock()
			EndIf
			If (cAliasSFI)->FI_ISENTO >0
			  	RecLock("A60",.T.)
				A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
				A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
				A60->A60_SITTRI	:=	"I"
				A60->A60_VALOR	:=	(cAliasSFI)->FI_ISENTO
				A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
				MsUnlock()
			EndIf
			If (cAliasSFI)->FI_CANCEL >0
				RecLock("A60",.T.)
				A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
				A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
				A60->A60_SITTRI	:=	"CANC"
				A60->A60_VALOR	:=	(cAliasSFI)->FI_CANCEL
				A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
				MsUnlock()
			EndIf         
			If (cAliasSFI)->FI_NTRIB >0
				RecLock("A60",.T.)
				A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
				A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
				A60->A60_SITTRI	:=	"N"
				A60->A60_VALOR	:=	(cAliasSFI)->FI_NTRIB
				A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
				MsUnlock()
			EndIf    
			If (cAliasSFI)->FI_DESC >0
				RecLock("A60",.T.)
				A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
				A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
				A60->A60_SITTRI	:=	"DESC"
				A60->A60_VALOR	:=	(cAliasSFI)->FI_DESC
				A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
				MsUnlock()
			EndIf
			aStruSFI := (cAliasSFI)->(dbStruct())
			For nX := 1 To Len(aStruSFI)
				If "FI_BAS"$(cAliasSFI)->(FieldName(nX))
					If (cAliasSFI)->(FieldGet(nX))>0
						RecLock("A60",.T.)
						A60->A60_EMISS	:=	(cAliasSFI)->FI_DTMOVTO
						A60->A60_NUMFAB	:=	(cAliasSFI)->FI_SERPDV
			    		A60->A60_SITTRI	:=	aFISFill(Num2Chr(Val(SubStr((cAliasSFI)->(FieldName(nX)),7)),4),4)
						A60->A60_VALOR	:=	(cAliasSFI)->(FieldGet(nX))
						A60->A60_PDV	:=	STRZERO(VAL((cAliasSFI)->FI_PDV),3)
						MsUnlock()
					EndIf
				EndIf
			Next nX	
		ElseIf !R83->(MsSeek(DTOS((cAliasSFI)->FI_DTMOVTO)+(cAliasSFI)->FI_PDV))
			RecLock("R83",.T.)
			R83->R83_DTMOV  := (cAliasSFI)->FI_DTMOVTO
			R83->R83_PDV    := (cAliasSFI)->FI_PDV
			R83->R83_SERIE  := (cAliasSFI)->FI_SERPDV
			R83->R83_VLGTIN := (cAliasSFI)->FI_GTINI
			R83->R83_VLGTFI := (cAliasSFI)->FI_GTFINAL
			MsUnlock()		
		Endif
		(cAliasSFI)->(dbSkip())
	EndDo
    If lQuery
	    dbSelectArea(cAliasSFI)
		dbCloseArea()
	Else
       	dbSelectArea("SFI")
		RetIndex("SFI")
		dbClearFilter()
		Ferase(cIndex+OrdBagExt())
	Endif	
Endif
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Monta Registros Tipo 60R           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lCupons .And. mv_par15 == 3
	dbSelectArea("SF2")	
	dbSetOrder(1)
	
	dbSelectArea("SD2")
	ProcRegua(LastRec())
	#IFDEF TOP
	     If TcSrvType()<>"AS/400"
		     cAliasSD2 := "a940ASD2"
			 aStru  := SD2->(dbStruct())
			 cQuery := "SELECT * "
			 cQuery += "FROM "+RetSqlName("SD2")+" "
			 cQuery += "WHERE D2_FILIAL='"+xFilial("SD2")+"' AND "
			 cQuery += "D2_EMISSAO>='"+Dtos(dDtIni)+"' AND "
	         cQuery += "D2_EMISSAO<='"+Dtos(dDtFim)+"' AND "	
			 cQuery	+= "(D2_CF LIKE '5%' OR D2_CF LIKE '6%' OR D2_CF LIKE '7%') AND "
				If !Empty(cDesCfop)
					cQuery += "D2_CF NOT IN('"+RetPar(cDesCfop)+"') AND "
	   			Endif
			 cQuery += "D2_PDV <> ' ' AND "
			 cQuery += "D_E_L_E_T_ = ' ' "
			 cQuery += "ORDER BY D2_FILIAL, D2_PDV, D2_EMISSAO"
	           	
			 cQuery := ChangeQuery(cQuery)
			 dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSD2,.T.,.T.)
	
			 For nX := 1 To Len(aStru)
				 If aStru[nX][2] <> "C" 
					 TcSetField(cAliasSD2,aStru[nX][1],aStru[nX][2],aStru[nX][3],aStru[nX][4])
				 EndIf
			 Next nX
			 dbSelectArea(cAliasSD2)
		 Else
	#ENDIF	
		     cIndex2 := CriaTrab(NIL,.F.)
			 cKey	 := 'D2_FILIAL+D2_PDV+DTOS(D2_EMISSAO)'
			 cFilter := 'D2_FILIAL == "'+xFilial("SD2")+'" .And. (Dtos(D2_EMISSAO) >= "'+Dtos(dDtIni)+'" .And. Dtos(D2_EMISSAO) <= "'+Dtos(dDtFim)+'")'
			 cFilter += '.And. Substr(D2_CF,1,1)$"5,6,7" .And. !Empty(D2_PDV)'
			 IndRegua(cAliasSD2,cIndex2,cKey,,cFilter,)
			 nIndex := RetIndex("SD2")
			 #IFNDEF TOP
			 	dbSetIndex(cIndex2+OrdBagExt())
			 #ENDIF			 
			 dbSelectArea("SD2")
			 dbSetOrder(nIndex+1)
	
			 dbSelectArea(cAliasSD2)
			 dbGotop()			 
	#IFDEF TOP
		 EndIf
	#ENDIF

    nItem := 1
    nAliqICM := SuperGETMV("MV_ICMPAD")
    While (cAliasSD2)->(!Eof()) 

    	IncProc(STR0006) //Preparando Base de Dados 2/3
       					
       	SF4->(MsSeek(xFilial("SF4")+(cAliasSD2)->D2_TES))
       	SB1->(MsSeek(xFilial("SB1")+(cAliasSD2)->D2_COD))
       	
		If SF2->(MsSeek(xFilial("SF2")+(cAliasSD2)->D2_DOC+(cAliasSD2)->D2_SERIE+(cAliasSD2)->D2_CLIENTE+(cAliasSD2)->D2_LOJA))
		    If SF2->F2_ECF <> "S"
		    	(cAliasSD2)->(dbSkip()) 
		    	Loop
		    Endif	
		Endif

		A940LoadPro("S",@cNcm,@cProd)
	        
   		cSitTrib := ""
		If (cAliasSD2)->D2_ICMSRET > 0
			cSitTrib := "F"
		Elseif (cAliasSD2)->D2_VALISS+(cAliasSD2)->D2_BASEISS > 0
			cSitTrib := "ISS"
		Elseif SF4->F4_BASEICM > 0 .And. SF4->F4_CONSUMO == "S" 
		    If SF4->F4_LFICM == "I"
				cSitTrib := "I"
			ElseIf SF4->F4_LFICM == "O"
				cSitTrib := "N"
			Endif	
		Elseif SF4->F4_BASEICM == 0
		    If SF4->F4_LFICM == "I"
				cSitTrib := "I"
			ElseIf SF4->F4_LFICM == "O"
				cSitTrib := "N"
			ElseIf SF4->F4_LFICM == "T"
				cSitTrib := aFISFill(Num2Chr((cAliasSD2)->D2_PICM,4),4)
			Endif		
		ElseIf SF4->F4_BASEICM > 0 .And. SF4->F4_CONSUMO == "N"
			cSitTrib := aFISFill(Num2Chr((cAliasSD2)->D2_PICM,4),4)
		EndIf	
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Define tipo de cupom fiscal                                  ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If Substr(SerieNfId(cAliasSD2,2,"D2_SERIE"),1,2)=="CP"
			cEspDoc:="2C"
		Else
		   	cEspDoc:="2D"
		EndIf
	    //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Monta Registro Tipo 60R³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		cEmiss := ""
		cEmiss := Substr(DTOS((cAliasSD2)->D2_EMISSAO),5,2)+Substr(DTOS((cAliasSD2)->D2_EMISSAO),1,4)
		If R60->(MsSeek(cEmiss+cProd+cSitTrib))
		    RecLock("R60",.F.)
			R60->R60_QUANT	+=	(cAliasSD2)->D2_QUANT
			R60->R60_VALOR	+=	(cAliasSD2)->D2_PRCVEN
			R60->R60_BSICM	+=	(cAliasSD2)->D2_BASEICM
			MsUnlock()
		Else
			RecLock("R60",.T.)
			R60->R60_MESANO	:=	cEmiss
			R60->R60_CODPRO	:=	cProd
			R60->R60_QUANT	:=	(cAliasSD2)->D2_QUANT	
			R60->R60_VALOR	:=	(cAliasSD2)->D2_PRCVEN
			R60->R60_BSICM	:=	(cAliasSD2)->D2_BASEICM
			R60->R60_SITTRI	:=	cSitTrib
			MsUnlock()
		Endif
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³% de Reducao do ICMS nas Operacoes Internas³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		nRedBase := 0
    	If SF4->F4_BASEICM >=100
			nRedBase :=0
		ElseIf SF4->F4_BASEICM > 0
		    nRedBase :=	(100-SF4->F4_BASEICM)
		Else
		    nRedBase :=	SF4->F4_BASEICM
	    Endif
   		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Situacao Tributaria ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		cSitTrib := ""
		If Empty((cAliasSD2)->D2_CLASFIS)
		    cSitTrib := aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+SF4->F4_SITTRIB),3,0),3)
		Else
		    cSitTrib :=	aFISFill(Num2Chr(Val((cAliasSD2)->D2_CLASFIS),3,0),3)
	    EndIf
		cSeek := (dtos(dDtIni)+dtos(dDtFim)+PADR(cProd,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
		If !(R75->(dbSeek(cSeek)))
			RecLock("R75",.T.)
			R75->A75_DTAINI	:= dDTIni
			R75->A75_DTAFIM	:= dDTFim
			R75->A75_PROD  	:= cProd
   			R75->A75_CODNCM	:= cNcm
			R75->A75_DESCR	:= SB1->B1_DESC
			R75->A75_UM    	:= SB1->B1_UM
			R75->A75_ALQIPI	:= SB1->B1_IPI
			R75->A75_ALQICM	:= nAliqICM
			R75->A75_BRICMS	:= (cAliasSD2)->D2_BRICMS
			R75->A75_SITTRI	:= cSitTrib
			R75->A75_REDBSE	:= nRedBase		
			If MV_PAR15 == 3
			   R75->A75_EAN      := SB1->B1_CODBAR
			   R75->A75_CODFIS   := &(SuperGetMv("MV_DIC_T06",,"'0850000'"))
			Endif
			MsUnlock()
		Endif	
	   	(cAliasSD2)->(dbSkip())
	EndDo
	If lQuery
    	dbSelectArea(cAliasSD2)
		dbCloseArea()
    Else
       	dbSelectArea("SD2")
		RetIndex("SD2")
		dbClearFilter()
		Ferase(cIndex2+OrdBagExt())
    EndIf 
EndIf
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Grava Registro 75 de acordo com o registro 74 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If mv_par21 == 1 .And. MV_PAR15 == 3
	cNcm  := ""
	cProd := ""
	cSitTrib := ""
	dbSelectArea("R74")
	dbGoTop()
	While R74->(!Eof())
		SB1->(MsSeek(xFilial("SB1")+R74->CODIGO))
		A940LoadPro("I",@cNcm,@cProd)
   		
   		If Len(Alltrim(SB1->B1_COD))>14
            cSeek :=(dtos(dDtIni)+dtos(dDtFim)+PADR(cProd,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
            RecLock("R74",.F.)
            R74->CODIGO := cProd
            MsUnlock()
	    Else						
            cSeek :=(dtos(dDtIni)+dtos(dDtFim)+Substr(SB1->B1_COD,1,14)+PADR(cNcm,8)+SB1->B1_UM+space(4))
   		EndIf						
   		
        If Len(Alltrim(SB1->B1_ORIGEM)) ==2
			cSitTrib := SB1->B1_ORIGEM+"0"
		Else	
		    cSitTrib :=	aFISFill(Num2Chr(Val(Substr(SB1->B1_ORIGEM,1,1)+Substr(SB1->B1_CLASFIS,1,1)+"0"),3,0),3)
        EndIf
        If R75->(!dbSeek(cSeek))
			RecLock("R75",.T.)
			R75->A75_DTAINI	:= dDTIni
			R75->A75_DTAFIM	:= dDTFim
			R75->A75_PROD  	:= cProd
	       	R75->A75_CODNCM	:= cNcm
			R75->A75_DESCR	:= SB1->B1_DESC
			R75->A75_UM    	:= SB1->B1_UM
			R75->A75_ALQIPI	:= SB1->B1_IPI
			R75->A75_ALQICM	:= SB1->B1_PICM
			R75->A75_BRICMS	:= 0
			R75->A75_SITTRI	:= cSitTrib
			R75->A75_REDBSE	:= 0	
			If MV_PAR15 == 3
				R75->A75_EAN      := SB1->B1_CODBAR
				R75->A75_CODFIS   := &(SuperGetMv("MV_DIC_T06",,"'0850000'"))
			Endif	
			MsUnlock()        
        Endif
        R74->(dbSkip())
    EndDo    
Endif
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Monta Registro Tipo 55³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If mv_par14 <> 4
	dbSelectArea("SF6")
	dbSetOrder(2)
	#IFDEF TOP
	    cAliasSF6 := "a940ASF6"
		aStru  := SF6->(dbStruct())
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SF6")+" "
		cQuery += "WHERE F6_FILIAL='"+xFilial("SF6")+"' AND "
		cQuery += "F6_DTARREC>='"+Dtos(dDtIni)+"' AND "
		cQuery += "F6_DTARREC<='"+Dtos(dDtFim)+"' AND "	
		If !Empty(cEstDest)
			If lListEst
				cQuery += "F6_EST ='"+ cEstDest+"' AND "
			Else
				cQuery += "F6_EST <>'"+ cEstDest+"' AND "
			EndIf
		EndIf			
		cQuery += "D_E_L_E_T_ = ' ' "
		cQuery += "ORDER BY "+SqlOrder(SF6->(IndexKey()))
	
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasSF6,.T.,.T.)
	
		For nX := 1 To len(aStru)
			If aStru[nX][2] <> "C" 
				TcSetField(cAliasSF6,aStru[nX][1],aStru[nX][2],aStru[nX][3],aStru[nX][4])
			EndIf
		Next nX
		dbSelectArea(cAliasSF6)
	#ELSE 
	    (cAliasSF6)->( MsSeek(xFilial("SF6")))
	#ENDIf
	
	ProcRegua(LastRec())
	While (cAliasSF6)->(!Eof()) .And. xFilial("SF6")== (cAliasSF6)->F6_FILIAL
		IncProc(STR0005) //"Selecionando Registros..."
		#IFNDEF TOP
			If (cAliasSF6)->F6_DTARREC < dDtIni .Or. Iif(lListEst,((cAliasSF6)->F6_EST <> cEstDest .And. !Empty(cEstDest)),((cAliasSF6)->F6_EST==cEstDest .And. !Empty(cEstDest)))
				(cAliasSF6)->(dbSkip())
				Loop
			EndIf
			If (cAliasSF6)->F6_DTARREC > dDtFim
				(cAliasSF6)->(dbSkip())
				Loop
			EndIf
	    #ENDIf

    	If !(cAliasSF6)->F6_TIPOIMP$"1# "
			(cAliasSF6)->(dbSkip())
			Loop    	
		EndIf

		RecLock("R55",.T.)	
		R55->A55_CNPJ	:=	SM0->M0_CGC
        If AllTrim((cAliasSF6)->F6_INSC)<>AllTrim(SM0->M0_INSC)
		   R55->A55_IE		:=	ARETDIG((cAliasSF6)->F6_INSC,.t.,(cAliasSF6)->F6_EST)
		Else
		   R55->A55_IE		:=	ARETDIG("",.t.,(cAliasSF6)->F6_EST)
		Endif   
		R55->A55_DATPAG	:=	(cAliasSF6)->F6_DTARREC
		R55->A55_UFSUBS	:=	GETMV("MV_ESTADO")
		R55->A55_UFFAV	:=	(cAliasSF6)->F6_EST
		R55->A55_BANCO	:=	(cAliasSF6)->F6_BANCO
		R55->A55_AGENC	:=	Strzero(val((cAliasSF6)->F6_AGENCIA),4)
		R55->A55_NUMERO	:=	Iif(!Empty((cAliasSF6)->F6_AUTENT),Replicate("0",20-Len(Alltrim((cAliasSF6)->F6_AUTENT)))+Alltrim((cAliasSF6)->F6_AUTENT),Strzero(val((cAliasSF6)->F6_NUMERO),20))
		R55->A55_VALOR	:=	(cAliasSF6)->F6_VALOR
		R55->A55_VENCTO	:=	(cAliasSF6)->F6_DTVENC
		R55->A55_CONVEN	:=	(cAliasSF6)->F6_NUMCONV
	
		SX3->(DbSetOrder(2))
		If !Empty(SF6->F6_ANOREF) .And. SX3->(MsSeek("F6_ANOREF")) .And. X3USO(SX3->X3_USADO)
			R55->A55_MESANO	:= StrZero((cAliasSF6)->F6_MESREF,2)+StrZero((cAliasSF6)->F6_ANOREF,4)
		Else
			R55->A55_MESANO	:= StrZero((cAliasSF6)->F6_MESREF,2)+StrZero(Year(dDatabase),4)
		EndIf
		SX3->(DbSetOrder(1))
		MsUnlock()
	
		(cAliasSF6)->( dbSkip())
		IncProc(STR0036) //"Preparando Base de Dados - 3/3"
	EndDo                      
    dbSelectArea(cAliasSF6)
	dbCloseArea()
Endif

If mv_par20==1
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Monta Registro Tipo 88E³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	SB1->(DbGoTop())
	While !SB1->(Eof())
        SB5->(dbSetOrder(1))
		SB5->(MsSeek(xFilial("SB1")+SB1->B1_COD))
		IF Empty(&cCodSEFMG)
		   SB1->(DbSkip())
	       Loop
	    EndIf
		If len(Alltrim(SB1->B1_COD))>14
			cProd :=STRTRAN(ALLTRIM(SB1->B1_POSIPI),".","")
		Else
			cProd :=SB1->B1_COD
		EndIf
		If !((cArq088E)->(dbSeek(cProd)))
			RecLock(cArq088E,.T.)
			(cArq088E)->A88ECNPJ		:=SM0->M0_CGC
			(cArq088E)->A88EIE			:=ARETDIG(SM0->M0_INSC,.T.,SM0->M0_ESTENT)
			(cArq088E)->A88ECOD			:=cProd
			(cArq088E)->A88ECODSEF		:=&cCodSEFMG
			MsUnlock()
		Endif

        If SB2->(dbSeek(xFilial("SB2")+SB1->B1_COD))
	       aSaldoIni:= CalcEst(cProd,SB2->B2_LOCAL,dDtIni)
	       aSaldoFim:= CalcEst(cProd,SB2->B2_LOCAL,dDtFim)

		   RecLock(cArq088Q,.T.)
		   (cArq088Q)->A88QDATA		:=dDtIni
		   (cArq088Q)->A88QPROD		:=cProd
		   (cArq088Q)->A88QQUANT	:=aSaldoIni[1]
		   (cArq088Q)->A88QTOT		:=aSaldoIni[2]
		   (cArq088Q)->A88QPOSSE	:="01"
		   MsUnlock()

		   RecLock(cArq088Q,.T.)
		   (cArq088Q)->A88QDATA		:=dDtFim
		   (cArq088Q)->A88QPROD		:=cProd
		   (cArq088Q)->A88QQUANT	:=aSaldoFim[1]
		   (cArq088Q)->A88QTOT		:=aSaldoFim[2]
		   (cArq088Q)->A88QPOSSE	:="01"
		   MsUnlock()
        Endif
        
		SB1->(dbSkip())
	Enddo

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Monta Registro Tipo 88M³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	While dDtIni2<=dDtFim
		nPos:=Ascan(aMovimen,{|x|x[1]==ALLTRIM(STR(MONTH(dDtIni2)))+ALLTRIM(STR(YEAR(dDtIni2)))})
		If nPos==0
			AADD(aMovimen,{ALLTRIM(STR(MONTH(dDtIni2)))+ALLTRIM(STR(YEAR(dDtIni2))),""})
		Endif
		dDtIni2 +=1
	Enddo

	For nX :=1 TO Len(aMovimen)
		If aMovimen[nX][2]<>"OK"
			RecLock(cArq088M,.T.)
			(cArq088M)->A88MCNPJ		:=SM0->M0_CGC
			(cArq088M)->A88MMENS		:="Sem Movimento de Entradas/Saidas"
			MsUnlock()
		Endif
	Next
Endif

If lQuery
	dbSelectArea(cAliasSF3)
	dbCloseArea()
Else
  	dbSelectArea("SF3")
	RetIndex("SF3")
	dbClearFilter()
	Ferase(cIndex+OrdBagExt())
EndIf

If !lFirst
	dbSelectArea("SD2")
	RetIndex("SD2")
	dbClearFilter()
	Ferase(cIndex2+OrdBagExt())
Endif

lPerg := !lSamePar
RestArea(aAreaSint)
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Programa  ³A940CNPJ  ³ Autor ³Nereu Humberto Jr      ³ Data ³12.12.2002³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Valida CNPJ                                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³ExpC1: CNPJ valido                                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ExpC1: CNPJ                                                 ³±±
±±³          ³ExpC2: Tipo do Cliente/Fornecedor                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³   DATA   ³ Programador   ³Manutencao Efetuada                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³          ³               ³                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function A940CNPJ(cCGC,cTipo)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Zera o campo de CGC para pessoas nao obrigadas a inscricao.  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ( cTipo=="X")
	cCGC:=""
EndIf

Return(PadR(cCGC,14))
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Programa  ³A940IE    ³ Autor ³Nereu Humberto Jr      ³ Data ³12.12.2002³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Valida Inscricao Estadual                                   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³ExpC1: IE valida                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ExpC1: IE                                                   ³±±
±±³          ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³   DATA   ³ Programador   ³Manutencao Efetuada                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³          ³               ³                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function A940IE(cInsc)

Local cRet	:=	""
Local nI	:=	1

For nI:=1 To Len(cInsc)
	If Isdigit(Subs(cInsc,nI,1)) .Or. IsAlpha(Subs(cInsc,nI,1))
		cRet+=Subs(cInsc,nI,1)
	Endif
Next
If Empty(cRet)
	cRet:="ISENTO"
Endif
Return(cRet)

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Programa  ³A94LoadPro³ Autor ³Nereu Humberto Jr      ³ Data ³26.12.2002³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Define codigo do Produto e do NCM                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³ExpC1: .T.                                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ExpC1: cTipo "E" - SD1 /  "S" - SD2                         ³±±
±±³          ³ExpC2: cNcm                                                 ³±±
±±³          ³ExpC3: cProd                                                ³±±
±±³          ³ExpC4: cTec - SD1->D1_TEC                                   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³   DATA   ³ Programador   ³Manutencao Efetuada                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³          ³               ³                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function A940LoadPro(cTipo,cNcm,cProd,cTec)

If Len(alltrim(SB1->B1_COD))>14
	cNcm  :=STRTRAN(ALLTRIM(SB1->B1_POSIPI),".","")
	cProd :=STRTRAN(ALLTRIM(SB1->B1_POSIPI),".","")
Else
	cNcm  :=STRTRAN(ALLTRIM(SB1->B1_POSIPI),".","")
	cProd :=SUBS(SB1->B1_COD,1,14)
EndIf
If cTipo == "E" .And. cTec <> NIL
	If!Empty(cTec)
		cNcm  :=STRTRAN(ALLTRIM(cTec),".","")
		cProd :=STRTRAN(ALLTRIM(cTec),".","")
	Endif	
EndIf

If Existblock("A940PRD")
    cProd := Execblock("A940PRD",.F.,.F.,{cTipo,cNcm,cProd,cTec}) 
EndIf

If Existblock("A940NCM") 
    cNCM := Execblock("A940NCM",.F.,.F.,{cTipo,cNcm,cProd,cTec}) 
EndIf 

Return(.T.)

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A940Fill     ³Autor ³ Andreia dos Santos  ³ Data ³ 07/01/00 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Encaixa conteudo em espaco especificado                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940Fill(cConteudo,nTam)
	
cConteudo	:=	If(cConteudo==NIL,"",cConteudo)
If Len(cConteudo)>nTam
	cRetorno	:=	Substr(cConteudo,1,nTam)
Else
	cRetorno	:=	cConteudo+Space(nTam-Len(cConteudo))
Endif
	
Return (cRetorno)

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ R940ANumReg  ³Autor ³Andreia dos Santos    ³Data³ 09/04/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ 	    	    			                                  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A940ANumReg(nSize)

Return({1000000000,10800}[Max(nSize,1)])

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFunction³A940AGeraTXT ºAutor  ³Andreia dos Santos  º Data ³ 05/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.   ³Gera Arquivo texto para SINTEGRA                              º±±
±±ÌÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso     ³MATA940A                                                      º±±
±±ÈÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function a940AGeraTxt()

Local cCGC	:=	SM0->M0_CGC
Local cInsc	:=	ARETDIG(SM0->M0_INSC,.T.,SM0->M0_ESTENT)
Local cFaxAux:=	SM0->M0_FAX
Local nVirgula	:= Rat(",",SM0->M0_ENDENT)
Local nNumero 	:= val(AllTrim(SubStr(SM0->M0_ENDENT,nVirgula+1)))
Local cEnderec	:= PadR(IIf(nNumero!=0,SubStr(SM0->M0_ENDENT,1,nVirgula-1),SM0->M0_ENDENT),34)
Local cTelEAux	:= SM0->M0_TEL
Local cContato	:=	GetMV("MV_RESPFIS")
Local cTel		:=	""
Local cFax		:=	""
Local nY		:=	1
Private nDisco	:=1
Private nRegN0	:=0


// Retira caracteres do campo cTeleAux
For nY:=1 To Len(cTeleAux)
	If IsDigit(Subs(cTeleAux,nY,1))
		cTel	+= Subs(cTeleAux,nY,1)
	Endif
Next

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Quando nao ha virgula no endereco procura-se o caracter branco³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ( nVirgula == 0 )
	nVirgula 	:= Rat(" ",AllTrim(SM0->M0_ENDENT))
	nNumero		:= Val(AllTrim(SubStr(SM0->M0_ENDENT,nVirgula+1)))
	cEnderec	:= PadR(IIf(nNumero!=0,SubStr(SM0->M0_ENDENT,1,nVirgula-1),SM0->M0_ENDENT),34)
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Retira caracteres do campo cFax³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
For nY:=1 To Len(cFaxAux)
	If IsDigit(Subs(cFaxAux,nY,1))
		cFax += Subs(cFaxAux,nY,1)
	Endif
Next

If Empty(cCGC)
	cCGC	:=	Replic("0",14)
Endif


//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro TIPO 10 Mestre de Estabelecimento  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
A940AAvlDrv(@nHandle,1,1)

a940AReg10(cCGC,cInsc, cFax)   // registro 10
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro TIPO 11 - Dados Complementares do Informante ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³LayOut diferencia para DIC                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If MV_PAR15 <> 3
	a940AReg11(cEnderec,nNumero,cContato,cTEL)
EndIf
If mv_par26 <> 2
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 50 - Notas Fiscais modelos 1, 1A, 3, 6 e 22 ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940AReg50()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 51 Total da NF quanto ao IPI  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940AReg51()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 53 Substituicao Tributaria    ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940AReg53()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 54 Produto ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940AReg54()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 55 Guia Nacional de Recolhimento de Tributos Estaduais  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940AReg55()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 60 Cupom Fiscal, Cupom Fiscal PDV  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940AReg60()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 61 Model 14, 15, 16, 13, 02, 21, 04 e 07  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940AReg61()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 70 NF de Servico de Transporte  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940AReg70()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 71 Informacoes da Carga Transportada  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940aReg71()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
    //³Registro TIPO 75 Codigo de Produto ou Servico ³
    //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940aReg75()	 
	
	If mv_par21 == 1 .and. MV_PAR15 == 3
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 74 Resumo do Inventario Produto ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	   a940aReg74()
    Endif	
   
EndIf  
If mv_par20==1 .And. mv_par26 <> 2
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 88C  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940ARg88C()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 88D  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940ARg88D()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 88E  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940ARg88E()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 88M  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940ARg88M()
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro TIPO 88Q  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	a940ARg88Q()
Endif

If mv_par15 == 3 .And. mv_par26 <> 2
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Registro Tipo 88/50³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	A940ARG8850()
EndIf
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro TIPO 88         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
a940aReg88()
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro TIPO 90 Mestre  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
a940aReg90()
return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³a940AReg10ºAutor  ³Andreia dos Santos  º Data ³  05/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Grava  registro tipo 11 em arquivo texto                    º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC FUNCTION a940AReg10(cCGC,cInsc,cFax)  // registro 10

Local cRegistro	:=	"10"
Local cCod		:=	"3"	
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³LayOut diferencia para DIC                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If mv_par15 <> 3
	cRegistro	+=	AFISFILL(Num2Chr(Val(cCGC),14,0),14)	// CGC da Empresa
	cRegistro	+=	aFISFILL(cInsc,14)							// Inscricao Estadual
	cRegistro	+=	aFISFILL(SM0->M0_NOMECOM,35)				// Nome Comercial
	cRegistro	+=	aFISFILL(SM0->M0_CIDENT,30)				// Municipio
	cRegistro	+=	aFISFILL(SM0->M0_ESTENT,02)				// Estado
	cRegistro	+=	aFISFILL(Num2Chr(Val(cFax),10,0),10)		// Fax
	cRegistro	+=	aFISFILL(DTOS(dDtIni),08)					// Data Inicial
	cRegistro	+=	aFISFILL(DTOS(dDtFim),08)					// Data Final
    If mv_par22 = 1   //Portaria: 1- 0531/2002 2- 1505/2002 3- 1453/2003
	    cRegistro += aFISFILL("1",01)    // Codigo da identificacao do Convenio   
	Elseif mv_par22 = 2
		cRegistro += aFISFILL("2",01)
	Else
	    cRegistro += aFISFILL("3",01)
	Endif   
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Codigo da Identificacao da Natureza das Operacoes Informadas 							³
	//³ 1-Interestaduais somente com Substituicao Tributaria         							³
	//³ 2-Interestaduais com ou Sem Substituicao Tributaria( Estado Origem/Destino preenchido)  ³
	//³ 3-Totalidade das operacoes do informante (Estado Origem/Destino vazio )                 ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	cCod	:=	(IIf(!Empty(cEstDest),"2",cCod))
	cRegistro	+=	aFISFILL(Str(mv_par23,1),01)		//Codigo da Identificacao da Natureza das Operacoes Informadas
	cRegistro	+=	aFISFILL(alltrim(cFinalid),1)		//Codigo da finalidade do arquivo magnetico	
Else
	cRegistro	+=	aFISFILL(StrZero(Val(SM0->M0_INSC),10),10)				// Inscricao Estadual
	cRegistro	+=	AFISFILL(Num2Chr(Val(cCGC),14,0),14)	// CGC da Empresa
	cRegistro	+=	aFISFILL(Substr(DTOS(dDtIni),1,4),04)
	cRegistro	+=	aFISFILL(Substr(DTOS(dDtIni),5,2),02)
	cRegistro	+=	aFISFILL(Strzero(Val(mv_par16),5),05)
	cRegistro	+=	Iif(!empty(mv_par17),aFISFILL(StrZero(Val(ALLTRIM(mv_par17)),10),10),aFISFILL(Repl("0",10),10))
	cRegistro	+=	Iif(MV_PAR25 == 1,"S","N")
	cRegistro	+=	Iif(mv_par26 == 1,"A","B")
    If mv_par22 = 1   //Portaria: 1- 531/2002 2- 1505/2002 3- 1453/2003
	    cRegistro += aFISFILL("1",01)    // Codigo da identificacao do Convenio   
	Elseif mv_par22 = 2
		cRegistro += aFISFILL("2",01)
	Else
	    cRegistro += aFISFILL("3",01)
	Endif  
	cRegistro	+=	Space(134)
EndIf
A940AGRAVA(cRegistro)
Return
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A940AReg11   ³Autor ³ Andreia dos Santos  ³ Data ³ 05/04/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Grava registro tipo 11                                      ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A940AReg11(cEnderec,nNumero,cContato,cTEL)

Local cRegistro	:=	"11"
Local aArray	:=	{}
Local lMta940Efs:=	(existblock("A940EFS"))	

If lMta940Efs
	aArray	:=	ExecBlock("A940EFS",.F.,.F.)
Endif

If Empty(aArray) .Or. !(ValType(aArray) == "A") .or.(ValType(aArray) == "A" .and. Len(aArray) # 7)
	aArray := { 	cEnderec	,;				//	[1] Endereco
		nNumero		,;				//	[2] Numero
		SM0->M0_COMPENT	,;				//	[3] complemento
		PadR(SM0->M0_BAIRENT,15),;	//	[4] Bairro
		Val(SM0->M0_CEPENT)	 ,;	//	[5] CEP
		cContato				 ,;	//	[6] Contato
		PadR(cTEL,12) }			//	[7] Telefone
Else
	aArray[1]	:=	IIf( !(Valtype(aArray[1])=="C"),cEnderec,aArray[1])
	aArray[2]	:=	IIf( !(Valtype(aArray[2])=="N"),nNumero,aArray[2])
	aArray[3]	:=	IIf( !(Valtype(aArray[3])=="C"),SM0->M0_COMPENT,aArray[3])
	aArray[4]	:=	IIf( !(Valtype(aArray[4])=="C"),PadR(SM0->M0_BAIRENT),aArray[4])
	aArray[5]	:=	IIf( !(Valtype(aArray[5])=="N"),Val(SM0->M0_CEPENT),aArray[5])
	aArray[6]	:=	IIf( !(Valtype(aArray[6])=="C"),cContato,aArray[6])
	aArray[7]	:=	IIf( !(Valtype(aArray[7])=="N"),PadR(cTEL,12),aArray[7])
EndIf

cRegistro	+=	a940Fill(aArray[1],34)						// Logradouro
cRegistro	+=	a940Fill(Num2Chr(aArray[2],5,0),05)	// Numero
cRegistro	+=	a940Fill(IIf(aArray[2]==0 .And. !lMta940Efs ,"S/N",aArray[3]),22)						// Complemento
cRegistro	+=	a940Fill(aArray[4],15)						// Bairro
cRegistro	+=	a940Fill(Num2Chr(aArray[5],8,0),08)	// CEP
cRegistro	+=	a940Fill(aArray[6],28)					  	// Contato
cRegistro	+=	a940Fill(Num2Chr(Val(aArray[7]),12,0),12)	// Telefone

A940AGRAVA(cRegistro)

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940AREG50ºAutor  ³Andreia dos Santos  º Data ³  05/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 50                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC FUNCTION A940AREG50()

Local cRegistro	:=	""
Local cMVEstado 	:= 	GetNewPar("MV_ESTADO","")
ProcRegua( R50->(LastRec()))
R50->(dbSetOrder(1))
R50->(dbGoTop())

While R50->(!EOF())

    If YEAR(dDtFim)<2003
	   	cRegistro	:="50"	
	   	cRegistro	+=	AFISFILL(Num2Chr(Val(R50->A50_CNPJ),14,0),14)			//02. CGC
		cRegistro	+=	AFISFILL(R50->A50_IE,14)									//03. Inscricao Estadual
		cRegistro	+=	AFISFILL(DTOS(R50->A50_ENTRAD),08)						//04. Data de entrada 
		cRegistro	+=	AFISFILL(R50->A50_UF,02)    								//05. Unidade da federacao do Remetente/Destinatario
		cRegistro	+=	AFISFILL(R50->A50_MODELO,02)		  		 				//06.Codigo do Modelo da Nota fiscal
		cRegistro	+=	AFISFILL(FisGetSer(R50->A50_SDOC),03)					//07. Serie da Nota Fiscal
		cRegistro	+=	AFISFILL(SPACE(02),02)    								//08. SubSerie
		cRegistro	+=	RetNf(R50->A50_NFISC,6,"N") 			//09.Numero da Nota Fiscal
		cRegistro	+=	AFISFILL(Num2Chr(Val(substr(R50->A50_CFOP,1,3)),3,0),3) //10.CFOP
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_VALTOT,13),13)					//12.Valor Total da Nota Fiscal
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_BSICM,13),13)					//13.Base de Calculo do ICMS
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_VALICM,13),13)					//14.Valor do ICMS
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_ISENTO,13),13)					//15.ICMS Isento
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_OUTRAS,13),13)					//16.ICMS outras
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_ALQICM,4),4)					//17.Aliquota do ICMS
		cRegistro	+=	AFISFILL(R50->A50_SITUAC,1)								//18.Situacao quanto ao cancelamento
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			cRegistro += AFISFILL(Strzero(Val(mv_par16),5),5)
			cRegistro += AFISFILL(Strzero(Val(R50->A50_ANOAID),4),4)
			cRegistro += AFISFILL(Strzero(Val(R50->A50_NUMAID),5),5)
			cRegistro += AFISFILL(StrZero(Val(R50->A50CFOPEXT),2)) //21.CFOP Extendido
			cRegistro += AFISFILL(DTOS(R50->A50_EMISS),08)//22. Data de emissao 
			cRegistro += Space(34)
		EndIf
	Else 
	   	cRegistro	:="50"	
	   	cRegistro	+=	AFISFILL(Num2Chr(Val(R50->A50_CNPJ),14,0),14)	//02. CGC
		cRegistro	+=	AFISFILL(R50->A50_IE,14)							//03. Inscricao Estadual
		cRegistro	+=	AFISFILL(DTOS(R50->A50_ENTRAD),08)				//04. Data de entrada 
		cRegistro	+=	AFISFILL(R50->A50_UF,02)    						//05. Unidade da federacao do Remetente/Destinatario
		cRegistro	+=	AFISFILL(R50->A50_MODELO,02)		  		 		//06.Codigo do Modelo da Nota fiscal
		cRegistro	+=	AFISFILL(FisGetSer(R50->A50_SDOC),03)			//07. Serie da Nota Fiscal
		cRegistro	+=	RetNf(R50->A50_NFISC,6,"N") 	//09.Numero da Nota Fiscal
		cRegistro	+=	AFISFILL(Num2Chr(Val(substr(R50->A50_CFOP,1,4)),4,0),4) //10.CFOP
		cRegistro	+=	AFISFILL(R50->A50_EMIT,1) //11.Emitente
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_VALTOT,13),13)		//12.Valor Total da Nota Fiscal
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_BSICM,13),13)		//13.Base de Calculo do ICMS
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_VALICM,13),13)		//14.Valor do ICMS
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_ISENTO,13),13)		//15.ICMS Isento
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_OUTRAS,13),13)		//16.ICMS outras
		cRegistro	+=	AFISFILL(Num2Chr(R50->A50_ALQICM,4),4)		//17.Aliquota do ICMS
		cRegistro	+=	AFISFILL(R50->A50_SITUAC,1)					//18.Situacao quanto ao cancelamento
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			If cMVEstado=="SE" .AND. !Empty(R50->A50_CODMUN)
				cRegistro += AFISFILL(Strzero(Val(R50->A50_CODMUN),5),5)
			Else
				cRegistro += AFISFILL(Strzero(Val(mv_par16),5),5)
			EndIf			
			cRegistro += AFISFILL(Strzero(Val(R50->A50_ANOAID),4),4)
			cRegistro += AFISFILL(Strzero(Val(R50->A50_NUMAID),5),5)
			cRegistro += AFISFILL(StrZero(Val(R50->A50CFOPEXT),2),2)
			cRegistro += AFISFILL(DTOS(R50->A50_EMISS),08)//22. Data de emissao
			cRegistro += Space(34)
		EndIf	
	Endif	
	A940aGrava(cRegistro)
	R50->(dbSkip())	
	IncProc(STR0023) //"Gravando Registro Tipo 50"
End

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFUNCAO    ³A940AREG51ºAutor  ³Andreia dos Santos  º Data ³  05/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 51                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A940AReg51()

Local cRegistro	:=""
Local cCNPJ	:= ""

ProcRegua( R51->(LastRec()))

R51->(dbGoTop())
While R51->(!eof())

    If YEAR(dDtFim)<2003
		cCNPJ		:= IIf(!empty(R51->A51_CNPJ),R51->A51_CNPJ,Replic("0",14))
		cRegistro	:=	"51"
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)				//02.CGC
		cRegistro	+=	aFISFill(R51->A51_IE,14)						//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R51->A51_EMISS),8)			//04.Data de emissao/Recebimento
		cRegistro	+=	aFISFill(R51->A51_UF,2)						//05.UF
	
		If MV_PAR15 <> 3
			cRegistro	+=	AFISFILL(FisGetSer(R51->A51_SDOC),02) 					//06.Serie	
			cRegistro	+=	aFISFill(SPACE(02),2)					//07.Sub-serie
		Else
			cRegistro	+=	AFISFILL(FisGetSer(R51->A51_SDOC),03) 					//06.Serie	
		EndIf	
		cRegistro	+=	RetNf(R51->A51_NFISC,6,"N") //08.Numero da Nota Fiscal
		cRegistro	+=	aFISFill(Num2Chr(Val(substr(R51->A51_CFOP,1,3)),3,0),3) //09.CFOP		
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_VALTOT,13),13)	//10.Valor Total da NF
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_VALIPI,13),13)	//11.Valor do IPI
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_ISENTA,13),13)	//12.IPI isento
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_OUTRAS,13),13)	//13.IPI outras
		cRegistro	+=	aFISFill(,20)										//14.Brancos
		cRegistro	+=	aFISFill(R51->A51_SITUAC,1)					//15.Situacao quanto ao cancelamento
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			cRegistro	+=	aFISFill(Num2Chr(R51->A51_BASIPI,13),13)					//15.Situacao quanto ao cancelamento		
			cRegistro += Space(45)	

		EndIf
	Else
		cCNPJ		:= IIf(!empty(R51->A51_CNPJ),R51->A51_CNPJ,Replic("0",14))
		cRegistro	:=	"51"
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)				//02.CGC
		cRegistro	+=	aFISFill(R51->A51_IE,14)						//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R51->A51_EMISS),8)			//04.Data de emissao/Recebimento
		cRegistro	+=	aFISFill(R51->A51_UF,2)						//05.UF
		cRegistro	+=	AFISFILL(FisGetSer(R51->A51_SDOC),03) 					//06.Serie	
		cRegistro	+=	RetNf(R51->A51_NFISC,6,"N") //08.Numero da Nota Fiscal
		cRegistro	+=	aFISFill(Num2Chr(Val(substr(R51->A51_CFOP,1,4)),4,0),4) //09.CFOP
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_VALTOT,13),13)	//10.Valor Total da NF
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_VALIPI,13),13)	//11.Valor do IPI
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_ISENTA,13),13)	//12.IPI isento
		cRegistro	+=	aFISFill(Num2Chr(R51->A51_OUTRAS,13),13)	//13.IPI outras
		cRegistro	+=	aFISFill(,20)										//14.Brancos
		cRegistro	+=	aFISFill(R51->A51_SITUAC,1)					//15.Situacao quanto ao cancelamento
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			cRegistro	+=	aFISFill(Num2Chr(R51->A51_BASIPI,13),13)					//15.Situacao quanto ao cancelamento		
			cRegistro += Space(45)	
		EndIf
	Endif	
	A940aGrava(cRegistro)
	R51->(dbSkip())		
	IncProc(STR0024) //"Gravando Registro Tipo 51"
End

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³a940AReg53ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 53                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940AReg53()
Local cRegistro	:=	""
Local cCNPJ		:= ""

ProcRegua( R53->(LastRec()))
R53->(dbGoTop())
While R53->( !eof())
    If YEAR(dDtFim)<2003
		cCNPJ		:= IIf(!empty(R53->A53_CNPJ),R53->A53_CNPJ,Replic("0",14))

		cRegistro	:=	"53"
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)			//02.CGC
		cRegistro	+=	aFISFill(R53->A53_IE,14)				   	//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R53->A53_EMISS),08)		//04.Data de Emissao/Recebimento
		cRegistro	+=	aFISFill(R53->A53_UF,02)			   		//05.Unidade de Federacao
		cRegistro	+=	aFISFill(R53->A53_MODELO,02)				//06.Codigo do modelo da NF
		cRegistro	+=	AFISFILL(FisGetSer(R53->A53_SDOC),03)		//07.Serie da NF
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(SPACE(02),2)				//08.Subserie
		EndIf
		cRegistro	+=	RetNf(R53->A53_NFISC,6,"N")	//09.Numero da Nota Fiscal
		If MV_PAR15 == 3
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R53->A53_CFOP,1,4)),4,0),4)//10.CFOP
			cRegistro	+=	aFISFill(R53->A53_EMIT,1)							//11.EMITENTE					
		Else
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R53->A53_CFOP,1,3)),3,0),3)//10.CFOP	
		EndIf
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_BRICMS,13),13) 				//11.Base do ICMS Retido
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_VALRET,13),13) 				//12.ICMS Retido
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_DESPES,13),13)				//13.Despesas Acessorias
		cRegistro	+=	aFISFill(R53->A53_SITUAC,1)							//14.Situacao quanto ao cancelamento
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(,30)									//15.Brancos
		Else
			cRegistro	+=	aFISFill(,88)									//15.Brancos		
		EndIf
	Else
		cCNPJ		:= IIf(!empty(R53->A53_CNPJ),R53->A53_CNPJ,Replic("0",14))

		cRegistro	:=	"53"
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)			//02.CGC
		cRegistro	+=	aFISFill(R53->A53_IE,14)				   	//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R53->A53_EMISS),08)		//04.Data de Emissao/Recebimento
		cRegistro	+=	aFISFill(R53->A53_UF,02)			   		//05.Unidade de Federacao
		cRegistro	+=	aFISFill(R53->A53_MODELO,02)				//06.Codigo do modelo da NF
		cRegistro	+=	AFISFILL(FisGetSer(R53->A53_SDOC),03)	//07.Serie da NF
		cRegistro	+=	RetNf(R53->A53_NFISC,6,"N")	//09.Numero da Nota Fiscal
		cRegistro	+=	aFISFill(Num2Chr(Val(substr(R53->A53_CFOP,1,4)),4,0),4)//10.CFOP
		cRegistro	+=	aFISFill(R53->A53_EMIT,1)							//11.EMITENTE					
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_BRICMS,13),13) 				//11.Base do ICMS Retido
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_VALRET,13),13) 				//12.ICMS Retido
		cRegistro	+=	aFISFill(Num2Chr(R53->A53_DESPES,13),13)				//13.Despesas Acessorias
		cRegistro	+=	aFISFill(R53->A53_SITUAC,1)							//14.Situacao quanto ao cancelamento
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(,30)									//15.Brancos
		Else
			cRegistro	+=	aFISFill(R53->A53_ANTECI,1)						//15.Codigo Antecipacao Tributaria   
			cRegistro	+=	aFISFill(,87)									//15.Brancos		
		EndIf	
	Endif	
	A940AGrava(cRegistro)
	R53->(dbSkip())		
	IncProc(STR0025) //"Gravando Registro Tipo 53"
End

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³a940AReg54ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 54                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940AReg54()

Local cRegistro
Local cCNPJ	:= ""

ProcRegua( R54->(LastRec()))
R54->(dbGoTop())

While R54->(!eof())

    If YEAR(dDtFim)<2003

		cCNPJ		:= IIf(!empty(R54->A54_CNPJ),R54->A54_CNPJ,Replic("0",14))

		cRegistro	:=	"54"												//01.Tipo
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)				//02.CGC
		cRegistro	+=	aFISFill(R54->A54_MODELO,2)					
		//03.Codigo do modelo da NF
		cRegistro	+=	AFISFILL(FisGetSer(R54->A54_SDOC),03)				//04.Serie da NF
		If MV_PAR15 == 3
			cRegistro	+=	RetNf(R54->A54_NFISC,6,"N")//06.Numero da NF			
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R54->A54_CFOP,1,4)),4,0),4)//07.CFOP
			cRegistro	+=	IIf (aFISFill(R54->A54_NUMITE,3)$"991/992/993/999","   ",aFISFill(Num2Chr(Val(R54->A54_CST),3,0),3)) //08.CST
		Else
			cRegistro	+=	aFISFill(SPACE(02),2)					//05.Sub-serie
			cRegistro	+=	RetNf(R54->A54_NFISC,6,"N")//06.Numero da NF	
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R54->A54_CFOP,1,3)),3,0),3)//07.CFOP
		Endif
		cRegistro	+=	aFISFill(R54->A54_NUMITE,3)	   				//08.Numero do Item
		cRegistro	+=	aFISFill(Left(R54->A54_PRODUT,14),14)		//09.Codigo do produto ou servico
		If Mv_par15 == 3
			cRegistro	+=	aFISFill(Num2Chr(R54->A54_QUANT,11,3),11)	//10.Quantidade do produto
		Else
			cRegistro	+=	aFISFill(Num2Chr(R54->A54_QUANT,13,3),13)	//10.Quantidade do produto	
		EndIf
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_VALPRO,12),12) 	//11.Valor bruto do produto
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_VALDES,12),12)		//12.Valor do Desconto
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_BSICM,12),12)		//13.Base de calculo do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_BRICMS,12),12)		//14.Base de calculo do ICMS retido
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_VALIPI,12),12)		//15.Valor do IPI
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_ALQICM,4),4)		//16.Aliquota do ICMS
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ	
		IF MV_PAR15 == 3
			cRegistro += Space(03)
			cRegistro += AFISFILL(StrZero(Val(R54->A54CFOPEXT),2),2)
			cRegistro += Space(53)
		EndIf
	Else
		cCNPJ		:= IIf(!empty(R54->A54_CNPJ),R54->A54_CNPJ,Replic("0",14))

		cRegistro	:=	"54"												//01.Tipo
		cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)				//02.CGC
		cRegistro	+=	aFISFill(R54->A54_MODELO,2)					
		cRegistro	+=	AFISFILL(FisGetSer(R54->A54_SDOC),03)//04.Serie da NF
		cRegistro	+=	RetNf(R54->A54_NFISC,6,"N")//06.Numero da NF			
		cRegistro	+=	aFISFill(Num2Chr(Val(substr(R54->A54_CFOP,1,4)),4,0),4)//07.CFOP
		cRegistro	+=	IIf (aFISFill(R54->A54_NUMITE,3)$"991/992/993/999","   ",aFISFill(Num2Chr(Val(R54->A54_CST),3,0),3)) //08.CST
		cRegistro	+=	aFISFill(R54->A54_NUMITE,3)	   				//08.Numero do Item
		cRegistro	+=	aFISFill(Left(R54->A54_PRODUT,14),14)		//09.Codigo do produto ou servico
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_QUANT,11,3),11)	//10.Quantidade do produto

		cRegistro	+=	aFISFill(Num2Chr(IIF(R54->A54_NUMITE$"991/992/993/999",0,R54->A54_VALPRO),12),12) 	//11.Valor bruto do produto
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_VALDES,12),12)		//12.Valor do Desconto
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_BSICM,12),12)		//13.Base de calculo do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_BRICMS,12),12)		//14.Base de calculo do ICMS retido
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_VALIPI,12),12)		//15.Valor do IPI
		cRegistro	+=	aFISFill(Num2Chr(R54->A54_ALQICM,4),4)		//16.Aliquota do ICMS
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ	
		IF MV_PAR15 == 3
			cRegistro += Space(03)
			cRegistro += AFISFILL(StrZero(Val(R54->A54CFOPEXT),2),2)
			cRegistro += Space(53)
		EndIf
	Endif	
	A940AGrava(cRegistro)

	R54->(dbSkip())
	IncProc(STR0026) //"Gravando Registro Tipo 54"
EndDo	

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³a940AReg55ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 55                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940AReg55()
Local cRegistro


ProcRegua( R55->(LastRec()))

R55->(dbGoTop())

While R55->(!eof())


    If YEAR(dDtFim)<2003

		cInsc	:= IIf("ISENT"$R55->A55_IE,"INEXISTENTE",R55->A55_IE)		

		cRegistro	:=	"55"														//01.Tipo
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_CNPJ),14,0),14)	//02.CGC
		cRegistro	+=	a940Fill(cInsc,14)											//03.Inscricao Estadual
		cRegistro	+=	a940Fill(DTOS(R55->A55_DATPAG),8)					//04.Data do pagamento do documento de arrecadacao
		cRegistro	+=	a940Fill(R55->A55_UFSUBS,2)							//05.Sigla da Unidade da Federacao do Contribuinte Subst. Tributario
		cRegistro	+=	a940Fill(R55->A55_UFFAV,2)							//06.Sigla da Unidade da Federacao de Destino ( favorecida)
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_BANCO),3,0),3)   	//07.Codigo do banco onde foi efetuado o recolhimento
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_AGENC),4,0),4) 	//08.Codigo da agencia onde foi efetuado o recolhimento
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_NUMERO),12,0),12)//09.Numero da autenticacao bancaria do documento de arrecadacao
		cRegistro	+=	a940Fill(Num2Chr(R55->A55_VALOR,13),13)		//10.Valor da Arrecadacao
		cRegistro	+=	a940Fill(DTOS(R55->A55_VENCTO),8)					//12.Data do Vencimento do ICMS substituto
		cRegistro	+=	a940Fill(R55->A55_MESANO,6) 							//12.Mes e Ano de referencia
		cRegistro	+=	a940Fill(R55->A55_CONVEN,30)							//13.Numero do convenio ou protocolo/Mercadoria
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 <> 3
			cRegistro	+=	a940Fill(,08) 												//14.Brancos
		Else	
			cRegistro	+=	a940Fill(,66) 												//14.Brancos
		EndIf
	Else	
		cInsc	:= IIf("ISENT"$R55->A55_IE,"INEXISTENTE",R55->A55_IE)		
		cRegistro	:=	"55"														//01.Tipo
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_CNPJ),14,0),14)	//02.CGC
		cRegistro	+=	a940Fill(cInsc,14)											//03.Inscricao Estadual
		cRegistro	+=	a940Fill(DTOS(R55->A55_DATPAG),8)					//04.Data do pagamento do documento de arrecadacao
		cRegistro	+=	a940Fill(R55->A55_UFSUBS,2)							//05.Sigla da Unidade da Federacao do Contribuinte Subst. Tributario
		cRegistro	+=	a940Fill(R55->A55_UFFAV,2)							//06.Sigla da Unidade da Federacao de Destino ( favorecida)
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_BANCO),3,0),3)   	//07.Codigo do banco onde foi efetuado o recolhimento
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_AGENC),4,0),4) 	//08.Codigo da agencia onde foi efetuado o recolhimento
		cRegistro	+=	a940Fill(Num2Chr(Val(R55->A55_NUMERO),20,0),20)//09.Numero da autenticacao bancaria do documento de arrecadacao
		cRegistro	+=	a940Fill(Num2Chr(R55->A55_VALOR,13),13)		//10.Valor da Arrecadacao
		cRegistro	+=	a940Fill(DTOS(R55->A55_VENCTO),8)					//12.Data do Vencimento do ICMS substituto
		cRegistro	+=	a940Fill(R55->A55_MESANO,6) 							//12.Mes e Ano de referencia
		cRegistro	+=	a940Fill(R55->A55_CONVEN,30)							//13.Numero do convenio ou protocolo/Mercadoria
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			cRegistro	+=	a940Fill(,58) 												//14.Brancos
		EndIf
	Endif
	A940AGrava(cRegistro)

	R55->(dbSkip())
	IncProc(STR0027) //"Gravando Registro Tipo 55"
End

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940AREG60ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 60                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A940AREG60()

Local aReg60A		:= {}

Local cRegistro		:= ""
Local cRegistro2	:= ""
Local cChave60 		:= ""

Local nX			:= 0

If YEAR(dDtFim) >= 2003 .And. MV_PAR15 == 3
	A60->(dbSetOrder(2))
Else
	A60->(dbSetOrder(1))
Endif

ProcRegua( M60->(LastRec()))
M60->(dbGoTop())
While M60->(!eof())

    If YEAR(dDtFim)<2003

		cRegistro	:=	"60"										//01.Tipo
		cRegistro	+=	"M"							  				//02.Mestre
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(DTOS(M60->M60_EMISS),8)	//03.Data de emissao
			cRegistro	+=	aFISFill(Num2Chr(Val(M60->M60_PDV),3,0),3) //04.Numero da maquina,ECF
			cRegistro	+=	aFISFill(M60->M60_NUMFAB,15)			//05.Numero de serie de fabricacao do equimento ecf
			cRegistro	+=	aFISFill(M60->M60_MODELO,2)			//06.Modelo do documento Fiscal
			cRegistro	+=	RetNf(M60->M60_NUMINI,6,"C")+Space((6-Len(RetNf(M60->M60_NUMINI,6,"C"))))			//07.Numero do 1o. documento emitido no dia
			cRegistro	+=	RetNf(M60->M60_NUMFIM,6,"C")+Space((6-Len(RetNf(M60->M60_NUMFIM,6,"C"))))			//08.Numero do ultimo doc. emitido no dia
			cRegistro	+=	aFISFill(Num2Chr(VAL(M60->M60_REDUCZ),6,0),06)	//09.Numero de contador de reducao Z
	  	    cRegistro	+=	aFISFill(Num2Chr(M60->M60_VENDA,16,2),16)	//11.Totalizador Geral no inicio do dia
		    cRegistro	+=	aFISFill(Num2Chr(M60->M60_GERAL,16,2),16)	//12.Totalizador Geral no final do dia
			cRegistro	+=	aFISFill(,45)								//12.Brancos
		Else			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³LayOut diferencia para DIC                          ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			cRegistro	+=	aFISFill(DTOS(M60->M60_EMISS),8)	//03.Data de emissao
			cRegistro	+=	aFISFill(M60->M60_NUMFAB,20)			//05.Numero de serie de fabricacao do equimento ecf
			cRegistro	+=	aFISFill(Num2Chr(Val(M60->M60_PDV),3,0),3) //04.Numero da maquina,ECF
			cRegistro	+=	aFISFill(M60->M60_MODELO,2)			//06.Modelo do documento Fiscal
			cRegistro	+=	RetNf(M60->M60_NUMINI,6,"C")+Space((6-Len(RetNf(M60->M60_NUMINI,6,"C"))))			//07.Numero do 1o. documento emitido no dia
			cRegistro	+=	RetNf(M60->M60_NUMFIM,6,"C")+Space((6-Len(RetNf(M60->M60_NUMFIM,6,"C"))))			//08.Numero do ultimo doc. emitido no dia
			cRegistro	+=	aFISFill(Num2Chr(VAL(M60->M60_REDUCZ),6,0),06)	//09.Numero de contador de reducao Z
			cRegistro	+=	aFISFill(Num2Chr(M60->M60_CRO,3,0),03)	//10.CRO
	  	    cRegistro	+=	aFISFill(Num2Chr(M60->M60_VENDA,16,2),16)	//11.Totalizador Geral no inicio do dia
		    cRegistro	+=	aFISFill(Num2Chr(M60->M60_GERAL,16,2),16)	//12.Totalizador Geral no final do dia
			cRegistro	+=	aFISFill(,95)								//13.Brancos	
		EndIf
	Else
	    cRegistro	:=	"60"										//01.Tipo
	    cRegistro	+=	"M"							  				//02.Mestre
		If MV_PAR15 <> 3
		   cRegistro	+=	aFISFill(DTOS(M60->M60_EMISS),8)	//03.Data de emissao
		   cRegistro	+=	aFISFill(M60->M60_NUMFAB,20)			//05.Numero de serie de fabricacao do equimento ecf
		   cRegistro	+=	aFISFill(Num2Chr(Val(M60->M60_PDV),3,0),3) //04.Numero da maquina,ECF
		   cRegistro	+=	aFISFill(M60->M60_MODELO,2)			//06.Modelo do documento Fiscal
		   cRegistro	+=	RetNf(M60->M60_NUMINI,6,"C")+Space((6-Len(RetNf(M60->M60_NUMINI,6,"C"))))			//07.Numero do 1o. documento emitido no dia
		   cRegistro	+=	RetNf(M60->M60_NUMFIM,6,"C")+Space((6-Len(RetNf(M60->M60_NUMFIM,6,"C"))))			//08.Numero do ultimo doc. emitido no dia
		   cRegistro	+=	aFISFill(Num2Chr(VAL(M60->M60_REDUCZ),6,0),06)	//09.Numero de contador de reducao Z
		   cRegistro	+=	aFISFill(Num2Chr(M60->M60_CRO,3,0),03)	//10.CRO
	  	   cRegistro	+=	aFISFill(Num2Chr(M60->M60_VENDA,16,2),16)	//11.Totalizador Geral no inicio do dia
		   cRegistro	+=	aFISFill(Num2Chr(M60->M60_GERAL,16,2),16)	//12.Totalizador Geral no final do dia
		   cRegistro	+=	aFISFill(,37)								//12.Brancos
		Else
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³LayOut diferencia para DIC                                           ³
			//³De acordo com o novo layout - a partir de 2004, os registros de cupom³
			//³deverão ser gerados estruturados, exemplo:                           ³
			//³60M                                                                  ³
			//³      60A                                                            ³
			//³      60A                                                            ³
			//³      60A                                                            ³
			//³60M                                                                  ³
			//³.                                                                    ³
			//³.                                                                    ³
			//³.                                                                    ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			cRegistro	+=	aFISFill(DTOS(M60->M60_EMISS),8)	//03.Data de emissao
			cRegistro	+=	aFISFill(M60->M60_NUMFAB,20)			//05.Numero de serie de fabricacao do equimento ecf
			cRegistro	+=	aFISFill(Num2Chr(Val(M60->M60_PDV),3,0),3) //04.Numero da maquina,ECF
			cRegistro	+=	aFISFill(M60->M60_MODELO,2)			//06.Modelo do documento Fiscal
			cRegistro	+=	RetNf(M60->M60_NUMINI,6,"C")+Space((6-Len(RetNf(M60->M60_NUMINI,6,"C"))))			//07.Numero do 1o. documento emitido no dia
			cRegistro	+=	RetNf(M60->M60_NUMFIM,6,"C")+Space((6-Len(RetNf(M60->M60_NUMFIM,6,"C"))))				//08.Numero do ultimo doc. emitido no dia
			cRegistro	+=	aFISFill(Num2Chr(VAL(M60->M60_REDUCZ),6,0),06)	//09.Numero de contador de reducao Z
			cRegistro	+=	aFISFill(Num2Chr(M60->M60_CRO,3,0),03)	//10.CRO
	  	    cRegistro	+=	aFISFill(Num2Chr(M60->M60_VENDA,16,2),16)	//11.Totalizador Geral no inicio do dia
		    cRegistro	+=	aFISFill(Num2Chr(M60->M60_GERAL,16,2),16)	//12.Totalizador Geral no final do dia
			cRegistro	+=	aFISFill(,95)								//13.Brancos	
			cChave60 	:= dTos(M60->M60_EMISS)+M60->M60_NUMFAB+M60->M60_PDV
			aReg60A		:= {}
			If A60->(dbSeek(dTos(M60->M60_EMISS)+M60->M60_NUMFAB+M60->M60_PDV))	
				Do While !(A60->(Eof())) .And. cChave60 == dTos(A60->A60_EMISS)+A60->A60_NUMFAB+A60->A60_PDV
					cRegistro2	:=	"60"											//01.Tipo
					cRegistro2	+=	"A"												//02.Mestre/ANALITICO
					cRegistro2	+=	aFISFill(DTOS(A60->A60_EMISS),8)	   			//03.Data de emissao
					cRegistro2	+=	aFISFill(A60->A60_NUMFAB,20)
					cRegistro2	+=	aFISFill(A60->A60_SITTRI,04)			   		//05.Situacao Tributaria/Aliquota	
					cRegistro2	+=	aFISFill(Num2Chr(A60->A60_VALOR,12),12)		//06.Valor Acumulado
					cRegistro2	+=	aFISFill(,137)									//07.Brancos
					aAdd(aReg60A,cRegistro2)
					A60->(dbSkip())
				Enddo
			Endif   
		Endif
	Endif	

	A940AGrava(cRegistro)
	If MV_PAR15 == 3 .And. YEAR(dDtFim) >= 2003
		For nX := 1 to Len(aReg60A)
			A940AGrava(aReg60A[nX])
		Next
	Endif
	M60->(dbSkip())
	IncProc(STR0028) //"Gravando Registro Tipo 60-Mestre"
EndDo

ProcRegua( A60->(LastRec()))
A60->(dbGoTop())
While A60->(!eof())

    If YEAR(dDtFim)<2003
		cRegistro	:=	"60"											//01.Tipo
		cRegistro	+=	"A"												//02.Mestre/ANALITICO
		cRegistro	+=	aFISFill(DTOS(A60->A60_EMISS),8)		//03.Data de emissao
		If MV_PAR15==3
			cRegistro	+=	aFISFill(A60->A60_NUMFAB,20)
			cRegistro	+=	aFISFill(A60->A60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
		Else
			cRegistro	+=	aFISFill(Num2Chr(Val(A60->A60_PDV),3,0),3) //04.Numero da maquina,ECF
			cRegistro	+=	aFISFill(A60->A60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
		EndIf	
		cRegistro	+=	aFISFill(Num2Chr(A60->A60_VALOR,12),12)	//06.Valor Acumulado
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 <> 3
			cRegistro	+=	aFISFill(,96)									//07.Brancos
		Else
			cRegistro	+=	aFISFill(,137)									//07.Brancos
		EndIf            
	Else 
		If MV_PAR15 <> 3
			cRegistro	:=	"60"											//01.Tipo
			cRegistro	+=	"A"												//02.Mestre/ANALITICO
			cRegistro	+=	aFISFill(DTOS(A60->A60_EMISS),8)	   			//03.Data de emissao
			cRegistro	+=	aFISFill(Num2Chr(Val(A60->A60_PDV),3,0),3) 	//04.Numero da maquina,ECF
			cRegistro	+=	aFISFill(A60->A60_SITTRI,04)			   		//05.Situacao Tributaria/Aliquota	
			cRegistro	+=	aFISFill(Num2Chr(A60->A60_VALOR,12),12)		//06.Valor Acumulado
			cRegistro	+=	aFISFill(,96)									//07.Brancos
		EndIf            
	Endif	

	If MV_PAR15 <> 3
		A940AGRAVA(cRegistro)
	Endif

	A60->(dbSkip())
	IncProc(STR0029) //"Gravando Registro Tipo 60-Analitico"
EndDo

ProcRegua( D60->(LastRec()))
D60->(dbGoTop())
While D60->(!eof())

    If YEAR(dDtFim)>2002
		cRegistro	:=	"60"											//01.Tipo
		cRegistro	+=	"D"												//02.Mestre/ANALITICO
		cRegistro	+=	aFISFill(DTOS(D60->D60_EMISS),8)		//03.Data de emissao
		cRegistro	+=	aFISFill(D60->D60_NUMFAB,20)
		cRegistro	+=	aFISFill(D60->D60_CODPRO,14)
		cRegistro	+=	aFISFill(Num2Chr(D60->D60_QUANT,13),13)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(D60->D60_VALOR,16),16)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(D60->D60_BSICM,16),16)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(D60->D60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
		cRegistro	+=	aFISFill(Num2Chr(D60->D60_VLICM,13),13)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(,19)									//07.Brancos
	    A940AGRAVA(cRegistro)
	Endif	

	D60->(dbSkip())
	IncProc(STR0029) //"Gravando Registro Tipo 60-Analitico"
EndDo

ProcRegua( I60->(LastRec()))
I60->(dbGoTop())
While I60->(!eof())

    If YEAR(dDtFim)>2002
		cRegistro	:=	"60"											//01.Tipo
		cRegistro	+=	"I"												//02.Mestre/ANALITICO
		cRegistro	+=	aFISFill(DTOS(I60->I60_EMISS),8)		//03.Data de emissao
		cRegistro	+=	aFISFill(I60->I60_NUMFAB,20)
		cRegistro	+=	aFISFill(I60->I60_MODELO,02)
		cRegistro	+=	RetNf(I60->I60_COO,6,"C")+Space((6-Len(RetNf(I60->I60_COO,6,"C"))))
		cRegistro	+=	aFISFill(I60->I60_ITEM,03)
		cRegistro	+=	aFISFill(I60->I60_CODPRO,14)		
		cRegistro	+=	aFISFill(Num2Chr(I60->I60_QUANT,13),13)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(I60->I60_VLUNI,13),13)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(I60->I60_BSICM,12),12)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(I60->I60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
		cRegistro	+=	aFISFill(Num2Chr(I60->I60_VLICM,12),12)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(,16)									//07.Brancos
	    A940AGRAVA(cRegistro)
	Endif	

	I60->(dbSkip())
	IncProc(STR0029) //"Gravando Registro Tipo 60-Analitico"
EndDo

ProcRegua( R60->(LastRec()))
R60->(dbGoTop())
While R60->(!eof())

    If YEAR(dDtFim)>2002
		cRegistro	:=	"60"											//01.Tipo
		cRegistro	+=	"R"												//02.Mestre/ANALITICO
		cRegistro	+=	aFISFill(R60->R60_MESANO,6)		//03.Data de emissao
		cRegistro	+=	aFISFill(R60->R60_CODPRO,14)
		cRegistro	+=	aFISFill(Num2Chr(R60->R60_QUANT,13),13)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(R60->R60_VALOR,16),16)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(Num2Chr(R60->R60_BSICM,16),16)	//06.Valor Acumulado
		cRegistro	+=	aFISFill(R60->R60_SITTRI,04)				//05.Situacao Tributaria/Aliquota	
        If mv_par15<>3
		   cRegistro	+=	aFISFill(,54)									//07.Brancos
		Else
		   cRegistro	+=	aFISFill(,112)									//07.Brancos
		Endif   
	Endif	
	A940AGRAVA(cRegistro)

	R60->(dbSkip())
	IncProc(STR0029) //"Gravando Registro Tipo 60-Analitico"
EndDo
Return	

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³a940AReg61ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 55                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940aReg61()

Local cRegistro	:= ""

ProcRegua( R61->(LastRec()))
R61->(dbGoTop())
While R61->(!eof())
    If YEAR(dDtFim)<2003
		cRegistro	:=	"61"													//01.Tipo
		cRegistro	+=	aFISFill(,28) 											//02. brancos
		cRegistro	+=	aFISFill(dtos(R61->A61_EMISS),08)						//04. Data de emissao dos doc. fiscais
		cRegistro	+=	aFISFill(R61->A61_MODELO,02)						//05. Modelo dos doc. Fiscais
		cRegistro	+=	AFISFILL(FisGetSer(R61->A61_SDOC,"61"),03)		//06. Serie dos doc. Fiscais
		cRegistro	+=	aFISFill(R61->A61_SUBSER,02)						//07. Subserie dos documentos Fiscais
		cRegistro	+=	RetNf(R61->A61_NUMINI,6,"N")	//08. Numero do 1o. doc. Fiscal emitido no dia
		cRegistro	+=	RetNf(R61->A61_NUMFIM,6,"N")	//09. Numero do ultimo doc. Fiscal emitido no dia
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_VALTOT,13),13)			//10. Somatorio diario das saidas p/doc. fiscais de mesma serie e subserie
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_BSICM,13),13)		//11. Base de Calculo do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_VALICM,12),12)			//12.Valor do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_ISENTA,13),13)		//13.Isenta ou nao tributada
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_OUTRAS,13),13)			//14.Outras
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_ALQICM,04),04)		//15.Aliquota ICMS
		cRegistro	+=	aFISFill(,01)											//16. Brancos
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			cRegistro += aFISFill(strzero(val(R61->A61_CODMUN),5),5)					//17. Codigo do Municipio
			cRegistro += aFisFill(R61->A61_OBS,35)						//18. Observacao
			cRegistro += aFisFill(R61->A61_SITUAC,1)						//19. Situacao da nota fiscal
			cRegistro += aFisFill(Strzero(Val(R61->A61_ANOAID),4),4)						//20. Ano AIDF
			cRegistro += aFisFill(Strzero(Val(R61->A61_NUMAID),5),5)
			cRegistro += aFisFill(,08)											//22. Brancos
		EndIf
	Else
		cRegistro	:=	"61"													//01.Tipo
		cRegistro	+=	aFISFill(,28) 											//02. brancos
		cRegistro	+=	aFISFill(dtos(R61->A61_EMISS),08)						//04. Data de emissao dos doc. fiscais
		cRegistro	+=	aFISFill(R61->A61_MODELO,02)						//05. Modelo dos doc. Fiscais
		cRegistro	+=	AFISFILL(FisGetSer(R61->A61_SDOC,"61"),03)		//06. Serie dos doc. Fiscais
		cRegistro	+=	aFISFill(R61->A61_SUBSER,02)						//07. Subserie dos documentos Fiscais
		cRegistro	+=	RetNf(R61->A61_NUMINI,6,"N")	//08. Numero do 1o. doc. Fiscal emitido no dia
		cRegistro	+=	RetNf(R61->A61_NUMFIM,6,"N")	//09. Numero do ultimo doc. Fiscal emitido no dia
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_VALTOT,13),13)			//10. Somatorio diario das saidas p/doc. fiscais de mesma serie e subserie
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_BSICM,13),13)		//11. Base de Calculo do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_VALICM,12),12)			//12.Valor do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_ISENTA,13),13)		//13.Isenta ou nao tributada
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_OUTRAS,13),13)			//14.Outras
		cRegistro	+=	aFISFill(Num2Chr(R61->A61_ALQICM,04),04)		//15.Aliquota ICMS
		cRegistro	+=	aFISFill(,01)											//16. Brancos
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			cRegistro += aFISFill(strzero(val(R61->A61_CODMUN),5),5)					//17. Codigo do Municipio
			cRegistro += aFisFill(R61->A61_OBS,35)						//18. Observacao
			cRegistro += aFisFill(R61->A61_SITUAC,1)						//19. Situacao da nota fiscal
			cRegistro += aFisFill(Strzero(Val(R61->A61_ANOAID),4),4)						//20. Ano AIDF
			cRegistro += aFisFill(Strzero(Val(R61->A61_NUMAID),5),5)
			cRegistro += aFisFill(,08)											//22. Brancos
		EndIf

	Endif	
	A940AGrava(cRegistro)
	R61->(dbSkip())
	IncProc(STR0030) //"Gravando Registro Tipo 61"
EndDo
If MV_PAR15 == 3
	ProcRegua( (cArq61R)->(LastRec()))
	(cArq61R)->(dbGoTop())
	While (cArq61R)->(!eof())
		cRegistro	:=	"61"
		cRegistro	+=	"R"
		cRegistro	+=	aFISFill((cArq61R)->R61_EMISS,06)
		cRegistro	+=	aFISFill((cArq61R)->R61_PRODSV,14)	
		cRegistro	+=	aFISFill(Num2Chr((cArq61R)->R61_QUANT,13,3),13)	
		cRegistro	+=	aFISFill(Num2Chr((cArq61R)->R61_VALOR,16),16)	
		cRegistro	+=	aFISFill(Num2Chr((cArq61R)->R61_BICMS,16),16)	
		cRegistro	+=	aFISFill(Num2Chr((cArq61R)->R61_ALIQ,4),4)		
		cRegistro   +=  aFisFill(,112)
		A940AGrava(cRegistro)
		(cArq61R)->(dbSkip())
		IncProc(STR0072) //"Gravando Registro Tipo 61-Resumo"
	EndDo
EndIf	
Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³a940AReg70ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 70                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940AReg70()
Local cRegistro	:= ""

ProcRegua( R70->(LastRec()))
R70->(dbGoTop())
while R70->(!eof())
    If YEAR(dDtFim)<2003
		cRegistro	:=	"70"											//01.Tipo
		cRegistro	+=	aFISFill(Num2Chr(Val(R70->A70_CNPJ),14,0),14)//02.CGC
		cRegistro	+=	aFISFill(R70->A70_IE,14)							//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R70->A70_EMISS),8)					//04.Data de emissao
		cRegistro	+=	aFISFill(R70->A70_UF,2)							//05.Unidade da Federacao
		cRegistro	+=	aFISFill(R70->A70_MODELO,2) 							//06.Modelo
		cRegistro	+=	AFISFILL(FisGetSer(R70->A70_SERIE,"70"),01)			//07.Serie
		cRegistro	+=	aFISFill(R70->A70_SUBSER,2)									//08.Sub-serie
		cRegistro	+=	RetNf(R70->A70_NFISC,6,"N")  //09.Numero do documento
		If MV_PAR15 == 3
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R70->A70_CFOP,1,4)),4,0),4)//10.CFOP	
		Else
			cRegistro	+=	aFISFill(Num2Chr(Val(substr(R70->A70_CFOP,1,3)),3,0),3)//10.CFOP
		EndIf
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_VALTOT,14),14)		//11.Valor total do documento
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_BSICM,14),14)		//12.Base de calculo
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_VALICM,14),14)			//13.Valor do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_ISENTA,14),14)		//14.Isenta ou nao tributada
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_OUTRAS,14),14)		//15.Outras
		cRegistro	+=	aFISFill(R70->A70_CIFFOB,1) // Sempre CIF					  16.CIF ou FOB
		cRegistro	+=	aFISFill(R70->A70_SITUAC,1)	//17.Situacao quanto ao cancelamento
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			cRegistro += aFISFill(Strzero(Val(R70->A70_CODMUN),5),5)
			cRegistro += aFISFill(Strzero(Val(R70->A70_ANOAID),4),4)	//19.Ano AIDF
			cRegistro += aFisFill(Strzero(Val(R70->A70_NUMAID),5),5)
			cRegistro += AFISFILL(StrZero(Val(R70->A70CFOPEXT),2),2)
			cRegistro += aFISFill(DTOS(R70->A70_EMISS),8) //22.Data de emissao
			cRegistro += Space(34)							//23.Observacao
		EndIf
	Else
		cRegistro	:=	"70"											//01.Tipo
		cRegistro	+=	aFISFill(Num2Chr(Val(R70->A70_CNPJ),14,0),14)//02.CGC
		cRegistro	+=	aFISFill(R70->A70_IE,14)							//03.Inscricao Estadual
		cRegistro	+=	aFISFill(DTOS(R70->A70_EMISS),8)					//04.Data de emissao
		cRegistro	+=	aFISFill(R70->A70_UF,2)							//05.Unidade da Federacao
		cRegistro	+=	aFISFill(R70->A70_MODELO,2) 							//06.Modelo
	   	cRegistro	+=	aFISFill(R70->A70_SERIE,1) 					//07.Serie
		cRegistro	+=	aFISFill(R70->A70_SUBSER,2)									//08.Sub-serie
		cRegistro	+=	RetNf(R70->A70_NFISC,6,"N")  //09.Numero do documento
		cRegistro	+=	aFISFill(Num2Chr(Val(substr(R70->A70_CFOP,1,4)),4,0),4)//10.CFOP	
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_VALTOT,13),13)		//11.Valor total do documento
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_BSICM,14),14)		//12.Base de calculo
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_VALICM,14),14)			//13.Valor do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_ISENTA,14),14)		//14.Isenta ou nao tributada
		cRegistro	+=	aFISFill(Num2Chr(R70->A70_OUTRAS,14),14)		//15.Outras
		cRegistro	+=	aFISFill(R70->A70_CIFFOB,1) // Sempre CIF					  16.CIF ou FOB
		cRegistro	+=	aFISFill(R70->A70_SITUAC,1)	//17.Situacao quanto ao cancelamento
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			cRegistro += aFISFill(Strzero(Val(R70->A70_CODMUN),5),5)
			cRegistro += aFISFill(Strzero(Val(R70->A70_ANOAID),4),4)	//19.Ano AIDF
			cRegistro += aFisFill(Strzero(Val(R70->A70_NUMAID),5),5)
			cRegistro += AFISFILL(StrZero(Val(R70->A70CFOPEXT),2),2)
			cRegistro += aFISFill(DTOS(R70->A70_ENTRAD),8) //22.Data de prestacao
			cRegistro += Space(34)							//23.Observacao
		EndIf
	Endif	
	A940AGrava(cRegistro)

	R70->(dbSkip())
	IncProc(STR0031) //"Gravando Registro Tipo 70"
End
Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940AREG71ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 71                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940AReg71()

Local cRegistro	:= ""

ProcRegua( R71->(LastRec()))
R71->(dbGoTop())

While R71->(!eof())

    If YEAR(dDtFim)<2003
		cRegistro	:=	"71"									   					//01.TIPO
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_CGCTOM),14,0),14)//02.CGC
		cRegistro	+=	a940Fill(R71->A71_IETOM,14) 						//03.Inscricao Estadual
		cRegistro	+=	a940Fill(DTOS(R71->A71_DTCONH),8)					//04.Data de emissao do conhecimento
		cRegistro	+=	a940Fill(R71->A71_UFTOM,2)							//05.UF do tomador do servico
		cRegistro	+=	a940Fill(R71->A71_MODCON,2)							//06.Modelo
		cRegistro	+=	a940Fill(R71->A71_SERCON,1)							//07.Serie
		cRegistro	+=	a940Fill(R71->A71_SUBCON,2)							//08.Subserie
		cRegistro	+=	RetNf(R71->A71_NUMCON,6,"N") 	//09.Numero do conhecimento
		cRegistro	+=	a940Fill(R71->A71_UFREM,2) 							//10.UF do remetente/Destinatario
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_CGCREM),14,0),14)//11.CGC do Remetente/Destinatario
		cRegistro	+=	a940Fill(R71->A71_IEREM,14) 						//12.Inscr.Estadual do Remetente/Destinatario
		cRegistro	+=	a940Fill(DTOS(R71->A71_DTNOTA),8)					//13.Data de emissao
		cRegistro	+=	a940Fill(R71->A71_MODNOT,2)	                    	//14.Modelo da NF
		If MV_PAR15 == 3
			cRegistro	+=	a940Fill(R71->A71_SERNOT,3)							//15.Serie da NF	
		ELSE
			cRegistro	+=	a940Fill(R71->A71_SERNOT,2)							//15.Serie da NF
			cRegistro	+=	a940Fill(R71->A71_SUBNOT,2)							//16.Subserie
		EndIf
		cRegistro	+=	RetNf(R71->A71_NUMNOT,6,"N")	//17.Numero da NF
		cRegistro	+=	a940Fill(Num2Chr(R71->A71_VALNOT,14),14) 		//18.Valor total da NF
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 <> 3
			cRegistro += a940Fill(,11)                                				//19.Brancos
		Else
			cRegistro += a940Fill(,70)                                				//19.Brancos
		EndIf
	Else
		cRegistro	:=	"71"									   					//01.TIPO
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_CGCTOM),14,0),14)//02.CGC
		cRegistro	+=	a940Fill(R71->A71_IETOM,14) 						//03.Inscricao Estadual
		cRegistro	+=	a940Fill(DTOS(R71->A71_DTCONH),8)					//04.Data de emissao do conhecimento
		cRegistro	+=	a940Fill(R71->A71_UFTOM,2)							//05.UF do tomador do servico
		cRegistro	+=	a940Fill(R71->A71_MODCON,2)							//06.Modelo
		cRegistro	+=	a940Fill(R71->A71_SERCON,1)							//07.Serie
		cRegistro	+=	a940Fill(R71->A71_SUBCON,2)							//08.Subserie
		cRegistro	+=	RetNf(R71->A71_NUMCON,6,"N") 	//09.Numero do conhecimento
		cRegistro	+=	a940Fill(R71->A71_UFREM,2) 							//10.UF do remetente/Destinatario
		cRegistro	+=	a940Fill(Num2Chr(Val(R71->A71_CGCREM),14,0),14)//11.CGC do Remetente/Destinatario
		cRegistro	+=	a940Fill(R71->A71_IEREM,14) 						//12.Inscr.Estadual do Remetente/Destinatario
		cRegistro	+=	a940Fill(DTOS(R71->A71_DTNOTA),8)					//13.Data de emissao
		cRegistro	+=	a940Fill(R71->A71_MODNOT,2)	                    	//14.Modelo da NF
		cRegistro	+=	a940Fill(R71->A71_SERNOT,3)							//15.Serie da NF	
		cRegistro	+=	RetNf(R71->A71_NUMNOT,6,"N")	//17.Numero da NF
		cRegistro	+=	a940Fill(Num2Chr(R71->A71_VALNOT,14),14) 		//18.Valor total da NF
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 <> 3
			cRegistro += a940Fill(,12)                                				//19.Brancos
		Else
			cRegistro += a940Fill(,70)                                				//19.Brancos
		EndIf

	Endif	
	A940AGrava(cRegistro)

	R71->(dbSkip())
	IncProc(STR0032) //"Gravando Registro Tipo 71"
End	
Return
/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940AREG74ºAutor  ³Eduardo J Zanardo   º Data ³  09/08/02   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 74                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940AReg74()

Local cRegistro	:= ""

DbSelectArea("R74")
ProcRegua( R74->(LastRec()))
R74->(dbGoTop())

while R74->(!eof())

    If YEAR(dDtFim)<2003
		cRegistro	:=	"74"											//01.Tipo
		cRegistro	+= 	aFISFill(R74->A74_DTINVE,8)
		cRegistro	+= 	aFISFill(R74->A74_PROD,14)
		cRegistro	+=	aFISFill(Num2Chr(R74->A74_QUANT,13,3),13)
		cRegistro	+=	aFISFill(Num2Chr(R74->A74_VALOR,13),13)
		cRegistro	+=	aFISFill(R74->A74_POSSE,1)
		cRegistro	+=	aFISFill(R74->A74_CNPJP,14)		
		cRegistro	+=	aFISFill(R74->A74_INSCP,14) 		
		cRegistro	+=	aFISFill(R74->A74_UF,2) 			
		cRegistro 	+=  aFISFill(,103)					
	Else
		cRegistro	:=	"74"											//01.Tipo
		cRegistro	+= 	aFISFill(DTOS(SuperGetMv("MV_ULMES")),8)
		cRegistro	+= 	aFISFill(R74->CODIGO,14)
		cRegistro	+=	aFISFill(Num2Chr(R74->QUANT,13,3),13)
		cRegistro	+=	aFISFill(Num2Chr(R74->CUSTO,13),13)
		cRegistro	+=	AFISFill(IIF(R74->SITUACA=="2","3",IIF(R74->SITUACA=="3","2",R74->SITUACA)),01)
		cRegistro	+=	AFISFill(IIF(R74->SITUACA=="1",REPLI("0",14),ARETDIG(R74->CNPJ,.T.,"  ")),14)
		cRegistro	+=	AFISFill(IIF(R74->SITUACA=="1",SPACE(14),ARETDIG(R74->INSCR,.T.,"  ")),14)
		cRegistro	+=	aFISFill(R74->UF,2) 			
	    cRegistro 	+=  If(mv_par15==3,aFISFill(,103),aFISFill(,45))
	Endif	
	A940AGrava(cRegistro)
	R74->(dbSkip())
	IncProc(STR0076) //"Gravando Registro Tipo 74"
EndDo

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940AREG75ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 75                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940AReg75()

Local cRegistro	:= ""

ProcRegua( R75->(LastRec()))
R75->(dbGoTop())
while R75->(!eof())

    If YEAR(dDtFim)<2003
		cRegistro	:=	"75"												//01.Tipo
		cRegistro	+= 	aFISFill(dtos(R75->A75_DTAINI),8)			//02.Data Inicial de Validade
		cRegistro	+= 	aFISFill(dtos(R75->A75_DTAFIM),8)			//03.Data Final de Validade
		cRegistro	+=	aFISFill(Left(R75->A75_PROD,14),14)		//04.Codigo do Produto ou Servico
		cRegistro	+=	aFISFill(Left(R75->A75_CODNCM,08),08)		//05.Codigo NCM
		cRegistro	+=	aFISFill(R75->A75_DESCR,53)					//06.Descricao do Produto
		cRegistro	+=	aFISFill(R75->A75_UM,06)						//07.Unidade de Medida
		cRegistro	+=	aFISFill(R75->A75_SITTRI,3) 					//08.Situacao Tributaria
		cRegistro	+=	aFISFill(Num2Chr(R75->A75_ALQIPI,4),4)	//09. Aliquota do IPI
		cRegistro	+=	aFISFill(Num2Chr(R75->A75_ALQICM,4),4)	//10.Aliquota do ICMS
		cRegistro	+=	aFISFill(Num2Chr(R75->A75_REDBSE,4),4)	//11.% de Reducao do ICMS nas Operacoes Internas
		cRegistro	+=	aFISFill(Num2Chr(R75->A75_BRICMS,12),12)	//12.Base de calculo do ICMS retido
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			cRegistro += aFISFill(R75->A75_EAN,14)				//13.Codigo EAN
			cRegistro += aFISFill(R75->A75_CODFIS,07)			//14.Codigo Fisiografico
			cRegistro += aFISFill(,37)									//15.Brancos
		EndIf
	Else 
		cRegistro	:=	"75"										//01.Tipo
		cRegistro	+= 	aFISFill(dtos(R75->A75_DTAINI),8)			//02.Data Inicial de Validade
		cRegistro	+= 	aFISFill(dtos(R75->A75_DTAFIM),8)			//03.Data Final de Validade
		cRegistro	+=	aFISFill(Left(R75->A75_PROD,14),14)		//04.Codigo do Produto ou Servico
		cRegistro	+=	aFISFill(Left(R75->A75_CODNCM,08),08)		//05.Codigo NCM
		cRegistro	+=	aFISFill(R75->A75_DESCR,53)					//06.Descricao do Produto
		cRegistro	+=	aFISFill(R75->A75_UM,06)						//07.Unidade de Medida
        If mv_par15<>3 .And. mv_par15<>2
		   cRegistro	+=	aFISFill(R75->A75_SITTRI,3) 					//08.Situacao Tributaria
		Endif   
        If mv_par15<>3 .And. mv_par15<>2
	  	   cRegistro	+=	aFISFill(Num2Chr(R75->A75_ALQIPI,4),4)	//09. Aliquota do IPI
	  	Else
	  	   cRegistro	+=	aFISFill(Num2Chr(R75->A75_ALQIPI,5),5)	//09. Aliquota do IPI
	  	Endif   
	    cRegistro	+=	aFISFill(Num2Chr(R75->A75_ALQICM,4),4)	//10.Aliquota do ICMS
        If mv_par15<>3 .And. mv_par15<>2
			cRegistro	+=	aFISFill(Num2Chr(R75->A75_REDBSE,4),4)	//11.% de Reducao do ICMS nas Operacoes Internas
		Else
			cRegistro	+=	aFISFill(Num2Chr(R75->A75_REDBSE,5),5)	//11.% de Reducao do ICMS nas Operacoes Internas		
		Endif   
        If mv_par15<>3 .And. mv_par15<>2
			cRegistro	+=	aFISFill(Num2Chr(R75->A75_BRICMS,12),12)	//12.Base de calculo do ICMS retido	
		Else
			cRegistro	+=	aFISFill(Num2Chr(R75->A75_BRICMS,13),13)	//12.Base de calculo do ICMS retido	
		Endif	
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³LayOut diferencia para DIC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If MV_PAR15 == 3
			cRegistro += aFISFill(R75->A75_EAN,14)				//13.Codigo EAN
			cRegistro += aFISFill(R75->A75_CODFIS,07)			//14.Codigo Fisiografico
			cRegistro += aFISFill(,37)									//15.Brancos
		EndIf
	Endif	
	A940AGrava(cRegistro)

	R75->(dbSkip())
	IncProc(STR0033) //"Gravando Registro Tipo 75"
End

Return



/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³a940ARg88CºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 88C                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940ARg88C()

Local cRegistro
Local cCNPJ	:= ""

DbSelectArea(cArq088C)
dbSetOrder(1)

ProcRegua( (cArq088C)->(LastRec()))
(cArq088C)->(dbGoTop())

While (cArq088C)->(!eof())

	cCNPJ		:= IIf(!empty((cArq088C)->A88CCNPJ),(cArq088C)->A88CCNPJ,Replic("0",14))

	cRegistro	:=	"88C"												//01.Tipo
	cRegistro	+=	aFISFill(Num2Chr(Val(cCNPJ),14,0),14)				//02.CGC
	cRegistro	+=	aFISFill((cArq088C)->A88CMODELO,2)					//03.Codigo do modelo da NF
	cRegistro	+=	aFISFill((cArq088C)->A88CSDOC,3)					//04.Serie da NF
	cRegistro	+=	RetNf((cArq088C)->A88CNFISC,6,"N") //06.Numero da NF
    If YEAR(dDtFim)>2002
	   cRegistro	+=	aFISFill(Num2Chr(Val(substr((cArq088C)->A88CCFOP,1,4)),4,0),4)//07.CFOP
	Else
	   cRegistro	+=	aFISFill(Num2Chr(Val(substr((cArq088C)->A88CCFOP,1,3)),3,0),3)//07.CFOP
	Endif
	cRegistro	+=	aFISFill((cArq088C)->A88CNUMITE,3)	   				//08.Numero do Item
	cRegistro	+=	aFISFill(Left((cArq088C)->A88CPRODUT,14),14)		//09.Codigo do produto ou servico
	cRegistro	+=	aFISFill(Num2Chr((cArq088C)->A88CQUANT,13,3),13)	//10.Quantidade do produto
	cRegistro	+=	aFISFill(Num2Chr((cArq088C)->A88CBASEST,12),12) 	//11.Base de Calculo da ST na origem
	cRegistro	+=	aFISFill(Num2Chr((cArq088C)->A88CVALBSR,12),12)	//12.Valor do ICMS ST a ser repassado a UF destino
	cRegistro	+=	aFISFill(Num2Chr((cArq088C)->A88CVALBSC,12),12)	//13.Valor do ICMS ST a complementar a UF de destino
	cRegistro	+=	SPACE(28)

	A940AGrava(cRegistro)

	(cArq088C)->(dbSkip())
	IncProc("Gravando Registro Tipo 88C")

EndDo	

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940ARG88DºAutor  ³Andreia dos Santos  º Data ³  05/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 88D                                    º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC FUNCTION A940ARG88D()

Local cRegistro	:=	""
ProcRegua( (cArq088D)->(LastRec()))
(cArq088D)->(dbSetOrder(1))
(cArq088D)->(dbGoTop())

While (cArq088D)->(!EOF())

	cRegistro	:="88D"	
	cRegistro	+=	AFISFILL(Num2Chr(Val((cArq088D)->A88DCNPJ),14,0),14)	//02. CGC
	cRegistro	+=	AFISFILL((cArq088D)->A88DIE,14)							//03. Inscricao Estadual
	cRegistro	+=	AFISFILL((cArq088D)->A88DUF,02)    						//05. Unidade da federacao do Remetente/Destinatario
	cRegistro	+=	AFISFILL((cArq088D)->A88DMODELO,02)		  		 		//06.Codigo do Modelo da Nota fiscal
	cRegistro	+=	AFISFILL((cArq088D)->A88DSDOC,03)						//07. Serie da Nota Fiscal
	cRegistro	+=	RetNf((cArq088D)->A88DNFISC,6,"N") 	//09.Numero da Nota Fiscal
    If YEAR(dDtFim)>2002
	   cRegistro	+=	aFISFill(Num2Chr(Val(substr((cArq088D)->A88DCFOP,1,4)),4,0),4)//07.CFOP
	Else
	   cRegistro	+=	aFISFill(Num2Chr(Val(substr((cArq088D)->A88DCFOP,1,3)),3,0),3)//07.CFOP
	Endif
	cRegistro	+=	AFISFILL(DTOS((cArq088D)->A88DEMISS),08)				//04. Data de emissao/Recebimento
	cRegistro	+=	AFISFILL(DTOS((cArq088D)->A88DENTSAI),08)				//04. Data de emissao/Recebimento
	cRegistro	+=	SPACE(62)

	A940aGrava(cRegistro)
	(cArq088D)->(dbSkip())
	IncProc("Gravando Registro Tipo 88D")
End

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940ARG88EºAutor  ³Andreia dos Santos  º Data ³  05/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 88E                                    º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC FUNCTION A940ARG88E()

Local cRegistro	:=	""
ProcRegua( (cArq088E)->(LastRec()))
(cArq088E)->(dbSetOrder(1))
(cArq088E)->(dbGoTop())

While (cArq088E)->(!EOF())
	cRegistro	:="88E"	
	cRegistro	+=	AFISFILL(Num2Chr(Val((cArq088E)->A88ECNPJ),14,0),14)	//02. CGC
	cRegistro	+=	AFISFILL((cArq088E)->A88EIE,14)							//03. Inscricao Estadual
	cRegistro	+=	AFISFILL((cArq088E)->A88ECOD,14)						//04. Codigo Produto Informante
	cRegistro	+=	AFISFILL((cArq088E)->A88ECODSEF,14)						//03. Codigo Tabela SEF MG
	cRegistro	+=	SPACE(67)
	A940aGrava(cRegistro)
	(cArq088E)->(dbSkip())	
	IncProc("Gravando Registro Tipo 88E")
End

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940ARG88MºAutor  ³Andreia dos Santos  º Data ³  05/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 88M                                    º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC FUNCTION A940ARG88M()

Local cRegistro	:=	""
ProcRegua( (cArq088M)->(LastRec()))
(cArq088M)->(dbSetOrder(1))
(cArq088M)->(dbGoTop())

While (cArq088M)->(!EOF())
	cRegistro	:="88M"	
	cRegistro	+=	AFISFILL(Num2Chr(Val((cArq088M)->A88MCNPJ),14,0),14)	//02. CGC
	cRegistro	+=	AFISFILL((cArq088M)->A88MMENS,34)						//03. Mensagem
	cRegistro	+=	SPACE(75)
	A940aGrava(cRegistro)
	(cArq088M)->(dbSkip())
	IncProc("Gravando Registro Tipo 88M")
End

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940ARG88QºAutor  ³Edstron E. Correia  º Data ³  30/05/03   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 88Q                                    º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC FUNCTION A940ARG88Q()

Local cRegistro	:=	""
ProcRegua( (cArq088Q)->(LastRec()))
(cArq088Q)->(dbSetOrder(1))
(cArq088Q)->(dbGoTop())

While (cArq088Q)->(!EOF())
	cRegistro	:="88Q"
	cRegistro	+=AFISFILL(dtos((cArq088Q)->A88QDATA),8)
	cRegistro	+=AFISFILL((cArq088Q)->A88QPROD,14)
	cRegistro	+=AFISFILL(Num2Chr((cArq088Q)->A88QQUANT,13,3),13)
	cRegistro	+=AFISFILL(Num2Chr((cArq088Q)->A88QTOT,13,3),13)
	cRegistro	+=AFISFILL((cArq088Q)->A88QPOSSE,01)
	cRegistro	+=SPACE(74)
	A940aGrava(cRegistro)
	(cArq088Q)->(dbSkip())
	IncProc("Gravando Registro Tipo 88Q")
End

Return

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940ARG8850ºAutor  ³Eduardo Ju         º Data ³  23/07/03   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava Registro do Tipo 8850 (Tipo 88 Detalhe 50)           º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function A940ARG8850()

Local cRegistro	:=	""
ProcRegua( (cArq08850)->(LastRec()))
(cArq08850)->(dbSetOrder(1))
(cArq08850)->(dbGoTop())

While (cArq08850)->(!Eof())
	If mv_par15 == 3 //DIC
		cRegistro	:= "8850"                                                   	//01.Tipo 02.Detalhe
		cRegistro	+=	aFisFill(Num2Chr(Val((cArq08850)->A8850CNPJ),14,0),14)		//03.CGC
		cRegistro	+=  aFisFill(Dtos((cArq08850)->A8850EMISS),8)              	//04.Data de Emissao
		cRegistro	+=	aFisFill((cArq08850)->A8850UF,2)    						//05.Unidade Federativa do Remetente/Destinatario
		cRegistro	+=	aFisFill((cArq08850)->A8850MODEL,2)					    	//06.Codigo do modelo da NF
		cRegistro	+=	aFisFill((cArq08850)->A8850SDOC,3)					    	//07.Serie da NF
		cRegistro	+=	RetNf((cArq08850)->A8850NFISC,6,"N")//aFisFill(Num2Chr(Val((cArq08850)->A8850NFISC),6,0),6)  	//09.Numero da NF
		cRegistro	+=	aFisFill((cArq08850)->A8850SUFRA,14)                    	//10.Inscricao Suframa	   
		cRegistro   +=	aFisFill((cArq08850)->A8850OBS,35)	                    	//16.Observacao
	    cRegistro   +=	aFisFill((cArq08850)->A8850CONTA,15)                    	//17.Codigo Contabil
	    cRegistro   +=	aFisFill((cArq08850)->A8850VFRET,13)                    	//12.Valor do Frete
	    cRegistro   +=	aFisFill((cArq08850)->A8850ICFRE,13)                    	//13.ICMS Frete
	    cRegistro   +=	aFisFill((cArq08850)->A8850VDESP,13)                    	//14.Valor Despesa Acessoria
	    cRegistro   +=	aFisFill((cArq08850)->A8850VTOTP,13)                    	//15.Total dos Produtos
	    cRegistro   +=	aFisFill((cArq08850)->A8850NEMPH,08)                    	//16.Numero do Empenho
	    cRegistro   +=	aFisFill((cArq08850)->A8850TPFRE,01)                    	//17.1-CIF/2-FOB/3-OUTROS                                                                                             
	  	cRegistro	+=	Space(20)                                               	//18.Brancos	
		A940AGrava(cRegistro)

		(cArq08850)->(dbSkip())
		IncProc("Gravando Registro Tipo 88/50")
   EndIf
EndDo	
Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³A940AReg88ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Grava registro tipo 88                                     º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940A                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A940aReg88()

Local lGrava088	:= existBlock("M940GR88")
Local aIC       := {}
Local aST       := {}
Local cContas   := ""
Local nValor    := 0
Local nValor2   := 0
Local nValor3   := 0
Local nEstDebST := 0
Local dInicial	:= CtoD("  /  /  ")
Local dFinal  	:= CtoD("  /  /  ")
Local nX		:= 0                     

Private cRegistro 	:= ""
Private NMES := MONTH(MV_PAR02)
Private NANO := YEAR(MV_PAR02)

If lGrava088
	ProcRegua( (cArq088)->(LastRec()))
	(cArq088)->(dbGotop())
	While (cArq088)->(!eof())

		cRegistro	:=	execBlock("M940GR88")

		a940AGrava( cRegistro )
		(cArq088)->(dbSkip())
		IncProc(STR0034) //"Gravando Registro Tipo 88"
	EndDo
EndIf
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³LayOut diferencia para DIC                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If MV_PAR15 == 3  .And. File("DIC.CFP")

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄh¿
	//³Todos os campos dos registros 8801 e 8802 devem se referir ao mes anterior ao da declaracao.³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄhÙ

	// Calcula primeiro e ultimo dia do mes anterior ao da declaracao
	dbSelectArea("SM0")
	If Month(MV_PAR01) == 1
		dInicial := CtoD("01/12/" + StrZero(Year(MV_PAR01)-1,4))
		dFinal 	 := CtoD("31/12/" + StrZero(Year(MV_PAR01)-1,4))
	Else
		dInicial := CtoD("01/" + StrZero(Month(MV_PAR01)-1,2) + "/" + StrZero(Year(MV_PAR01),4))
		For nX := 31 to 1 Step -1
	        dFinal := CtoD(StrZero(nX,2) + "/" + StrZero(Month(MV_PAR01)-1,2) + "/" + StrZero(Year(MV_PAR01),4))
			If Month(dFinal) == (Month(MV_PAR01) - 1)
			   Exit
		    Endif
		Next
	Endif
	//Alimenta array utilizado na função Periodo()
	aTabela22:= DataTabela()	
	
	//Registro 8801
	cRegistro  :=	"88"								//01.Tipo
	cRegistro  += 	"01"								//02.Detalhe

	cContas := VerTpDet("901",.F.,"DIC.CFP")
	nValor 	:= SomaContas(cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//03. Saldo da conta caixa no final do mes

	cContas := VerTpDet("902",.F.,"DIC.CFP")
	nValor 	:= SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//04. Saldo da conta bancos no final do mes

	cContas := VerTpDet("903",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//05. Saldo da conta clientes no final do mes

	cContas := VerTpDet("904",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//06. Saldo a receber de outras contas no final do mes

	cContas := VerTpDet("905",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//07. Saldo da conta fornecedor no final do mes

	cContas := VerTpDet("906",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//08. Saldo a pagar de outras contas no final do mes

	cContas := VerTpDet("907",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//09. Valor dos emprestimos contraidos a pessoa fisica ate o final do mes

	cContas := VerTpDet("908",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(MV_PAR01-1,1),5,2)),1)
	cRegistro   += aFISFill(Num2Chr(nValor,13),13)	//10. Valor dos emprestimos contraidos a pessoa juridica ate o final do mes

	cRegistro   += Space(76)
	A940AGrava(cRegistro)

	//Registro 8802                                            
	cRegistro  :=	"88"								//01.Tipo
	cRegistro  += 	"02"								//02.Detalhe
	cContas := VerTpDet("909",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(dInicial-1,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor,13),13)	//03. Valor do saldo inicial das contas caixa e bancos no mes
	nValor2:= SomaContas (cContas,Val(SubStr(Periodo(dFinal,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(nValor2-nValor,13),13)	//04. Valor dos recebimentos ocorridos no mes

	cContas := VerTpDet("910",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(dInicial-1,1),5,2)),1)
	nValor2:= SomaContas (cContas,Val(SubStr(Periodo(dFinal,1),5,2)),1)
	nValor3 := nValor2-nValor
	cRegistro  += aFISFill(Num2Chr(Max(nValor2-nValor,0),13),13)	//05. Valor dos emprestimos contraidos a pessoa fisica no mes

	cContas := VerTpDet("911",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(dInicial-1,1),5,2)),1)
	nValor2:= SomaContas (cContas,Val(SubStr(Periodo(dFinal,1),5,2)),1)
	nValor3 += nValor2-nValor
	cRegistro  += aFISFill(Num2Chr(Max(nValor2-nValor,0),13),13)	//06. Valor dos emprestimos contraidos a pessoa juridica no mes
	If nValor3 < 0
		nValor3 := Abs(nValor3)
	Else
		nValor3 := 0
	EndIf
	cRegistro  += aFISFill(Num2Chr(Max(nValor3,0),13),13)	//07. Valor dos pagamentos de emprestimos efetuados no mes

	cContas := VerTpDet("912",.F.,"DIC.CFP")
	nValor := SomaContas (cContas,Val(SubStr(Periodo(dInicial-1,1),5,2)),1)
	nValor2:= SomaContas (cContas,Val(SubStr(Periodo(dFinal,1),5,2)),1)
	cRegistro  += aFISFill(Num2Chr(Max(nValor2-nValor,0),13),13)	//08. Valor de outros pagamentos efetuados no mes
	cRegistro  += Space(102)
	A940AGrava(cRegistro)
	nReg88 := 2
EndIf
If MV_PAR15 == 3
	If MV_PAR26 <> 2
		//Registro 8803	
	  	aIC :=  FisApur("IC",val(Substr(DTOS(dDtFim),1,4)),val(Substr(DTOS(dDtFim),5,2)),2,0,"*",.F.,{},1,.F.,"")
		aST :=  FisApur("ST",val(Substr(DTOS(dDtFim),1,4)),val(Substr(DTOS(dDtFim),5,2)),2,0,"*",.F.,{},1,.F.,"")
		aEval(aST, {|x| nEstDebST += Iif(Substr(Alltrim(x[4]),1,6)=="008.00" .and. Substr(Alltrim(x[1]),1,3)=="008",x[3],0)})
	    If !Empty(aIC)
			cRegistro := "88"
			cRegistro += "03"
			cRegistro += aFisfill(Num2Chr(0,13,2),13) 			//03.PSDI
			cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="003"}),3],13,2),13) 	//04.Estorno de Credito
			cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="002"}),3],13,2),13)	//05.Outros Debitos
			cRegistro += aFisfill(Num2Chr(0,13,2),13) 			//06.Credito Presumido
			cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="009"}),3],13,2),13)	//07.Saldo Credor do Período Anterior
			cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="006"}),3],13,2),13)	//08.Outros Creditos
			cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="007"}),3],13,2),13)	//09.Estorno de Debitos
			cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="012"}),3],13,2),13)	//10.Deducoes
			cRegistro += aFisfill(Num2Chr(0,13,2),13) 			//11.Credito utilizado do imobilizado
			cRegistro += aFisfill(Num2Chr(0,4,0),4) 			//12.PSDI
			cRegistro += aFisfill(Num2Chr(0,2,0),2) 			//13.PSDI	
			cRegistro += aFisfill(Num2Chr(0,13,2),13) 			//14.Transferencia
			cRegistro += aFisfill(,44) //12.Brancos
			a940AGrava( cRegistro )
			nReg88 += 1   	   		
	    Endif
		//Registro AD4	
		(cArqAD4)->(dbGoTop())
		while (cArqAD4)->(!eof())
			cRegistro	:=	"88"
			cRegistro	+= 	"04"
			cRegistro	+= 	aFISFill((cArqAD4)->AD4TIPO,1)
			cRegistro	+=	aFISFill(Num2Chr(Val((cArqAD4)->AD4INSC),10,0),10)
			cRegistro	+=	aFISFill((cArqAD4)->AD4MODELO,2)
			cRegistro	+=	AFISFILL(FisGetSer((cArqAD4)->AD4SERIE),03)
			cRegistro	+=	aFISFill(,2)
			cRegistro	+=  RetNf((cArqAD4)->AD4NUMERO,6,"N")
			cRegistro	+=	aFISFill(DTOS((cArqAD4)->AD4EMISS),08)
			cRegistro	+=	aFISFill(Num2Chr((cArqAD4)->AD4VALOR,13,2),13)
			cRegistro	+=  aFISFill(,135)
			a940AGrava( cRegistro )	
			(cArqAD4)->(dbSkip())
			IncProc(STR0080) //"Gravando Registro Tipo AD44"
			nReg88 += 1   	   				
		EndDo
	
		//Registro 8805
	    If !Empty(aIC)
			cRegistro := "88"
			cRegistro += "05"
			cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="013"}),3],13,2),13) //03.Valor ICMS Normal
			cRegistro += aFisfill(Num2Chr(nVal88St,13,2),13) //04.Valor ICMS Substituto
			cRegistro += aFisfill(Num2Chr(0,13,2),13) //05.Valor ICMS Transporte
			cRegistro += aFisfill(Num2Chr(0,13,2),13) //06.ICMS de Antecipacao
			cRegistro += aFisfill(Num2Chr(0,13,2),13) //07.ICMS s/ Antecipacao
			cRegistro += aFisfill(Num2Chr(0,13,2),13) //08.ICMS MVA
			cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="020"}),3],13,2),13) //09.Diferencial de aliquota ( uso e consumo )
			cRegistro += aFisfill(Num2Chr(aIC[Ascan(aIC,{|x|x[1]=="019"}),3],13,2),13) //10.Diferencial de aliquota	( imobilizado )
			cRegistro += aFisfill(Num2Chr(0,13,2),13) //11.PSDI
			cRegistro += aFisfill(Num2Chr(nEstDebST,13,2),13) //12.Estorno de Debito do ICMS ST Interno
			cRegistro += aFisfill(Num2Chr(0,13,2),13) //13.Fundo Estadual
			cRegistro += aFisfill(,24)//aFisfill(,37) //14.Brancos
			cRegistro += aFisfill(Num2Chr(0,13,2),13) //15.Fundo Pobreza ST interna
			a940AGrava( cRegistro )
			nReg88 += 1   	   				
	    Endif
		//Registro 8808
	    If mv_par21 == 1 .and. MV_PAR15 == 3  .and. Month(dDtFim) == 1
		   cRegistro := "88"
		   cRegistro += "08"
	       cRegistro += aFisfill(Num2Chr(nValMPI,13,2),13) //03.Valor de Estoque Materia Prima Inicial Tributada
		   cRegistro += aFisfill(Num2Chr(nValMPF,13,2),13) //04.Valor de Estoque Materia Prima Final Tributada
		   cRegistro += aFisfill(Num2Chr(nValPAI,13,2),13) //05.Valor de Estoque Produto Acabado Inicial Tributada
		   cRegistro += aFisfill(Num2Chr(nValPAF,13,2),13) //06.Valor de Estoque Produto Acabado Final Tributada
		   cRegistro += aFisfill(Num2Chr(nValISI,13,2),13) //07.Valor Isento Inicial
		   cRegistro += aFisfill(Num2Chr(nValISF,13,2),13) //08.Valor Isento Final
		   cRegistro += aFisfill(Num2Chr(nValANI,13,2),13) //09.Valor ST com encerramento de fase inicial
		   cRegistro += aFisfill(Num2Chr(nValANF,13,2),13) //10.Valor ST com encerramento de fase final
		   cRegistro += aFisfill(Num2Chr(0.00,13,2),13) //11.Valor dos produtos em Processo Inicial
		   cRegistro += aFisfill(Num2Chr(0.00,13,2),13) //12.Valor dos produtos em Processo Final
		   cRegistro += aFisfill(,50) //12.Brancos
	   	   a940AGrava(cRegistro)
	   	   IncProc(STR0082) //"Gravando Registro Tipo 88 detalhe 08 "
	   	   nReg88 += 1   	   
	    Endif 
	Else                     
	                                                                                                        
    	DbSelectArea("R88")
    	R88->(dbGoTop())
		While R88->(!eof())
    	   	cRegistro := "88"
	    	cRegistro += "81"
       		cRegistro += aFisfill(R88->R88_ESTADO,2)
       		cRegistro += aFisfill(R88->R88_MUNIC,5)           
       		cRegistro += aFisfill(R88->R88_CFOP,4)
       		cRegistro += Iif(SubStr(R88->R88_CFOP,2,3)=="949",SF4->F4_CFEXT,"")
       		cRegistro += aFisfill(Num2Chr(R88->R88_VALCON,13,2),13)
       		cRegistro += aFisfill(Num2Chr(R88->R88_BASICM,13,2),13)
       		cRegistro += aFisfill(Num2Chr(R88->R88_VALICM,13,2),13)
       		cRegistro += aFisfill(Num2Chr(R88->R88_ISEICM,13,2),13)
       		cRegistro += aFisfill(Num2Chr(R88->R88_OUTICM,13,2),13)
       		cRegistro += aFisfill(Num2Chr(R88->R88_ALQICM,4,2),4)    
       		cRegistro += aFisfill(Num2Chr(R88->R88_ICMRET,13,2),13)
       		cRegistro += aFisfill(,85)
    		a940AGrava(cRegistro) 
    		R88->(dbSkip())
    		nReg88 += 1	
	 	EndDo 
	 	
	 	DbSelectArea("R82")
    	R82->(dbGoTop())
		While R82->(!eof())
	 		cRegistro := "88"
	    	cRegistro += "82"
       		cRegistro += If(!Empty(R82->R82_IE),aFisfill(R82->R82_IE,14),Space(14))
       		cRegistro += If(!Empty(R82->R82_DTINCO),aFisfill(DTOS(R82->R82_DTINCO),08),Replic("0",8))
       		cRegistro += If(!Empty(R82->R82_UF),aFisfill(R82->R82_UF,02),Space(2))
       		cRegistro += If(!Empty(R82->R82_MODINC),aFisfill(R82->R82_MODINC,02),Replic("0",2))
       		cRegistro += If(!Empty(R82->R82_SDOCC),aFisfill(R82_SDOCC,03),Space(3))
       		cRegistro += Space(2)
       		cRegistro += If(!Empty(R82->R82_NFINC),aFisfill(R82->R82_NFINC,06),Replic("0",6))
       		cRegistro += If(!Empty(R82->R82_CFOPEN),aFisfill(R82->R82_CFOPEN,04),Replic("0",4))
       		cRegistro += If(!Empty(R82->R82_ALQINC),aFisfill(Num2Chr(R82->R82_ALQINC,04,02),04),Replic("0",4))
       		cRegistro += If(!Empty(R82->R82_VLTINC),aFisfill(Num2Chr(R82->R82_VLTINC,13,2),13),Replic("0",13))
       		cRegistro += Replic("0",13)
       		cRegistro += If(!Empty(R82->R82_DTDESI),aFisfill(DTOS(R82->R82_DTDESI),08),Replic("0",8))
       		cRegistro += If(!Empty(R82->R82_MODDES),aFisfill(R82->R82_MODDES,02),Replic("0",2))
       		cRegistro += If(!Empty(R82->R82_SDOCS),aFisfill(R82->R82_SDOCS,03),Space(3))
       		cRegistro += Space(2)       		
       		cRegistro += If(!Empty(R82->R82_NFDES),aFisfill(R82->R82_NFDES,06),Replic("0",6))
       		cRegistro += If(!Empty(R82->R82_CFOPSA),aFisfill(R82->R82_CFOPSA,04),Replic("0",4))
       		cRegistro += aFisfill(Num2Chr(R82->R82_ALQDES,04,02),04)
       		cRegistro += aFisfill(Num2Chr(R82->R82_VLTDES,13,2),13)
       		cRegistro += Space(67)
    		a940AGrava(cRegistro) 
    		R82->(dbSkip())
    		nReg88 += 1	
	 	EndDo
	 	
	 	DbSelectArea("R83")
    	R83->(dbGoTop())
		While R83->(!eof())
    	   	cRegistro := "88"
	    	cRegistro += "83"
	    	cRegistro += aFisfill(R83->R83_PDV,03)
	    	cRegistro += aFisfill(R83->R83_SERIE,15)
	    	cRegistro += aFisfill(Num2Chr(R83->R83_VLGTIN,16,2),16)
	    	cRegistro += aFisfill(Num2Chr(R83->R83_VLGTFI,16,2),16)
	    	cRegistro += Space(130)
	    	a940AGrava(cRegistro) 
    		R83->(dbSkip())
    		nReg88 += 1	
	 	EndDo
	EndIf
	//Registro D10	
	(cArqD10)->(dbGoTop())
	while (cArqD10)->(!eof())
		cRegistro	:=	"88"
		cRegistro	+= 	"10"
		cRegistro	+= 	aFISFill((cArqD10)->D10CNPJ,14)
		cRegistro	+=	aFISFill((cArqD10)->D10MODDES,2)
		cRegistro	+=	aFISFill((cArqD10)->D10SERDES,3)
		cRegistro	+=	aFISFill(,2)
		cRegistro	+=	RetNf((cArqD10)->D10NUMDES,6,"C")+Space((6-Len(RetNf((cArqD10)->D10NUMDES,6,"C"))))
		cRegistro	+=  aFISFill((cArqD10)->D10CFOP,4)
		cRegistro	+=	aFISFill((cArqD10)->D10IT_DES,3)
		cRegistro	+=	aFISFill((cArqD10)->D10INSCIN,14)    		
		cRegistro	+=	aFISFill((cArqD10)->D10UFINC,2)
		cRegistro	+=	aFISFill((cArqD10)->D10MODINC,2)    		
		cRegistro	+=	aFISFill((cArqD10)->D10SERINC,3)
		cRegistro	+=	aFISFill(,2)//aFISFill((cArqD10)->D10SBSRIN,2)
		cRegistro	+=	RetNf((cArqD10)->D10NUMINC,6,"C")+Space((6-Len(RetNf((cArqD10)->D10NUMINC,6,"C"))))
		cRegistro	+=	aFISFill((cArqD10)->D10EMIINC,8)
		cRegistro	+=	aFISFill((cArqD10)->D10QUANT,5)
		cRegistro	+=	aFISFill(Num2Chr((cArqD10)->D10VALOR,13,2),13)
		cRegistro	+=  aFISFill(,91)
		a940AGrava( cRegistro )	
		(cArqD10)->(dbSkip())
		IncProc(STR0081) //  	  #define STR0081 "Gravando Registro Tipo 88 Detalhe 10"
		nReg88 += 1   	   				
	EndDo
EndIf
Return


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³a940AREG90ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³                                                            º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP5                                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940AREG90()

Local 	cRegistro   :=	""
Private lGravou		:=	.F.

nReg50	:=	R50->(LastRec())
nReg51	:=	R51->(LastRec())
nReg53	:=	R53->(LastRec())
nReg54	:=	R54->(LastRec())
nReg55	:=	R55->(LastRec())
nReg61	:=	R61->(LastRec())
nReg60	:=	A60->(LastRec())
nReg60	+=	M60->(LastRec())
nReg70	:=	R70->(LastRec())
nReg71	:=	R71->(LastRec())
If mv_par20==1 .And. mv_par26 <> 2
	nReg88	:=	(cArq088C)->(LastRec())
	nReg88	+=	(cArq088D)->(LastRec())
	nReg88	+=	(cArq088E)->(LastRec())
	nReg88	+=	(cArq088M)->(LastRec())
	nReg88	+=	(cArq088Q)->(LastRec())
Endif
nReg90	:=	1            	
If mv_par15 == 3 .And. mv_par26 <> 2
	nReg60	+=	R60->(LastRec())
	nReg61	+=	(cArq61R)->(LastRec()) 
	nReg75	:=	R75->(LastRec())
	nReg88	+=	(cArqD10)->(LastRec())
	nReg88	+=	(cArqAD4)->(LastRec())  
	nReg88   += (cArq08850)->(LastRec())
Endif 
If mv_par15 == 3 .Or. mv_par26 == 2
	nReg74	:=	R74->(LastRec())
EndIf	
if lcArq088
	if File(cArq088)
		nReg88	+=	(cArq088)->(LastRec())
	Endif
Endif
cRegistro	:=	"90"												//01.Tipo
cRegistro	+=	aFISFill(Num2Chr(Val(SM0->M0_CGC),14,0),14)   //02.CGC
cRegistro	+=	aFISFill(ARETDIG(SM0->M0_INSC,.t.,SM0->M0_ESTENT),14) //03.Inscr. Estadual

If mv_par26 <> 2 
	If nReg50>0
		// 58
		cRegistro	+=	"50"
		cRegistro	+=	aFISFill(StrZero(nReg50,8),8)	// Total de Registros "50"
	Endif
	
	If nReg51>0
		// 68
		cRegistro	+=	"51"
		cRegistro	+=	aFISFill(StrZero(nReg51,8),8)	// Total de Registros "51"
	Endif
	
	If nReg53>0
		// 78
		cRegistro	+=	"53"
		cRegistro	+=	aFISFill(StrZero(nReg53,8),8)	// Total de Registros "53"
	Endif
	
	If nReg54>0
		//	88
		cRegistro	+=	"54"
		cRegistro	+=	aFISFill(StrZero(nReg54,8),8)	// Total de Registros "54"
	Endif
	
	If nReg55>0
		// 98
		cRegistro	+=	"55"
		cRegistro	+=	aFISFill(StrZero(nReg55,8),8)	// Total de Registros "55"
	Endif
	
	If nReg60>0
		//	108
		cRegistro	+=	"60"
		cRegistro	+=	aFISFill(StrZero(nReg60,8),8)	// Total de Registros "60"
	Endif
	
	If nReg61>0
		cRegistro	+=	"61"
		cRegistro	+=	aFISFill(StrZero(nReg61,8),8)	// Total de Registros "61"
	Endif
	
	If nReg70>0
		//	118
		cRegistro	+=	"70"
		cRegistro	+=	aFISFill(StrZero(nReg70,8),8)	// Total de Registros "70"
	Endif       

	// Imprime Reg. Tipo 90
	If Len(cRegistro)>=110
		A940AIncReg90(@cRegistro,@nReg90,(nReg71+nReg74+nReg75+nReg88))
	Endif
	
	If nReg71>0
		cRegistro	+=	"71"
		cRegistro	+=	aFISFill(StrZero(nReg71,8),8)	// Total de Registros "71"
	Endif
	
	// Imprime Reg. Tipo 90
	If Len(cRegistro)>=110.And.!lGravou
		A940AIncReg90(@cRegistro,@nReg90,(nReg74+nReg75+nReg88))
	Endif 
EndIf     

If nReg74>0
	cRegistro	+=	"74"
	cRegistro	+=	aFISFill(StrZero(nReg74,8),8)	// Total de Registros "74"
Endif
// Imprime Reg. Tipo 90
If (Len(cRegistro)>=110.And.!lGravou).Or.!lGravou
	A940AIncReg90(@cRegistro,@nReg90,nReg75+nReg88)
Endif
If nReg75>0  
	cRegistro	+=	"75"
	cRegistro	+=	aFISFill(StrZero(nReg75,8),8)	// Total de Registros "75"
Endif
// Imprime Reg. Tipo 90
If (Len(cRegistro)>=110.And.!lGravou).Or.!lGravou
	A940AIncReg90(@cRegistro,@nReg90,nReg88)
Endif

If nReg88>0
	cRegistro	+=	"88"
	cRegistro	+=	aFISFill(StrZero(nReg88,8),8)	// Total de Registros "88"
Endif
// Imprime Reg. Tipo 90
If (Len(cRegistro)>=110.And.!lGravou).Or.!lGravou
	A940AIncReg90(@cRegistro,@nReg90,0)
Endif

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao ³A940AIncReg90ºAutor  ³Andreia dos Santos  º Data ³  06/04/01   º±±
±±ÌÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.  ³ Grava registros tipo 90                                       º±±
±±º       ³                                                               º±±
±±ÌÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso    ³ MATA940A                                                      º±±
±±ÈÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A940AIncReg90(cRegistro,nReg90,nResto)

If nResto<=0.And.(125-Len(cRegistro))>8
	// Nao possui mais registros a imprimir
	lGravou	:=	.T.
	cRegistro	+=	"99"
	If MV_PAR15 <> 3
		If mv_par20==1
			cRegistro	+=	AFISFill(StrZero(2+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+nReg75+nReg88,8),8)
		Else
			cRegistro	+=	AFISFill(StrZero(2+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+nReg75,8),8)
		Endif	
		cRegistro	+=	aFISFill(,(125-Len(cRegistro)))	// Brancos ate registro final	
		cRegistro	+=	Alltrim(Str(nReg90)) 				// Nro registro tipo 90	
	Else
		If mv_par26 <> 2
	   		cRegistro	+=	AFISFill(StrZero(1+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+nReg74+nReg75+nReg88,8),8)
	 	Else  	 	   
	 		cRegistro	+=	AFISFill(StrZero(1+nReg90+nReg88,8),8)
	 	EndIf
		cRegistro	+=	aFISFill(,(125-Len(cRegistro)))	// Brancos ate registro final	
		cRegistro	+=	Alltrim(Str(nReg90)) 				// Nro registro tipo 90		
		cRegistro += Space(58)
	EndIf
	A940AGrava(cRegistro)				 				// Grava reg. tipo 90
Endif

If (125-Len(cRegistro))<=16	// Verifica se imprime mais um registro
	If !lGravou
		nReg90++				// Incrementa reg. tipo 90
		cRegistro	+=	space(125-Len(cRegistro))
		cRegistro	+=	Alltrim(Str(nReg90))				// Nro registro tipo 90
		If MV_PAR15 == 3
			cRegistro += Space(58)
		EndIf
		A940AGrava(cRegistro)								// Grava reg. tipo 90
		If nResto<=0.And.(125-Len(cRegistro))<9
			// Nao possui mais registros a imprimir
			lGravou:=.T.
			cRegistro	:=	"90"	// Reinicializa segundo registro 90
			cRegistro	+=	aFISFill(Num2Chr(Val(SM0->M0_CGC),14,0),14)
			cRegistro	+=	aFISFill(ARETDIG(SM0->M0_INSC,.T.,SM0->M0_ESTENT),14)
			cRegistro	+=	"99"
			cRegistro	+=	AFISFill(StrZero(2+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+(If(mv_par15==3,nReg74,0))+nReg75,8),8)
			cRegistro	+=	aFISFill(,(125-Len(cRegistro)))	// Brancos ate registro final
			cRegistro	+=	Alltrim(Str(nReg90))  				// Nro registro tipo 90
			If MV_PAR15 == 3
				cRegistro += Space(58)
			EndIf
			A940AGRAVA(cRegistro)								// Grava reg. tipo 90
		Else
			cRegistro	:=	"90"	// Reinicializa segundo registro 90
			cRegistro	+=	aFISFill(Num2Chr(Val(SM0->M0_CGC),14,0),14)
			cRegistro	+=	aFISFill(ARETDIG(SM0->M0_INSC,.T.,SM0->M0_ESTENT),14)
		Endif
	Endif
Endif

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³a940AGravaºAutor  ³Andreia dos Santos  º Data ³  09/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Grava Registro no arquivo texto e acrescenta marca de final º±±
±±º          ³de registro                                                 º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA940a                                                   º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a940AGrava(cConteudo)

cConteudo += Chr(13)+Chr(10)

//verificar numero do disco
nRegN0++
If (nRegN0 == nNumReg)
	nDisco++
	A940AAvlDrv(@nHandle,Len(cConteudo),nDisco)
	nRegN0 := 0
EndIf

If !lEnd
	FWrite(nHandle,cConteudo,Len(cConteudo))
Endif

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao   ³A940aAVLDRVºAutor  ³Andreia dos Santos  º Data ³  17/04/01   º±±
±±ÌÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.    ³                                                             º±±
±±º         ³                                                             º±±
±±ÌÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso      ³ AP5                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A940aAvlDrv(nHandle,nBytes,nAtual)

Local 	nDisco	:=	0
Local 	cPath	:=	""
Local 	cFile
Local	nHdlChk	:=	0
Local	cArqChk	:=	"MATA940.CHK"
Local 	cTitulo	:=	STR0035 //"Numero Discos"
Local 	cMens1	:=	STR0036 + StrZero(nAtual,2)  //"Insira o disco numero : "
Local  	nOpcA	:=	2
Local	nOpcB	:=	2
Local 	aSays	:=	{}
Local aButtons	:=	{}
Local cExt 		:= Iif(mv_par24==1,".TXT",".T"+Strzero(nAtual,2))

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Fecha Arquivo Aberto Anteriormente                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If nHandle >= 0
	FClose(nHandle)
Endif
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Mostra o Disco Atual                                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

AADD(aSays,OemToAnsi( cMens1 ) )
AADD(aButtons, { 1,.T.,{|o| nOpca:= 1,o:oWnd:End()}} )

If !lAutomato
	FormBatch( cTitulo, aSays, aButtons )
Else
	nOpcA := 1
EndIf

If !(nOpcA==1)
	lEnd:=.T.
Endif

While (nOpcA==1) .And. (nOpcB==2)
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Define disco a ser gravado                                   ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	__cDest := Nil
	If !Empty(cDisco)
		nDisco	:=	Asc(cDisco)-Asc("A")+1
		cPath	:=	cDisco+":\"
	Else
		cPath:=""
	Endif
	
	If nProcFil == 2
		cPath := cPath + cFilAnt + "\"
		Makedir(cPath)
	EndIf
	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica se drive ‚ avaliavel                                ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	IF Subs(cDisco,1,1)$"AB"
		cArqChk	:=	cPath+cArqChk
		nHdlChk	:=	MsFCreate(cArqChk)
		If nHdlChk < 0
			nOpcB	:=	Aviso(STR0037,STR0038,{STR0002,STR0001}) //###"Abandona",###"Continua" //"Drive"###"Drive n„o est  dispon¡vel."
			If nOpcB==2
				Loop
			Else
				lEnd := .T. ; Exit
			Endif
		Else
			FClose(nHdlChk) ; Ferase(cArqChk)
		EndIf
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Verifica espaco no disco                                     ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If DiskSpace(nDisco)<nBytes
			cMsg := STR0039 //"N„o h  espa‡o no disco para grava‡„o;"
			cMsg += STR0040 //" Troque disquete para continuar..."
			nHdlChk := -1
			nOpcB:=Aviso("Drive",cMsg,{STR0002,STR0001}) //###"Abandonar",###"Continuar"
			If nOpcB==2
				Loop
			Else
				lEnd := .T. ; Exit
			Endif
		Endif
		cFile	:=cPath+cArqTxt+cExt
	
	ElseIf !lAutomato
		
		cFile   :=CriaTrab(,.f.)
		__cTrbName := cFile
		__cDest := cPath+cArqTxt+cExt
	
	Else

		cFile   	:= "\baseline\"+cArqTxt+cExt
		__cTrbName 	:= cArqTxt
		__cDest 	:= cFile
		
	Endif
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Cria arquivo                                                 ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	nHandle	:=MsFCreate(cFile)
	If nHandle < 0
		nOpcB	:=	Aviso("Drive","Drive n„o est  pronto.",{"Abandona","Continua"})
		If nOpcB==2
			Loop
		Else
			lEnd := .T. ; Exit
		Endif
	EndIf
	Exit
EndDo

Return
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³a940aRelat  ³ Autor ³ Andreia dos Santos  ³ Data ³ 26/04/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Imprime relatorio de conferencia                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC FUNCTION a940ARelat()

Titulo	:=	STR0041 //"Listagem de acompanhamento"
cDesc1	:=	STR0042 //"Listagem de acompanhamento do arquivo pr‚-formatado."
cDesc2	:=	""
cDesc3	:=	""
Tamanho	:=	"P"
Limite	:=	80
nTipo	:=	18
cabec1	:=	''
cabec2	:=	''
cabec3	:=	''
cbCont	:=	0
cbtxt	:=	Space(10)
m_pag	:=	1
cPerg   :=	"MTA94A"
cString :=	"SF3"
lEnd	:=	.f.
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica as perguntas selecionadas                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
pergunte(cperg,.F.)
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Envia controle para a funcao SETPRINT                        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
nLastKey:=0

wnrel	:=	SetPrint(cString,wnrel,cPerg,Titulo,cDesc1,cDesc2,cDesc3,.F.,"",.F.)
If nLastKey==27
	Return
Endif
SetDefault(aReturn,cString)
If nLastKey==27
	Return
Endif

RptStatus({|lEnd|A940AImpr(@lEnd,wnRel,cString,Tamanho)},titulo)

Return
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³a940AImpr    ³Autor ³ Andreia dos Santos  ³ Data ³ 26/04/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Chamada para impressao da listagem                          ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
FUNCTION a940AImpr(lEnd,wnRel,cString,Tamanho)

Local nLin
Local nTotReg

cabec(titulo,cabec1,cabec2,nomeprog,tamanho,nTipo)
nLin	:=	Prow()+1
@ nLin,00 PSAY Replic("*",80)
nLin	+=2
@ ++nLin,15 PSAY STR0043+Transform(SM0->M0_CGC,"@R! NN.NNN.NNN/NNNN-99") //"C.G.C.(MF)........: "
@ ++nLin,15 PSAY STR0044+SM0->M0_INSC //"Inscricao Estadual: "
@ ++nLin,15 PSAY STR0045+SM0->M0_NOMECOM //"Razao Social......: "
@ ++nLin,15 PSAY STR0046+SM0->M0_ENDENT //"Endereco..........: "
@ ++nLin,15 PSAY "                    "+SM0->M0_CIDENT+" - "+SM0->M0_ESTENT+" - CEP: "+Transform(SM0->M0_CEPENT,"@R 99999-999")
nLin	+=2
@++nLin,15 PSAY STR0047+cEquip //"Equipamento.......: "
@++nLin,15 PSAY STR0048+IIf(nMeioMag<=4,"Disquete","Fita") //"Meio Magnetico....: "
@++nLin,15 PSAY STR0049+cFatBloc //"Fator de Bloco....: "
nLin	+=2
@ ++nLin,15 PSAY STR0050+DTOC(dDtIni)+" a "+DTOC(dDtFim) //"Periodo abrangido.: "
nLin++
@ ++nLin,15 PSAY STR0051+Str(1,8)	   +STR0052 //"Tipo 10...........: "###" Registro"
If mv_par26 <> 2
	@ ++nLin,15 PSAY STR0053+Str(1,8)	   +STR0052 //"Tipo 11...........: "###" Registro"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Imprime somente itens existentes no arq. magnetico           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If nReg50>0
		@ ++nLin,15 PSAY STR0054+Str(nReg50,8)	+STR0055 //"Tipo 50...........: "###" Registro(s)"
	Endif
	If nReg51>0
		@ ++nLin,15 PSAY STR0056+Str(nReg51,8)	+STR0055 //"Tipo 51...........: "###" Registro(s)"
	Endif
	If nReg53>0
		@ ++nLin,15 PSAY STR0057+Str(nReg53,8)	+STR0055 //"Tipo 53...........: "###" Registro(s)"
	Endif
	If nReg54>0
		@ ++nLin,15 PSAY STR0058+Str(nReg54,8)	+STR0055 //"Tipo 54...........: "###" Registro(s)"
	Endif
	If nReg55>0
		@ ++nLin,15 PSAY STR0059+Str(nReg55,8)	+STR0055 //"Tipo 55...........: "###" Registro(s)"
	Endif
	If nReg60>0
		@ ++nLin,15 PSAY STR0060+Str(nReg60,8) +STR0055 //"Tipo 60...........: "###" Registro(s)"
	Endif
	If nReg61>0
		@ ++nLin,15 PSAY STR0061+Str(nReg61,8)	+STR0055 //"Tipo 61...........: "###" Registro(s)"
	Endif
	If nReg70>0
		@ ++nLin,15 PSAY STR0062+Str(nReg70,8)	+STR0055 //"Tipo 70...........: "###" Registro(s)"
	Endif
	If nReg71>0
		@ ++nLin,15 PSAY STR0063+Str(nReg71,8)	+STR0055 //"Tipo 71...........: "###" Registro(s)"
	Endif
	If Mv_par15 == 3
		If nReg74>0
			@ ++nLin,15 PSAY STR0077+Str(nReg74,8)	+STR0055 //"Tipo 74...........: "###" Registro(s)"
		Endif
	EndIf	
	If nReg75>0
		@ ++nLin,15 PSAY STR0064+Str(nReg75,8)	+STR0055 //"Tipo 75...........: "###" Registro(s)"
	Endif
EndIf
If nReg88>0
	@ ++nLin,15 PSAY STR0065+Str(nReg88,8)	+STR0055 //"Tipo 88...........: "###" Registro(s)"
Endif
If mv_par20==1 .And. mv_par26 <> 2
	If nReg88C>0
		@ ++nLin,15 PSAY "Tipo 88C..........: "+Str(nReg88C,8)	+" Registro(s)"
	Endif
	If nReg88D>0
		@ ++nLin,15 PSAY "Tipo 88D..........: "+Str(nReg88D,8)	+" Registro(s)"
	Endif
	If nReg88E>0
		@ ++nLin,15 PSAY "Tipo 88E..........: "+Str(nReg88E,8)	+" Registro(s)"
	Endif
	If nReg88M>0
		@ ++nLin,15 PSAY "Tipo 88M..........: "+Str(nReg88M,8)	+" Registro(s)"
	Endif
	If nReg88Q>0
		@ ++nLin,15 PSAY "Tipo 88Q..........: "+Str(nReg88Q,8)	+" Registro(s)"
	Endif
Endif
@ ++nLin,15 PSAY STR0066+Str(nReg90,8)	   +STR0067 //"Tipo 90...........: "###" Registros"
nLin++
If mv_par20==1 .And. mv_par26 <> 2
	nTotReg	:=	2+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+nReg75+nReg88+nReg88C+nReg88D+nReg88E+nReg88M+nReg88Q
Elseif mv_par26 == 2
	nTotReg	:= 1+nReg90+nReg88
Else
	nTotReg	:=	2+nReg90+nReg50+nReg51+nReg53+nReg54+nReg55+nReg60+nReg61+nReg70+nReg71+nReg75+nReg88
Endif
@ ++nLin,15 PSAY STR0068+Str(nTotReg)+STR0067 //"Total de registros: "###" Registros"
nLin++

If nTotReg>0
	roda(cbcont,cbtxt,tamanho)
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Spool de Impressao                                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Set Printer to
If aReturn[5] == 1
	dbcommitAll()
	ourspool(wnrel)
Endif

MS_FLUSH()
Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao   ³A940DelArq ºAutor  ³ Nereu Humberto Jr. º Data ³  02/01/03   º±±
±±ÌÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.    ³ Apaga arquivos temporarios criados para gerar o arquivo     º±±
±±º         ³ Magnetico                                                   º±±
±±ÌÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso      ³ MATA940                                                     º±±
±±ÈÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function a940ADelArq(aDelArqs)
Local aAreaDel := GetArea()
Local nI := 0

For nI:= 1 To Len(aDelArqs)
	If aDelArqs[ni,1] <> nil .And. File(aDelArqs[ni,1]+GetDBExtension())
		dbSelectArea(aDelArqs[ni,2])
		dbCloseArea()
		Ferase(aDelArqs[ni,1]+GetDBExtension())
		Ferase(aDelArqs[ni,1]+OrdBagExt())
	Endif	
Next

RestArea(aAreaDel)

Return
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³ SomaContas³ Autor ³Gustavo G. Rueda      ³ Data ³ 16.08.04 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Soma os saldos de um grupo aleatorio de contas. Esta funcao³±±
±±³          ³  foi duplicada com o objetivo de liberar para o usuario a  ³±±
±±³          ³  indicacao no .CFP das contas Sinteticas.                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe	 ³ SomaContas( ExpC1 , ExpN1 , ExpN2 ) 						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ Contas , Mes , Moeda 									  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Para uso na planilha. Obs:sem macro e so' com vars locais !³±±
±±³ Atencao  ³ Esta funcao faz chamadas a funcao SomaSaldo()			  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function SomaContas ( cContas , nMes , nMoeda )
	Local nLop	  := 0	 // Variavel para uso no laco que varre cContas e arrays
	Local aDeAte  := {}	 // Armazenara' os grupos de contas "De/Ate'"
	Local aContas := {}	 // Armazenara' as contas indiviuais
	Local cTempor := ""   // Variavel auxiliar, transitoria e temporaria
	Local nVolta  := 0	 // Variavel auxiliar de retorno da funcao
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica passagem correta de parametros ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If ValType( cContas )	# "C"
		// Avaliar se devemos criar um help para esta consistencia
		Return( 0 )
	Endif
	//
	If ValType( nMes ) # "N"
		nMes := Month( dDataBase )
	Endif
	//
	If ValType( nMoeda ) # "N"
		nMoeda := 1
	Endif
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Analisa a String que contem as contas   ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	cContas := AllTrim( cContas )
	cTempor := ""
	For nLop := 1 to Len( cContas )
		 cChar := Subst( cContas, nLop , 1)
		 //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		 //³ Verifica a presenca de caracteres invalidos ³
		 //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		 If !cChar $ "0123456789,:"
			 // Avaliar se devemos criar um help para esta consistencia
			 Loop
		 Endif
		 //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		 //³ Se encontrar o separador simples, faz a carga dos arrays	 ³
		 //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		 If CChar == ","
			 If ":" $ cTempor
				 Aadd( aDeAte , cTempor)
			 Else
				 If !Empty( cTempor )
					 Aadd( aContas , cTempor )
				 Endif
			 Endif
			 cTempor := ""
		 Else
			 cTempor += cChar
		 Endif
	Next nLop
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica o fim, pois nao precisa haver "," no final !      ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If !Empty( cTempor )
		If ":" $ cTempor
			 Aadd( aDeAte , cTempor)
		Else
			 Aadd( aContas , cTempor )
		Endif
	Endif
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Verifica se houve identificacao de contas ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If Len( aDeAte ) == 0 .and. Len( aContas ) == 0
		Return( 0 )
	Endif
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Laco das contas "De / Ate"       ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	For nLop := 1 to Len( aDeAte )
		// Conta inicial
		cTempor := Subst( aDeAte[nLop], 1, At(":",aDeAte[nLop]) -1 )
		// Conta Final
		cChar   := Subst( aDeAte[nLop], At(":",aDeAte[nLop]) + 1 , Len(aDeAte[nLop] ) )
		//
		nVolta += Somasaldo	( cTempor , cChar , nMes , nMoeda )	
	Next nLop	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Laco das contas isoladas   ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	For nLop := 1 to Len( aContas )
		 nVolta += SomaSaldo ( aContas[nLop] , aContas[nLop] , nMes , nMoeda )
	Next Lop
Return nVolta
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³ SomaSaldo³ Autor ³Gustavo G. Rueda	    ³ Data ³ 03.02.93 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Soma os saldos de um intervalo de conta. Esta funcao       ³±±
±±³          ³  foi duplicada com o objetivo de liberar para o usuario a  ³±±
±±³          ³  indicacao no .CFP das contas Sinteticas.                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe	 ³ SomaSaldo( ExpC1 , ExpC2 , ExpN1 , ExpN2 )				  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ Conta de , Conta Ate , Mes , Moeda						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Generico 												  ³±±
±±³ Atencao  ³ Esta funcao tembem e' chamada pela funcao SomaContas acima ³±±
±±³			 ³ . Caso ocorram alteracoes nesta funcao, verificar passagem ³±±
±±³			 ³ e tratamento das alteracoes na funcao SomaContas.		  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function SomaSaldo ( cContaDe , cContaAte , nMes , nMoeda )
	Local nSaldo := 0
	Local dData  
	Private cMes	
	// ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	// ³ Verifica qual e'o periodo de acordo com mˆs    ³
	// ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If nMes <= 12
		dData := Ctod("01/"+StrZero(nMes,2)+"/"+StrZero(Year(dDataBase),4),"ddmmyy")
		If ! DataMoeda(nMoeda, @cMes, dData)
			Return 0
		End
		nMes := Int(Val(cMes))		// atualiza cMes de acordo com periodo
	EndIf
	//
	cContaDe :=Trim ( cContaDe  ) + Space ( 20 - Len ( Trim ( cContaDe ) ) )
	cContaAte:=Trim ( cContaAte ) + Space ( 20 - Len ( Trim ( cContaAte) ) )
	//	
	nMoeda := IIF( nMoeda = NIL, 1 , nMoeda )
	//
	IF nMoeda = 1
		dbSelectArea ( "SI1" )
		dbSeek ( cFilial + cContaDe , .T. )
	Else
		dbSelectArea ( "SI7" )
		dbSeek ( cFilial + cContaDe + Str ( nMoeda , 1 ) , .T. )
	End
	//
	Do While !Eof()
		IF nMoeda == 1
			IF cFilial != I1_FILIAL .or. I1_CODIGO > cContaAte
				Exit
			End
		ElseIf cFilial != I7_FILIAL .or.I7_CODIGO > cContaAte
			Exit
		End
		//
		IF nMoeda != 1
			SI1 -> ( dbSeek ( cFilial + SI7->I7_CODIGO ) )
		End
		//
		IF nMoeda > 1
			If SI7->I7_MOEDA != Str ( nMoeda , 1 )
				dbSkip()
				Loop
			End
		End
		//
		nSaldo += CalcSaldo ( nMes , nMoeda )
		//
		dbSkip ( )	
	End	
Return nSaldo
/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ImporSWN  ºAutor  ³Microsiga           º Data ³  06/01/05   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Tratamento para os itens de importacao da tabela SWN        º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function IMporSWN (cAliasSd1, cCNPJ, cSitTrib, dDTIni, dDTFim, nAliqICM, nBRetido, nRedBase, aArrayF3, cAliasSF3, nItem)
	//
	Local aAreaSb1	:=	{}
	//
	dbSelectArea('SWN')
	dbSetOrder(1)	
	SWN->(DbSeek (cSeek:=xFilial ('SWN')+(cAliasSD1)->D1_DOC+(cAliasSD1)->D1_SERIE+AllTrim ((cAliasSD1)->D1_TEC), .F.))
	While !SWN->(Eof ()) .And.;
		xFilial ("SWN")+(cAliasSD1)->D1_DOC+(cAliasSD1)->D1_SERIE+(cAliasSD1)->D1_TEC==SWN->WN_FILIAL+SWN->WN_DOC+SWN->WN_SERIE+SWN->WN_TEC+SWN->WN_EX_NCM+SWN->WN_EX_NBM
		
		RecLock("R54",.T.)
		R54->A54_CNPJ	:=	cCNPJ
		R54->A54_MODELO	:=	AModNot(aArrayF3[1][7])
		R54->A54_SERIE 	:=	(cAliasSD1)->D1_SERIE
		R54->A54_SDOC 	:=	SerieNfId(cAliasSD1,2,"D1_SERIE")
		R54->A54_NFISC 	:=	(cAliasSD1)->D1_DOC
		R54->A54_CFOP	:=	(cAliasSD1)->D1_CF
	    R54->A54CFOPEXT :=SF4->F4_CFEXT
		R54->A54_CST   	:=	cSitTrib
		R54->A54_NUMITE	:=	StrZero(nItem,3)
		R54->A54_PRODUT	:=	SWN->WN_PRODUTO
		R54->A54_QUANT 	:=	SWN->WN_QUANT
		R54->A54_VALPRO	:=	SWN->WN_VALOR
		R54->A54_VALDES	:=	0
		R54->A54_BSICM 	:= 	SWN->WN_BASEICM
		R54->A54_BRICMS	:=	0
		R54->A54_VALIPI	:=	0
		R54->A54_ALQICM	:=	aArrayF3[1][8]
		MsUnlock()		
		
		aAreaSb1	:=	SB1->(GetArea ())
		SB1->(DbSeek (xFilial ("SB1")+SWN->WN_PRODUTO))

		If !R75->(dbSeek (DTOS(dDTIni)+DTOS(dDTFim)+AllTrim (SB1->B1_COD)))
    		RecLock("R75",.T.)
			R75->A75_DTAINI	:=	dDTIni
			R75->A75_DTAFIM	:=	dDTFim
			R75->A75_PROD	:=	SB1->B1_COD
			R75->A75_CODNCM	:=	SB1->B1_POSIPI
			R75->A75_DESCR	:=	SB1->B1_DESC
			R75->A75_UM    	:=	SB1->B1_UM
		    R75->A75_ALQIPI	:=	SB1->B1_IPI
			R75->A75_ALQICM	:=	nAliqICM
			R75->A75_BRICMS	:=	nBRetido  	//Base do Retido
			R75->A75_SITTRI	:=	cSitTrib
			R75->A75_REDBSE	:=	nRedBase		//Reducao da Base do ICMS
			If MV_PAR15 == 3
				R75->A75_EAN      := SB1->B1_CODBAR
				R75->A75_CODFIS   := &(SuperGetMv("MV_DIC_T06",,"'0850000'"))
			Endif	
			MsUnlock()
	    Endif
	    //
	    RestArea (aAreaSb1)
		//
		nItem++
		SWN->(DbSkip ())
	EndDo
	nItem--
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³RetPar    ºAutor  ³Sergio S. Fuzinaka  º Data ³  18/08/05   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Retorna o parametro tratado para o Top                      º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
#IFDEF TOP
	Static Function RetPar(cMvPar)
	
	Local cRet	:= ""
	Local nI	:= 0
	
	If Len(cMvPar) > 0
		For nI := 1 To Len(cMvPar)
			If Substr(cMvPar,nI,1) == "/"
				cRet += "','"
			ElseIf !Empty(Substr(cMvPar,nI,1))
				cRet += Substr(cMvPar,nI,1)
			Endif
		Next
	Endif
	
	Return(cRet)       
#ENDIF
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³RetPar    ºAutor  ³Rodrigo de A Godinhoº Data ³  16/11/05   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±± 
±±ºRetorno   ³cRet - string com todos os CFOP's a desconsiderar           º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Cria string com todos os CFOP's a ser desconsiderados       º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function GetDesCFOP()
Local cRet	:=	""
dbSelectArea("SX6")
SX6->(dbSetOrder(1))
If SX6->(dbSeek(xFilial("SX6") + "MV_DESCFO"))
	While !SX6->(EOF()) .And.  xFilial("SX6")==SX6->X6_FIL .And. "MV_DESCFO"$SX6->X6_VAR
		cRet += Iif(Empty(AllTrim(cRet)) .Or. Empty(AllTrim(SX6->X6_CONTEUD)),"","/") + AllTrim(SX6->X6_CONTEUD)
		SX6->(dbSkip())
	End
EndIf
Return(cRet)

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ GrEstR74 ³ Autor ³ Liber De Esteban      ³ Data ³ 12/08/08 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Calcula inventario atraves do FsEstInv, e grava na tabela  ³±±
±±³          ³ R74. Isso e necessario para processamento multifiliais     ³±±
±±³          ³ ja que o FsEstInv calcula apenas da filial corrente        ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³lCreate -> Flaf indicando se deve criar a tabela temporaria ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function GrEstR74(lCreate)

Local	aStru074	:= {}
DEFAULT	lCreate		:= .F.

If lCreate
	AADD(aStru074,{"CODIGO"		,"C",TamSX3("B1_COD")[1],0})
	AADD(aStru074,{"QUANT"	 	,"N",013,3})
	AADD(aStru074,{"CUSTO"	 	,"N",013,3})
	AADD(aStru074,{"SITUACA"	,"C",001,0})
	AADD(aStru074,{"CNPJ"	 	,"C",014,0})
	AADD(aStru074,{"INSCR"	 	,"C",TamSX3("A2_INSCR")[1],0})
	AADD(aStru074,{"UF"  	 	,"C",002,0})
 
	cArq074  :=	CriaTrab(aStru074)
	dbUseArea(.T.,__LocalDriver,cArq074,"R74")
	IndRegua("R74",cArq074,"CODIGO+SITUACA")
EndIf

FsEstInv({"T74",""},1,.T.,.F.,,.T.)

DbSelectArea("T74")
T74->(dbGoTop())

Do while T74->(!eof())

	If R74->(DbSeek(T74->CODIGO+T74->SITUACA))
		RecLock("R74",.F.)
		R74->QUANT		+= T74->QUANT
		R74->QUANT		+= T74->QUANT
	Else
		RecLock("R74",.T.)
		R74->CODIGO		:= T74->CODPRD
		R74->QUANT		:= T74->QUANT
		R74->CUSTO		:= T74->CUSTO
		R74->SITUACA	:= T74->SITUACA
		R74->CNPJ		:= T74->CNPJ
		R74->INSCR		:= T74->INSCR
		R74->UF			:= T74->UF
	EndIf

	R74->(MsUnlock())
	T74->(dbSkip())
EndDo

FsEstInv({"T74",""},2,,,,.T.)

Return

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ CreateTBL³ Autor ³ Liber De Esteban      ³ Data ³ 28/08/08 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Cria tabelas que serao utilizadas no processamento         ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function CreateTbl()

Local cAlias	:=	Alias()

Local aStru050  := {}
Local aStru051  := {}
Local aStru053  := {}
Local aStru054  := {}
Local aStru055  := {}
Local aStru060M := {}
Local aStru060A := {}
Local aStru060D := {}
Local aStru060I := {}
Local aStru060R := {}
Local aStru061  := {}
Local aStru070  := {}
Local aStru071  := {}
Local aStru075  := {}
Local aStru076  := {}
Local aStru077  := {}
Local aStru090  := {}

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Zera contadores                                                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
nReg50	 := 0
nReg51	 := 0
nReg53	 := 0
nReg54	 := 0
nReg55	 := 0
nReg60	 := 0
nReg61	 := 0
nReg70	 := 0
nReg71	 := 0
nReg74	 := 0
nReg75 	 := 0
nReg88 	 := 0
nReg90	 := 1
nValMPI	 := 0
nValMPF	 := 0
nValPAI	 := 0
nValPAF	 := 0
nValISI	 := 0
nValISF	 := 0
nValANI	 := 0
nValANF	 := 0
nReg88C	 := 0
nReg88D	 := 0
nReg88E	 := 0
nReg88M	 := 0
nReg88Q	 := 0
nVal88St := 0

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Criacao os arquivos de trabalho                                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 050 - Notas Fiscais Modelo 1/1A (ICMS) SPED modelo 55          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru050,{"A50_CNPJ"	,"C",014,0})
AADD(aStru050,{"A50_IE"		,"C",014,0})
AADD(aStru050,{"A50_ENTRAD" ,"D",008,0})
AADD(aStru050,{"A50_EMISS"	,"D",008,0})
AADD(aStru050,{"A50_UF"		,"C",002,0})
AADD(aStru050,{"A50_MODELO"	,"C",002,0})
AADD(aStru050,{"A50_SERIE"	,"C",TamSX3("F2_SERIE")[1],0})
AADD(aStru050,{"A50_SDOC"	,"C",003,0})
AADD(aStru050,{"A50_NFISC"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru050,{"A50_CFOP"	,"C",004,0})
AADD(aStru050,{"A50CFOPEXT"	,"C",002,0})
AADD(aStru050,{"A50_EMIT"	,"C",001,0})
AADD(aStru050,{"A50_VALTOT"	,"N",013,2})
AADD(aStru050,{"A50_BSICM"	,"N",013,2})
AADD(aStru050,{"A50_VALICM"	,"N",013,2})
AADD(aStru050,{"A50_ISENTO"	,"N",013,2})
AADD(aStru050,{"A50_OUTRAS"	,"N",013,2})
AADD(aStru050,{"A50_ALQICM"	,"N",005,2})
AADD(aStru050,{"A50_SITUAC"	,"C",001,0})
AADD(aStru050,{"A50_DESPES"	,"N",014,2})
AADD(aStru050,{"A50_CODMUN"	,"C",005,0})
AADD(aStru050,{"A50_ANOAID"	,"C",004,0})
AADD(aStru050,{"A50_NUMAID"	,"C",005,0})

cArq050	:=	CriaTrab(aStru050)
dbUseArea(.T.,__LocalDriver,cArq050,"R50")
IndRegua("R50",cArq050,"DTOS(A50_EMISS)") 

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 051 - Nota Fiscal ( IPI )                                      ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru051,{"A51_CNPJ"	,"C",014,0})
AADD(aStru051,{"A51_IE"		,"C",014,0})
AADD(aStru051,{"A51_EMISS"	,"D",008,0})
AADD(aStru051,{"A51_UF"		,"C",002,0})
AADD(aStru051,{"A51_SERIE"	,"C",TamSX3("F2_SERIE")[1],0})
AADD(aStru051,{"A51_SDOC"	,"C",003,0})
AADD(aStru051,{"A51_NFISC"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru051,{"A51_CFOP"	,"C",004,0})
AADD(aStru051,{"A51_VALTOT"	,"N",014,2})
AADD(aStru051,{"A51_VALIPI"	,"N",014,2})
AADD(aStru051,{"A51_ISENTA"	,"N",014,2})
AADD(aStru051,{"A51_OUTRAS"	,"N",014,2})
AADD(aStru051,{"A51_SITUAC"	,"C",001,0})
AADD(aStru051,{"A51_BASIPI"	,"N",013,2})

cArq051	:=	CriaTrab(aStru051)
dbUseArea(.T.,__LocalDriver,cArq051,"R51")
IndRegua("R51",cArq051,"Dtos(A51_EMISS)")
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 053 - Nota Fiscal Subst. Tributaria                            ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru053,{"A53_CNPJ"	,"C",014,0})
AADD(aStru053,{"A53_IE"		,"C",014,0})
AADD(aStru053,{"A53_EMISS"	,"D",008,0})
AADD(aStru053,{"A53_UF"		,"C",002,0})
AADD(aStru053,{"A53_MODELO"	,"C",002,0})
AADD(aStru053,{"A53_SERIE"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru053,{"A53_SDOC"	,"C",003,0})
AADD(aStru053,{"A53_NFISC"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru053,{"A53_CFOP"	,"C",004,0})
AADD(aStru053,{"A53_EMIT"	,"C",001,0})
AADD(aStru053,{"A53_BRICMS"	,"N",014,2})
AADD(aStru053,{"A53_VALRET"	,"N",014,2})
AADD(aStru053,{"A53_DESPES"	,"N",014,2})
AADD(aStru053,{"A53_SITUAC"	,"C",001,0})
AADD(aStru053,{"A53_ANTECI"	,"C",001,0})

cArq053	:=	CriaTrab(aStru053)
dbUseArea(.T.,__LocalDriver,cArq053,"R53")
IndRegua("R53",cArq053,"DTOS(A53_EMISS)")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 054 - Itens do documento fiscal                                ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru054,{"A54_CNPJ"	,"C",014,0})
AADD(aStru054,{"A54_MODELO"	,"C",002,0})
AADD(aStru054,{"A54_SERIE"	,"C",TamSX3("F2_SERIE")[1],0})
AADD(aStru054,{"A54_SDOC"	,"C",003,0})
AADD(aStru054,{"A54_NFISC"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru054,{"A54_CFOP"	,"C",004,0})
AADD(aStru054,{"A54CFOPEXT"	,"C",002,0})
AADD(aStru054,{"A54_CST"	,"C",003,0})
AADD(aStru054,{"A54_NUMITE"	,"C",003,0})
AADD(aStru054,{"A54_PRODUT"	,"C",014,0})
AADD(aStru054,{"A54_QUANT"	,"N",014,3})
AADD(aStru054,{"A54_VALPRO"	,"N",014,2})
AADD(aStru054,{"A54_VALDES"	,"N",014,2})
AADD(aStru054,{"A54_BSICM"	,"N",014,2})
AADD(aStru054,{"A54_BRICMS"	,"N",014,2})
AADD(aStru054,{"A54_VALIPI"	,"N",014,2})
AADD(aStru054,{"A54_ALQICM"	,"N",005,2})

cArq054	:=	CriaTrab(aStru054)
dbUseArea(.T.,__LocalDriver,cArq054,"R54")
IndRegua("R54",cArq054,"A54_CNPJ+A54_SERIE+A54_NFISC+A54_NUMITE")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arquivo do Registro tipo 55 - Guia Nacional de Recolhimento de Tributos Estaduais³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru055,{"A55_CNPJ"	,"C",014,0})
AADD(aStru055,{"A55_IE"		,"C",014,0})
AADD(aStru055,{"A55_DATPAG"	,"D",008,0})
AADD(aStru055,{"A55_UFSUBS"	,"C",002,0})
AADD(aStru055,{"A55_UFFAV"	,"C",002,0})
AADD(aStru055,{"A55_BANCO"	,"C",003,0})
AADD(aStru055,{"A55_AGENC"	,"C",004,0})
AADD(aStru055,{"A55_NUMERO"	,"C",020,0})
AADD(aStru055,{"A55_VALOR"	,"N",014,2})
AADD(aStru055,{"A55_VENCTO"	,"D",008,0})
AADD(aStru055,{"A55_MESANO"	,"C",006,0})
AADD(aStru055,{"A55_CONVEN"	,"C",030,0})

cArq055	:=	CriaTrab(aStru055)
dbUseArea(.T.,__LocalDriver,cArq055,"R55")
IndRegua("R55",cArq055,"DTOS(A55_DATPAG)")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arquivo do Registro tipo 61R ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aCampos	:=	{}
AADD(aCampos,{"R61_EMISS"	,"C"	,006,0})
AADD(aCampos,{"R61_PRODSV"	,"C"	,014,0})	
AADD(aCampos,{"R61_QUANT"	,"N"	,013,3})
AADD(aCampos,{"R61_VALOR"	,"N"	,016,2})
AADD(aCampos,{"R61_BICMS"	,"N"	,016,2})
AADD(aCampos,{"R61_ALIQ"	,"N"	,005,2})

cArq61R	:=	CriaTrab(aCampos)
dbUseArea(.T.,__LocalDriver,cArq61R,cArq61R,.T.,.F.)
IndRegua(cArq61R,cArq61R,"R61_EMISS+R61_PRODSV+STR(R61_ALIQ,5,2)",,,STR0071 )  //"Indexando Registro Tipo 61R"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arq. do Registro tipo AD404-D³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aCampos	:=	{}
AADD(aCampos,{"AD4TIPO"  ,"C"	,001,0})
AADD(aCampos,{"AD4INSC"  ,"C"	,010,0})	
AADD(aCampos,{"AD4MODELO","C"	,002,0})
AADD(aCampos,{"AD4SERIE" ,"C"	,003,0})
AADD(aCampos,{"AD4NUMERO","C"	,TamSX3("F2_DOC")[1],0})
AADD(aCampos,{"AD4EMISS" ,"D"	,008,0})
AADD(aCampos,{"AD4VALOR" ,"N"	,013,2})

cArqAD4	:=	CriaTrab(aCampos)
dbUseArea(.T.,__LocalDriver,cArqAD4,cArqAD4,.T.,.F.)
IndRegua(cArqAD4,cArqAD4,"AD4TIPO+AD4INSC+AD4NUMERO+AD4SERIE+Dtos(AD4EMISS)",,,STR0079 )  //"Indexando Registro Tipo 88 Detalhe 04"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arq. do Registro tipo AD410-H³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aCampos	:=	{}
AADD(aCampos,{"D10CNPJ"  ,"C"	,014,0})
AADD(aCampos,{"D10MODDES","C"	,002,0})	
AADD(aCampos,{"D10SERDES","C"	,003,0})
AADD(aCampos,{"D10SBSRDS","C"	,002,0})
AADD(aCampos,{"D10NUMDES","C"	,TamSX3("F2_DOC")[1],0})
AADD(aCampos,{"D10CFOP"  ,"C"	,004,0})
AADD(aCampos,{"D10IT_DES","C"	,003,0})
AADD(aCampos,{"D10INSCIN","C"	,014,0})
AADD(aCampos,{"D10UFINC" ,"C"	,002,0})
AADD(aCampos,{"D10MODINC","C"	,002,0})
AADD(aCampos,{"D10SERINC","C"	,003,0})
AADD(aCampos,{"D10SBSRIN","C"	,002,0})
AADD(aCampos,{"D10NUMINC","C"	,TamSX3("F2_DOC")[1],0})
AADD(aCampos,{"D10EMIINC","C"	,008,0})
AADD(aCampos,{"D10QUANT" ,"C"	,005,0})
AADD(aCampos,{"D10VALOR" ,"N"	,013,2})

cArqD10	:=	CriaTrab(aCampos)
dbUseArea(.T.,__LocalDriver,cArqD10,cArqD10,.T.,.F.)
IndRegua(cArqD10,cArqD10,"D10CNPJ+D10NUMDES+D10SERDES",,,STR0078 )  //"Indexando Registro Tipo 88 Detalhe 10"


//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 060 - ECF(Mestre do equipamento)                               ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru060M,{"M60_EMISS"	,"D",008,0})
AADD(aStru060M,{"M60_NUMFAB","C",020,0})
AADD(aStru060M,{"M60_PDV"	,"C",003,0})
AADD(aStru060M,{"M60_MODELO","C",002,0})
AADD(aStru060M,{"M60_NUMINI","C",TamSX3("F2_DOC")[1],0})
AADD(aStru060M,{"M60_NUMFIM","C",TamSX3("F2_DOC")[1],0})
AADD(aStru060M,{"M60_REDUCZ","C",006,0})
AADD(aStru060M,{"M60_CRO"	,"N",003,0})
AADD(aStru060M,{"M60_VENDA"	,"N",016,2})
AADD(aStru060M,{"M60_GERAL"	,"N",016,2})

cArq060M :=	CriaTrab(aStru060M)
dbUseArea(.T.,__LocalDriver,cArq060M,"M60")
IndRegua("M60",cArq060M,"DTOS(M60_EMISS)+M60_PDV")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 060A - ECF(Analitico)                                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru060A,{"A60_EMISS"	,"D",008,0})
AADD(aStru060A,{"A60_NUMFAB","C",020,0})
AADD(aStru060A,{"A60_SITTRI","C",004,0})
AADD(aStru060A,{"A60_VALOR"	,"N",014,2})
AADD(aStru060A,{"A60_PDV"	,"C",003,0})
cArq060A	:=	CriaTrab(aStru060A)
dbUseArea(.T.,__LocalDriver,cArq060A,"A60")
IndRegua("A60",cArq060A,"DTOS(A60_EMISS)+A60_NUMFAB+A60_SITTRI")
dbClearIndex()
/// Indice para geracao da DIC-SE
cArq060A2 := CriaTrab(Nil,.F.)
IndRegua("A60",cArq060A2,"DTOS(A60_EMISS)+A60_NUMFAB+A60_PDV+A60_SITTRI")
dbClearIndex()
dbSelectArea("A60")
dbSetIndex(cArq060A+OrdBagExt())
dbSetIndex(cArq060A2+OrdBagExt())
dbSetOrder(1)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 060D - ECF ( Resumo Diario )                                   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru060D,{"D60_EMISS"	,"D",008,0})
AADD(aStru060D,{"D60_NUMFAB","C",020,0})
AADD(aStru060D,{"D60_CODPRO","C",014,0})
AADD(aStru060D,{"D60_QUANT" ,"N",013,3})
AADD(aStru060D,{"D60_VALOR" ,"N",016,2})
AADD(aStru060D,{"D60_BSICM" ,"N",016,2})
AADD(aStru060D,{"D60_SITTRI","C",004,0})
AADD(aStru060D,{"D60_VLICM" ,"N",013,0})
cArq060D	:=	CriaTrab(aStru060D)
dbUseArea(.T.,__LocalDriver,cArq060D,"D60")
IndRegua("D60",cArq060D,"DTOS(D60_EMISS)+D60_CODPRO")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 060I - ECF ( Itens do documento )                              ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru060I,{"I60_EMISS" ,"D",008,0})
AADD(aStru060I,{"I60_NUMFAB","C",020,0})
AADD(aStru060I,{"I60_MODELO","C",002,0})
AADD(aStru060I,{"I60_COO"   ,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru060I,{"I60_ITEM"  ,"C",003,0})
AADD(aStru060I,{"I60_CODPRO","C",014,0})
AADD(aStru060I,{"I60_QUANT" ,"N",013,3})
AADD(aStru060I,{"I60_VLUNI" ,"N",013,3})
AADD(aStru060I,{"I60_BSICM" ,"N",012,2})
AADD(aStru060I,{"I60_SITTRI","C",004,0})
AADD(aStru060I,{"I60_VLICM" ,"N",012,0})
cArq060I	:=	CriaTrab(aStru060I)
dbUseArea(.T.,__LocalDriver,cArq060I,"I60")
IndRegua("I60",cArq060I,"DTOS(I60_EMISS)+I60_CODPRO")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 060R - ECF ( Resumo Mensal )                                   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru060R,{"R60_MESANO","C",006,0})
AADD(aStru060R,{"R60_CODPRO","C",014,0})
AADD(aStru060R,{"R60_QUANT" ,"N",013,3})
AADD(aStru060R,{"R60_VALOR" ,"N",016,2})
AADD(aStru060R,{"R60_BSICM" ,"N",016,2})
AADD(aStru060R,{"R60_SITTRI","C",004,0})
cArq060R	:=	CriaTrab(aStru060R)
dbUseArea(.T.,__LocalDriver,cArq060R,"R60")
IndRegua("R60",cArq060R,"R60_MESANO+R60_CODPRO+R60_SITTRI")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arquivo do Registro tipo 61 - Docs.Fiscais nao emitidos por ECF ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru061,{"A61_EMISS"	,"D",008,0})
AADD(aStru061,{"A61_MODELO"	,"C",002,0})
AADD(aStru061,{"A61_SDOC"	,"C",003,0})
AADD(aStru061,{"A61_SERIE"	,"C",TamSX3("F2_SERIE")[1],0})
AADD(aStru061,{"A61_SUBSER"	,"C",002,0})
AADD(aStru061,{"A61_NUMINI"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru061,{"A61_NUMFIM"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru061,{"A61_VALTOT"	,"N",014,2})
AADD(aStru061,{"A61_BSICM"	,"N",014,2})
AADD(aStru061,{"A61_VALICM"	,"N",014,2})
AADD(aStru061,{"A61_ISENTA"	,"N",014,2})
AADD(aStru061,{"A61_OUTRAS"	,"N",014,2})
AADD(aStru061,{"A61_ALQICM"	,"N",005,2})
AADD(aStru061,{"A61_CODMUN"	,"C",005,0})
AADD(aStru061,{"A61_ANOAID"	,"C",004,0})
AADD(aStru061,{"A61_NUMAID"	,"C",005,0})
AADD(aStru061,{"A61_OBS"    ,"C",035,0})
AADD(aStru061,{"A61_SITUAC" ,"C",001,0})
cArq061	:=	CriaTrab(aStru061)
dbUseArea(.T.,__LocalDriver,cArq061,"R61")
IndRegua("R61",cArq061,"DTOS(A61_EMISS)")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 070 - Documento de Conhecimento de Transporte                  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru070,{"A70_CNPJ"	,"C",014,0})
AADD(aStru070,{"A70_IE"		,"C",014,0})
AADD(aStru070,{"A70_EMISS"	,"D",008,0})
AADD(aStru070,{"A70_UF"		,"C",002,0})
AADD(aStru070,{"A70_MODELO"	,"C",002,0})
AADD(aStru070,{"A70_SERIE"	,"C",001,0})
AADD(aStru070,{"A70_SUBSER"	,"C",002,0})
AADD(aStru070,{"A70_NFISC"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru070,{"A70_CFOP"	,"C",004,0})
AADD(aStru070,{"A70CFOPEXT"	,"C",002,0})
AADD(aStru070,{"A70_VALTOT"	,"N",015,2})
AADD(aStru070,{"A70_BSICM"	,"N",015,2})
AADD(aStru070,{"A70_VALICM"	,"N",015,2})
AADD(aStru070,{"A70_ISENTA"	,"N",015,2})
AADD(aStru070,{"A70_OUTRAS"	,"N",015,2})
AADD(aStru070,{"A70_CIfFOB"	,"C",001,0})
AADD(aStru070,{"A70_SITUAC"	,"C",001,0})
AADD(aStru070,{"A70_CODMUN"	,"C",005,0})
AADD(aStru070,{"A70_ANOAID"	,"C",004,0})
AADD(aStru070,{"A70_NUMAID"	,"C",005,0})
AADD(aStru070,{"A70_ENTRAD","D",008,0})

cArq070	:=	CriaTrab(aStru070)
dbUseArea(.T.,__LocalDriver,cArq070,"R70")
IndRegua("R70",cArq070,"DTOS(A70_EMISS)") 
IndRegua("R70",cArq070,"DTOS(A70_ENTRAD)")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 071 - Complemento do Conhecimento de Transporte                ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru071,{"A71_CGCTOM"	,"C",014,0})
AADD(aStru071,{"A71_IETOM"	,"C",014,0})
AADD(aStru071,{"A71_DTCONH"	,"D",008,0})
AADD(aStru071,{"A71_UFTOM"	,"C",002,0})
AADD(aStru071,{"A71_MODCON"	,"C",002,0})
AADD(aStru071,{"A71_SERCON"	,"C",001,0})
AADD(aStru071,{"A71_SUBCON"	,"C",002,0})
AADD(aStru071,{"A71_NUMCON"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru071,{"A71_UFREM"	,"C",002,0})
AADD(aStru071,{"A71_CGCREM"	,"C",014,0})
AADD(aStru071,{"A71_IEREM"	,"C",014,0})
AADD(aStru071,{"A71_DTNOTA"	,"D",008,0})
AADD(aStru071,{"A71_MODNOT"	,"C",002,0})
AADD(aStru071,{"A71_SERNOT"	,"C",003,0})
AADD(aStru071,{"A71_NUMNOT"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru071,{"A71_VALNOT"	,"N",014,2})
AADD(aStru071,{"A71_SUBNOT"	,"C",002,0})

cArq071	:=	CriaTrab(aStru071)
dbUseArea(.T.,__LocalDriver,cArq071,"R71")
IndRegua("R71",cArq071,"DTOS(A71_DTCONH)")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 075 - Relacao de Produtos e Servicos                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru075,{"A75_DTAINI"	,"D",008,0})
AADD(aStru075,{"A75_DTAFIM"	,"D",008,0})
AADD(aStru075,{"A75_PROD"	,"C",014,0})
AADD(aStru075,{"A75_CODNCM"	,"C",008,0})
AADD(aStru075,{"A75_DESCR"	,"C",053,0})
AADD(aStru075,{"A75_UM"		,"C",006,0})
AADD(aStru075,{"A75_SITTRI"	,"C",003,0})
AADD(aStru075,{"A75_ALQIPI"	,"N",005,2})
AADD(aStru075,{"A75_ALQICM"	,"N",005,2})
AADD(aStru075,{"A75_REDBSE"	,"N",006,2})
AADD(aStru075,{"A75_BRICMS"	,"N",014,2})
AADD(aStru075,{"A75_EAN"   ,"C"	,014,0})
AADD(aStru075,{"A75_CODFIS"	,"C",007,0})
cArq075	  :=	CriaTrab(aStru075)
dbUseArea(.T.,__LocalDriver,cArq075,"R75")
IndRegua("R75",cArq075,"DTOS(A75_DTAINI)+DTOS(A75_DTAFIM)+A75_PROD+A75_CODNCM+A75_UM")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 076 - Nota Fiscal Servico de Comunicacao/Telecomunicacao (mod.21/mod.22) ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru076,{"A76_CNPJ"	,"C",014,0})
AADD(aStru076,{"A76_IE"		,"C",014,0})
AADD(aStru076,{"A76_MODELO"	,"C",002,0})
AADD(aStru076,{"A76_SERIE"	,"C",002,0})
AADD(aStru076,{"A76_SUBSER"	,"C",002,0})
AADD(aStru076,{"A76_NFISC"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru076,{"A76_CFOP"	,"C",004,0})
AADD(aStru076,{"A76_TIPREC"	,"C",001,0})
AADD(aStru076,{"A76_EMISS"	,"D",008,0})
AADD(aStru076,{"A76_UF"		,"C",002,0})
AADD(aStru076,{"A76_VALTOT"	,"N",013,2})
AADD(aStru076,{"A76_BRICMS"	,"N",013,2})
AADD(aStru076,{"A76_VALICM"	,"N",012,2})
AADD(aStru076,{"A76_ISENTA"	,"N",012,2})
AADD(aStru076,{"A76_OUTRAS"	,"N",012,2})
AADD(aStru076,{"A76_ALQICM"	,"N",005,2})
AADD(aStru076,{"A76_SITUAC"	,"C",001,0})
AADD(aStru076,{"A76_CODMUN"	,"C",005,0})
AADD(aStru076,{"A76_ANOAID"	,"C",004,0})
AADD(aStru076,{"A76_NUMAID"	,"C",005,0})
AADD(aStru076,{"A76CFOPEXT"	,"C",002,0})

cArq076	:=	CriaTrab(aStru076)
dbUseArea(.T.,__LocalDriver,cArq076,"R76")
IndRegua("R76",cArq076,"DTOS(A76_EMISS)")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Registro 077 - Servicos de Comunicacao de Telecomunicacao                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru077,{"A77_CNPJ"	,"C",014,0})
AADD(aStru077,{"A77_MODELO"	,"C",002,0})
AADD(aStru077,{"A77_SERIE"	,"C",002,0})
AADD(aStru077,{"A77_SUBSER"	,"C",002,0})
AADD(aStru077,{"A77_NFISC"	,"C",TamSX3("F2_DOC")[1],0})
AADD(aStru077,{"A77_CFOP"	,"C",004,0})
AADD(aStru077,{"A77_TIPREC"	,"C",001,0})
AADD(aStru077,{"A77_NUMITE"	,"C",003,0})
AADD(aStru077,{"A77_PRODUT"	,"C",011,0})
AADD(aStru077,{"A77_QUANT"	,"N",013,3})
AADD(aStru077,{"A77_VALPRO"	,"N",012,2})
AADD(aStru077,{"A77_VALDES"	,"N",012,2})
AADD(aStru077,{"A77_BSICM"	,"N",012,2})
AADD(aStru077,{"A77_ALQICM"	,"N",005,2})
AADD(aStru077,{"A77_CNPJMF"	,"C",014,0})
AADD(aStru077,{"A77_CODTER"	,"C",010,0})

cArq077	:=	CriaTrab(aStru077)
dbUseArea(.T.,__LocalDriver,cArq077,"R77")
IndRegua("R77",cArq077,"A77_PRODUT")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arquivo do Registro tipo 88C³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aCampos	:=	{}
AADD(aCampos,{"A88CCNPJ"		,"C"	,014,0})
AADD(aCampos,{"A88CMODELO"	,"C"	,002,0})
AADD(aCampos,{"A88CSERIE"	,"C"	,TamSX3("F2_SERIE")[1],0})
AADD(aCampos,{"A88CSDOC"		,"C"	,003,0})
AADD(aCampos,{"A88CNFISC"	,"C"	,TamSX3("F2_DOC")[1],0})
AADD(aCampos,{"A88CCFOP"		,"C"	,004,0})
AADD(aCampos,{"A88CNUMITE"	,"C"	,003,0})
AADD(aCampos,{"A88CPRODUT"	,"C"	,014,0})
AADD(aCampos,{"A88CQUANT"	,"N"	,013,3})
AADD(aCampos,{"A88CBASEST"	,"N"	,012,2})
AADD(aCampos,{"A88CVALBSR"	,"N"	,012,2})
AADD(aCampos,{"A88CVALBSC"	,"N"	,012,2})
AADD(aCampos,{"A88CCLIFOR"	,"C"	,006,0})
AADD(aCampos,{"A88CLOJA"	,"C"	,002,0})

cArq088C	:=	CriaTrab(aCampos)                                   '

dbUseArea(.T.,__LocalDriver,cArq088C,cArq088C,.T.,.F.)
IndRegua(cArq088C,cArq088C,"A88CCNPJ+A88CSERIE+A88CNFISC+A88CNUMITE",,,"Indexando Registro Tipo 88C" ) //

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arquivo do Registro tipo 88D³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aCampos	:=	{}
AADD(aCampos,{"A88DCNPJ"	,"C"	,014,0})
AADD(aCampos,{"A88DIE"		,"C"	,014,0})
AADD(aCampos,{"A88DUF"		,"C"	,002,0})
AADD(aCampos,{"A88DMODELO"	,"C"	,002,0})
AADD(aCampos,{"A88DSDOC"	,"C"	,003,0})
AADD(aCampos,{"A88DSERIE"	,"C"	,TamSX3("F2_SERIE")[1],0})
AADD(aCampos,{"A88DSUBSER"	,"C"	,002,0})
AADD(aCampos,{"A88DNFISC"	,"C"	,TamSX3("F2_DOC")[1],0})
AADD(aCampos,{"A88DCFOP"	,"C"	,004,0})
AADD(aCampos,{"A88DEMISS"	,"D"	,008,0})
AADD(aCampos,{"A88DENTSAI"	,"D"	,008,0})
AADD(aCampos,{"A88DALQICM"	,"N"	,005,2})

cArq088D :=	CriaTrab(aCampos)
cArq088A := Left(cArq088D,6)+"A"
dbUseArea(.T.,__LocalDriver,cArq088D,cArq088D,.T.,.F.)
IndRegua(cArq088D,cArq088D,"dtos(A88DEMISS)",,,"Indexando Registro tipo 88D")
IndRegua(cArq088D,cArq088A,"A88DSERIE+A88DNFISC+STR(A88DALQICM,5,2)+A88DCFOP+A88DCNPJ",,,"Indexando Registro tipo 88D")
DbSelectArea(cArq088D)
DbClearIndex()
DbSetIndex(cArq088D+OrdBagExt())
DbSetIndex(cArq088A+OrdBagExt())
dbSetOrder(2)
dbSelectArea(cAlias)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arquivo do Registro tipo 88E³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aCampos	:=	{}
AADD(aCampos,{"A88ECNPJ"	,"C"	,014,0})
AADD(aCampos,{"A88EIE"		,"C"	,014,0})
AADD(aCampos,{"A88ECOD"		,"C"	,014,0})
AADD(aCampos,{"A88ECODSEF"	,"C"	,014,0})
cArq088E	:=	CriaTrab(aCampos)
dbUseArea(.T.,__LocalDriver,cArq088E,cArq088E,.T.,.F.)
IndRegua(cArq088E,cArq088E,"A88ECOD",,,"Indexando Registro Tipo 88E" )
DbSelectArea(cArq088E)
DbClearIndex()
DbSetIndex(cArq088E+OrdBagExt())
dbSelectArea(cAlias)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arquivo do Registro tipo 88M³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aCampos	:=	{}
AADD(aCampos,{"A88MCNPJ"	,"C"	,014,0})
AADD(aCampos,{"A88MMENS"	,"C"	,034,0})
cArq088M	:=	CriaTrab(aCampos)
dbUseArea(.T.,__LocalDriver,cArq088M,cArq088M,.T.,.F.)
IndRegua(cArq088M,cArq088M,"A88MCNPJ",,,"Indexando Registro Tipo 88M" ) //
DbSelectArea(cArq088M)
DbClearIndex()
DbSetIndex(cArq088M+OrdBagExt())
dbSelectArea(cAlias)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arquivo do Registro tipo 88Q³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aCampos	:=	{}
AADD(aCampos,{"A88QDATA"	,"D"	,008,0})
AADD(aCampos,{"A88QPROD"	,"C"	,014,0})
AADD(aCampos,{"A88QQUANT"	,"N"	,013,3})
AADD(aCampos,{"A88QTOT"		,"N"	,013,3})
AADD(aCampos,{"A88QPOSSE"	,"C"	,001,0})
cArq088Q	:=	CriaTrab(aCampos)
dbUseArea(.T.,__LocalDriver,cArq088Q,cArq088Q,.T.,.F.)
IndRegua(cArq088Q,cArq088Q,"A88QPROD+DTOS(A88QDATA)",,,"Indexando Registro Tipo 88Q" ) //
DbSelectArea(cArq088Q)
DbClearIndex()
DbSetIndex(cArq088Q+OrdBagExt())
dbSelectArea(cAlias)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arquivo do Registro Tipo 88 Detalhe 50³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
aCampos	:=	{}
AADD(aCampos,{"A8850CNPJ"		,"C",014,0})
AADD(aCampos,{"A8850EMISS"		,"D",008,0})
AADD(aCampos,{"A8850UF"			,"C",002,0})
AADD(aCampos,{"A8850MODEL"	    ,"C",002,0})
AADD(aCampos,{"A8850SERIE"		,"C",TamSX3("F2_SERIE")[1],0})
AADD(aCampos,{"A8850SDOC"		,"C",003,0})
AADD(aCampos,{"A8850NFISC"		,"C",TamSX3("F2_DOC")[1],0})
AADD(aCampos,{"A8850SUFRA"		,"C",014,0})
AADD(aCampos,{"A8850OBS"	    ,"C",035,0})
AADD(aCampos,{"A8850CONTA"	    ,"C",015,0})
AADD(aCampos,{"A8850VFRET"	    ,"C",013,0})
AADD(aCampos,{"A8850ICFRE"	    ,"C",013,0})
AADD(aCampos,{"A8850VDESP"	    ,"C",013,0})
AADD(aCampos,{"A8850VTOTP"	    ,"C",013,0})
AADD(aCampos,{"A8850NEMPH"	    ,"C",008,0})
AADD(aCampos,{"A8850TPFRE"	    ,"C",001,0})
cArq08850	:=	CriaTrab(aCampos)
dbUseArea(.T.,__LocalDriver,cArq08850,cArq08850,.T.,.F.)
IndRegua(cArq08850,cArq08850,"A8850CNPJ+A8850SERIE+A8850NFISC",,,"Indexando Registro Tipo 88 Detalhe 50" ) 
DbSelectArea(cArq08850)
DbClearIndex()   
DbSetIndex(cArq08850+OrdBagExt())
DbSelectArea(cArq08850)

IF lcArq088
	cArq088 := execBlock("M940TP88")
EndIf	

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Arquivo do Registro tipo 90 - Totalizador do Arquivo                             ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aStru090,{"A90_REGS"	,"C",126,0})

cArq090	:=	CriaTrab(aStru090)
dbUseArea(.T.,__LocalDriver,cArq090,"R90")
IndRegua("R90",cArq090,"Substr(A90_REGS,1,10)") 

Return
