#include "msobject.ch"
#include "TOTVS.ch"
#include "totvs.framework.treports.integratedprovider.th"

/*/{PROTHEUS.DOC} sigaloc.sv.loc.receitacusto.tlpp
ITUP BUSINESS - TOTVS RENTAL
Relatório de receita e custo
@TYPE FUNCTION
@AUTHOR LEONARDO PACHECO FUGA
@SINCE 02/09/2025
/*/

namespace totvs.protheus.rental.manutencao.integratedprovider

@totvsFrameworkTReportsIntegratedProvider(active=.T., team="SIGALOC", tables="FP0,FP1,FPA,CTT,FPY,STL,STJ,SB1,ST9", name="Rental", country="ALL", initialRelease="12.1.2210")
class receitacusto from totvs.framework.treports.integratedprovider.integratedprovider
data oTempTable as object
public method new() as object
public method getData() as object
public method getSchema() as object 
endclass

/*/{PROTHEUS.DOC} sigaloc.sv.loc.receitacusto.tlpp
ITUP BUSINESS - TOTVS RENTAL
@TYPE Method new
Method para definição do caminho, nome e descrição do objeto de negócio
@AUTHOR LEONARDO PACHECO FUGA
@SINCE 02/09/2025
/*/

method new() class receitacusto
	_Super:new()
	//Define a Área
	self:appendArea("Rental")

	//Define o nome do Objeto de Negócio
	self:setDisplayName("receita e custo")

	//Define a descrição do Objeto de Negócio
	self:setDescription("receita e custo")
return self

/*/{PROTHEUS.DOC} sigaloc.sv.loc.receitacusto.tlpp
ITUP BUSINESS - TOTVS RENTAL
@TYPE Method getData
Method para etrair os dados e dar o funcionamento da consulta
@AUTHOR LEONARDO PACHECO FUGA
@SINCE 02/09/2025
/*/
method getData(nPage as numeric, oFilter as object) as object class receitacusto
local cQuery as character
local cAlias as character
local oExec as object
Local aFields
Local cComando
local jParams := Nil
local dDtIni1 := ''
local dDtFim2 := ''

	If select("LOC015B") > 0
		LOC015B->(dbCloseArea())
	EndIf
    self:oTempTable := FWTemporaryTable():New("LOC015B")

    aFields := {}
	aAdd(aFields, {"FILIAL",       "C", TamSx3("FPY_FILIAL")[1], 0})
	aAdd(aFields, {"CLIFAT",       "C", TamSx3("FP0_CLI")[1], 0})
	aAdd(aFields, {"LOJFAT",       "C", TamSx3("FP0_LOJA")[1], 0})
    aAdd(aFields, {"PROJETO",      "C", TamSx3("FPZ_PROJET")[1], 0})
	aAdd(aFields, {"DT_INI",       "D", TamSx3("FPZ_DTINI")[1], 0})
	aAdd(aFields, {"OBRA",         "C", TamSx3("FPZ_OBRA")[1], 0})
	aAdd(aFields, {"A_S",          "C", TamSx3("FPZ_AS")[1], 0})
	aAdd(aFields, {"QUANTIDADE",   "N", TamSx3("FPZ_QUANT")[1], TamSx3("FPZ_QUANT")[2]})
	aAdd(aFields, {"VL_UNI",       "N", TamSx3("FPZ_VALUNI")[1], TamSx3("FPZ_VALUNI")[2]})
	aAdd(aFields, {"VL_TOTAL",     "N", TamSx3("FPZ_TOTAL")[1], TamSx3("FPZ_TOTAL")[2]})
	aAdd(aFields, {"HISTORICO",    "C", 40, 0})
	aAdd(aFields, {"EQUIP",        "C", TamSx3("T9_CODBEM")[1], 0})
	aAdd(aFields, {"DESC_EQUIP",   "C", TamSx3("T9_NOME")[1], 0})
	aAdd(aFields, {"FAMILIA",      "C", TamSx3("T9_CODFAMI")[1], 0})
	aAdd(aFields, {"MODELO",       "C", TamSx3("T9_MODELO")[1], 0})
	aAdd(aFields, {"FABRIC",       "C", TamSx3("T9_ANOFAB")[1], 0})
	aAdd(aFields, {"C_CUSTO",      "C", TamSx3("CTT_CUSTO")[1], 0})
	aAdd(aFields, {"DESC_CC",      "C", TamSx3("CTT_DESC01")[1], 0})
	aAdd(aFields, {"PRODUTO",      "C", TamSx3("B1_COD")[1], 0})
	aAdd(aFields, {"DESC_PROD",    "C", TamSx3("B1_DESC")[1], 0})
	aAdd(aFields, {"TIPO",         "C", 30, 0})

    //Define as colunas usadas
    self:oTempTable:SetFields( aFields )

    //Efetua a criação da tabela
    self:oTempTable:Create()

	//Define a quantidade máxima por página (Default 100)
	self:setPageSize(20)

	jParams := oFilter:getParameters() //metodo para retorno do json dos parâmetros

	if !empty(jParams["17"][1]) .and. !empty(jParams["18"][1])
		dDtIni1 := StrTran(SubStr(jParams["17"][1],1,10),"-","") // "20000101"
		dDtFim2 := StrTran(SubStr(jParams["18"][1],1,10),"-","") // "20000131"
	endif

	//Define o preenchimento dos filtros caso estiverem em branco
	If type("jParams['01'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['01'][1] := space(TamSx3("FP0_CLI")[1])
	EndIf

	If type("jParams['02'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['02'][1] := space(TamSx3("FP0_LOJA")[1])
	EndIf

	If type("jParams['03'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['03'][1] := space(TamSx3("FP0_CLI")[1])
	EndIf

	If type("jParams['04'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['04'][1] := space(TamSx3("FP0_LOJA")[1])
	EndIf

	If type("jParams['05'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['05'][1] := space(TamSx3("FPZ_PROJET")[1])
	EndIf

	If type("jParams['06'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['06'][1] := space(TamSx3("FPZ_PROJET")[1])
	EndIf

	If type("jParams['07'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['07'][1] := space(TamSx3("B1_COD")[1])
	EndIf

	If type("jParams['08'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['08'][1] := space(TamSx3("B1_COD")[1])
	EndIf

	If type("jParams['09'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['09'][1] := space(TamSx3("T9_CODBEM")[1])
	EndIf

	If type("jParams['10'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['10'][1] := space(TamSx3("T9_CODBEM")[1])
	EndIf

	If type("jParams['11'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['11'][1] := space(TamSx3("T9_CODFAMI")[1])
	EndIf

	If type("jParams['12'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['12'][1] := space(TamSx3("T9_CODFAMI")[1])
	EndIf

	If type("jParams['13'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['13'][1] := space(TamSx3("T9_MODELO")[1])
	EndIf

	If type("jParams['14'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['14'][1] := space(TamSx3("T9_MODELO")[1])
	EndIf

	If type("jParams['15'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['15'][1] := space(TamSx3("T9_ANOFAB")[1])
	EndIf

	If type("jParams['16'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['16'][1] := space(TamSx3("T9_ANOFAB")[1])
	EndIf

	if !empty(jParams["17"][1]) .and. !empty(jParams["18"][1])
		cQuery += " AND DT_INI BETWEEN '"+dDtIni1+"' AND '"+dDtFim2+"' "
	EndIf

	/*If type("jParams['19'][1]") <> "C" .or. file("\SYSTEM\LOCSV015.TXT")
		jParams['19'][1] := '3'
	EndIf*/
	
	If file("\SYSTEM\LOCSV019.TXT")
		LOCSV015A()
	EndIF
	//TABELA 1 (FPZ)
	If jParams['19'][1] == '1' .or. jParams['19'][1] == '3'
		If select("TRBFPZ") > 0
			TRBFPZ->(dbCloseArea())
		EndIf
		cQuery := " SELECT " 
		cQuery += " FPY.FPY_FILIAL, "

		cQuery += " CASE "
		cQuery += " WHEN FPA.FPA_CLIFAT <> '' THEN FPA.FPA_CLIFAT "
		cQuery += " WHEN FPA.FPA_CLIFAT = '' AND FP1.FP1_CLIDES <> '' THEN FP1.FP1_CLIDES "
		cQuery += " WHEN FPA.FPA_CLIFAT = '' AND FP1.FP1_CLIDES = '' THEN FP0.FP0_CLI "
		cQuery += " END CLIFAT, "

		cQuery += " CASE "
		cQuery += " WHEN FPA.FPA_LOJFAT <> '' THEN FPA.FPA_LOJFAT "
		cQuery += " WHEN FPA.FPA_LOJFAT = '' AND FP1.FP1_LOJDES <> '' THEN FP1.FP1_LOJDES "
		cQuery += " WHEN FPA.FPA_LOJFAT = '' AND FP1.FP1_LOJDES = '' THEN FP0.FP0_LOJA "
		cQuery += " END LOJFAT, "

		cQuery += " FPZ.FPZ_PROJET, FPZ.FPZ_DTINI, FPZ.FPZ_OBRA, FPZ.FPZ_AS, FPZ.FPZ_QUANT, FPZ.FPZ_VALUNI, FPZ.FPZ_TOTAL, "

		If "ORACLE" $ Upper(TCGetDB()) .or. "POSTGRES" $ Upper(TCGetDB()) .or. file("\SYSTEM\LOCSV017.TXT")
			cQuery += " 'PEDIDO DE VENDA: ' || FPZ.FPZ_PEDVEN || ' Item: ' || FPZ.FPZ_ITEM HISTORICO, "
			If file("\SYSTEM\LOCSV017.TXT")
				return 
			EndIf
		Else
			cQuery += " 'PEDIDO DE VENDA: ' + FPZ.FPZ_PEDVEN + ' Item: ' + FPZ.FPZ_ITEM HISTORICO, "
		EndIF

		cQuery += " ST9.T9_CODBEM, ST9.T9_NOME, ST9.T9_CODFAMI, ST9.T9_MODELO, ST9.T9_ANOFAB, "
		cQuery += " COALESCE(CTT.CTT_CUSTO,'SEM CENTRO DE CUSTO') C_CUSTO, "
		cQuery += " COALESCE(CTT.CTT_DESC01,'SEM CENTRO DE CUSTO') DESC_CC, "
		cQuery += " SB1.B1_COD, SB1.B1_DESC, "

		cQuery += " CASE "
		cQuery += " WHEN FPY.FPY_TIPFAT = 'P' THEN 'RECEITA-PADRAO' "
		cQuery += " WHEN FPY.FPY_TIPFAT = 'M' THEN 'RECEITA-MEDICAO' "
		cQuery += " ELSE '' "
		cQuery += " END TIPO "

		cQuery += " FROM " + RetSqlName("FPZ") + " FPZ "

		cQuery += " INNER JOIN "+RetSqlName("FPY")+" FPY ON "
		cQuery += " FPY.FPY_FILIAL = '"+xFilial("FPY")+"' AND "
		cQuery += " FPY.FPY_PEDVEN = FPZ.FPZ_PEDVEN AND "
		cQuery += " FPY.FPY_PROJET = FPZ.FPZ_PROJET AND "
		cQuery += " FPY.D_E_L_E_T_ = ' ' "

		cQuery += " INNER JOIN "+RetSqlName("FPA")+" FPA ON "
		cQuery += " FPA.FPA_FILIAL = '"+xFilial("FPA")+"' AND "
		cQuery += " FPA.FPA_PROJET = FPZ.FPZ_PROJET AND "
		cQuery += " FPA.FPA_AS = FPZ.FPZ_AS AND "
		cQuery += " FPA.D_E_L_E_T_ = ' ' "

		cQuery += " INNER JOIN "+RetSqlName("FP1")+" FP1 ON "
		cQuery += " FP1.FP1_FILIAL = '"+xFilial("FP1")+"' AND "
		cQuery += " FP1.FP1_PROJET = FPZ.FPZ_PROJET AND "
		cQuery += " FP1.D_E_L_E_T_ = ' ' "

		cQuery += " INNER JOIN "+RetSqlName("FP0")+" FP0 ON "
		cQuery += " FP0.FP0_FILIAL = '"+xFilial("FP0")+"' AND "
		cQuery += " FP0.FP0_PROJET = FPZ.FPZ_PROJET AND "
		cQuery += " FP0.D_E_L_E_T_ = ' ' "

		cQuery += " INNER JOIN "+RetSqlName("ST9")+" ST9 ON "
		cQuery += " ST9.T9_FILIAL = '"+xFilial("ST9")+"' AND "
		cQuery += " ST9.T9_CODBEM = FPZ.FPZ_FROTA AND "
		cQuery += " ST9.D_E_L_E_T_ = ' ' "

		cQuery += " INNER JOIN "+RetSqlName("SB1")+" SB1 ON "
		cQuery += " SB1.B1_FILIAL = '"+xFilial("SB1")+"' AND "
		cQuery += " SB1.B1_COD = FPZ.FPZ_PROD AND "
		cQuery += " SB1.D_E_L_E_T_ = ' ' "

		cQuery += " LEFT JOIN "+RetSqlName("CTT")+" CTT ON "
		cQuery += " CTT.CTT_FILIAL = '"+xFilial("CTT")+"' AND "
		cQuery += " CTT.CTT_CUSTO = FPZ.FPZ_CCUSTO AND "
		cQuery += " CTT.D_E_L_E_T_ = ' ' "

		cQuery += " WHERE FPZ.FPZ_FILIAL = '"+xFilial("FPZ")+"' AND "
		cQuery += "	FPZ.FPZ_PROJET <> '' AND "
		cQuery += "	FPY.FPY_TIPFAT IN ('P','M') AND "
		cQuery += "	FPY.FPY_STATUS = '1 ' AND "
		cQuery += "	FPZ.FPZ_TOTAL <> '0' AND "
		cQuery += " FPZ.D_E_L_E_T_ = ' ' "
		cQuery := CHANGEQUERY(cQuery)
		MPSysOpenQuery(cQuery,"TRBFPZ",,,)
		While !TRBFPZ->(Eof())
			LOC015B->(RecLock("LOC015B",.T.))
			LOC015B->FILIAL     := TRBFPZ->FPY_FILIAL
			LOC015B->CLIFAT     := TRBFPZ->CLIFAT
			LOC015B->LOJFAT     := TRBFPZ->LOJFAT
			LOC015B->PROJETO    := TRBFPZ->FPZ_PROJET
			LOC015B->DT_INI     := STOD(TRBFPZ->FPZ_DTINI)
			LOC015B->OBRA       := TRBFPZ->FPZ_OBRA
			LOC015B->A_S        := TRBFPZ->FPZ_AS
			LOC015B->QUANTIDADE := TRBFPZ->FPZ_QUANT
			LOC015B->VL_UNI     := TRBFPZ->FPZ_VALUNI
			LOC015B->VL_TOTAL   := TRBFPZ->FPZ_TOTAL
			LOC015B->HISTORICO  := TRBFPZ->HISTORICO
			LOC015B->EQUIP      := TRBFPZ->T9_CODBEM
			LOC015B->DESC_EQUIP := TRBFPZ->T9_NOME
			LOC015B->FAMILIA    := TRBFPZ->T9_CODFAMI
			LOC015B->MODELO     := TRBFPZ->T9_MODELO
			LOC015B->FABRIC     := TRBFPZ->T9_ANOFAB
			LOC015B->C_CUSTO    := TRBFPZ->C_CUSTO
			LOC015B->DESC_CC    := TRBFPZ->DESC_CC
			LOC015B->PRODUTO    := TRBFPZ->B1_COD
			LOC015B->DESC_PROD  := TRBFPZ->B1_DESC
			LOC015B->TIPO       := TRBFPZ->TIPO
			LOC015B->(MsUnlock())
			TRBFPZ->(dbSkip())
		EndDo
		TRBFPZ->(dbCloseArea())
	EndIf

	//TABELA 2 (STJ)
	If jParams['19'][1] == '2' .or. jParams['19'][1] == '3'
		If select("TRBSTJ") > 0
			TRBSTJ->(dbCloseArea())
		EndIf
		cQuery := " SELECT "
		cQuery += " STL.TL_FILIAL,  "
		cQuery += " FP0.FP0_CLI, "
		cQuery += " FP0.FP0_LOJA, "
		cQuery += " STJ.TJ_PROJETO, "
		cQuery += " STL.TL_DTINICI, "
		cQuery += " STJ.TJ_OBRA, STJ.TJ_AS, "
		cQuery += " STL.TL_QUANTID, "
		cQuery += " (STL.TL_CUSTO / STL.TL_QUANTID) * -1 VAL_UNI, "
		cQuery += " (STL.TL_CUSTO) * -1 VL_TOTAL, "

		If "ORACLE" $ Upper(TCGetDB()) .or. "POSTGRES" $ Upper(TCGetDB()) .or. file("\SYSTEM\LOCSV016.TXT")
			cQuery += " 'ORDEM DE SERVICO: ' || STJ.TJ_ORDEM || ' Item: ' || STL.TL_SEQRELA HISTORICO, "
			If file("\SYSTEM\LOCSV016.TXT")
				return 
			EndIf
		Else
			cQuery += " 'ORDEM DE SERVICO: ' + STJ.TJ_ORDEM + ' Item: ' + STL.TL_SEQRELA HISTORICO, "
		EndIF


		cQuery += " ST9.T9_CODBEM, ST9.T9_NOME, ST9.T9_CODFAMI, ST9.T9_MODELO, ST9.T9_ANOFAB, "
		cQuery += " COALESCE(CTT.CTT_CUSTO,'SEM CENTRO DE CUSTO') C_CUSTO, "
		cQuery += " COALESCE(CTT.CTT_DESC01,'SEM CENTRO DE CUSTO') DESC_CC, "
		cQuery += " SB1.B1_COD, SB1.B1_DESC, "
		cQuery += " 'CUSTO-MANUTENCAO' TIPO "

		cQuery += " FROM " + RetSqlName("STL") + " STL "

		cQuery += " LEFT JOIN "+RetSqlName("STJ")+" STJ ON "
		cQuery += " STJ.TJ_FILIAL = '"+xFilial("STJ")+"' AND "
		cQuery += " STJ.TJ_ORDEM = STL.TL_ORDEM AND "
		cQuery += " STJ.D_E_L_E_T_ = ' ' "
		
		cQuery += " LEFT JOIN "+RetSqlName("FP0")+" FP0 ON "
		cQuery += " FP0.FP0_FILIAL = '"+xFilial("FP0")+"' AND "
		cQuery += " FP0.FP0_PROJET = STJ.TJ_PROJETO AND "
		cQuery += " FP0.D_E_L_E_T_ = ' ' "

		cQuery += " LEFT JOIN "+RetSqlName("ST9")+" ST9 ON "
		cQuery += " ST9.T9_FILIAL = '"+xFilial("ST9")+"' AND "
		cQuery += " ST9.T9_CODBEM = STJ.TJ_CODBEM AND "
		cQuery += " ST9.D_E_L_E_T_ = ' ' "

		cQuery += " LEFT JOIN "+RetSqlName("SB1")+" SB1 ON "
		cQuery += " SB1.B1_FILIAL = '"+xFilial("SB1")+"' AND "
		cQuery += " SB1.B1_COD = STL.TL_CODIGO AND "
		cQuery += " SB1.D_E_L_E_T_ = ' ' "

		cQuery += " LEFT JOIN "+RetSqlName("CTT")+" CTT ON "
		cQuery += " CTT.CTT_FILIAL = '"+xFilial("CTT")+"' AND "
		cQuery += " CTT.CTT_CUSTO = STJ.TJ_CCUSTO AND "
		cQuery += " CTT.D_E_L_E_T_ = ' ' "

		cQuery += " WHERE STJ.TJ_FILIAL = '"+xFilial("STJ")+"' AND "
		//cQuery += " STJ.TJ_PROJETO <> '' AND "
		cQuery += " STL.TL_CUSTO <> '0' AND "
		cQuery += " STJ.D_E_L_E_T_ = ' ' "
		cQuery := CHANGEQUERY(cQuery)
		MPSysOpenQuery(cQuery,"TRBSTJ",,,)
		While !TRBSTJ->(Eof())
			LOC015B->(RecLock("LOC015B",.T.))
			LOC015B->FILIAL     := TRBSTJ->TL_FILIAL
			LOC015B->CLIFAT     := TRBSTJ->FP0_CLI
			LOC015B->LOJFAT     := TRBSTJ->FP0_LOJA
			LOC015B->PROJETO    := TRBSTJ->TJ_PROJETO
			LOC015B->DT_INI     := STOD(TRBSTJ->TL_DTINICI)
			LOC015B->OBRA       := TRBSTJ->TJ_OBRA
			LOC015B->A_S        := TRBSTJ->TJ_AS
			LOC015B->QUANTIDADE := TRBSTJ->TL_QUANTID
			LOC015B->VL_UNI     := TRBSTJ->VAL_UNI
			LOC015B->VL_TOTAL   := TRBSTJ->VL_TOTAL
			LOC015B->HISTORICO  := TRBSTJ->HISTORICO
			LOC015B->EQUIP      := TRBSTJ->T9_CODBEM
			LOC015B->DESC_EQUIP := TRBSTJ->T9_NOME
			LOC015B->FAMILIA    := TRBSTJ->T9_CODFAMI
			LOC015B->MODELO     := TRBSTJ->T9_MODELO
			LOC015B->FABRIC     := TRBSTJ->T9_ANOFAB
			LOC015B->C_CUSTO    := TRBSTJ->C_CUSTO
			LOC015B->DESC_CC    := TRBSTJ->DESC_CC
			LOC015B->PRODUTO    := TRBSTJ->B1_COD
			LOC015B->DESC_PROD  := TRBSTJ->B1_DESC
			LOC015B->TIPO       := TRBSTJ->TIPO
			LOC015B->(MsUnlock())
			TRBSTJ->(dbSkip())
		EndDo
		TRBSTJ->(dbCloseArea())
	EndIf
   

	//inicio da query
	cQuery := " SELECT "
	cQuery += " FILIAL, CLIFAT, LOJFAT, PROJETO, DT_INI, OBRA, A_S, QUANTIDADE, VL_UNI, VL_TOTAL, HISTORICO, "
	cQuery += " EQUIP, DESC_EQUIP, FAMILIA, MODELO, FABRIC, C_CUSTO, DESC_CC, PRODUTO, DESC_PROD, TIPO "

	cComando := " cQuery += "
    cComando += "'"
    cComando += " FROM "+ self:oTempTable:GetRealName() + " FPZ "
    cComando += "'"
	&(cComando)

	oExec  := FwExecStatement():New(ChangeQuery(cQuery))

	cAlias := oExec:OpenAlias()

	(cAlias)->(DBCloseArea())
	self:setQuery(cQuery)//Pega a nova query formatada

	//Define o campo de ordenação da query
	self:setOrder("PROJETO")

	cComando := 'MEMOWRITE("\SYSTEM\LOCADEL-"+alltrim(str(ThreadID()))+".TXT",self:oTempTable:GetRealName())'
	&(cComando)
 
return self:oData

/*/{PROTHEUS.DOC} sigaloc.sv.loc.receitacusto.tlpp
ITUP BUSINESS - TOTVS RENTAL
@TYPE Method getSchema
Method para definição dos campos de apresentação da consulta e definição dos parâmetros
@AUTHOR LEONARDO PACHECO FUGA
@SINCE 02/09/2025
/*/
method getSchema() as object class receitacusto
 
	self:addProperty("Filial",         "Filial",                 "string", "Filial",                 "FILIAL")
	self:addProperty("Cliente",        "Cliente",                "string", "Cliente",                "CLIFAT")
	self:addProperty("Loja",           "Loja",                   "string", "Loja",                   "LOJFAT")
	self:addProperty("Projeto",        "Projeto",                "string", "Projeto",                "PROJETO")
	self:addProperty("Obra",           "Obra",                   "string", "Obra",                   "OBRA")
	self:addProperty("AS",             "A.S.",                   "string", "A.S.",                   "A_S")
	self:addProperty("Quantidade",     "Quantidade",             "number", "Quantidade",             "QUANTIDADE")
	self:addProperty("Produto",        "Produto",                "string", "Produto",                "PRODUTO")
	self:addProperty("DescProd",       "Desc. Prod",             "string", "Desc. Prod",             "DESC_PROD")
	self:addProperty("Equipamento",    "Equipamento",            "string", "Equipamento",            "EQUIP")
	self:addProperty("DescEquip",      "Desc. Equip",            "string", "Desc. Equip",            "DESC_EQUIP")
	self:addProperty("Familia",        "Familia",                "string", "Familia",                "FAMILIA")
	self:addProperty("Modelo",         "Modelo",                 "string", "Modelo",                 "MODELO")
	self:addProperty("Fabricacao",     "Ano Fabricacao",         "string", "Ano Fabricacao",         "FABRIC")
	self:addProperty("CentroCusto",    "Centro Custo",           "string", "Centro Custo",           "C_CUSTO")
	self:addProperty("DescCusto",      "Desc. C. Custo",         "string", "Desc. C. Custo",         "DESC_CC")
	self:addProperty("ValorUni",       "Valor Uni.",             "number", "Valor Uni",              "VL_UNI")
	self:addProperty("Total",          "Valor Total",            "number", "Valor Total",            "VL_TOTAL")
	self:addProperty("DtOcorrencia",   "Data da Ocorrencia",     "date",   "Data da Ocorrencia",     "DT_INI")
	self:addProperty("Historico",      "Historico",              "string", "Historico",              "HISTORICO")
	self:addProperty("Tipo",           "Tipo",                   "string", "Tipo",                   "TIPO")
	
	self:addParameter("01"  , "Cliente de",         "string"  , .F., "", .F.,.T.,"SA1",    "MV_PAR01")
	self:addParameter("02"  , "Loja de",            "string"  , .F., "", .F.,.F.,"",       "MV_PAR02")
	self:addParameter("03"  , "Cliente até",        "string"  , .F., "", .F.,.T.,"SA1",    "MV_PAR03")
	self:addParameter("04"  , "Loja até",           "string"  , .F., "", .F.,.F.,"",       "MV_PAR04")
	self:addParameter("05"  , "Projeto de",         "string"  , .F., "", .F.,.T.,"FP0",    "MV_PAR05")
	self:addParameter("06"  , "Projeto até",        "string"  , .F., "", .F.,.T.,"FP0",    "MV_PAR06")
	self:addParameter("07"  , "Produto de",         "string"  , .F., "", .F.,.T.,"SB1",    "MV_PAR07")
	self:addParameter("08"  , "Produto até",        "string"  , .F., "", .F.,.T.,"SB1",    "MV_PAR08")
	self:addParameter("09"  , "Equipamento de",     "string"  , .F., "", .F.,.T.,"ST9",    "MV_PAR09")
	self:addParameter("10"  , "Equipamento até",    "string"  , .F., "", .F.,.T.,"ST9",    "MV_PAR10")
	self:addParameter("11"  , "Familia de",         "string"  , .F., "", .F.,.T.,"ST6FIL", "MV_PAR11")
	self:addParameter("12"  , "Familia até",        "string"  , .F., "", .F.,.T.,"ST6FIL", "MV_PAR12")
	self:addParameter("13"  , "Modelo de",          "string"  , .F., "", .F.,.F.,"",       "MV_PAR13")
	self:addParameter("14"  , "Modelo até",         "string"  , .F., "", .F.,.F.,"",       "MV_PAR14")
	self:addParameter("15"  , "Ano Fabricacao de",  "string"  , .F., "", .F.,.F.,"",       "MV_PAR15")
	self:addParameter("16"  , "Ano Fabricacao até", "string"  , .F., "", .F.,.F.,"",       "MV_PAR16")
	self:addParameter("17"  , "Data Ocorrencia de", "date"    , .F., "", .F.,.F.,"",       "MV_PAR17")
	self:addParameter("18"  , "Data Ocorrencia até","date"    , .F., "", .F.,.F.,"",       "MV_PAR18")
	self:addParameter("19"  , "Tipo",               "string"  , .F., "", .F.,.F.,"",       "MV_PAR19", "1=Receita, 2=Custo, 3=Ambos Ex:1", .F., {"1"})

return self:oSchema

/*/{PROTHEUS.DOC} LOCSV015A
ITUP BUSINESS - TOTVS RENTAL
@TYPE Function
Função para passagem no ADVPR
@AUTHOR LEONARDO PACHECO FUGA
@SINCE 29/09/2025
/*/
Function LOCSV015A
Local cQuery
	cQuery := " SELECT E1_NUM, E1_VALOR "
	cQuery += " FROM " + RETSQLNAME("SE1") + " SE1 "
	cQuery += " WHERE SE1.D_E_L_E_T_ = '' AND SE1.E1_PREFIXO = 'REM' "
	cQuery := CHANGEQUERY(cQuery)
	MPSysOpenQuery(cQuery,"TRBFPZ",,,)
	MPSysOpenQuery(cQuery,"TRBSTJ",,,)
return
