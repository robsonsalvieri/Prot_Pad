#include "tlpp-core.th"
#include "tlpp-rest.th"
#include "backoffice.stock.trackcosts.estr900.ch"

namespace totvs.protheus.backoffice.stock.trackcosts.ESTR900.controller

using namespace ac.BasicValidation.Controller
using namespace totvs.protheus.backoffice.stock.trackcosts.ESTR900.service
using namespace totvs.protheus.backoffice.stock.trackcosts.ESTR900B.service
using namespace totvs.protheus.backoffice.stock.trackcosts.ESTR900C.service
using namespace totvs.protheus.backoffice.stock.trackcosts.metrics.servise

/* 
------------------------------------------------------------------------------
    Estrutura de chamadas
    ========= == ========

backoffice.stock.trackcosts.ESTR900.controller
backoffice.stock.trackcosts.ESTR900.service
backoffice.stock.trackcosts.ESTR900.repository

backoffice.stock.trackcosts.ESTR900A.service
backoffice.stock.trackcosts.ESTR900A.repository

backoffice.stock.trackcosts.ESTR900B.service
backoffice.stock.trackcosts.ESTR900B.repository

    0.backoffice.stock.trackcosts.ESTR900.controller
    |
    |
    |-> 1.backoffice.stock.trackcosts.ESTR900.service 
    |   |
    |   |
    |   |-> 2.backoffice.stock.trackcosts.ESTR900.repository
    |   |
    |   |
    |   |-> 2.backoffice.stock.trackcosts.ESTR900A.service
    |       |
    |       |
    |       |-> 3.backoffice.stock.trackcosts.ESTR900A.repository
    |
    |-> 1.backoffice.stock.trackcosts.ESTR900B.service
        |
        |
        |-> 2.backoffice.stock.trackcosts.ESTR900B.repository
    |
    |
    |-> 1.backoffice.stock.trackcosts.ESTR900C.service
        |
        |
        |-> 2.backoffice.stock.trackcosts.ESTR900C.repository

------------------------------------------------------------------------------ 
*/

class ESTR900Controller from acBasicValidationController

    public method New()
    public method version()
    
    @Post("api/stock/trackcosts/kardex/v1/ESTR900A")
    public method postESTR900A()

    @Post("api/stock/trackcosts/kardex/v1/ESTR900B")
    public method postESTR900B()

    @Post("api/stock/trackcosts/kardex/v1/ESTR900C")
    public method postESTR900C()

    @Get("api/stock/trackcosts/kardex/v1/ESTR900/products")
    public method getProducts()

    @Get("api/stock/trackcosts/kardex/v1/ESTR900/movements")
    public method getMovements()

    @Get("api/stock/trackcosts/kardex/v1/ESTR900/productionOrders")
    public method getProductionOrders()

    @Get("api/stock/trackcosts/kardex/v1/ESTR900/productionOrders/total")
    public method getTotalProductionOrder()

    @Get("api/stock/trackcosts/kardex/v1/ESTR900/productionOrders/info")
    public method getProductionOrderInfo()

    @Get("api/stock/trackcosts/kardex/v1/status")
    public method getStatus()

    @Get("api/stock/trackcosts/kardex/v1/id")
    public method getIdByConfig()

    @Get("api/stock/trackcosts/kardex/v1/thread")
    public method getThread()

endclass

/*/{Protheus.doc} ESTR900Controller:New()
Â Â Â Â Metodo responsavel por instanciar e iniciar as variaveis da class acUser
Â Â Â Â @typeÂ Â Metodo
Â Â Â Â @authorÂ Pedro Missaglia
Â Â Â Â @sinceÂ Â OutubroÂ 02, 2020
Â Â Â Â @versionÂ 12.1.27
/*/
method new() class ESTR900Controller
    _Super:New()
return Self

/*/{Protheus.doc} ESTR900Controller:New()
Â Â Â Â Metodo responsavel por instanciar e iniciar as variaveis da class acUser
Â Â Â Â @typeÂ Â Metodo
Â Â Â Â @authorÂ Pedro Missaglia
Â Â Â Â @sinceÂ Â OutubroÂ 02, 2020
Â Â Â Â @versionÂ 12.1.27
    //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
    //³ Verifica as perguntas selecionadas                      ³
    //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
    //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿                 
    //³ MATR900 - mv_par01 X ACKardex - mv_par01                // Do produto                           
    //³ MATR900 - mv_par02 X ACKardex - mv_par01                // Ate o produto                        
    //³ MATR900 - mv_par03 X ACKardex - mv_par02                // Do tipo                              
    //³ MATR900 - mv_par04 X ACKardex - mv_par02                // Ate o tipo                           
    //³ MATR900 - mv_par05 X ACKardex - mv_par03                // Da data                              
    //³ MATR900 - mv_par06 X ACKardex - mv_par04                // Ate a data                           
    //³ MATR900 - mv_par07 X ACKardex - mv_par05                // Lista produtos s/movimento           
    //³ MATR900 - mv_par08 X ACKardex - mv_par06                // Qual Local (almoxarifado)            
    //³ MATR900 - mv_par09 X ACKardex - (deprecated)            // (d)OCUMENTO/(s)EQUENCIA              
    //³ MATR900 - mv_par10 X ACKardex - mv_par07                // moeda selecionada ( 1 a 5 )          
    //³ MATR900 - mv_par11 X ACKardex - mv_par08                // Seq.de Digitacao /Calculo            
    //³ MATR900 - mv_par12 X ACKardex - (deprecated)            // Pagina Inicial                       
    //³ MATR900 - mv_par13 X ACKardex - mv_par09                // Lista Transf Locali (Sim/Nao)        
    //³ MATR900 - mv_par14 X ACKardex - mv_par10                // Do  Grupo                            
    //³ MATR900 - mv_par15 X ACKardex - mv_par10                // Ate o Grupo                          
    //³ MATR900 - mv_par16 X ACKardex - (deprecated)            // Seleciona Filial?                    
    //³ MATR900 - mv_par17 X ACKardex - mv_par11                // Qual Custo ? ( Medio / Reposicao )   
    //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
{
    "parameters": [
        {"parameter": "mv_par01","value": []},
        {"parameter": "mv_par02","value": []},
        {"parameter": "mv_par03","value": "20140101"}, 
        {"parameter": "mv_par04","value": "20220731"}, 
        {"parameter": "mv_par05","value": 1}, 
        {"parameter": "mv_par06","value": ["01"]},
        {"parameter": "mv_par07","value": 1},
        {"parameter": "mv_par08","value": 1},
        {"parameter": "mv_par09","value": 2},
        {"parameter": "mv_par10","value": []},
        {"parameter": "mv_par11","value": 1},
        {"parameter": "mv_par12","value": 1}
        ]
    ,
    "branches": 
    [
        {
            "Code": "D MG 01 ",
            "Cgc": "53485215000106",
            "Description": "Filial BELO HOR                          "
        }
    ] 
}
/*/
method postESTR900A() class ESTR900Controller

    Local jBody     as Object
    Local oService  as Object
    Local oMetric   as Object
    Local oDictionaryValidator  as Object

    Local jError := JsonObject():New()
    Local jResponse := JsonObject():New()
    Local cResponse := ""
    Local cSubRoutine := "SETTINGS"
    Local cIdMetric := "estoque/custos-protheus_acompanha-custos-settings_total"
    Local cRotina := "ESTR900A"
    
    jBody := JsonObject():New()

    oDictionaryValidator := _Super:GetDictionaryValid()

    oRest:setKeyHeaderResponse("Content-Type", "application/json")
    jBody:fromJson(oRest:GetBodyRequest()) 

    If !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    Else
        oMetric  := totvs.protheus.backoffice.stock.trackcosts.metrics.servise.MetricsServise():New()
        oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900.service.ESTR900Service():New()
        oService:calculateESTR900(jBody)
        
        if Empty(oService:cError)
            jResponse["id"] := oService:cIdJobAverageCost
            jResponse["configuration"] := oService:cIdConfiguration
            cResponse := jResponse:toJson()
            oRest:setResponse(cResponse)
            oMetric:setMetricsEst(cSubRoutine,cIdMetric,cRotina)
        Else 
            oRest:setStatusCode(400)
            jError["error"] := oService:cError
            cResponse := jError:toJson()
            oRest:setResponse(cResponse) 
        Endif
    Endif
    
return Self

/*/{Protheus.doc} ESTR900Controller:New()
Â Â Â Â Metodo responsavel por instanciar e iniciar as variaveis da class acUser
Â Â Â Â @typeÂ Â Metodo
Â Â Â Â @authorÂ Pedro Missaglia
Â Â Â Â @sinceÂ Â OutubroÂ 02, 2020
Â Â Â Â @versionÂ 12.1.27
{
    "configuration": "78122f10eecf1004124A",
    "id": "78122f10eecf1004124A",
    "product": "PROD00000000000000000000000003",
    "warehouse": "01",
    "branch": "D MG 01 ",
    "initialBalance": 1000000,
    "finalBalance": 1637587.66,
    "initialQuantity": 100000,
    "finalQuantity": 37139
}
/*/
method postESTR900B() class ESTR900Controller

    local jError := JsonObject():New()
    local jResponse := JsonObject():New()
    Local cResponse := ""
    Local cSubRoutine := "MOVEMENT"
    Local cIdMetric := "estoque/custos-protheus_acompanha-custos-movement_total"
    Local cRotina := "ESTR900B"
    Local jBody     as Object
    Local oService  as Object
    Local oMetric   as Object
    Local oDictionaryValidator  as Object
    
    jBody := JsonObject():New()
    oDictionaryValidator := _Super:GetDictionaryValid()

    oRest:setKeyHeaderResponse("Content-Type", "application/json")
    jBody:fromJson(oRest:GetBodyRequest()) 

    oMetric  := totvs.protheus.backoffice.stock.trackcosts.metrics.servise.MetricsServise():New()
    oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900B.service.ESTR900BService():New()
    oService:calculateESTR900B(jBody)
    
    If !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    Else 
        If Empty(oService:cError)
            jResponse["id"] := oService:cIdJobTotalizer
            jResponse["configuration"] := oService:cIdConfiguration
            cResponse := jResponse:toJson()
            oRest:setResponse(cResponse) 
            oMetric:setMetricsEst(cSubRoutine,cIdMetric,cRotina)
        Else 
            oRest:setStatusCode(400)
            jError["error"] := oService:cError
            cResponse := jError:toJson()
            oRest:setResponse(cResponse) 
        Endif
    Endif

return Self

/*/{Protheus.doc} postInsertMovTotal()
    Recebe os dados da requisicao de POST para efetuar o INSERT na tabela D4B
    @type  Method
    @author Adriano Vieira
    @since 20/01/2023
    @version 1.0
    //Exemplo POSTMAN
    {
        "parameters": [
            {"parameter": "mv_par01","value": "pcpB0001001"}, // OP
            {"parameter": "mv_par02","value": 1}, // Moeda
            {"parameter": "mv_par03","value": "20140701"}, DATA DE 
            {"parameter": "mv_par04","value": "20220731"}, DATA ATE
            {"parameter": "mv_par05","value": 1}, //   QUANTIDADE TOTAL POR OP (VERIFICAR)
            {"parameter": "mv_par06","value": 1}, QUAL CUSTO IMPRIMIR
            {"parameter": "mv_par07","value": id(ALEATORIO)}
        ],
        "branches": [
            {
                "Code": "D MG 01 ",
                "Cgc": "53485215000106",
                "Description": "Filial BELO HOR                          "
            }
        ]
    }
/*/
method postESTR900C() class ESTR900Controller

    local jError := JsonObject():New()
    local jResponse := JsonObject():New()
    Local cResponse := ""
    Local cSubRoutine := "PRODUCTION_ORDER"
    Local cIdMetric := "estoque/custos-protheus_acompanha-custos-production-order_total"
    Local cRotina := "ESTR900C"
    Local jBody     as Object
    Local oService  as Object
    Local oMetric   as Object
    Local oDictionaryValidator  as Object
    
    jBody := JsonObject():New()
    oDictionaryValidator := _Super:GetDictionaryValid()

    oRest:setKeyHeaderResponse("Content-Type", "application/json")
    jBody:fromJson(oRest:GetBodyRequest()) 

    oMetric  := totvs.protheus.backoffice.stock.trackcosts.metrics.servise.MetricsServise():New()
    oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900C.service.ESTR900CService():New()
    oService:calculateESTR900C(jBody)
    
    If !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    Else 
        If Empty(oService:cError)
            jResponse["id"] := oService:cIdJobOP
            jResponse["configuration"] := oService:cIdConfiguration
            cResponse := jResponse:toJson()
            oRest:setResponse(cResponse) 
            oMetric:setMetricsEst(cSubRoutine,cIdMetric,cRotina)
        Else 
            oRest:setStatusCode(400)
            jError["error"] := oService:cError
            cResponse := jError:toJson()
            oRest:setResponse(cResponse) 
        Endif
    Endif

return Self

/*/{Protheus.doc} ESTR900Controller:New()
Â Â Â Â Metodo responsavel por instanciar e iniciar as variaveis da class acUser
Â Â Â Â @typeÂ Â Metodo
Â Â Â Â @authorÂ Pedro Missaglia
Â Â Â Â @sinceÂ Â OutubroÂ 02, 2020
Â Â Â Â @versionÂ 12.1.27
/*/
method getStatus() class ESTR900Controller

    local jError := JsonObject():New()
    local jEmpty := JsonObject():New()
    Local cResponse := ""
    Local jQuery     as Object
    Local oService  as Object
    Local oDictionaryValidator  as Object
    
    jQuery := JsonObject():New()

    oDictionaryValidator := _Super:GetDictionaryValid()
    oRest:setKeyHeaderResponse("Content-Type", "application/json")
    jQuery := oRest:getQueryRequest()

    If !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    Else 
        oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900.service.ESTR900Service():New()
        oService:getStatus(jQuery)
        
        If Empty( oService:cError ) .AND. Empty( oService:cEmpty )
            cResponse := oService:oThreads:toJson()
            oRest:setResponse(cResponse) 
        Elseif !Empty(oService:cEmpty)
            oRest:setStatusCode(204)
            jEmpty["message"] := oService:cEmpty
            cResponse := jEmpty:toJson()
            oRest:setResponse(cResponse)     
        Else 
            oRest:setStatusCode(400)
            jError["error"] := oService:cError
            cResponse := jError:toJson()
            oRest:setResponse(cResponse) 
        Endif
    Endif

return Self

/*/{Protheus.doc} acClosingCalc:New()
    Metodo responsavel por acionar o startJob do processamento do recalculo
    @type  Metodo
    @since  Novembro 10, 2020
    @version 12.1.27
/*/

Method getProducts() class ESTR900Controller

    Local oDictionaryValidator  as Object
    Local jParams               as Object
    Local cData                 as character
    Local oResponse             as Object
    Local oStatus               as object
    Local oService              as object

    oStatus := JsonObject():New()

    oDictionaryValidator := _Super:GetDictionaryValid()
    oRest:setKeyHeaderResponse("Content-Type", "application/json")

     
    jParams       := oRest:getQueryRequest()

    if !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    else
        oResponse := JsonObject():New()

        If jParams:HasProperty("configuration") .and. !Empty(jParams:getJsonText("configuration"))
            
            oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900.service.ESTR900Service():New()

            oService:getProducts(jParams)

            If !Empty(oService:cError)
                oResponse["message"] := STR0001
                cData := oResponse:toJson()
                oRest:setStatusCode(400)
                oRest:setResponse(cData) 
            Else
                cData := oService:cProducts
                oRest:setResponse(cData) 
            Endif
        Else 
            oResponse["message"] := STR0002
            cData := oResponse:toJson()
            oRest:setStatusCode(400)
            oRest:setResponse(cData) 
        Endif
    endif
return .T.

/*/{Protheus.doc} acClosingCalc:New()
    Metodo responsavel por acionar o startJob do processamento do recalculo
    @type  Metodo
    @since  Novembro 10, 2020
    @version 12.1.27
/*/

Method getIdByConfig() class ESTR900Controller

    Local oDictionaryValidator  as Object
    Local jParams               as Object
    Local cData                 as character
    Local oResponse             as Object
    Local oStatus               as object
    Local oService              as object
    Local cId                   as character

    oStatus := JsonObject():New()

    oDictionaryValidator := _Super:GetDictionaryValid()
    oRest:setKeyHeaderResponse("Content-Type", "application/json")

     
    jParams       := oRest:getQueryRequest()

    if !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    else
        oResponse := JsonObject():New()

        oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900.service.ESTR900Service():New()

        cId := oService:getIdByConfig(jParams)
        
        If !Empty(oService:cError)

            oResponse["message"] := oService:cError
            cData := oResponse:toJson()
            oRest:setStatusCode(400)
            oRest:setResponse(cData) 

        Elseif !Empty(oService:cEmpty)
            
            oResponse["message"] := oService:cEmpty
            cData := oResponse:toJson()
            oRest:setStatusCode(400)
            oRest:setResponse(cData) 

        Else 
             oResponse["id"] := Alltrim(cId)
            oResponse["process"] := Alltrim(jParams:GetJsonText("process"))
            cData := oResponse:toJson()
            oRest:setResponse( cData )  
        Endif
        
    endif
return .T.

/*/{Protheus.doc} acClosingCalc:New()
    Metodo responsavel por acionar o startJob do processamento do recalculo
    @type  Metodo
    @since  Novembro 10, 2020
    @version 12.1.27
/*/
Method getThread() class ESTR900Controller

    Local oDictionaryValidator  as Object
    Local jParams               as Object
    Local cData                 as character
    Local oResponse             as Object
    Local oStatus               as object
    Local oService              as object
    Local oThread               as object

    oStatus := JsonObject():New()
    oThread := JsonObject():New()

    oDictionaryValidator := _Super:GetDictionaryValid()
    oRest:setKeyHeaderResponse("Content-Type", "application/json")

     
    jParams       := oRest:getQueryRequest()

    if !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    else
        oResponse := JsonObject():New()

        oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900.service.ESTR900Service():New()

        oThread := oService:getThread(jParams)
        
        If !Empty(oService:cError)

            oResponse["message"] := oService:cError
            cData := oResponse:toJson()
            oRest:setStatusCode(400)
            oRest:setResponse(cData) 

        Elseif !Empty(oService:cEmpty)
            
            oResponse["message"] := oService:cEmpty
            cData := oResponse:toJson()
            oRest:setStatusCode(400)
            oRest:setResponse(cData) 

        Else 
            oResponse := oThread
            cData := oResponse:toJson()
            oRest:setResponse( cData )  
        Endif
        
    endif
return .T.

/*/{Protheus.doc} acClosingCalc:New()
    Metodo responsavel por acionar o startJob do processamento do recalculo
    @type  Metodo
    @since  Novembro 10, 2020
    @version 12.1.27
/*/

Method getMovements() class ESTR900Controller

    Local oDictionaryValidator  as Object
    Local jParams               as Object
    Local cData                 as character
    Local oResponse             as Object
    Local oStatus               as object
    Local oService              as object

    oStatus := JsonObject():New()

    oDictionaryValidator := _Super:GetDictionaryValid()
    oRest:setKeyHeaderResponse("Content-Type", "application/json")

     
    jParams       := oRest:getQueryRequest()

    if !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    else
        oResponse := JsonObject():New()

        If jParams:HasProperty("configuration") .and. !Empty(jParams:getJsonText("configuration"))
            If jParams:HasProperty("id") .and. !Empty(jParams:getJsonText("id"))
                oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900.service.ESTR900Service():New()

                oService:getMovements(jParams)

                If !Empty(oService:cError)
                    oResponse["message"] := STR0001
                    cData := oResponse:toJson()
                    oRest:setStatusCode(400)
                    oRest:setResponse(cData) 
                Else
                    cData := oService:cMovements
                    oRest:setResponse(cData) 
                Endif
            Else 
                oResponse["message"] := STR0002
                cData := oResponse:toJson()
                oRest:setStatusCode(400)
                oRest:setResponse(cData) 
            Endif
        Else 
            oResponse["message"] := STR0003
            cData := oResponse:toJson()
            oRest:setStatusCode(400)
            oRest:setResponse(cData) 
        Endif
    endif
return .T.

/*/{Protheus.doc} acClosingCalc:New()
    Metodo responsavel por acionar o startJob do processamento do recalculo
    @type  Metodo
    @since  Novembro 10, 2020
    @version 12.1.27
/*/

Method getProductionOrders() class ESTR900Controller

    Local oDictionaryValidator  as Object
    Local jParams               as Object
    Local cData                 as character
    Local oResponse             as Object
    Local oStatus               as object
    Local oService              as object

    oStatus := JsonObject():New()

    oDictionaryValidator := _Super:GetDictionaryValid()
    oRest:setKeyHeaderResponse("Content-Type", "application/json")

     
    jParams       := oRest:getQueryRequest()

    if !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    else
        oResponse := JsonObject():New()

        If jParams:HasProperty("configuration") .and. !Empty(jParams:getJsonText("configuration"))
            If jParams:HasProperty("id") .and. !Empty(jParams:getJsonText("id"))
                oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900C.service.ESTR900CService():New()

                oService:getProductionOrders(jParams)

                If !Empty(oService:cError)
                    oResponse["message"] := STR0001
                    cData := oResponse:toJson()
                    oRest:setStatusCode(400)
                    oRest:setResponse(cData) 
                Else
                    cData := oService:cProductionOrders
                    oRest:setResponse(cData) 
                Endif
            Else 
                oResponse["message"] := STR0002
                cData := oResponse:toJson()
                oRest:setStatusCode(400)
                oRest:setResponse(cData) 
            Endif
        Else 
            oResponse["message"] := STR0003
            cData := oResponse:toJson()
            oRest:setStatusCode(400)
            oRest:setResponse(cData) 
        Endif
    endif
return .T.

/*/{Protheus.doc} acClosingCalc:New()
    Metodo responsavel por acionar o startJob do processamento do recalculo
    @type  Metodo
    @since  Novembro 10, 2020
    @version 12.1.27
/*/

Method getTotalProductionOrder() class ESTR900Controller

    Local oDictionaryValidator  as Object
    Local jParams               as Object
    Local cData                 as character
    Local oResponse             as Object
    Local oStatus               as object
    Local oService              as object

    oStatus := JsonObject():New()

    oDictionaryValidator := _Super:GetDictionaryValid()
    oRest:setKeyHeaderResponse("Content-Type", "application/json")
  
    jParams       := oRest:getQueryRequest()

    if !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    else
        oResponse := JsonObject():New()

        If jParams:HasProperty("configuration") .and. !Empty(jParams:getJsonText("configuration"))
            If jParams:HasProperty("id") .and. !Empty(jParams:getJsonText("id"))
                oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900C.service.ESTR900CService():New()

                oService:getTotalProductionOrder(jParams)

                If !Empty(oService:cError)
                    oResponse["message"] := STR0001
                    cData := oResponse:toJson()
                    oRest:setStatusCode(400)
                    oRest:setResponse(cData) 
                Else
                    cData := oService:cTotalProductionOrder
                    oRest:setResponse(cData) 
                Endif
            Else 
                oResponse["message"] := STR0002
                cData := oResponse:toJson()
                oRest:setStatusCode(400)
                oRest:setResponse(cData) 
            Endif
        Else 
            oResponse["message"] := STR0003
            cData := oResponse:toJson()
            oRest:setStatusCode(400)
            oRest:setResponse(cData) 
        Endif
    endif
return .T.

/*/{Protheus.doc} acClosingCalc:New()
    Metodo responsavel por acionar o startJob do processamento do recalculo
    @type  Metodo
    @since  Novembro 10, 2020
    @version 12.1.27
/*/
Method getProductionOrderInfo() class ESTR900Controller

    Local oDictionaryValidator  as Object
    Local jParams               as Object
    Local cData                 as character
    Local oResponse             as Object
    Local oStatus               as object
    Local oService              as object

    oStatus := JsonObject():New()

    oDictionaryValidator := _Super:GetDictionaryValid()
    oRest:setKeyHeaderResponse("Content-Type", "application/json")
  
    jParams       := oRest:getQueryRequest()

    if !oDictionaryValidator['bIsValid']
        oRest:setStatusCode(oDictionaryValidator['nErrorNumber'])
        oRest:setResponse(oDictionaryValidator['cErrorMsg'])
    else
        oResponse := JsonObject():New()

        oService := totvs.protheus.backoffice.stock.trackcosts.ESTR900C.service.ESTR900CService():New()

        oService:getProductionOrderInfo(jParams)

        If !Empty(oService:cError)
            oResponse["message"] := STR0004
            cData := oResponse:toJson()
            oRest:setStatusCode(400)
            oRest:setResponse(cData) 
        Else
            cData := oService:cProductionOrderInfo
            oRest:setResponse(cData) 
        Endif



    endif
return .T.

/*/{Protheus.doc} version
    Metodo responsavel por indicar a versao da classe
    @type  Method
    @author Adriano Vieira
    @since  15/02/2024
    @version 12.1.23.10
/*/
Method version() class ESTR900Controller
    Local nVersion := 200
Return nVersion
