#INCLUDE "MATC051.CH"
#INCLUDE "PROTHEUS.CH"
#DEFINE _RMCONS "1A"
/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ MATC051  ³ Autor ³ Gilson do Nascimento  ³ Data ³ 29/07/94 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Consulta Geral ao Produto                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ Generico                                                   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ ATUALIZACOES SOFRIDAS DESDE A CONSTRUCAO INICIAL.                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ PROGRAMADOR  ³ DATA   ³ BOPS ³  MOTIVO DA ALTERACAO                   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Patricia Sal. ³05/04/00³003493³Incl.do mv_par04:"Lista as Amarracoes ?"³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

FUNCTION MATC051
LOCAL aAlias:={},cSavRegua
Local i := 0
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define o cabecalho da tela de baixas                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
PRIVATE aRotina := { { STR0001,"AxPesqui", 0 , 1},;		//"Pesquisar"
						{ STR0002,"MC051CON", 0 , 2} }		//"Consulta"

//-- Defini‡„o de SET CENTURY
Private lCentury := __SetCentury()
cCadastro := OemToAnsi(STR0003)	//"Consulta Geral ao Produto"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ativa tecla F12 para acessar os parametros                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
SetKey( VK_F12, { || pergunte("MTC050",.T.) } )
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica as perguntas selecionadas                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Variaveis utilizadas para parametros                         ³
//³ mv_par01        // Data inicial                              ³
//³ mv_par02        // Data final                                ³
//³ mv_par03        // Apresenta Movimentos                      ³
//³ mv_par04        // Lista as Amarracoes ?                     ³
//³ mv_par05        // Cons Saldo Em/De 3o.?                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
pergunte("MTC050",.F.)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Endereca a funcao de BROWSE                                  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
mBrowse( 6, 1,22,75,"SB1")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Desativa tecla F12                                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Set Key VK_F12	To
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Recupera a Ordem Original do arquivo principal               ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SB1")
dbSetOrder(1)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Recupera a Integridade dos dados e posiciona os arquivos uti-³
//³ lizados na Ordem 1                                           ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If cPaisLoc == "BRA"
	aAlias:={"SB1","SB5","SA5","SAD","SA7","SC1","SC7","SD4","SC6","SF1","SF2","SC2",;
		"SD1","SF4","SD2","SD3","SB6","SB3","SB9","SB2"}
Else
	aAlias:={"SB1","SB5","SA5","SAD","SA7","SC1","SC7","SD4","SC6","SF1","SF2","SF4","SC2",;
		"SD1","SD2","SD3","SB6","SB3","SB9","SB2"}
EndIf				
For i:=1 to Len(aAlias)
	dbSelectArea(aAlias[i])
	dbSetOrder(1)
Next i
Return .T.

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ MC051CON ³ Autor ³ Gilson do Nasciemento ³ Data ³ 29/07/94 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Envia para funcao que monta o arquivo de trabalho com as   ³±±
±±³          ³ movimentacoes e mostra-o na tela                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATC050                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function MC051CON
LOCAL aCampos 	:= {}
Local oTempTable	:= NIL

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define array para arquivo de trabalho                        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aCampos,{"LINHA","C",120,0 } )

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Cria arquivo de Trabalho                                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
oTempTable := FWTemporaryTable():New( "SB1TRB" )
oTempTable:SetFields( aCampos )
oTempTable:AddIndex("indice1", {"LINHA"} )
oTempTable:Create()

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Grava as movimentacoes no arquivo de trabalho                ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If !NetErr() 
	If !MC050Monta()
		HELP(" ",1,"ERRO")
		Return
	Endif
	dbSelectArea("SB1TRB")
	If RecCount() > 0
		MW050Brows("SB1TRB")
	Else
		Help("",1,"MC050NOREC")
	Endif
	dbSelectArea("SB1TRB")
	dbCloseArea()
Else
	Help("",1,"MC050NOARQ")
Endif
dbSelectArea("SB1")
oTempTable:Delete()

Return .T.

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MC050TRB  ³ Autor ³ Gilson do Nascimento  ³ Data ³ 29/07/94 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Grava registro no arquivo de Trabalho                      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ Generico                                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC Function MC050TRB(cVar,cAlias)
cVar := StrTran(cVar,Chr(179)," ")
cVar := StrTran(cVar,Chr(191)," ")
cVar := StrTran(cVar,Chr(192)," ")
cVar := StrTran(cVar,Chr(196)," ")
cVar := StrTran(cVar,Chr(217)," ")
cVar := StrTran(cVar,Chr(218)," ")
dbSelectArea("SB1TRB")
RecLock("SB1TRB",.T.)
Replace LINHA with OemToAnsi(cVar)
MsUnLock()
dbSelectArea(cAlias)
Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MC050BUSCA³ Autor ³ Gilson do Nascimento  ³ Data ³ 29/07/94 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Busca o Titulo de Apresentacao no Dicionario               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Sintaxe  ³ aExpr:=MC050BUSCA(aExpr,cExpr1)                            ³±±
±±³          ³ aExpr:=array com os campos do arquivo a apresentar         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ Generico                                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC Function MC050BUSCA(aEstru,cArq)
LOCAL cAlias := Alias(),n
dbSelectArea("SX3")
dbSeek(cArq)
While !Eof() .and. X3_ARQUIVO==cArq
	For n:=1 to Len(aEstru)
		If AllTrim(X3_CAMPO) == aEstru[n][1]
			aEstru[n][2] := X3Titulo()
			aEstru[n][3] := X3_TAMANHO+X3_DECIMAL+1
			aEstru[n][4] := X3_PICTURE
			aEstru[n][5] := X3_TIPO
			Exit
		Endif
	Next n
	dbSkip()
End
dbSelectArea(cAlias)
Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MC050Monta³ Autor ³ Gilson do Nascimento  ³ Data ³ 29/07/94 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Grava arquivo de trabalho                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ Generico                                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
STATIC Function MC050Monta
Local nTamanho:=IF(cPaisLoc == "BRA",72,78)	//Tamanho variavel por causa da NF
Local cString,lTudoOk:=.T.,cFimBloc:=CHR(192)+Repli(CHR(196),(nTamanho-2))+CHR(217),n
Local cBrancBloc:="³"+Repli(" ",(nTamanho-2))+"³",lFirst,nTotLocal,nTotGeral,nSaldoINi
Local dDataFim,aTotGeral := {0,0,0,0,0,0},cTam, nSaldo:= 0, aSaldoTer
Local nString, nTaxa, nMoeda
Local nDecSB2:=TamSX3("B2_QATU")[2]
Local nSpace := If(lCentury,2,0)
Local nFrete := 0
Local nDesp  := 0
Local aTamSXG1:=TamSXG("001"), aTamSXG2:=TamSXG("002"), cCliFor, cLoja, lSXG1Max:=.F., lSXG2Max:=.F.
Local lQuery := .F., cAliasTop
Local k := 0
Private aEstru,aSaldo,aMRP:={}

  lQuery := TcSrvType()<>"AS/400"
	
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verificar SXG ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If aTamSXG1[1] != aTamSXG1[3]
	lSXG1Max := .T.
EndIf
If aTamSXG2[1] != aTamSXG2[3]
	lSXG2Max := .T.
EndIf

//---------- Dados Cadastrais do Produto (SB1)
cString:=STR0006 	//" Dados Cadastrais "
MC050TRB(CHR(218)+cString+Repli(CHR(196),((nTamanho-2)-Len(cString)))+CHR(191),Alias())
MC050TRB("³"+Space((nTamanho-2))+"³")
dbSelectArea("SB1")
aEstru := {}
AADD(aEstru,{"B1_COD"   ,"",0,"",""})
AADD(aEstru,{"B1_TIPO"  ,"",0,"",""})
AADD(aEstru,{"B1_DESC"  ,"",0,"",""})
AADD(aEstru,{"B1_UM"    ,"",0,"",""})
AADD(aEstru,{"B1_SEGUM" ,"",0,"",""})
AADD(aEstru,{"B1_FORPRZ","",0,"",""})
AADD(aEstru,{"B1_GRUPO" ,"",0,"",""})
AADD(aEstru,{"B1_LOCPAD","",0,"",""})
AADD(aEstru,{"B1_EMIN"  ,"",0,"",""})
AADD(aEstru,{"B1_LE"    ,"",0,"",""})
AADD(aEstru,{"B1_QE"    ,"",0,"",""})
AADD(aEstru,{"B1_ESTSEG","",0,"",""})
AADD(aEstru,{"B1_ESTFOR","",0,"",""})
MC050BUSCA(aEstru,Alias())
cString:="³"
For n:=1 to Len(aEstru)
	If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
		cPicture	 := aEstru[n][4]
		cConteudo := aEstru[n][1]
		If aEstru[n][5] $ "ND"
			cConteudo := Transform(&cConteudo,cPicture)
		ElseIf aEstru[n][5]=="C"
			cConteudo := &cConteudo
		Endif
		cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
	Else
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
		cString:="³"     
		cPicture	 := aEstru[n][4]
		cConteudo := aEstru[n][1]
		If aEstru[n][5] $ "ND"
			cConteudo := Transform(&cConteudo,cPicture)
		ElseIf aEstru[n][5]=="C"
			cConteudo := &cConteudo
		Endif
		If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
			cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
		Else
			nString   := Len(cString) + Len(Alltrim(aEstru[n][2])) + 2
			cString   += Alltrim(aEstru[n][2])+": "+Substr(cConteudo,1,(nTamanho-2)-nString)+" ³"
		EndIf
	EndIf
Next n
If Len(cString) > 1
	cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
	MC050TRB(cString,Alias())
Endif
cString:=""

//----------- Dados Adicionais do Produto (SB5)
dbSelectArea("SB5")
dbSetOrder(1)
dbSeek(xFilial("SB5")+SB1->B1_COD)
If Found()
	aEstru := {}
	AADD(aEstru,{"B5_CEME"   ,"",0,"",""})
	MC050BUSCA(aEstru,Alias())
	cString:="³"
	For n:=1 to Len(aEstru)
		cConteudo := aEstru[n][1]
		cConteudo := &cConteudo
		cString   += Alltrim(aEstru[n][2])+": "+Subs(Alltrim(cConteudo),1,50)+" "
		cString   += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	Next n
Endif
MC050TRB(cFimBloc,Alias())

//----------- Amarracao Produto X Fornecedor (SA5)
dbSelectArea("SA5")
dbSetOrder(2)
dbSeek(cFilial+SB1->B1_COD)
If Found() .And. mv_par04 == 1
	cString:=STR0007 	//" Amarracao Produto X Fornecedor "
	MC050TRB(CHR(218)+cString+Repli(CHR(196),((nTamanho-2)-Len(cString)))+CHR(191),Alias())
	cString:=""
	aEstru := {}
	AADD(aEstru,{"A5_FORNECE"   ,"",0,"",""})
	AADD(aEstru,{"A5_LOJA"      ,"",0,"",""})
	AADD(aEstru,{"A5_CODPRF"    ,"",0,"",""})
	AADD(aEstru,{"A5_NOMEFOR"   ,"",0,"",""})
	MC050BUSCA(aEstru,Alias())

	While !Eof() .and. A5_FILIAL+A5_PRODUTO == cFilial+SB1->B1_COD
		cString:="³"
		For n:=1 to Len(aEstru)
			If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
				cPicture  := aEstru[n][4]
				cConteudo := aEstru[n][1]
				If aEstru[n][5] $ "ND"
					cConteudo := Transform(&cConteudo,cPicture)
				ElseIf aEstru[n][5]=="C"
					cConteudo := &cConteudo
				Endif
				cString += Alltrim(aEstru[n][2])+": "+cConteudo+" "
			Else
				cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
				MC050TRB(cString,Alias())
				cString := "³"
				SA2->(dbSetOrder(1))
				SA2->(dbSeek(xFilial("SA2")+SA5->A5_FORNECE+SA5->A5_LOJA))
				cConteudo := SA2->A2_NOME
				If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
					cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
				Else
					nString   := Len(cString) + Len(Alltrim(aEstru[n][2])) + 2
					cString   += Alltrim(aEstru[n][2])+": "+Substr(cConteudo,1,(nTamanho-2)-nString)+" ³"
				EndIf
			EndIf
		Next n
		If Len(cString) > 1
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
		Endif
		MC050TRB(cBrancBloc,Alias())
		dbSkip()
	End
	MC050TRB(cFimBloc,Alias())
EndIf

//--------------- Amarracao Grupo X Fornecedor (SAD)
dbSelectArea("SAD")
dbSetOrder(2)
dbSeek(cFilial+SB1->B1_GRUPO)
If Found() .And. mv_par04 == 1
	cString:=  STR0008 	//" Amarracao Grupo X Fornecedor "
	MC050TRB(CHR(218)+cString+Repli(CHR(196),((nTamanho-2)-Len(cString)))+CHR(191),Alias())
	cString:=""
	aEstru := {}
	AADD(aEstru,{"AD_FORNECE"   ,"",0,"",""})
	AADD(aEstru,{"AD_LOJA"      ,"",0,"",""})
	AADD(aEstru,{"AD_NOMEFOR"   ,"",0,"",""})
	AADD(aEstru,{"AD_NOMGRUP"   ,"",0,"",""})
	MC050BUSCA(aEstru,Alias())
	While !Eof() .and. AD_FILIAL+AD_GRUPO == cFilial+SB1->B1_GRUPO
		cString:="³"
		For n:=1 to Len(aEstru)
			If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
				cPicture	 := aEstru[n][4]
				cConteudo := aEstru[n][1]
				If aEstru[n][5] $ "ND"
					cConteudo := Transform(&cConteudo,cPicture)
				ElseIf aEstru[n][5]=="C"
					cConteudo := &cConteudo
				Endif
				cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
			Else
				cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
				MC050TRB(cString,Alias())
				cString:="³"
				cPicture	 := aEstru[n][4]
				cConteudo := aEstru[n][1]
				If aEstru[n][5] $ "ND"
					cConteudo := Transform(&cConteudo,cPicture)
				ElseIf aEstru[n][5]=="C"
					cConteudo := &cConteudo
				Endif
				If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
					cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
				Else
					nString   := Len(cString) + Len(Alltrim(aEstru[n][2])) + 2
					cString   += Alltrim(aEstru[n][2])+": "+Substr(cConteudo,1,(nTamanho-2)-nString)+" ³"
				EndIf
			Endif
		Next n
		If Len(cString) > 1
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
		Endif
		MC050TRB(cBrancBloc,Alias())
		dbSkip()
	End
	MC050TRB(cFimBloc,Alias())
EndIf

//--------------Dados Amarracao Produto X Cliente (SA7)
dbSelectArea("SA7")
dbSetOrder(2)
dbSeek(cFilial+SB1->B1_COD)
If Found() .And. mv_par04 == 1
	cString:=STR0009		//" Amarracao Produto X Cliente "
	MC050TRB(CHR(218)+cString+Repli(CHR(196),((nTamanho-2)-Len(cString)))+CHR(191),Alias())
	cString:=""
	aEstru := {}
	AADD(aEstru,{"A7_CLIENTE"   ,"",0,"",""})
	AADD(aEstru,{"A7_LOJA"      ,"",0,"",""})
	AADD(aEstru,{"A7_CODCLI"    ,"",0,"",""})
	AADD(aEstru,{"A7_DESCCLI"   ,"",0,"",""})
	MC050BUSCA(aEstru,Alias())

	While !Eof() .and. A7_FILIAL+A7_PRODUTO == cFilial+SB1->B1_COD
		cString:="³"
		For n:=1 to Len(aEstru)
			If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
				cPicture	 := aEstru[n][4]
				cConteudo := aEstru[n][1]
				If aEstru[n][5] $ "ND"
					cConteudo := Transform(&cConteudo,cPicture)
				ElseIf aEstru[n][5]=="C"
					cConteudo := &cConteudo
				Endif
				cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
			Else
				cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
				MC050TRB(cString,Alias())
				cString:="³"
				cPicture	 := aEstru[n][4]
				cConteudo := aEstru[n][1]
				If aEstru[n][5] $ "ND"
					cConteudo := Transform(&cConteudo,cPicture)
				ElseIf aEstru[n][5]=="C"
					cConteudo := &cConteudo
				Endif
				If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
					cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
				Else
					nString   := Len(cString) + Len(Alltrim(aEstru[n][2])) + 2
					cString   += Alltrim(aEstru[n][2])+": "+Substr(cConteudo,1,(nTamanho-2)-nString)+" ³"
				EndIf
			Endif
		Next n
		If Len(cString) > 1
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
		Endif
		MC050TRB(cBrancBloc,Alias())
		dbSkip()
	End
	MC050TRB(cFimBloc,Alias())
EndIf

//--------------------- Dados Movimentos em Aberto
cString:=  STR0010	//" Movimentos em Aberto "
MC050TRB(CHR(218)+cString+Repli(CHR(196),((nTamanho-2)-Len(cString)))+CHR(191),Alias())

// ------------------- Solicitacoes de Compra (SC1)
cAliasTop := "SC1"
	If lQuery
		cAliasTop := "AliasSC1"
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SC1")+" SC1, "
		cQuery += "WHERE SC1.C1_FILIAL='"+xFilial("SC1")+"' AND "
		cQuery += "SC1.C1_PRODUTO='" + SB1->B1_COD + "' AND "
		cQuery += "SC1.C1_QUJE < SC1.C1_QUANT AND "
		cQuery += "SC1.C1_EMISSAO >= '" + DTOS(mv_par01) + "' AND "
		cQuery += "SC1.C1_EMISSAO <= '" + DTOS(mv_par02) + "' AND "
		cQuery += "SC1.D_E_L_E_T_=' ' "
		cQuery += "ORDER BY "+SqlOrder(SC1->(IndexKey(2)))
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasTop,.T.,.T.)
		aEval(SC1->(dbStruct()), {|x| If(x[2] <> "C", TcSetField(cAliasTop,x[1],x[2],x[3],x[4]),Nil)})
	Endif	
dbSelectArea(cAliasTop)
If ! lQuery
	dbSetOrder(2)
	dbSeek(cFilial+SB1->B1_COD)
Endif
If ! Eof()
	/*
	³Solicit.  Dt.Entr.   Cotac.    Quant.Inf.   Quant.Entr.         Saldo ³
	³000001 01 DD/MM/AAAA 000001 9999999999.99 9999999999.99 99999999999.99³
	*/
	lFirst:=.T.
	nTotQtd:=0.00
	nTotEnt:=0.00
	nTotSal:=0.00
	While !Eof() .and. (lQuery .Or. C1_FILIAL+C1_PRODUTO == cFilial+SB1->B1_COD)
		If ! lQuery .And. (C1_QUJE >= C1_QUANT .or. C1_EMISSAO < mv_par01 .or. C1_EMISSAO > mv_par02)
			dbSkip()
			Loop
		Endif
		If lFirst
			MC050TRB(cBrancBloc,Alias())
			cString:= STR0011	//"³ Solicitacoes de Compra                                               ³"
			MC050TRB(cString,Alias())
			cString:= STR0012	//"³Solicit.  Dt.Entr.   Cotac.    Quant.Inf.   Quant.Entr.         Saldo ³"
			MC050TRB(cString,Alias())
			lFirst := .F.
		Endif

		dDataFim := C1_DATPRF

		cString := "³"+C1_NUM+" "+C1_ITEM+" "+dtoc(dDataFim)+C1_COTACAO+" "+;
			Transform(C1_QUANT,"@E 9999999999.99")+" "+;
			Transform(C1_QUJE,"@E 9999999999.99")+" "+;
			Transform(C1_QUANT-C1_QUJE,"@E 99999999999.99")
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())

		nTotQtd+= C1_QUANT
		nTotEnt+= C1_QUJE
		nTotSal+= ( C1_QUANT - C1_QUJE )

		a051MRP(dDataFim,(C1_QUANT - C1_QUJE),"E")

		dbSkip()
	End

	If !lFirst
		MC050TRB(cBrancBloc,Alias())
		cString:= STR0013+Transform(nTotQtd,"@E 9999999999.99")+STR0014+Transform(nTotEnt,"@E 9999999999.99")+STR0015+Transform(nTotSal,"@E 99999999999.99")		//"³Qtd.Tot.: "###" Qtd.Entr.: "###" Sld.: "
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	Endif
Endif
If lQuery
	dbSelectArea(cAliasTop)
	dbCloseArea()
	dbSelectArea("SC1")
EndIf
// --------------------- Pedido de Compra (SC7)
cAliasTop := "SC7"
	If lQuery
		cAliasTop := "AliasSC7"
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SC7")+" SC7, "
		cQuery += "WHERE SC7.C7_FILIAL='"+xFilial("SC7")+"' AND "
		cQuery += "SC7.C7_PRODUTO='" + SB1->B1_COD + "' AND "
		cQuery += "SC7.C7_QUJE < SC7.C7_QUANT AND "
		cQuery += "SC7.C7_EMISSAO >= '" + DTOS(mv_par01) + "' AND "
		cQuery += "SC7.C7_EMISSAO <= '" + DTOS(mv_par02) + "' AND "
		cQuery += "SC7.C7_RESIDUO  = '" + CriaVar("C7_RESIDUO", .F.) + "' AND " 
		cQuery += "SC7.D_E_L_E_T_=' ' "
		cQuery += "ORDER BY "+SqlOrder(SC7->(IndexKey(2)))
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasTop,.T.,.T.)
		aEval(SC7->(dbStruct()), {|x| If(x[2] <> "C", TcSetField(cAliasTop,x[1],x[2],x[3],x[4]),Nil)})
	Endif	

dbSelectArea(cAliasTop)
If ! lQuery
	dbSetOrder(2)
	dbSeek(cFilial+SB1->B1_COD)
Endif
If ! Eof()
	/*
	³Pedido Dt.Entr.   Forneced.   Quant.Inf.         Saldo Saldo em Valor ³
	³000001 DD/MM/AAAA 000000/00 999999999.99 999.999.999,99 999.999.999,99³
	³                  000000xxxxxxxxxxxxxx/00xx                           ³
	*/
	lFirst:=.T.
	nTotQtd:=0.00
	nTotEnt:=0.00
	nTotSal:=0.00
	While !Eof() .and. (lQuery .Or. C7_FILIAL+C7_PRODUTO == cFilial+SB1->B1_COD)
		IF ! lQuery .And. (C7_QUJE >= C7_QUANT .or. C7_EMISSAO < mv_par01 .or. C7_EMISSAO > mv_par02 .or. !Empty(C7_RESIDUO))
			dbSkip()
			Loop
		Endif
		If lFirst
			MC050TRB(cBrancBloc,Alias())
			cString:= STR0016	//"³ Pedidos de Compra                                                    ³"
			MC050TRB(cString,Alias())
			cString:= STR0017	//"³Pedido Dt.Entr.   Forneced.   Quant.Inf.         Saldo Saldo em Valor ³"
			MC050TRB(cString,Alias())
			lFirst:=.F.
		Endif

		dDataFim := C7_DATPRF

		cCliFor := If(lSXG1Max .Or. lSXG2Max, Space(aTamSXG1[1]), C7_FORNECE)
		cLoja   := If(lSXG1Max .Or. lSXG2Max, Space(aTamSXG2[1]), C7_LOJA)
		cString := "³"+C7_NUM+" "+dtoc(dDataFim)+" "+cCliFor+If(Empty(cCliFor)," ","/")+cLoja+" "+;
			Transform(C7_QUANT,"@E 999999999.99")+" "+;
			Transform((C7_QUANT-C7_QUJE),"@E 999,999,999.99")+" "+;
			Transform((C7_QUANT-C7_QUJE)*C7_PRECO,"@E 999,999,999.99")
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"

		MC050TRB(cString,Alias())

		If lSXG1Max .Or. lSXG2Max
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³Quebro em Duas Linhas³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			cString := "³"+PadR(Space(18)+C7_FORNECE+"/"+C7_LOJA,nTamanho-2)+"³"
			MC050TRB(cString,Alias())
		EndIf

		nTotQtd+= C7_QUANT
		nTotEnt+= C7_QUJE
		nTotSal+= ( C7_QUANT - C7_QUJE ) * C7_PRECO

		a051MRP(dDataFim,(C7_QUANT-C7_QUJE),"E")

		dbSkip()
	End

	If !lFirst
		MC050TRB(cBrancBloc,Alias())
		cString:= STR0013+Transform(nTotQtd,"@E 999999999.99")+STR0014+Transform(nTotEnt,"@E 999,999,999.99")+STR0018+Transform(nTotSal,"@E 999,999,999.99") //"³Qtd.Tot.:"###" Qtd.Entr.:"###" Sld.Vl.:"
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	Endif

Endif
If lQuery
	dbSelectArea(cAliasTop)
	dbCloseArea()
	dbSelectArea("SC7")
EndIf

// ---------------------- Empenhos em Aberto (SD4)
cAliasTop := "SD4"
	If lQuery
		cAliasTop := "AliasSD4"
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SD4")+" SD4, "
		cQuery += "WHERE SD4.D4_FILIAL='"+xFilial("SD4")+"' AND "
		cQuery += "SD4.D4_COD='" + SB1->B1_COD + "' AND "
		cQuery += "SD4.D4_QUANT < 0 AND "
		cQuery += "SD4.D_E_L_E_T_=' ' "
		cQuery += "ORDER BY "+SqlOrder(SD4->(IndexKey(1)))
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasTop,.T.,.T.)
		aEval(SD4->(dbStruct()), {|x| If(x[2] <> "C", TcSetField(cAliasTop,x[1],x[2],x[3],x[4]),Nil)})
	Endif	

SC2->(dbSetOrder(1))

dbSelectArea(cAliasTop)
If ! lQuery
	dbSetOrder(1)
	dbSeek(cFilial+SB1->B1_COD)
Endif
If ! Eof()
	/*
	³Almox. Ordem Prod.  C Custo   Dt. Emp.   Quantidade                   ³
	³01     99999999999 999999999 DD/MM/AAAA 999999999.99                  ³
	*/
	lFirst:=.T.
	nTotQtd:=0.00
	While !Eof() .and. (lQuery .Or. D4_FILIAL+D4_COD == cFilial+SB1->B1_COD)
		If ! lQuery .And. D4_QUANT <= 0
			dbSkip()
			Loop
		Endif
		If lFirst
			MC050TRB(cBrancBloc,Alias())
			cString:=STR0019	//"³ Empenhos                                                             ³"
			MC050TRB(cString,Alias())
			cString:=STR0020	//"³Almox. Ordem Prod.  C Custo   Dt. Emp.   Quantidade                   ³"
			MC050TRB(cString,Alias())
			lFirst:=.F.
		Endif
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Posiciona Ordem de Producao para listar centro de custo da OP ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		SC2->(dbSetOrder(1))
		SC2->(dbSeek(xFilial("SC2")+(cAliasTop)->D4_OP))
		cString := "³"+D4_LOCAL+"     "+D4_OP+" "+SC2->C2_CC+" "+DtoC(D4_DATA)+Transform(D4_QUANT,"@E 999999999.99")
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
		nTotQtd += D4_QUANT
		If D4_DATA < dDataBasE
			dDataFim := dDataBase
		Else
			dDataFim := D4_DATA
		Endif

		a051MRP(dDataFim,D4_QUANT,"S")
		dbSkip()
	End
	If !lFirst
		MC050TRB(cBrancBloc,Alias())
		cString :=STR0021+Transform(nTotQtd,"@E 999999999.99") //"³ Quantidade Total empenhada : "
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	Endif
Endif
If lQuery
	dbSelectArea(cAliasTop)
	dbCloseArea()
	dbSelectArea("SD4")
EndIf

// ------------------------ Pedido de Venda (SC6)
cAliasTop := "SC6"
lQuery    := .F.
	If lQuery
		cAliasTop := "AliasSC6"
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SC6")+" SC6, "
		cQuery += "WHERE SC6.C6_FILIAL='"+xFilial("SC6")+"' AND "
		cQuery += "SC6.C6_PRODUTO='" + SB1->B1_COD + "' AND "
		cQuery += "SC6.C6_QTDENT < SC6.C6_QTDVEN AND "
		cQuery += "Ltrim(Rtrim(SC6.C6_BLQ)) <> 'R' AND "
		cQuery += "SC6.D_E_L_E_T_=' ' "
		cQuery += "ORDER BY "+SqlOrder(SC6->(IndexKey(2)))
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasTop,.T.,.T.)
		aEval(SC6->(dbStruct()), {|x| If(x[2] <> "C", TcSetField(cAliasTop,x[1],x[2],x[3],x[4]),Nil)})
	Endif	

dbSelectArea(cAliasTop)
If ! lQuery
	dbSetOrder(2)
	dbSeek(cFilial+SB1->B1_COD)
Endif
If ! Eof()
	/*
	³Pedido/It Cliente    Quant.Inf.      Vlr.Total Reserva        Saldo³
	³000001 01 00000/00 999999999.99 999.999.999,99 000000  999999999.99³
	*/
	lFirst:=.T.
	nTotQtd:=0.00
	nTotEnt:=0.00
	While !Eof() .and. (lQuery .Or. C6_FILIAL+C6_PRODUTO == cFilial+SB1->B1_COD)
		dbSelectArea("SF4")
		dbSeek(cFilial+(cAliasTop)->C6_TES)
		dbSelectArea("SC6")
		If (! lQuery .And. (C6_QTDENT >= C6_QTDVEN .or. Alltrim((cAliasTop)->C6_BLQ) == "R")) .or. SF4->F4_ESTOQUE # "S"
			dbSkip()
			Loop
		Endif                
		dbSelectArea("SC5")
		dbSetOrder(1)                  
		dbSeek(xFilial()+(cAliasTop)->C6_NUM)
		nMoeda :=STR(SC5->C5_MOEDA,1)		
		SM2->(dbSeek(SC5->C5_EMISSAO,.T.)	)
  		nTaxa := SM2->(M2_MOEDA&nMoeda)
		dbSelectArea(cAliasTop)		
		If lFirst
			MC050TRB(cBrancBloc,Alias())
			cString:=STR0022	//"³ Pedidos de Venda                                                     ³"
			MC050TRB(cString,Alias())
			cString:=STR0023	//"³Pedido/It Cliente    Quant.Inf.      Moeda   Vlr.Total Reserva   Vlr. Convertido    Saldo    ³"
			MC050TRB(cString,Alias())
			lFirst:=.F.
		Endif
		cCliFor := If(lSXG1Max .Or. lSXG2Max, Space(aTamSXG1[1]), C6_CLI)
		cLoja   := If(lSXG1Max .Or. lSXG2Max, Space(aTamSXG2[1]), C6_LOJA)
		cString := "³"+C6_NUM+" "+C6_ITEM+" "+cCliFor+If(Empty(cCliFor)," ","/")+cLoja+;
			Transform(C6_QTDVEN,"@E 999999999.99")+" "+;
			STR(SC5->C5_MOEDA)+"      "+;
			Transform((C6_QTDVEN-C6_QTDENT)*C6_PRCVEN,"@E 999,999,999.99")+" "+;
			Transform(((C6_QTDVEN-C6_QTDENT)*C6_PRCVEN)*If(nTaxa<=0,1,nTaxa),"@E 999,999,999.99")+" "+;			
			C6_RESERVA+" "+Transform(C6_QTDVEN-C6_QTDENT,"@E 999999999.99")
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		
		MC050TRB(cString,Alias())

		If lSXG1Max .Or. lSXG2Max
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³Quebro em Duas Linhas³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			cString := "³"+PadR(Space(11)+C6_CLI+"/"+C6_LOJA,nTamanho-2)+"³"
			MC050TRB(cString,Alias())
		EndIf

		nTotQtd += C6_QTDVEN
		nTotEnt += (C6_QTDVEN - C6_QTDENT)

		If C6_ENTREG < dDataBasE
			dDataFim := dDataBase
		Else
			dDataFim := C6_ENTREG
		Endif

		a051MRP(dDataFim,(C6_QTDVEN - C6_QTDENT ),"S")

		dbSkip()
	End
	If !lFirst
		MC050TRB(cBrancBloc,Alias())
		cString:=STR0024+Transform(nTotQtd,"@E 999999999.99")+STR0025+Transform(nTotEnt,"@E 999999999.99")		//"³Qtd.Total: "###" Saldo Total  : "
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	endif
Endif
If lQuery
	dbSelectArea(cAliasTop)
	dbCloseArea()
	dbSelectArea("SC6")
EndIf

// ------------------------- Ordens de Producao (SC2)

cAliasTop := "SC2"
	If lQuery
		cAliasTop := "AliasSC2"
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SC2")+" SC2, "
		cQuery += "WHERE SC2.C2_FILIAL='"+xFilial("SC2")+"' AND "
		cQuery += "SC2.C2_PRODUTO='" + SB1->B1_COD + "' AND "
		cQuery += "SC2.C2_DATRF <> '" + Space(8) + "' AND "
		cQuery += "SC2.D_E_L_E_T_=' ' "
		cQuery += "ORDER BY "+SqlOrder(SC2->(IndexKey(2)))
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasTop,.T.,.T.)
		aEval(SC2->(dbStruct()), {|x| If(x[2] <> "C", TcSetField(cAliasTop,x[1],x[2],x[3],x[4]),Nil)})
	Endif	

dbSelectArea(cAliasTop)
If lQuery
	dbSetOrder(2)
	dbSeek(cFilial+SB1->B1_COD)
Endif
If ! Eof()
	/*
	³O.Prod/It/Seq Loc Quant.Inf. Quant.Entr.   Perda    P.Ini     P.Final   Tipo Op³
	³999999 99 999 99 9999999.99 9999999.99 999999.99 99/99/9999 99/99/9999     x   ³
	*/
	lFirst:=.T.
	nTotQtd:=0.00
	nTotEnt:=0.00
	nTotPer:=0.00
	While !Eof() .and. (lQuery .Or. C2_FILIAL+C2_PRODUTO == cFilial+SB1->B1_COD)
		If ! lQuery .And. (!Empty(C2_DATRF)) //.and. (C2_QUJE + C2_PERDA) <= C2_QUANT
			dbSkip()
			Loop
		Endif
		If lFirst
			MC050TRB(cBrancBloc,Alias())
			cString:="³ "+STR0057+Space(nTamanho-(Len(STR0057)+3))+"³"	// "Ordens de Producao"
			MC050TRB(cString,Alias())
			cString:=STR0026	//"³O.Prod/It/Seq Loc Quant.Inf. Quant.Entr.   Perda    P.Ini     P.Final  Tipo Op³"
			// ³999999 99 999 99 9999999.99 9999999.99 999999.99 99/99/9999 99/99/9999    x   ³
			//  012345678901234567890123456789012345678901234567890123456789012345678901234567890
			//  0         1         2         3         4         5         6         7         8
			MC050TRB(cString,Alias())
			lFirst:=.F.
		Endif
		cString :=  "³"+C2_NUM+" "+C2_ITEM+" "+C2_SEQUEN+" "+C2_LOCAL+" "+;
			Transform(C2_QUANT,"@E 9999999.99")+" "+;
			Transform(C2_QUJE ,"@E 9999999.99")+" "+;
			Transform(C2_PERDA,"@E 999999.99")+" "+;
			dToc(C2_DATPRI)+" "+dToc(C2_DATPRF)
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )
		cString += Space(4) + C2_TPOP + Space(3) + "³"
		MC050TRB(cString,Alias())
		nTotQtd+=C2_QUANT
		nTotEnt+=C2_QUJE
		nTotPer+=C2_PERDA

		If C2_DATPRF < dDataBasE
			dDataFim := SomaPrazo(dDataBase, CalcPrazo(SB1->B1_COD,SB1->B1_LE,,,.T.,dDataBase))
		Else
			dDataFim := C2_DATPRF
		Endif

		a051MRP(dDataFim,(C2_QUANT - C2_QUJE - C2_PERDA),"E")

		dbSkip()
	End
	If !lFirst
		MC050TRB(cBrancBloc,Alias())
		cString:= STR0024+Transform(nTotQtd,"@E 9999999.99")+STR0027+Transform(nTotEnt,"@E 9999999.99")+STR0028+Transform(nTotPer,"@E 999999.99")		//"³Qtd.Total: "###" Qtd.Entreg.: "###" Perda:"
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	Endif

Endif
If lQuery
	dbSelectArea(cAliasTop)
	dbCloseArea()
	dbSelectArea("SC2")
EndIf

// ------------------------- Previsoes de Venda (SC4)
cAliasTop := "SC4"
	If lQuery
		cAliasTop := "AliasSC4"
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SC4")+" SC4, "
		cQuery += "WHERE SC4.C4_FILIAL='"+xFilial("SC4")+"' AND "
		cQuery += "SC4.C4_PRODUTO='" + SB1->B1_COD + "' AND "
		cQuery += "SC4.D_E_L_E_T_=' ' "
		cQuery += "ORDER BY "+SqlOrder(SC4->(IndexKey(1)))
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasTop,.T.,.T.)
		aEval(SC4->(dbStruct()), {|x| If(x[2] <> "C", TcSetField(cAliasTop,x[1],x[2],x[3],x[4]),Nil)})
	Endif	
dbSelectArea(cAliasTop)
If ! lQuery
	dbSetOrder(1)
	dbSeek(xFilial()+SB1->B1_COD)
Endif
If ! Eof()
	lFirst:=.T.
	/*
	³Doc.   Loc.  Quantidade      Valor         Data                       ³
	³000001 00   999999999.99 999.999.999,99 99/99/9999                    ³
	*/
	While !Eof() .and. (lQuery .Or. C4_FILIAL+C4_PRODUTO == xFilial()+SB1->B1_COD)
		If Empty(C4_NUMOP)
			If lFirst
				MC050TRB(cBrancBloc,Alias())
				cString:="³ "+STR0058+Space(nTamanho-(Len(STR0058)+3))+"³"	// "Previsoes de Venda"
				MC050TRB(cString,Alias())
				cString:=STR0059	//"³Doc.   Loc.  Quantidade      Valor         Data                       ³"
				MC050TRB(cString,Alias())
				lFirst:=.F.
			EndIf
			cString := "³"+C4_DOC+" "+C4_LOCAL+"   "
			cString += Transform(C4_QUANT,"@E 999999999.99")+" "
			cString += Transform(C4_VALOR,"@E 999,999,999.99")+" "+DTOC(C4_DATA)
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
		EndIf
		dbSkip()
	End
EndIf

MC050TRB(cFimBloc,Alias())

If lQuery
	dbSelectArea(cAliasTop)
	dbCloseArea()
	dbSelectArea("SC4")
EndIf

//--------- Define Dados Historicos de Movimentacoes
cString:=STR0029	//" Historicos de Movimentacoes "
MC050TRB(CHR(218)+cString+Repli(CHR(196),((nTamanho-2)-Len(cString)))+CHR(191),Alias())

// --------- Movimentos de Entrada (SD1)

cAliasTop := "SD1"
lQuery    := .F.
	lQuery := .T.
	cAliasTop := "AliasSD1"
	cQuery := "SELECT * "
	cQuery += "FROM "+RetSqlName("SD1")+" SD1, "
	cQuery += "WHERE SD1.D1_FILIAL='"+xFilial("SD1")+"' AND "
	cQuery += "SD1.D1_COD='" + SB1->B1_COD + "' AND "
	cQuery += "SD1.D1_TES<>'" + Space(Len(SD1->D1_TES)) + "' AND "
	cQuery += "SD1.D1_DTDIGIT>='" + Dtos(mv_par01) + "' AND "
	cQuery += "SD1.D1_DTDIGIT<='" + Dtos(mv_par02) + "' AND "
	cQuery += "SD1.D_E_L_E_T_=' ' "
	cQuery += "ORDER BY "+SqlOrder(SD1->(IndexKey(7)))
	cQuery := ChangeQuery(cQuery)
	dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasTop,.T.,.T.)
	aEval(SD1->(dbStruct()), {|x| If(x[2] <> "C", TcSetField(cAliasTop,x[1],x[2],x[3],x[4]),Nil)})
dbSelectArea(cAliasTop)
If ! lQuery
	dbSetOrder(7)
	dbSeek(cFilial+SB1->B1_COD)
Endif
If ! Eof()
	/*
	Chile/Argentina
	³TP   Nota Fiscal     Emissao    Entrada   Fornecedor Atu.Estoque?     ³"
	³X  999999999999/XXX DD/MM/AAAA DD/MM/AAAA  999999/99      X           ³
	³ Frete:99,999.99 Desp:99,999.99 Qtd:99999999.99 Vl.Tot:999,999,999.99 ³


	Brasil
	³TP  Nota Fiscal  Emissao    Entrada   Fornecedor Atu.Estoque?         ³"
	³X    999999/XXX DD/MM/AAAA DD/MM/AAAA  999999/99      X               ³
	³ Frete:99,999.99 Desp:99,999.99 Qtd:99999999.99 Vl.Tot:999,999,999.99 ³
	*/

	lFirst:=.T.
	nTotEnt:=0.00
	nTotQtd:=0.00
	nTotCom:=0
	nFrete := 0
	nDesp  := 0
	While !Eof() .and. (lQuery .Or. D1_FILIAL+D1_COD == cFilial+SB1->B1_COD)

		dbSelectArea("SF4")
		dbSeek(cFilial+(cAliasTop)->D1_TES)
		dbSelectArea("SF1")
		dbSeek(cFilial+(cAliasTop)->D1_DOC+(cAliasTop)->D1_SERIE)
		dbSelectArea(cAliasTop)

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Para paises do MercoSul, desprezar as Notas Fiscais que foram ³
		//³ ingressadas por Remitos de Salida...                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If cPaisLoc != "BRA"
			If ! Empty(D1_REMITO)
				dbSkip()
				Loop
			EndIf
		EndIf

		If ! lQuery .And. (Empty(D1_TES) .or. D1_DTDIGIT < mv_par01 .or. D1_DTDIGIT > mv_par02)
			dbSkip()
			Loop
		Endif

		//-- Calcula Despesas e Frete Proporcionais ao Produto (NF Entrada)
		If SF1->F1_FRETE > 0
			nFrete := ((cAliasTop)->D1_TOTAL/SF1->F1_VALMERC) * SF1->F1_FRETE
		Else
			nFrete := 0
		EndIf
		If SF1->F1_DESPESA > 0
			nDesp := ((cAliasTop)->D1_TOTAL/SF1->F1_VALMERC) * SF1->F1_DESPESA
		Else
			nDesp := 0
		EndIf

		If lFirst
			MC050TRB(cBrancBloc,Alias())
			cString:=STR0030	// "³ Lancamentos de Entrada                                               ³"
			MC050TRB(cString,Alias())

			If mv_par03==1
				//-- Variavel por causa do no. da Nota Fiscal
				cString := STR0031 // "³TP "
				cString += If(cPaisLoc=="BRA"," ","  ")
				cString += STR0060 // "Nota Fiscal"
				cString += If(cPaisLoc=="BRA","","   ")
				cString += STR0053 // "  Emissao    Entrada   Fornecedor Atu.Estoque?"
				cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
				MC050TRB(cString,Alias())
			Endif

			lFirst:=.F.
		Endif
		If mv_par03==1
			cCliFor := If(lSXG1Max .Or. lSXG2Max, Space(aTamSXG1[1]), D1_FORNECE)
			cLoja   := If(lSXG1Max .Or. lSXG2Max, Space(aTamSXG2[1]), D1_LOJA)
			cString := "³"+D1_TIPO+"  "+If(cPaisLoc=="BRA","  "+D1_DOC,PadR(D1_DOC,12))+"/"+D1_SERIE+" "+DtoC(D1_EMISSAO)+" "
			cString += DtoC(D1_DTDIGIT)+"  "+cCliFor+If(Empty(cCliFor)," ","/")+cLoja+"      "+SF4->F4_ESTOQUE
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())

			If lSXG1Max .Or. lSXG2Max
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³Quebro em Duas Linhas³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				cString := "³"+PadR(Space(If(cPaisLoc=="BRA",40,44))+D1_FORNECE+"/"+D1_LOJA,nTamanho-2)+"³"
				MC050TRB(cString,Alias())
			EndIf

			cString := "³ "
			cString += STR0064 + Transform(nFrete,"@E 99,999.99")+" " // "Frete:"
			cString += STR0065 + Transform(nDesp,"@E 99,999.99")+" " // "Desp:"
			cString += STR0061 + Transform(D1_QUANT,"@E 99999999.99")+" " // "Qtd:"
			cString += STR0062 + Transform((D1_VUNIT-(D1_VALDESC/D1_QUANT))*D1_QUANT,"@E 999,999,999.99") // "Vl.Tot:"
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
		Endif

		nTotQtd+=D1_QUANT
		nTotEnt+=(D1_VUNIT-(D1_VALDESC/D1_QUANT))*D1_QUANT
		nTotCom++
		dbSkip()
	End

	If nTotQtd > 0
		MC050TRB(cBrancBloc,Alias())
		cString:=STR0024+Transform(nTotQtd,"@E 999999999.99")+STR0032+Transform(nTotEnt,"@E 999,999,999.99")+STR0033+Transform(nTotCom,"9999")		//"³Qtd.Total: "###" Vlr.Total: "###" Num.Movim. "
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	Endif

Endif
If lQuery
	dbSelectArea(cAliasTop)
	dbCloseArea()
	dbSelectArea("SD1")
EndIf

// ------------------- Movimentos de Saida (SD2)

cAliasTop := "SD2"
	If lQuery
		cAliasTop := "AliasSD2"
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SD2")+" SD2, "
		cQuery += "WHERE SD2.D2_FILIAL='"+xFilial("SD2")+"' AND "
		cQuery += "SD2.D2_COD='"  + SB1->B1_COD + "' AND "
		cQuery += "SD2.D2_TES<>'" + Space(Len(SD2->D2_TES)) + "' AND "
		cQuery += "SD2.D2_EMISSAO>='" + Dtos(mv_par01) + "' AND "
		cQuery += "SD2.D2_EMISSAO<='" + Dtos(mv_par02) + "' AND "
		cQuery += "SD2.D_E_L_E_T_=' ' "
		cQuery += "ORDER BY "+SqlOrder(SD2->(IndexKey(6)))
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasTop,.T.,.T.)
		aEval(SD2->(dbStruct()), {|x| If(x[2] <> "C", TcSetField(cAliasTop,x[1],x[2],x[3],x[4]),Nil)})
	Endif	
dbSelectArea(cAliasTop)
If ! lQuery
	dbSetOrder(6)
	dbSeek(cFilial+SB1->B1_COD)
Endif
If ! Eof()
	/*
	Chile/Argentina
	³TP   Nota Fiscal    Pedido  Emissao    Cliente  Atu.Estoque?          ³"
	³X  999999999999/XXX 999999 DD/MM/AAAA 999999/99      X                ³
	³ Frete:99,999.99 Desp:99,999.99 Qtd:99999999.99 Vl.Tot:999,999,999.99 ³

	Brasil
	³TP Nota Fiscal Pedido  Emissao    Cliente  Atu.Estoque?               ³"
	³X   999999/XXX 999999 DD/MM/AAAA 999999/99      X                     ³
	³ Frete:99,999.99 Desp:99,999.99 Qtd:99999999.99 Vl.Tot:999,999,999.99 ³
	*/

	lFirst:=.T.
	nTotQtd:=0.00
	nTotEnt:=0.00
	nTotSai:=0
	nFrete := 0
	nDesp  := 0
	While !Eof() .and. (lQuery .Or. D2_FILIAL+D2_COD == cFilial+SB1->B1_COD)

		dbSelectArea("SF4")
		dbSeek(cFilial+(cAliasTop)->D2_TES)
		dbSelectArea("SF2")
		dbSeek(cFilial+(cAliasTop)->D2_DOC+(cAliasTop)->D2_SERIE)
		dbSelectArea("SD2")

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Para paises do MercoSul, desprezar as Notas Fiscais que foram ³
		//³ ingressadas por Remitos de Salida...                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If cPaisLoc != "BRA".And.	!Empty(D2_REMITO) .And. !(D2_TPDCENV $ _RMCONS)
			(cAliasTop)->(dbSkip())
			Loop
		EndIf

		If ! lQuery .And. (Empty(D2_TES) .or. D2_EMISSAO < mv_par01 .or. D2_EMISSAO > mv_par02)
			dbSkip()
			Loop
		Endif

		//-- Calcula Despesas e Frete Proporcionais ao Produto (NF Saida)
		If SF2->F2_FRETE > 0
			nFrete := ((cAliasTop)->D2_TOTAL/SF2->F2_VALMERC) * SF2->F2_FRETE
		Else
			nFrete := 0
		EndIf
		If SF2->F2_DESPESA > 0
			nDesp := ((cAliasTop)->D2_TOTAL/SF2->F2_VALMERC) * SF2->F2_DESPESA
		Else
			nDesp := 0
		EndIf

		If lFirst
			MC050TRB(cBrancBloc,Alias())
			cString:=STR0034	//"³ Lancamentos de Saida                                                 ³"
			MC050TRB(cString,Alias())
			If mv_par03==1
				//-- Variavel por causa do no. da Nota Fiscal
				cString := STR0031 // "³TP "
				cString += If(cPaisLoc=="BRA","",Space(2))
				cString += STR0060 // "Nota Fiscal"
				cString += If(cPaisLoc=="BRA","",Space(3))
				cString += STR0054 // " Pedido  Emissao    Cliente  Atu.Estoque?"
				cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
				MC050TRB(cString,Alias())
			Endif
			lFirst:=.F.
		Endif
		If mv_par03==1
			cCliFor := If(lSXG1Max .Or. lSXG2Max, Space(aTamSXG1[1]), D2_CLIENTE)
			cLoja   := If(lSXG1Max .Or. lSXG2Max, Space(aTamSXG2[1]), D2_LOJA)
			cString := "³"+D2_TIPO+"  "+If(cPaisLoc=="BRA"," "+D2_DOC,Padr(D2_DOC,12))+"/"+D2_SERIE+" "+D2_PEDIDO+" "
			cString += DtoC(D2_EMISSAO)+" "+cCliFor+If(Empty(cCliFor)," ","/")+cLoja+"      "+SF4->F4_ESTOQUE
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())

			If lSXG1Max .Or. lSXG2Max
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³Quebro em Duas Linhas³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				cString := "³"+PadR(Space(If(cPaisLoc=="BRA",34,39))+D2_CLIENTE+"/"+D2_LOJA,nTamanho-2)+"³"
				MC050TRB(cString,Alias())
			EndIf

			cString := "³ "
			cString += STR0064 + Transform(nFrete,"@E 99,999.99")+" " // "Frete:"
			cString += STR0065 + Transform(nDesp,"@E 99,999.99")+" " // "Desp:"
			cString += STR0061 + Transform(D2_QUANT,"@E 99999999.99")+" " // "Qtd:"
			cString += STR0062 + Transform(D2_TOTAL,"@E 999,999,999.99") // "Vl.Tot:"
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())

		Endif
		nTotQtd+=D2_QUANT
		nTotEnt+=D2_TOTAL
		nTotSai++
		dbSkip()
	End

	If nTotQtd > 0
		MC050TRB(cBrancBloc,Alias())
		cString:=STR0024+Transform(nTotQtd,"@E 999999999.99")+STR0032+Transform(nTotEnt,"@E 999,999,999.99")+STR0079+Transform(nTotSai,"9999")		//"³Qtd.Total: "###" Vlr.Total: " //" Num.Movim. "
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	Endif
Endif
If lQuery
	dbSelectArea(cAliasTop)
	dbCloseArea()
	dbSelectArea("SD2")
EndIf

// --------------------- Movimentos Internos (SD3)
cAliasTop := "SD3"
	If lQuery
		lQuery := .T.
		cAliasTop := "AliasSD3"
		cQuery := "SELECT * "
		cQuery += "FROM "+RetSqlName("SD3")+" SD3, "
		cQuery += "WHERE SD3.D3_FILIAL='"+xFilial("SD3")+"' AND "
		cQuery += "SD3.D3_COD='"  + SB1->B1_COD + "' AND "
		cQuery += "SD3.D3_EMISSAO>='" + Dtos(mv_par01) + "' AND "
		cQuery += "SD3.D3_EMISSAO<='" + Dtos(mv_par02) + "' AND "
		cQuery += "SD3.D_E_L_E_T_=' ' "
		cQuery += "ORDER BY "+SqlOrder(SD3->(IndexKey(7)))
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasTop,.T.,.T.)
		aEval(SD3->(dbStruct()), {|x| If(x[2] <> "C", TcSetField(cAliasTop,x[1],x[2],x[3],x[4]),Nil)})
	Endif	

dbSelectArea(cAliasTop)
If ! lQuery
	dbSetOrder(7)
	dbSeek(cFilial+SB1->B1_COD)
Endif
If ! Eof()
	/*
	Chile/Arg.
	³TP   Documento   Emissao    Quantidade  RE/DE Local OP/Documento      ³
	³XX 999999999999 DD/MM/AAAA 999999999.99  999   99    99999999999      ³

	Brasil
	³TP   Documento   Emissao    Quantidade  RE/DE Local OP/Documento      ³
	³XX     999999   DD/MM/AAAA 999999999.99  999   99    99999999999      ³
	*/
	lFirst:=.T.
	nTotQtd:=0.00
	nTotEnt:=0.00
	nTotInt:=0
	While !Eof() .and. (lQuery .Or. D3_FILIAL+D3_COD == cFilial+SB1->B1_COD)

		If ! lQuery .And. (D3_EMISSAO < mv_par01 .or. D3_EMISSAO > mv_par02)
			dbSkip()
			Loop
		Endif

		If lFirst
			MC050TRB(cBrancBloc,Alias())
			cString:=STR0078 //"³ Lancamentos Internos                                                 ³"
			MC050TRB(cString,Alias())
			If mv_par03==1
				cString := STR0055 // "³TP   Documento   Emissao    Quantidade  RE/DE Local OP/Documento      ³"
				MC050TRB(cString,Alias())
			Endif
			lFirst:=.F.
		Endif
		If mv_par03==1
			cString := "³"+D3_TIPO+" "+If(cPaisLoc=="BRA","    "+D3_DOC+"  ",Padr(D3_DOC,12))+" "+ DtoC(D3_EMISSAO)+" "
			cString += Transform(D3_QUANT,"@E 999999999.99")+"  "+D3_CF+"   "+D3_LOCAL+"    "+D3_OP
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
		Endif
		nTotQtd+=D3_QUANT
		nTotInt++
		dbSkip()
	End

	If nTotQtd > 0
		MC050TRB(cBrancBloc,Alias())
		cString:=STR0037+Transform(nTotQtd,"@E 999999999.99")+STR0038+Transform(nTotInt,"9999")		//"³Qtd.Total: "###" Num.Lanctos "
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	Endif

Endif
If lQuery
	dbSelectArea(cAliasTop)
	dbCloseArea()
	dbSelectArea("SD3")
EndIf

// -------------- Movimentos controle Poder Terceiros (SB6)
dbSelectArea("SB6")
dbSetOrder(1)
dbSeek(cFilial+SB1->B1_COD)
If Found()
	/*
	Chile/Arg.
	³TP  Nota Fiscal     Emissao   Cli./Forn. Loc Ultima Entrada         ³
	³X 999999999999/XXX DD/MM/AAAA 999999/99  99    DD/MM/AAAA           ³
	³  Quantidade: 999999999.99 Valor Unitario: 999,999,999.99           ³


	³TP Nota Fiscal  Emissao   Cli./Forn. Loc Ultima Entrada             ³
	³X   999999/XXX DD/MM/AAAA 999999/99  99    DD/MM/AAAA               ³
	³    Quantidade: 999999999.99 Valor Unitario: 999,999,999.99         ³
	*/
	lFirst:=.T.
	nTotQtd:=0.00
	nTotEnt:=0.00
	nTotInt:=0
	nQtdGer:=0.00
	nEntGer:=0.00
	nIntGer:=0.00
	cIdentB6 := B6_IDENT
	While !Eof() .and. B6_FILIAL+B6_PRODUTO == cFilial+SB1->B1_COD

		If B6_DTDIGIT < mv_par01 .or. B6_DTDIGIT > mv_par02
			dbSkip()
			Loop
		Endif

		If lFirst
			MC050TRB(cBrancBloc,Alias())
			cString:=STR0074 //"³ Lancamentos Controle Poder Terceiros                                 ³"
			MC050TRB(cString,Alias())
			If mv_par03==1
				cString := STR0031 // "³TP "
				cString += If(cPaisLoc == "BRA",""," ")
				cString += STR0060 // "Nota Fiscal"
				cString += If(cPaisLoc == "BRA","","   ")
				cString += STR0056 // "  Emissao   Cli./Forn. Loc Ultima Entrada"
				cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
				MC050TRB(cString,Alias())
			Endif
			lFirst:=.F.
		Endif

		nRegSB6 := Recno()

		If mv_par03 == 1
			If SB6->B6_IDENT <> cIdentB6
				If nTotQtd > 0
					MC050TRB(cBrancBloc,Alias())
					cString:=STR0040+Transform(nTotQtd,"@E 9999999.99")+STR0014+Transform(nTotEnt,"@E 999999.99")+STR0038+Transform(nTotInt,"9999")		//"³    Qtd : "###" Qtd.Entr.: "###" Num.Lanctos "
					cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
					MC050TRB(cString,Alias())
				Endif
				cIdentB6 := SB6->B6_IDENT
				nTotQtd:=0.00
				nTotEnt:=0.00
				nTotInt:=0
			Endif
			cCliFor := If(lSXG1Max .Or. lSXG2Max, Space(aTamSXG1[1]), SB6->B6_CLIFOR)
			cLoja   := If(lSXG1Max .Or. lSXG2Max, Space(aTamSXG2[1]), SB6->B6_LOJA)
			cString := "³"+SB6->B6_TIPO+" "+If(cPaisLoc=="BRA","  "+SB6->B6_DOC,Padr(SB6->B6_DOC,12))+"/"+SB6->B6_SERIE+" "+DtoC(SB6->B6_DTDIGIT)+" "
			cString += cCliFor+If(Empty(cCliFor)," ","/")+cLoja+"  "+SB6->B6_LOCAL+"    "+DtoC(SB6->B6_UENT)
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())

			If lSXG1Max .Or. lSXG2Max
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³Quebro em Duas Linhas³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				cString := "³"+PadR(Space(If(cPaisLoc=="BRA",27,31))+B6_CLIFOR+"/"+B6_LOJA,nTamanho-2)+"³"
				MC050TRB(cString,Alias())
			EndIf

			cString := "³  " + If(cPaisLoc == "BRA","  ","")
			cString += STR0061 + " " + Transform(SB6->B6_QUANT,"@E 999999999.99")+" " // "Qtd:"
			cString += STR0063 + Transform(SB6->B6_PRUNIT,"@E 999,999,999.99") // "Valor Unitario: "
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())

		EndIf
		dbSelectArea("SF4")
		dbSeek(cFilial+SB6->B6_TES)
		If SF4->F4_PODER3 == "R"
			nQuant   := SB6->B6_QUANT
			aSaldoTer:= CalcTerc(SB6->B6_PRODUTO, SB6->B6_CLIFOR, SB6->B6_LOJA,SB6->B6_IDENT,SB6->B6_TES)
			nSaldo   := nQuant - aSaldoTer[1]
		Else
			nQuant  := 0
			nSaldo  := 0
		Endif

		//If mv_par03==1
		//	cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		//	MC050TRB(cString,Alias())
		//Endif

		nTotQtd+=nQuant
		nTotEnt+=nSaldo
		nTotInt++

		nQtdGer+=nQuant
		nEntGer+=nSaldo
		nIntGer++

		dbSelectArea("SB6")
		dbSetOrder(1)
		dbGoto(nRegSB6)
		dbSkip()
	End

	If mv_par03 == 1
		If nTotQtd > 0
			MC050TRB(cBrancBloc,Alias())
			cString:=STR0040+Transform(nTotQtd,"@E 9999999.99")+STR0014+Transform(nTotEnt,"@E 999999.99")+STR0038+Transform(nTotInt,"9999")	//"³    Qtd : "###" Qtd.Entr.: "###" Num.Lanctos "
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
		Endif
	Endif

	If nQtdGer > 0
		MC050TRB(cBrancBloc,Alias())
		cString:=STR0024+Transform(nQtdGer,"@E 9999999.99")+STR0014+Transform(nEntGer,"@E 999999.99")+STR0038+Transform(nIntGer,"9999")		//"³Qtd.Total: "###" Qtd.Entr.: "###" Num.Lanctos "
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	Endif
Endif

MC050TRB(cFimBloc,Alias())

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define Dados Saldos do Produto                               ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
cPictQtd := PesqPict("SB3","B3_Q01")

// -----------------------Saldos e Consumos
cString:=STR0075 //" Saldos e Consumos "
MC050TRB(CHR(218)+cString+Repli(CHR(196),((nTamanho-2)-Len(cString)))+CHR(191),Alias())
// ------------------ Consumo Ultimos Meses (SB3)
/*
³Classe ABC: X Med. Consumo: 99999999999                             ³
³Vlr.da Media: 99999999999.99                                        ³
³       xxx/99          xxx/99          xxx/99          xxx/99       ³
³   999999999.99    999999999.99    999999999.99    999999999.99     ³
*/

dbSelectArea("SB3")
dbSetOrder(1)
dbSeek(cFilial+SB1->B1_COD)
If Found()
	aEstru := {}
	AADD(aEstru,{"B3_CLASSE"    ,"",0,"",""})
	AADD(aEstru,{"B3_MEDIA"     ,"",0,"",""})
	AADD(aEstru,{"B3_TOTAL"     ,"",0,"",""})
	MC050BUSCA(aEstru,Alias())

	MC050TRB(cBrancBloc,Alias())
	cString:=STR0076 //"³ Consumo dos Ultimos 12 Meses                                         ³"
	MC050TRB(cString,Alias())
	cString:="³"
	For n:=1 to Len(aEstru)
		If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
			cPicture	 := AllTrim(aEstru[n][4])
			cConteudo := aEstru[n][1]
			If aEstru[n][5] $ "ND"
				cConteudo := Transform(&cConteudo,cPicture)
			ElseIf aEstru[n][5]=="C"
				cConteudo := &cConteudo
			Endif
			cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
		Else
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
			cString:="³"
			cPicture	 := aEstru[n][4]
			cConteudo := aEstru[n][1]
			If aEstru[n][5] $ "ND"
				cConteudo := Transform(&cConteudo,cPicture)
			ElseIf aEstru[n][5]=="C"
				cConteudo := &cConteudo
			Endif
			If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
				cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
			Else
				nString   := Len(cString) + Len(Alltrim(aEstru[n][2])) + 2
				cString   += Alltrim(aEstru[n][2])+": "+Substr(cConteudo,1,(nTamanho-2)-nString)+" ³"
			EndIf
		Endif
	Next n
	If Len(cString) > 1
		cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
		MC050TRB(cString,Alias())
	Endif
	MC050TRB(cBrancBloc,Alias())

	cString:="³"+Space(8)
	cDados :="³   "
	nAno   := Year(dDataBase)
	For k:=1 to 12
		nMes := ( ( Month(dDataBase) + 1 ) - k )
		If nMes <= 0
			nAno := Year(dDataBase)-1
			nMes += 12
		Endif
		cCampo := "B3_Q"+StrZero(nMes,2)
		cMes   := Subs(MesExtenso(nMes),1,3)
		cAno 	 := StrZero(nAno,4)

		cString += cMes+"/"+cAno+Space(8)
		cDados  += Space(2) + Transform(&cCampo,cPictQtd)
		cDados  += Space(14-Len(Transform(&cCampo,cPictQtd)))

		If StrZero(k,2) $ "04/08/12"
			cString := Alltrim(cString)
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
			cDados  += Space( ( ( nTamanho-Len(cDados ) ) - 1 ) )+"³"
			MC050TRB(cDados,Alias())
			cString:="³"+Space(8)
			cDados :="³"+Space(3)
		Endif
	Next k

Endif

// ------------------ Saldos Iniciais (SB9)
dbSelectArea("SB9")
dbSetOrder(1)
dbSeek(cFilial+SB1->B1_COD)
If Found()
	aEstru := {}
	AADD(aEstru,{"B9_LOCAL"			,"",0,"",""})
	AADD(aEstru,{"B9_QINI"			,"",0,"",""})
	AADD(aEstru,{"B9_VINI1"			,"",0,"",""})
	AADD(aEstru,{"B9_DATA"			,"",0,"",""})
	MC050BUSCA(aEstru,Alias())
	lFirst:=.T.
	While !Eof() .and. B9_FILIAL+B9_COD == cFilial+SB1->B1_COD
		cLocal := B9_LOCAL
		While !Eof() .and. B9_FILIAL+B9_COD+B9_LOCAL == cFilial+SB1->B1_COD+cLocal
			dbSkip()
		End
		dbSkip(-1)

		MC050TRB(cBrancBloc,Alias())
		cString:=STR0077 //"³ Saldo Ultimo Fechamento (por Almx.)                                  ³"
		MC050TRB(cString,Alias())
		cString:="³"
		For n:=1 to Len(aEstru)
			If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
				cPicture	 := Alltrim(aEstru[n][4])
				cConteudo := aEstru[n][1]
				If aEstru[n][5] $ "ND"
					cConteudo := Transform(&cConteudo,cPicture)
				ElseIf aEstru[n][5]=="C"
					cConteudo := &cConteudo
				Endif
				cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
			Else
				cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
				MC050TRB(cString,Alias())
				cString:="³"
				cPicture	 := aEstru[n][4]
				cConteudo := aEstru[n][1]
				If aEstru[n][5] $ "ND"
					cConteudo := Transform(&cConteudo,cPicture)
				ElseIf aEstru[n][5]=="C"
					cConteudo := &cConteudo
				Endif
				If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
					cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
				Else
					nString   := Len(cString) + Len(Alltrim(aEstru[n][2])) + 2
					cString   += Alltrim(aEstru[n][2])+": "+Substr(cConteudo,1,(nTamanho-2)-nString)+" ³"
				EndIf
			Endif
		Next n
		If Len(cString) > 1
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
		Endif
		MC050TRB(cBrancBloc,Alias())
		dbSkip()
	End
Endif

// ------------------- Saldos Fisicos e Financeiros
dbSelectArea("SB2")
dbSetOrder(1)
dbSeek(cFilial+SB1->B1_COD)
If Found()
	aEstru := {}
	AADD(aEstru,{"B2_LOCAL"     ,"",0,"",""})
	AADD(aEstru,{"B2_CM1"       ,"",0,"",""})
	AADD(aEstru,{"B2_QATU"      ,"",0,"",""})
	AADD(aEstru,{"B2_VATU1"     ,"",0,"",""})
	AADD(aEstru,{"B2_VATU2"     ,"",0,"",""})
	AADD(aEstru,{"B2_VATU3"     ,"",0,"",""})
	AADD(aEstru,{"B2_VATU4"     ,"",0,"",""})
	AADD(aEstru,{"B2_VATU5"     ,"",0,"",""})
	AADD(aEstru,{"B2_SALPEDI"   ,"",0,"",""})
	AADD(aEstru,{"B2_SALPPRE"   ,"",0,"",""})
	AADD(aEstru,{"B2_RESERVA"   ,"",0,"",""})
	AADD(aEstru,{"B2_QPEDVEN"   ,"",0,"",""})
	AADD(aEstru,{"B2_QEMP"      ,"",0,"",""})
	AADD(aEstru,{"B2_QEMPPRE"   ,"",0,"",""})
	AADD(aEstru,{"B2_QEMPSA"    ,"",0,"",""})
	AADD(aEstru,{"B2_QTNP"      ,"",0,"",""})
	AADD(aEstru,{"B2_QNPT"      ,"",0,"",""})
	AADD(aEstru,{"B2_QDISP"     ,"",0,"",""})
	MC050BUSCA(aEstru,Alias())
	nPos := aScan(aEstru, {|x| x[1] = "B2_QDISP"})
	If Empty(aEstru[nPos, 2])
		aEstru[nPos, 2] := STR0066   // "Saldo Disponível"
		aEstru[nPos, 3] := TamSX3("B2_QATU")[1]
		aEstru[nPos, 4] := PesqPict("SB2", "B2_QATU")
	Endif

	lFirst:=.T.
	aTotGeral := {0,0,0,0,0,0}
	While !Eof() .and. B2_FILIAL+B2_COD == cFilial+SB1->B1_COD
		aSaldo := CalcEst(SB1->B1_COD,SB2->B2_LOCAL,CTOD("31/12/49","ddmmyy"))
		If ( SB2->B2_QATU != Round(aSaldo[1],nDecSB2))
			Help(" ",1,"MATC050SLD")
		EndIf
		If mv_par05 == 1	// Considera Qtde De/Em Terceiros
			aSaldo[1] += SB2->B2_QNPT - SB2->B2_QTNP 
		EndIf
		MC050TRB(cBrancBloc,Alias())
		cString:=STR0067
		MC050TRB(cString,Alias())
		cString:="³"
		For n:=1 to Len(aEstru)
			If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
				cPicture  := aEstru[n][4]
				cConteudo := aEstru[n][1]
				If cConteudo == "B2_QDISP"
					cConteudo := Transform(SaldoSB2(.f., .t.), AllTrim(cPicture))
				Else
					If aEstru[n][5] $ "ND"
						cConteudo := Transform(&cConteudo,AllTrim(cPicture))
					ElseIf aEstru[n][5]=="C"
						cConteudo := &cConteudo
					Endif
				Endif
				cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
			Else
				cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
				MC050TRB(cString,Alias())
				cString:="³"
				cPicture  := aEstru[n][4]
				cConteudo := aEstru[n][1]
				If cConteudo == "B2_QDISP"
					cConteudo := Transform(SaldoSB2(.f., .t.), AllTrim(cPicture))
				Else
					If aEstru[n][5] $ "ND"
						If mv_par05 == 1 .And. cConteudo == "B2_QATU"
							cConteudo := Transform(aSaldo[1],AllTrim(cPicture))
						Else	
							cConteudo := Transform(&cConteudo,cPicture)
						EndIf	
					ElseIf aEstru[n][5]=="C"
						cConteudo := &cConteudo
					Endif
				Endif
				If Len(cString)+Len(Alltrim(aEstru[n][2]))+aEstru[n][3]+3 < nTamanho
					cString   += Alltrim(aEstru[n][2])+": "+cConteudo+" "
				Else
					nString   := Len(cString) + Len(Alltrim(aEstru[n][2])) + 2
					cString   += Alltrim(aEstru[n][2])+": "+Substr(cConteudo,1,(nTamanho-2)-nString)+" ³"
				EndIf
			Endif
		Next n

		If Len(cString) > 1
			cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
			MC050TRB(cString,Alias())
		Endif
		MC050TRB(cBrancBloc,Alias())
		aTotGeral[1] += aSaldo[1]
		aTotGeral[2] += aSaldo[2]
		aTotGeral[3] += aSaldo[3]
		aTotGeral[4] += aSaldo[4]
		aTotGeral[5] += aSaldo[5]
		aTotGeral[6] += aSaldo[6]
		// Caso tenha B2 e nao tenha nada, poe a database como referencia
		If dDataFim == NIL
			dDataFim:=dDataBase
		EndIf
		dbSkip()
	End

	MC050TRB(cBrancBloc,Alias())
	cString := STR0068  // "³Total Geral: "
	cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
	MC050TRB(cString,Alias())

	cString := STR0069+Transform(aTotGeral[1],"@E 999999999.99") // "³  Total Qtd. : "
	cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
	MC050TRB(cString,Alias())

	cString := STR0070 +" 1: " + Transform(aTotGeral[2],"@E 999999999.99")  //  "³  Total Vlr.1: "
	cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
	MC050TRB(cString,Alias())

	cString := STR0070 +" 2: " + Transform(aTotGeral[3],"@E 999999999.99")  //  "³  Total Vlr.2: "
	cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
	MC050TRB(cString,Alias())

	cString := STR0070 +" 3: " + Transform(aTotGeral[4],"@E 999999999.99")  //  "³  Total Vlr.3: "
	cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
	MC050TRB(cString,Alias())

	cString := STR0070 +" 4: " + Transform(aTotGeral[5],"@E 999999999.99")  //  "³  Total Vlr.4: "
	cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
	MC050TRB(cString,Alias())

	cString := STR0070 +" 5: " + Transform(aTotGeral[6],"@E 999999999.99")  //  "³  Total Vlr.5: "
	cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
	MC050TRB(cString,Alias())

Endif

// ------------------------------ Projecao de Saldos (mrp)
/*
³  Data      Saldo Inic.  Qtd.Entrada    Qtd.Saida  Saldo Atual      ³
³dd/mm/aaaa 999999999.99 999999999.99 999999999.99 999999999.99      ³
*/
lFirst:=.T.
nSaldoIni:=aTotGeral[1]
// Montar a linha com saldo inicial
aMRP := aSort( aMRP,,, { |x,y| x[1] < y[1] } )
For k:=1 to Len(aMRP)
	If lFirst
		MC050TRB(cBrancBloc,Alias())
		cString:=STR0042	//"³ Projecao de Saldos                                                   ³"
		MC050TRB(cString,Alias())
		cString:=STR0043	//"³  Data      Saldo Inic.  Qtd.Entrada    Qtd.Saida  Saldo Final        ³"
		MC050TRB(cString,Alias())
		lFirst:=.F.
	Endif
	cString :=  "³"+DtoC(aMRP[k][1])+" "+;
		Transform(nSaldoIni ,"@E 999999999.99")+" "+;
		Transform(aMRP[k][2],"@E 999999999.99")+" "+;
		Transform(aMRP[k][3],"@E 999999999.99")+" "+;
		Transform((nSaldoIni+aMRP[k][2])-aMRP[k][3],"@E 999999999.99")
	cString += Space( ( ( nTamanho-Len(cString) ) - 1 ) )+"³"
	nSaldoIni := (nSaldoIni+aMRP[k][2])-aMRP[k][3]
	MC050TRB(cString,Alias())
Next
MC050TRB(cFimBloc,Alias())

dbCommit()
Return(lTudoOK)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ a051MRP  ³ Autor ³ Gilson do Nasciemento ³ Data ³ 29/07/94 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Envia para funcao que monta o arquivo de trabalho com as   ³±±
±±³          ³ movimentacoes e mostra-o na tela                           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATC050                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function a051MRP(dData,nQtd,cTipo)
Local nPos:=0

nPos := Ascan(aMRP, { |x|x[1] == dData} )

If nPos == 0
	aADD(aMRP,{dData,0,0})
	nPos := Len(aMRP)
Endif
If cTipo=="E"
	aMRP[nPos][2] += nQtd
Else
	aMRP[nPos][3] += nQtd
Endif

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ a050Imp  ³ Autor ³ Gilson do Nasciemento ³ Data ³ 29/07/94 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Envia para funcao que faz a impressao da consulta.         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATC050                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function a050Imp()
LOCAL cTitulo  :=STR0044	//"POSICAO ATUAL DE PRODUTO"
LOCAL cDesc1 	:=STR0045	//"Este programa ira imprimir a Consulta do Produto selecionado,"
LOCAL cDesc2 	:=STR0046	//"informando os dados cadastrais, Movimentacoes em Aberto,"
LOCAL cDesc3 	:=STR0047	//"Historico de Movimentacoes, Saldos e Consumos."
LOCAL cString  :="SB1"
LOCAL wnrel    :="MATC050"

PRIVATE cPerg   :="      "
PRIVATE aReturn := { STR0048, 1,STR0049, 1, 2, 1, "",1 }		//"Zebrado"###"Administracao"
PRIVATE nLastKey:=0
nOpc:=2
nOpcA:=2
wnRel:= SetPrint(cString,wnrel,cPerg,cTitulo,cDesc1,cDesc2,cDesc3,.F.,"",,,,.F.)

If nLastKey = 27
	Return
Endif

SetDefault(aReturn,cString)

If nLastKey = 27
	Return
Endif

RptStatus({|lEnd| C050Imp(@lEnd,ctitulo,wnRel)},ctitulo)
Return .T.

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ C050Imp  ³ Autor ³ Cristina M. Ogura     ³ Data ³ 07/02/96 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Envia para funcao que faz a impressao da consulta.         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATC050                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function C050Imp(lEnd,ctitulo,wnRel)
Local cCabec1  :=STR0050	//"Consulta Geral ao Produto"
Local cCabec2  :=""
Local cTamanho :="M"
Local cNomeProg:="MATC050"
Local cbtxt    := SPACE(10)
Local cbcont   := 0
Local x        := 0

li       := 80
m_pag    := 1

cabec(cTitulo,cCabec1,cCabec2,cNomeProg,cTamanho)
li++

dbSelectArea("SB1TRB")
dbGoTop()
SetRegua(RecCount())            // Total de Elementos da Regua

While !EOF()

	IncRegua()

	IF li > 62
		@ ++li,65 PSay STR0051	//"Continua......."
		cabec(cTitulo,cCabec1,cCabec2,cNomeProg,cTamanho)
	EndIF

	// Substituir os caracteres graficos antes da impressao. //
	cCampo:=""
	For x:=1 to Len(LINHA)
		If Subs(LINHA,x,1) $ "Ú¿ÀÙ"
			cCampo += "+"
		ElseIf Subs(LINHA,x,1) == "Ä"
			cCampo += "-"
		ElseIf Subs(LINHA,x,1) == "„"
			cCampo += "a"
		ElseIf Subs(LINHA,x,1) == "‡"
			cCampo += "c"
		ElseIf Subs(LINHA,x,1) == "³"
			cCampo += "|"
		Else
			cCampo += Subs(LINHA,x,1)
		Endif
	Next

	@ li++,00 PSay cCampo
	dbSkip()

EndDO

IF li != 80
	li++
	roda(cbcont,cbtxt,"P")
EndIF

If aReturn[5] = 1
	Set Printer TO
	dbCommitAll()
	ourspool(wnrel)
Endif

Return (.T.)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³MW050Brows³ Autor ³ Cristina M. Ogura     ³ Data ³ 07/02/96 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Mostra o Arquivo de Consulta para o Windows                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATC050                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function MW050Brows(cAlias)
Local oDlg, oQual
Local cCadastro := OemToAnsi(STR0052)		//"Analise do Produto"
Local oFont:=TFont():New( "Courier New", 6, 0 )

dbSelectArea(cAlias)
dbGotop()

DEFINE MSDIALOG oDlg TITLE cCadastro From 8,10 To 33,100 OF oMainWnd
@ 5,10 LISTBOX oQual FIELDS &(cAlias+"->LINHA") HEADER "" SIZE 340,160  FONT oFont PIXEL
 DEFINE SBUTTON FROM 170,270  TYPE 1 ACTION (oDlg:End()) 				ENABLE OF oDlg
 DEFINE SBUTTON FROM 170,300  TYPE 6 ACTION (a050Imp(),oDlg:End())	ENABLE OF oDlg
ACTIVATE MSDIALOG oDlg CENTERED
oFont:End()
Return(.T.)
