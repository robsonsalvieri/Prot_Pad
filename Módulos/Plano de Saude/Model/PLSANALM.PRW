#INCLUDE "PLSANALM.ch"
#INCLUDE "TOTVS.CH"
#INCLUDE "FWMVCDEF.CH"
//
// Define
//
#DEFINE PLS__ALIAS	 "B72"
#DEFINE PLS_MODELO 	 "PLSANALM"
#DEFINE PLS_MD__ID 	 "PLSANALMMD"
#DEFINE PLS_VW__ID	 "PLSANALMVI"

#DEFINE PLS_TITULO 	 STR0001 //"Analise"

#DEFINE PLS_VW_OPE  2
#DEFINE PLS_MD_OPE	 1
//-------------------------------------------------------------------
/*/{Protheus.doc} PLSANALM
Classe modelo de dados da rotina de Auditoria (analise)

@author Alexander Santos
@since 16/02/2011
@version P11
/*/
//-------------------------------------------------------------------
Class PLSANALM

METHOD New() Constructor

EndClass     
//-------------------------------------------------------------------
/*/{Protheus.doc} New
Construtor da Class

@author Alexander Santos
@since 16/02/2011
@version P11
/*/
//-------------------------------------------------------------------
METHOD New() Class PLSANALM
Return Self
/*


Ŀ
Funcao     MenuDef  Autor  Totvs                   Data  16.02.11 
Ĵ
Descricao  MenuDef													  
ٱ


*/
Static Function MenuDef()
LOCAL aSubMenu 	:= {}
LOCAL o790C	 	:= PLS790GEC() 
LOCAL cSetor	:= GETNEWPAR('MV_SETJNMD','ND')
Local lDUTGrid := PlsAliasExi("BKY")
PRIVATE aRotina := {}        

IF cSetor <> 'ND' .AND. (o790C:cCodDep $ cSetor) .AND. (B53->B53_JNTMED = "1")

	aAdd( aSubMenu, { STR0029 , "PLSJNTANX('1')" , 0, MODEL_OPERATION_INSERT} ) //Anexo I - Beneficirio
	aAdd( aSubMenu, { STR0030 , "PLSJNTANX('2')" , 0, MODEL_OPERATION_INSERT} ) //Anexo II - Mdico Assistente
	aAdd( aSubMenu, { STR0031 , "PLSJNTANX('3')" , 0, MODEL_OPERATION_INSERT} ) //Anexo III - Convocao
	aAdd( aSubMenu, { STR0032 , "PLSJNTANX('4')" , 0, MODEL_OPERATION_INSERT} ) //Anexo IV - Ata
	
	aAdd( aRotina, { STR0033, aSubMenu, 0, 0} ) //'Relacionados'
	
	aSubMenu 	:= {}
endif      
//
// Sub-Menu
//
If !o790C:lNegPar
	aAdd( aSubMenu, { STR0002, "PLS790VAO('13')",0, 0} ) //"Nivel da Critica"
	aAdd( aSubMenu, { STR0003, "PLS790VAO('14')",0, 0} ) //"Tabela Padrao"
	//Adicionando o Menu Relacionados da auditoria no menu Aes Relacionadas da Anlise
	aAdd( aSubMenu, { STR0016, "PLS790VAO('1')", 0, 0} ) //"Contrato"
	aAdd( aSubMenu, { STR0017, "PLS790VAO('2')", 0, 0} ) //"Familia"
	aAdd( aSubMenu, { STR0018, "PLS790VAO('3')", 0, 0} ) //"Rda"
	aAdd( aSubMenu, { STR0019, "PLS790VAO('4')", 0, 0} ) //"Solicitante"
	aAdd( aSubMenu, { STR0020, "PLS790VAO('5')", 0, 0} ) //"Executante"
	aAdd( aSubMenu, { STR0021, "PLS790VAO('6')", 0, 0} ) //"Vlr. Cobranca"
	aAdd( aSubMenu, { STR0022, "PLS790VAO('7')", 0, 0} ) //"Movimentacao"
	aAdd( aSubMenu, { STR0023, "PLS790VAO('8')", 0, 0} ) //"Guia"
	aAdd( aSubMenu, { STR0024, "PLS790VAO('9')", 0, 0} ) //"Financeiro"
	aAdd( aSubMenu, { STR0025, "PLS790VAO('10')", 0, 0} ) //"Criticas"
	aAdd( aSubMenu, { STR0026, "PLS790VAO('11')", 0, 0} ) //"Grupo Caren"
	aAdd( aSubMenu, { STR0027, "PLS790VAO('12')", 0, 0} ) //"Classe Caren"
	aAdd( aSubMenu, { STR0028, "PLS790VAO('23')", 0, 0} ) //"Hist. Aud. Guia"

	If !lDUTGrid
		aAdd( aSubMenu, { STR0034, "PLS790VAO('24')", 0, 0} ) //"Dut"
	EndIF
	
	//
	// aRotina
	//
	aAdd( aRotina, { STR0012 , 'FWMsgRun(, {|| PLS790ALS("' + PLS__ALIAS + '",  __oDlgAna  ) }, "AGUARDE", "PREPARANDO TUDO PARA VOC...")' , 0, MODEL_OPERATION_INSERT} ) //'Parecer' 
	IF (o790C:lIncProc) .AND. !o790C:lRotinaGen //Verifica se usurio tem acesso para incluir procedimentos
	   aAdd( aRotina, {"INCLUIR", "PLSTESR()",0,0}) // Incluir 
	ENDIF
	//
	// Sub-Menu
	//
	IIF ( !o790C:lRotinaGen, aAdd( aRotina, { STR0013, aSubMenu, 0, 0} ), "") //'Relacionados'
Else 
	//
	// aRotina
	//
	aAdd( aRotina, { "Negar Partic." , 'PLS790NEG' , 0, MODEL_OPERATION_UPDATE} )
EndIf

//Ŀ
// P.E. utilizado para adicionar novas opcoes ao menu           
//
If ExistBlock("PLBOTADD")
	aBtAdd := ExecBlock("PLBOTADD",.F.,.F.,{aRotina})
	If ValType(aBtAdd) == "A"
		AEval(aBtAdd,{|x| AAdd(aRotina,x)})
	EndIf
EndIf

//
// Fim da funcao															 
//
	
Return aRotina
/*/


Ŀ
Funcao     ViewDef  Autor  Totvs                   Data  16.02.11 
Ĵ
Descricao  ViewDef									  				  
ٱ


/*/               
Static Function ViewDef()
LOCAL oModel := FWLoadModel( PLS_MODELO )
LOCAL oStruV := FWFormStruct( PLS_VW_OPE, PLS__ALIAS )
LOCAL oView  := FWFormView():New()
LOCAL o790C  := PLSA790C():New() 
LOCAL oPADC  := PLSPADRC():New(PLS__ALIAS) 
//
// Verifica se o perfil informado e da interna-saude
//

If !o790C:lIntSau
	oStruV:RemoveField( 'B72_INCONS' )
	oStruV:RemoveField( 'B72_TPPARE' )
	oStruV:RemoveField( 'B72_TPINCO' ) 
	oStruV:RemoveField( 'B72_DETPIC' ) 
	oStruV:RemoveField( 'B72_OBSISA' ) 
	If !GETNEWPAR('MV_EXPROC',.F.)
	  oStruV:RemoveField( 'B72_CODPRO' ) 
	  oStruV:RemoveField( 'B72_DESPRO' ) 
	EndIf
	oStruV:RemoveField( 'B72_CODGLO' ) 
	oStruV:RemoveField( 'B72_DESGLO' ) 
	oStruV:RemoveField( 'B72_RECMOV' )
	oStruv:RemoveField( 'B72_ALIMOV' )
	oStruv:RemoveField( 'B72_DATMOV' )	
//	oStruv:RemoveField( 'B72_CODPRO' )
	oStruv:RemoveField( 'B72_CODPAD' )	
	oStruv:RemoveField( 'B72_SEQPRO' )	
	oStruv:RemoveField( 'B72_ACOTOD' )
	oStruv:RemoveField( 'B72_RESAUT' )
	oStruv:RemoveField( 'B72_OPERAD' )
Else	
	oStruV:RemoveField( 'B72_NOMOPE' ) 
	If !GETNEWPAR('MV_EXPROC',.F.)
	  oStruV:RemoveField( 'B72_CODPRO' ) 
	  oStruV:RemoveField( 'B72_DESPRO' ) 
	EndIf 
	oStruV:RemoveField( 'B72_CODGLO' ) 
	oStruV:RemoveField( 'B72_DESGLO' ) 
	oStruV:RemoveField( 'B72_RECMOV' )
	oStruv:RemoveField( 'B72_ALIMOV' )
	oStruv:RemoveField( 'B72_DATMOV' )	
	//oStruv:RemoveField( 'B72_CODPRO' )
	oStruv:RemoveField( 'B72_CODPAD' )	
	oStruv:RemoveField( 'B72_SEQPRO' )	
	oStruv:RemoveField( 'B72_ACOTOD' )
	oStruv:RemoveField( 'B72_RESAUT' )
	oStruv:RemoveField( 'B72_OPERAD' )
EndIf 

If !o790C:lCriDia
	  oStruV:RemoveField( 'B72_DIASOL' ) 
	  oStruV:RemoveField( 'B72_DIAAUT' ) 
EndIf


//
// Seta o modelo na visao													 
//
oView:SetModel( oModel )
//
// Adiciona a strutura de campos da tabela na view							 
//
oView:AddField( PLS_VW__ID, oStruV, PLS_MD__ID )   
//
// Fecha a tela
//
oView:SetCloseOnOk( {|oView| oPADC:VWOkCloseScreenVLD(oView,.F.) } )
//
// Validacao da view
//
oView:SetVldActivate( {|oView| oPADC:VWInitVLD(oView) } ) 
//
// Fim da rotina															 
//
Return oView
/*/


Ŀ
Funcao     ModelDef Autor  Totvs                   Data  16.02.11 
Ĵ
Descricao  ModelDef									  				  
ٱ


/*/
Static Function ModelDef()
LOCAL oPADC  := PLSPADRC():New(PLS__ALIAS) 
LOCAL oStruM := FWFormStruct( PLS_MD_OPE, PLS__ALIAS)
LOCAL oModel := MPFormModel():New( PLS_MODELO,/*bPreValidacao*/,{|oModel| oPADC:MDPosVLD(oModel,PLS__ALIAS) },{|oModel| oPADC:MDCommit(oModel,PLS__ALIAS) }, /*bCancel*/ )  /*bPosValidacao*/ /*bCommit*/ 
//
// Adiciona a strutura de campos ao modelo									 
//
oModel:AddFields( PLS_MD__ID,,oStruM )
//
// Defini a descricao da tela												 
//
oModel:SetDescription( PLS_TITULO )
//
// Valida o modelo															 
//
oModel:SetVldActivate( { |oModel| oPADC:MDActVLD(oModel) } )
//
// Fim da rotina															 
//
Return oModel
/*/


Ŀ
Funcao    PLSANALM   Autor  Totvs				    	 Data  30/03/10 
Ĵ
Descricao  Somente para compilar a class							  			
ٱ


/*/
Function PLSANALM
Return
