#INCLUDE 'restful.ch'
#Include "PROTHEUS.CH"
#Include "TOTVS.CH"
#Include 'tlpp-core.th'
#Include 'tlpp-rest.th'
#Include "FWLIBVERSION.CH"
//-------------------------------------------------------------------
/*/{Protheus.doc} PLSBeneficiaryPasswordRecoveryRequest

@author    Daniel Silva
@version   V12
@since     14/04/2021
/*/
class PLSBeneficiaryPasswordRecoveryRequest from CenRequest 

    public data oRest as object
    public data oJson as object
    public data oSvc as Object 


    public method New() 
    public method processa()
    public method getError()

endclass

//-------------------------------------------------------------------
/*/{Protheus.doc} New

@author    Daniel Silva
@version   V12
@since     14/04/2021
/*/
method New(oRest, lPortalOperadora) class PLSBeneficiaryPasswordRecoveryRequest 
    Default lPortalOperadora := .F.
    _Super:New(oRest,'')
    self:oSvc := PLSBeneficiaryPasswordRecoveryService():new(oRest,iif(self:checkBody(), self:jRequest, nil), lPortalOperadora)
return self

//-------------------------------------------------------------------
/*/{Protheus.doc} processa

@author    Daniel Silva
@version   V12
@since     08/03/2021
/*/

method processa() class PLSBeneficiaryPasswordRecoveryRequest

    self:oSvc:vldJson()
    self:oSvc:validBenefEMail()
    self:oSvc:generateNewPassword()
    self:oSvc:sendEmail()

    if self:oSvc:lSuccess
        self:lSuccess  := .T.
        self:cResponse := self:oSvc:getResult()
        self:nStatus   := self:oSvc:getStatusCode()
    else
        self:getError()
    endif

Return self:lSuccess

//-------------------------------------------------------------------
/*/{Protheus.doc} getError

@author    Daniel Silva
@version   V12
@since     08/03/2021
/*/

method getError() class PLSBeneficiaryPasswordRecoveryRequest

    oErrorAux         := self:oSvc:getError()
    self:lSuccess     := .F.
    self:nFault       := oErrorAux['status']
    self:nStatus      := oErrorAux['status']
    self:cFaultDesc   := oErrorAux['message']
    self:cFaultDetail := oErrorAux['detailedMessage']

return




