#INCLUDE 'protheus.ch'
#INCLUDE 'restful.ch'

//-------------------------------------------------------------------
/*/{Protheus.doc} PLSPacienteNoLocalRequest

@author    Daniel Silva
@version   V12
@since     14/04/2021
/*/
class PLSPacienteNoLocalRequest from CenRequest 

    public data cError 
    public data oRest as object
    public data oJson as object

    public method New(oRest) constructor
    public method get()
    public method valida()
    public method setGetError()

endclass

//-------------------------------------------------------------------
/*/{Protheus.doc} New

@author    Daniel Silva
@version   V12
@since     14/04/2021
/*/
method New(oRest) class PLSPacienteNoLocalRequest 
::oRest     := oRest
::cError    := ""
::oJson     := jsonObject():new()
_Super:New(oRest,'')
return self

//-------------------------------------------------------------------
/*/{Protheus.doc} get

@author    Daniel Silva
@version   V12
@since     14/04/2021
/*/
method get() class PLSPacienteNoLocalRequest
local oAppService   := nil
local cJson as Character

oAppService := PLSPacienteNoLocalService():new(::oRest)
lErro := oAppService:get()

cJson := '{"hasError": '+iif(lErro,'true','false')+','
cJson += '"message": "'+iif(lErro, 'Não foi possível indicar o paciente para a guia '+cvaltochar(::oRest:healthProviderCode), 'Paciente indicado com sucesso para a guia '+cvaltochar(::oRest:healthProviderCode))+'"}

::oRest:setResponse(cJson)

return .t.

//-------------------------------------------------------------------
/*/{Protheus.doc} valida

@author    Daniel Silva
@version   V12
@since     08/03/2021
/*/

method valida() class PLSPacienteNoLocalRequest
local lRet      := .t.

if empty(::oRest:healthProviderCode)
    ::cError := "Campo 'healthProviderCode' deve ser informado no QueryParm."
    lRet := .f.
endif

if lRet .and. empty(::oRest:codRda)
    ::cError := "Campo 'codRda' deve ser informado no QueryParm."
    lRet := .f.
endif

return lRet


method setGetError() class PLSPacienteNoLocalRequest

local cJson := ""

    cJson := '{"hasError": true,'
    cJson += '"message":"' + ::cError + '"}'
    ::oRest:setResponse(cJson)

return 



