#include "tlpp-core.th"
#include "tlpp-rest.th"
#include "distribution.convergencia.api.estoque.ch"

/*/{Protheus.doc} WMSSaasFinalizaInventario
    Servico de finalizacao do inventario (Criacao de fichas) via WMS SaaS
    @author Alexsander Burigo Corrêa
    @since 02/09/2024
    @version 1.0
    @obs Camada de API
    /*/
@Post("/wms/api/v2/estoque/finalizarInventario")
Function WMSSaasFinalizaInventario()
    Local oError
    Local oSuccess := WMSSaasRestFinish():new(@oRest)
    Local bError   := ErrorBlock( { |oError| WMSSaasErrorBlock( oError ) } )
    
    Begin Sequence
        oJsonBody   := WMSSaasparseBodyFromRest(oRest)
        WMSSaasEstoqueAdapter():finalizarInventario(oJsonBody)
        oSuccess:setStatus(200)
        oSuccess:setJsonResponse(STR0001) // Registro finalizado com sucesso.
	Recover using oKnownError
		SetRestFault(oKnownError:getStatus(),oKnownError:getDescription(),.T.,oKnownError:getStatus(),oKnownError:getDetailedMessage())
		Return .F.
	End Sequence

    ErrorBlock( bError )
Return

/*/{Protheus.doc} WMSSaasFinalizaMovimentoSimplificado
    Servico de finalizacao de movimentação simplificada via WMS SaaS
    @author Alexsander Burigo Corrêa
    @since 20/09/2024
    @version 1.0
    @obs Camada de API
    /*/
@Post("/wms/api/v2/estoque/finalizarMovimentacaoSimplificada")
Function WMSSaasFinalizaMovimentoSimplificado()
    Local oError
    Local oSuccess := WMSSaasRestFinish():new(@oRest)
    Local bError   := ErrorBlock( { |oError| WMSSaasErrorBlock( oError ) } )
    
    Begin Sequence
        oJsonBody   := WMSSaasparseBodyFromRest(oRest)
        WMSSaasEstoqueAdapter():finalizarMovimentoSimplificado(oJsonBody)
        oSuccess:setStatus(200)
        oSuccess:setJsonResponse(STR0001) // Registro finalizado com sucesso.
	Recover using oKnownError
		SetRestFault(oKnownError:getStatus(),oKnownError:getDescription(),.T.,oKnownError:getStatus(),oKnownError:getDetailedMessage())
		Return .F.
	End Sequence

    ErrorBlock( bError )
Return

/*/{Protheus.doc} WMSSaasFinalizaMovimentoTransferencia
    Servico de finalizacao do movimento de estoque por tipo de estoque via WMS SaaS
    @author Alexsander Burigo Corrêa
    @since 01/10/2024
    @version 1.0
    @obs Camada de API
    /*/
@Post("/wms/api/v2/estoque/finalizarAlteracaoEstoque")
Function WMSSaasFinalizaMovimentoTransferencia()
    Local oError
    Local oSuccess := WMSSaasRestFinish():new(@oRest)
    Local bError   := ErrorBlock( { |oError| WMSSaasErrorBlock( oError ) } )
    
    Begin Sequence
        oJsonBody   := WMSSaasparseBodyFromRest(oRest)
        WMSSaasEstoqueAdapter():finalizarMovimentoTransferencia(oJsonBody)
        oSuccess:setStatus(200)
        oSuccess:setJsonResponse(STR0001) // Registro finalizado com sucesso.
	Recover using oKnownError
		SetRestFault(oKnownError:getStatus(),oKnownError:getDescription(),.T.,oKnownError:getStatus(),oKnownError:getDetailedMessage())
		Return .F.
	End Sequence

    ErrorBlock( bError )
Return
