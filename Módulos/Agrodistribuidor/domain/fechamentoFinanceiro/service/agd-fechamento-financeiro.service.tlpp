#include 'totvs.ch'
#include 'tlpp-core.th'

namespace agd.fechamentoFinanceiroService
using namespace agd.fechamentoFinanceiroRepository /*shortCurt de funcao*/
using namespace agd.utilsService

/*/{Protheus.doc} agdFechamentoFinanceiroService
Servico de Fechamentos Financeiros Barter
@type class
@version 12
@author jean.schulze
@since 14/01/2025
/*/ 
class agdFechamentoFinanceiroService FROM agdUtilsService

	public method new()

	public method listar()
	public method buscarPorId()
	public method registrar()
	public method atualizar()
	public method excluir()
	public method verificaAlteracaoModelo()

endclass

/*/{Protheus.doc} new
Constructor
@type method
@version 12
@author jean.schulze
@since 14/01/2025
@return variant, instância
/*/
method new() class agdFechamentoFinanceiroService
	_Super:New()
return Self

/*/{Protheus.doc} listar
Listar Negócio
@type method
@version 12
@author jean.schulze
@since 14/01/2025
@param nPage, numeric, pagina
@param nPageSize, numeric, tamanho pagina
@param oJsonQryParam, object, query param
@param oJsonPathParam, object, path param
@return variant, nil
/*/
method listar(nPage, nPageSize, oJsonQryParam) class agdFechamentoFinanceiroService
	Local oRepository As Object
	Default nPage     := 1
	Default nPageSize := 10
	Default oJsonQryParam := nil

	oRepository := agdFechamentoFinanceiroRepository():New()
	oRepository:find(nPage, nPageSize, oJsonQryParam)

	Self:setFullResponse(oRepository)

	oRepository:DeActivate()
	FreeObj(oRepository)
Return nil


/*/{Protheus.doc} buscarPorId
Buscar Por Id Unico
@type method
@version 12
@author jean.schulze
@since 14/01/2025
@param cCodigo, character, id unico
@return variant, nil
/*/
method buscarPorId(cCodigo) class agdFechamentoFinanceiroService
	Local oRepository As object
	Local oResponseMerge     As object

	oRepository := agdFechamentoFinanceiroRepository():New()
	oRepository:findById(oRepository:getFilterById(cCodigo)) 

	oResponseMerge := oRepository:getResponse()

	Self:setFullResponse(oRepository)

	oRepository:DeActivate()
	FreeObj(oRepository)	
return nil

/*/{Protheus.doc} agdFechamentoFinanceiroService::registrar
Registra fechamento financeiro
@type method
@version 12
@author jc.maldonado
@since 04/06/2025
@param jPayload, json, payload do fechamento financeiro
/*/
method registrar(jPayload as json) class agdFechamentoFinanceiroService
	local oAGDFechaFinRepo as object

	oAGDFechaFinRepo := agdFechamentoFinanceiroRepository():New()
	oAGDFechaFinRepo:save(jPayload) 

	::setFullResponse(oAGDFechaFinRepo)

	oAGDFechaFinRepo:DeActivate()
	FWFreeObj(oAGDFechaFinRepo)
return

/*/{Protheus.doc} agdFechamentoFinanceiroService::excluir
Exclui fechamento financeiro
@type method
@version 12
@author jc.maldonado
@since 21/05/2025
@param cChave, character, filial + codigo_fechamento
/*/
method excluir(cChave as character) class agdFechamentoFinanceiroService
	local oAGDFechaFinRepo as object

	oAGDFechaFinRepo := agdFechamentoFinanceiroRepository():New(cChave)
	oAGDFechaFinRepo:delete() 

	::setFullResponse(oAGDFechaFinRepo)

	oAGDFechaFinRepo:DeActivate()
	FWFreeObj(oAGDFechaFinRepo)
return

/*/{Protheus.doc} modeloPermiteEdicao
Checa se o modelo do fechamento financeiro permite edição
@type method
@version 12
@since 05/08/2025
@author carlos.augusto
@param cCodBarter, character, código da negociação
*/
method verificaAlteracaoModelo(cChave as character) class agdFechamentoFinanceiroService
	Local oRepository As Object

	oRepository := agdFechamentoFinanceiroRepository():New(cChave)
	oRepository:isRepositoryChange()
	Self:setFullResponse(oRepository)

	oRepository:DeActivate()
	FreeObj(oRepository)
return Nil

method atualizar(cChave as Character, jPayload as json) class agdFechamentoFinanceiroService
	Local oRepository As Object

	oRepository := agdFechamentoFinanceiroRepository():New(cChave)
	oRepository:save(jPayload, .T.)
	Self:setFullResponse(oRepository)

	oRepository:DeActivate()
	FreeObj(oRepository)
	
return nil
