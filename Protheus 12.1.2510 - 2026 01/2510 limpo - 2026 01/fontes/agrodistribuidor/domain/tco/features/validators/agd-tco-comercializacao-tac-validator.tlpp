#include 'tlpp-core.th'
#include 'agd.tco.comercializacao.tac.validator.ch'

namespace agd.tcoComercializacaoTACValidator

/*/{Protheus.doc} agdTCOcomercializacaoTACValidator
Classe de validações da Feature Comercialização TACC
@type class
@version 12
@author jc.maldonado
@since 12/12/2025
/*/
Class agdTCOcomercializacaoTACValidator
    private data cErrorMsg as character

	public method new()
	public method validateDeParaInsert() as logical
    public method getErrorMsg()          as character

    private method setErrorMsg()
EndClass

/*/{Protheus.doc} agdTCOcomercializacaoTACValidator::new
Constructor
@type method
@version 12
@author jc.maldonado
@since 12/12/2025
@return object, Instância da classe
/*/
method new() class agdTCOcomercializacaoTACValidator
    ::cErrorMsg := ""
return Self

/*/{Protheus.doc} agdTCOcomercializacaoTACValidator::validateDeParaInsert
Valida a inserção de um de-para
@type method
@version 12
@author jc.maldonado
@since 12/12/2025
@param cReferencia, character, codigo referencia
@param Alias, character, alias
@param cCampo, character, campo
@param cInternalID, character, Id interno
@return logical, Resultado da validação
/*/
method validateDeParaInsert(cAlias as character, cCampo as character, cInternalID as character) as logical Class agdTCOcomercializacaoTACValidator
    local oTACCdto    as object
    local cReferencia as character
    local cExternalId as character
    
    oTACCdto    := agdTCOComercializacaoTACDTO():New()
    cReferencia := oTACCdto:getIdentificaoIntegracao()
    FWFreeObj(oTACCdto)

    if cAlias == "SF4"
        if ! empty(cExternalId := rTrim(CFGA070Ext(cReferencia, cAlias, cCampo, cInternalID)))
            ::setErrorMsg(STR0001 + "'" + rTrim(cInternalID) + "'" + STR0002 + "'" + cExternalId + "'") //"O código TES XXX já está vinculado ao código externo XXX"
            return .f.
        endif
    endIf
return .t.

/*/{Protheus.doc} agdTCOcomercializacaoTACValidator::setErrorMsg
Define a mensagem de erro
@type method
@version 12
@author jc.maldonado
@since 12/12/2025
/*/
method setErrorMsg(cMsg as character) Class agdTCOcomercializacaoTACValidator
    ::cErrorMsg := cMsg
return

/*/{Protheus.doc} agdTCOcomercializacaoTACValidator::getErrorMsg
Retorna a mensagem de erro
@type method
@version 12
@author jc.maldonado
@since 12/12/2025
@return character, Mensagem de erro
/*/
method getErrorMsg() as character Class agdTCOcomercializacaoTACValidator
return ::cErrorMsg
