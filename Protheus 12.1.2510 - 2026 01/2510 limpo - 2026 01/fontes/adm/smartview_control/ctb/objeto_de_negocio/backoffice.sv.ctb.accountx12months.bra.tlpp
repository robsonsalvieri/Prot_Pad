
#include "totvs.ch"
#include "msobject.ch"
#include "totvs.framework.treports.integratedprovider.th"
#include "tlpp-core.th"
#include "tlpp-rest.th"
#include "backoffice.sv.ctb.accountx12months.bra.ch"

namespace totvs.protheus.ctb.smartviewintegratedprovider
using namespace control.sv.functions.utils

@totvsFrameworkTReportsIntegratedProvider(active=.T., team="SIGACTB", tables="CT1, CT7", name="Conta X 12 Meses", country="ALL")

//-------------------------------------------------------------------------------
/*{Protheus.doc} Accountx12MonthsSmartViewBusinessObject
Classe paara a criação do Objeto de Negócio do Balancete Conta X 12 Meses
para o TReports
 
@author Renan Gremes
@since 09/11/2023
@version 1.0
*/
//-------------------------------------------------------------------------------

class Accountx12MonthsSmartViewBusinessObject from totvs.protheus.ctb.smartviewintegratedprovider.SmartViewCtGerComp
    public method new()                    as object 
    public method getAreas()               as array
    public method getDescription()         as character
    public method getCtGerCompData()       as object //Carregado na classe pai
    public method getCtGerCompSchema()     as object //Carregado na classe pai

    //usados na internacionalização
    public method preData()                as object
    public method preSchema()              as object
    public method processData()            as json
    
    public method handleCtGerCompParams() //carrega os parametros
    public method handleCtGerCompAppend()  as object //Executado na classe pai
    public method handleExeCtGerComp()     as object //Executado na classe pai
    public method ExecDBSkipTemp()         as logical
    public method processCustomData()      as json

    protected data nAcumColuna1 as numeric
    protected data nAcumColuna2 as numeric
    protected data nAcumColuna3 as numeric
    protected data nAcumColuna4 as numeric
    protected data nAcumColuna5 as numeric
    protected data nAcumColuna6 as numeric
    protected data nAcumColuna7 as numeric
    protected data nAcumColuna8 as numeric
    protected data nAcumColuna9 as numeric
    protected data nAcumColuna10 as numeric
    protected data nAcumColuna11 as numeric
    protected data nAcumColuna12 as numeric

    protected data nAcumGrpColuna1 as numeric
    protected data nAcumGrpColuna2 as numeric
    protected data nAcumGrpColuna3 as numeric
    protected data nAcumGrpColuna4 as numeric
    protected data nAcumGrpColuna5 as numeric
    protected data nAcumGrpColuna6 as numeric
    protected data nAcumGrpColuna7 as numeric
    protected data nAcumGrpColuna8 as numeric
    protected data nAcumGrpColuna9 as numeric
    protected data nAcumGrpColuna10 as numeric
    protected data nAcumGrpColuna11 as numeric
    protected data nAcumGrpColuna12 as numeric

    protected data aTamVal as array
    protected data cGrupoBkp as character
endclass

//-------------------------------------------------------------------
/*{Protheus.doc} new
Método de instância da classe
 
@return object: self
 
@author Renan Gremes
@since 09/11/2023
@version 1.0
*/
//------------------------------------------------------------------- 

method new() as object class Accountx12MonthsSmartViewBusinessObject

    _Super:new()

    //Define o nome do Objeto de Negócio
    self:setDisplayName(STR0001) //"Conta X 12 Meses"
    self:setPergunte("CTR265") //Indica o pergunte que será utilizado no relatório

    ::nAcumColuna1  := 0
    ::nAcumColuna2  := 0
    ::nAcumColuna3  := 0
    ::nAcumColuna4  := 0
    ::nAcumColuna5  := 0
    ::nAcumColuna6  := 0
    ::nAcumColuna7  := 0
    ::nAcumColuna8  := 0
    ::nAcumColuna9  := 0
    ::nAcumColuna10 := 0
    ::nAcumColuna11 := 0
    ::nAcumColuna12 := 0

    ::nAcumGrpColuna1  := 0
    ::nAcumGrpColuna2  := 0
    ::nAcumGrpColuna3  := 0
    ::nAcumGrpColuna4  := 0
    ::nAcumGrpColuna5  := 0
    ::nAcumGrpColuna6  := 0
    ::nAcumGrpColuna7  := 0
    ::nAcumGrpColuna8  := 0
    ::nAcumGrpColuna9  := 0
    ::nAcumGrpColuna10 := 0
    ::nAcumGrpColuna11 := 0
    ::nAcumGrpColuna12 := 0

    ::aTamVal := TAMSX3("CT2_VALOR")
    ::cGrupoBkp := ""

return self

//-------------------------------------------------------------------
/*{Protheus.doc} getDescription
Método de instância da classe
 
@return object: string
 
@author Renan Gremes
@since 09/11/2023
@version 12.1.2310
*/
//------------------------------------------------------------------- 

method getDescription() as character class Accountx12MonthsSmartViewBusinessObject
return STR0002  //"Objeto contendo informações sobre o relatorio de Conta X 12 Meses"

//-------------------------------------------------------------------
/*{Protheus.doc} getAreas
Método de instância da classe
 
@return object: string
 
@author Renan Gremes
@since 09/11/2023
@version 1.0
*/
//------------------------------------------------------------------- 

method getAreas() as array class Accountx12MonthsSmartViewBusinessObject
return {STR0003} //"Contabilidade"

//-------------------------------------------------------------------
/*/{Protheus.doc} preSchema
    Metodo que será consumido pelo M.I.

    @author Renan Gremes
    @since 09/11/2023
    @version 12.1.2310
/*/
//-------------------------------------------------------------------

method preSchema() as object class Accountx12MonthsSmartViewBusinessObject
return self:oSchema

//-------------------------------------------------------------------
/*/{Protheus.doc} preData
    Metodo que será consumido pelo M.I.
    AJusta o Json conforme alteração no processData e preSchema

    @author Renan Gremes
    @since 09/11/2023
    @version 12.1.2310
/*/
//-------------------------------------------------------------------

method preData() as object class Accountx12MonthsSmartViewBusinessObject    
return self:oData

//-------------------------------------------------------------------
/*/{Protheus.doc} processData
    Metodo que será consumido pelo M.I.
    Será usado para alterar a Query antes do getData.

    @author Renan Gremes
    @since 09/11/2023
    @version 12.1.2310
/*/
//-------------------------------------------------------------------

method processData() as json class Accountx12MonthsSmartViewBusinessObject
return ::jItens

//-------------------------------------------------------------------
/*{Protheus.doc} getCtGerCompData
Retorna os dados do objeto de negócio
 
@param nPage, numérico, indica a página atual do relatório
@param oFilter, objeto, contém o filtro do TReports
 
@return object: self:oData
 
@author Renan Gremes
@since 09/11/2023
@version 1.0
*/
//-------------------------------------------------------------------

method getCtGerCompData(nPage as numeric, oFilter as object) as object class Accountx12MonthsSmartViewBusinessObject
    //Carrega lista de parametros para a memória
    CTBsetValueMVPAR(oFilter:getParameters(), "CTR265")

    self:handleCtGerCompParams(oFilter)

    //Elimina da memória a instância do objeto informado como parâmetro.
    FreeObj(oFilter:getParameters())
    
return self:oData

//-------------------------------------------------------------------
/*{Protheus.doc} getCtGerCompSchema
Prepara a estrutura dos campos
 
@return array: array com a estrutura dos campos
 
@author Renan Gremes
@since 09/11/2023
@version 1.0
*/
//-------------------------------------------------------------------

method getCtGerCompSchema() as object class Accountx12MonthsSmartViewBusinessObject
    self:oSchema:addProperty("NomeEmpresa"  ,STR0004 , "string", STR0004, "NomeEmpresa" ,,,,.F. ) //"Nome Empresa"
    self:oSchema:addProperty("NomeFilial"   ,STR0005 , "string", STR0005, "NomeFilial"  ,,,,.F. ) //"Nome Filial"
    self:oSchema:addProperty("TOTALPERIODO" ,STR0006 , "string", STR0006, "TOTALPERIODO",,,,.F. ) //"Total Período"

    //Totais acumulados período
    self:oSchema:addProperty("ACUMCOL01" ,STR0007 , "string", STR0007, "ACUMCOL01",,,,.F. )  //"Valor Acum. Per. Col. 1"
    self:oSchema:addProperty("ACUMCOL02" ,STR0008 , "string", STR0008, "ACUMCOL02",,,,.F. )  //"Valor Acum. Per. Col. 2"
    self:oSchema:addProperty("ACUMCOL03" ,STR0009 , "string", STR0009, "ACUMCOL03",,,,.F. )  //"Valor Acum. Per. Col. 3"
    self:oSchema:addProperty("ACUMCOL04" ,STR0010 , "string", STR0010, "ACUMCOL04",,,,.F. )  //"Valor Acum. Per. Col. 4"
    self:oSchema:addProperty("ACUMCOL05" ,STR0011 , "string", STR0011, "ACUMCOL05",,,,.F. )  //"Valor Acum. Per. Col. 5"
    self:oSchema:addProperty("ACUMCOL06" ,STR0012 , "string", STR0012, "ACUMCOL06",,,,.F. )  //"Valor Acum. Per. Col. 6"
    self:oSchema:addProperty("ACUMCOL07" ,STR0013 , "string", STR0013, "ACUMCOL07",,,,.F. )  //"Valor Acum. Per. Col. 7"
    self:oSchema:addProperty("ACUMCOL08" ,STR0014 , "string", STR0014, "ACUMCOL08",,,,.F. )  //"Valor Acum. Per. Col. 8"
    self:oSchema:addProperty("ACUMCOL09" ,STR0015 , "string", STR0015, "ACUMCOL09",,,,.F. )  //"Valor Acum. Per. Col. 9"
    self:oSchema:addProperty("ACUMCOL10" ,STR0016 , "string", STR0016, "ACUMCOL10",,,,.F. )  //"Valor Acum. Per. Col. 10"
    self:oSchema:addProperty("ACUMCOL11" ,STR0017 , "string", STR0017, "ACUMCOL11",,,,.F. )  //"Valor Acum. Per. Col. 11"
    self:oSchema:addProperty("ACUMCOL12" ,STR0018 , "string", STR0018, "ACUMCOL12",,,,.F. )  //"Valor Acum. Per. Col. 12"
    self:oSchema:addProperty("TOTACUMPER",STR0031 , "string", STR0031, "TOTACUMPER",,,,.F.)  //"Valor Total Acum. Per."

    //Totais acumulados por grupo
    self:oSchema:addProperty("ACUMGRPCOL01" ,STR0019 , "string", STR0019, "ACUMGRPCOL01",,,,.F. )  //"Valor Acum. Grp. Col. 1"
    self:oSchema:addProperty("ACUMGRPCOL02" ,STR0020 , "string", STR0020, "ACUMGRPCOL02",,,,.F. )  //"Valor Acum. Grp. Col. 2"
    self:oSchema:addProperty("ACUMGRPCOL03" ,STR0021 , "string", STR0021, "ACUMGRPCOL03",,,,.F. )  //"Valor Acum. Grp. Col. 3"
    self:oSchema:addProperty("ACUMGRPCOL04" ,STR0022 , "string", STR0022, "ACUMGRPCOL04",,,,.F. )  //"Valor Acum. Grp. Col. 4"
    self:oSchema:addProperty("ACUMGRPCOL05" ,STR0023 , "string", STR0023, "ACUMGRPCOL05",,,,.F. )  //"Valor Acum. Grp. Col. 5"
    self:oSchema:addProperty("ACUMGRPCOL06" ,STR0024 , "string", STR0024, "ACUMGRPCOL06",,,,.F. )  //"Valor Acum. Grp. Col. 6"
    self:oSchema:addProperty("ACUMGRPCOL07" ,STR0025 , "string", STR0025, "ACUMGRPCOL07",,,,.F. )  //"Valor Acum. Grp. Col. 7"
    self:oSchema:addProperty("ACUMGRPCOL08" ,STR0026 , "string", STR0026, "ACUMGRPCOL08",,,,.F. )  //"Valor Acum. Grp. Col. 8"
    self:oSchema:addProperty("ACUMGRPCOL09" ,STR0027 , "string", STR0027, "ACUMGRPCOL09",,,,.F. )  //"Valor Acum. Grp. Col. 9"
    self:oSchema:addProperty("ACUMGRPCOL10" ,STR0028 , "string", STR0028, "ACUMGRPCOL10",,,,.F. )  //"Valor Acum. Grp. Col. 10"
    self:oSchema:addProperty("ACUMGRPCOL11" ,STR0029 , "string", STR0029, "ACUMGRPCOL11",,,,.F. )  //"Valor Acum. Grp. Col. 11"
    self:oSchema:addProperty("ACUMGRPCOL12" ,STR0030 , "string", STR0030, "ACUMGRPCOL12",,,,.F. )  //"Valor Acum. Grp. Col. 12"
    self:oSchema:addProperty("TOTACUMGRP"   ,STR0032 , "string", STR0032, "TOTACUMGRP",,,,.F.   )  //"Valor Total Acum. Grp."
return self:oSchema

//-------------------------------------------------------------------
/*{Protheus.doc} handleCtGerCompParams
Define para os atributos conforme parâmetros informados

@param oFilter, objeto, contém o filtro do TReports
 
@author Renan Gremes
@since 09/11/2023
@version 1.0
*/
//-------------------------------------------------------------------

method handleCtGerCompParams( oFilter as object ) class Accountx12MonthsSmartViewBusinessObject    
    Local cAlias      := "CT7"                                      as character
    Local cIdent      := ""                                         as character

    Local dDataIni    := MV_PAR01                                   as date
    Local dDataFim    := MV_PAR02                                   as date
    Local cContaIni   := MV_PAR03                                   as character
    Local cContaFim   := MV_PAR04                                   as character
       
    Local lImpSint    := iif(MV_PAR05 == 1 .OR. MV_PAR05 == 3, .T., .F.)  as logical
    Local aSetOfBook  := iif(!empty(MV_PAR06), CTBSetOf(MV_PAR06), CTBSetOf("")) as array
    Local lVlrZerado  := iif(MV_PAR07==1,.T.,.F.)                   as logical
    Local cMoeda      := iif(Empty(MV_PAR08), "01", MV_PAR08)       as character 
    Local cSaldos     := iif(Empty(MV_PAR10), "1", MV_PAR10)        as character
    Local nGrupo      := MV_PAR11                                   as numeric
    Local cSegmento   := MV_PAR12                                   as character
    Local cSegIni     := MV_PAR13                                   as character
    Local cSegFim     := MV_PAR14                                   as character
    Local cFiltSegm   := MV_PAR15                                   as character
    Local lPrintZero  := iif(MV_PAR17 == 1, .T., .F.)               as logical
    Local lImpAntLP   := iif(MV_PAR21 == 1, .T., .F.)               as logical
    Local dDataLP     := MV_PAR22                                   as date
    Local cTpComp     := iif( MV_PAR25 == 1, "M", "S" )	            as character

    //Variaveis fixas no relatorio 
    Local lMeses      := .T.                                        as logical
    Local aMeses      := ::aMeses                                   as array
    Local cHeader     := ""                                         as character
    Local lNImpMov    := .F.                                        as logical
    Local cString     := "CT1"                                      as character
    Local aFilAux     := {}                                         as array
    Local lExercicio  := .T.                                        as logical
    Local lZeradas    := .F.                                        as logical

    If MV_PAR25 == 2
	    cHeader := "SLD"		// Indica que deverá obter o saldo na 1ª coluna (Comparativo de Saldo Acumulado)
	    MV_PAR23 := 2			// NÃO DEVE TOTALIZAR (O ULTIMO PERIODO É A POSICAO FINAL)
    Endif

    If MV_PAR19 == 2			// Divide por cem
	    nDivide := 100
    ElseIf MV_PAR19 == 3		// Divide por mil
        nDivide := 1000
    ElseIf MV_PAR19 == 4		// Divide por milhao
        nDivide := 1000000
    Else
        nDivide := 1       
    EndIf	
    
    If Len(aMeses) < 1
        AADD(aMeses,{StrZero(Month(MV_PAR01),2),MV_PAR01,MV_PAR02,MesExtenso(Month(MV_PAR01))})	
    EndIf

    //setar os parametros da classe CtGerComp conforme os MV_PARxx
    self:cAlias      := cAlias
    self:cIdent      := cIdent
    self:dDataIni    := dDataIni
    self:dDataFim    := dDataFim
    self:cContaIni   := cContaIni
    self:cContaFim   := cContaFim
    self:lImpSint    := lImpSint
    self:aSetOfBook  := aSetOfBook
    self:cMoeda      := cMoeda
    self:lVlrZerado  := lVlrZerado  //Tratado na impressão antigo R4  
    self:cSaldos     := cSaldos
    self:cSegmento   := cSegmento
    self:cSegIni     := cSegIni
    self:cSegFim     := cSegFim
    self:cFiltSegm   := cFiltSegm
    self:lPrintZero  := lPrintZero
    self:lImpConta   := .F.         //FIXO MV_PAR20 - tratado na seção antigo R4
    self:nDivide     := nDivide
    self:lImpAntLP   := lImpAntLP
    self:dDataLP     := dDataLP
    self:cTpVlr      := cTpComp
    self:nGrupo      := nGrupo
    self:lMeses      := lMeses
    self:aMeses      := aMeses
    self:cHeader     := cHeader
    self:lNImpMov    := lNImpMov
    self:lImpTotS    := .F.
    self:cString     := cString

    //Utilizadas no metodo CTBPERIODOS para preencher o aMeses, verificar conforme relatorio seu valor
    self:lExercicio :=  lExercicio
    self:lZeradas   :=  lZeradas
    self:lFiliais    := .F. 
    self:aFiliais    := aFilAux

return

//-------------------------------------------------------------------
/*{Protheus.doc} handleCtGerCompAppend
Método para execução do append

@param oFilter, objeto, contém o filtro do TReports
 
@return object: self:oData
 
@author Renan Gremes
@since 09/11/2023
@version 1.0
*/
//-------------------------------------------------------------------

method handleCtGerCompAppend(oFilter as object) as object class Accountx12MonthsSmartViewBusinessObject
    //execucao do Append
return self:oData

//-------------------------------------------------------------------
/*{Protheus.doc} handleExeCtGerComp
Método para execução do CTGERCOMP

@param oFilter, objeto, contém o filtro do TReports
 
@return object: self:oData
 
@author Renan Gremes
@since 09/11/2023
@version 1.0
*/
//-------------------------------------------------------------------

method handleExeCtGerComp(oFilter as object) as object class Accountx12MonthsSmartViewBusinessObject
    //execucao da CtGerComp
return self:oData

//-------------------------------------------------------------------
/*{Protheus.doc} processCustomData
Método de instância da classe
 
@return object: string
 
@author Renan Gremes
@since 09/11/2023
@version 1.0
*/
//------------------------------------------------------------------- 

method processCustomData() as json class Accountx12MonthsSmartViewBusinessObject
    Local cPicture  := ""  as character
    Local cNormal   := ""  as character
    Local cGrupoBkp := "" as character
    Local lSoma     := .F. as logical
    Local nDecimais       as numeric

    cPicture  := Iif(!Empty(::aSetOfBook[4]),"@E 999,999,999,999.99","")
    nDecimais := DecimalCTB(::aSetOfBook,::cMoeda)
    cNormal   := cArqTmp->NORMAL
    cGrupoBkp := cArqTMP->GRUPO

    ::JItens["NomeEmpresa"]  := self:cCompanyName
    ::JItens["NomeFilial" ]  := self:cBranchName

    ::JItens["TOTALPERIODO"] := ValorCTB(cArqTmp->(COLUNA1+COLUNA2+COLUNA3+;
	                                              COLUNA4+COLUNA5+COLUNA6+;
	                                              COLUNA7+COLUNA8+COLUNA9+;
	                                              COLUNA10+COLUNA11+COLUNA12),,,20-2,nDecimais,.T.,cPicture,cNormal, , , , , ,::lPrintZero,.F.)
    
    //Validação para realizar a soma dos acumulados
    If cArqTmp->TIPOCONTA == "1"
        If MV_PAR05 <> 1
            lSoma := .F.
        Else
            If cArqTmp->NIVEL1
                lSoma := .T.
            Else
                lSoma := .F.
            EndIf
        EndIf
    Else
        lSoma := .T.
    EndIf

    ::nAcumColuna1  += iif(lSoma, cArqTmp->COLUNA1,  0)
    ::nAcumColuna2  += iif(lSoma, cArqTmp->COLUNA2,  0)
    ::nAcumColuna3  += iif(lSoma, cArqTmp->COLUNA3,  0)
    ::nAcumColuna4  += iif(lSoma, cArqTmp->COLUNA4,  0)
    ::nAcumColuna5  += iif(lSoma, cArqTmp->COLUNA5,  0)
    ::nAcumColuna6  += iif(lSoma, cArqTmp->COLUNA6,  0)
    ::nAcumColuna7  += iif(lSoma, cArqTmp->COLUNA7,  0)
    ::nAcumColuna8  += iif(lSoma, cArqTmp->COLUNA8,  0)
    ::nAcumColuna9  += iif(lSoma, cArqTmp->COLUNA9,  0)
    ::nAcumColuna10 += iif(lSoma, cArqTmp->COLUNA10, 0)
    ::nAcumColuna11 += iif(lSoma, cArqTmp->COLUNA11, 0)
    ::nAcumColuna12 += iif(lSoma, cArqTmp->COLUNA12, 0)

    ::JItens["ACUMCOL01"]  := ValorCTB(::nAcumColuna1 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL02"]  := ValorCTB(::nAcumColuna2 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL03"]  := ValorCTB(::nAcumColuna3 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL04"]  := ValorCTB(::nAcumColuna4 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL05"]  := ValorCTB(::nAcumColuna5 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL06"]  := ValorCTB(::nAcumColuna6 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL07"]  := ValorCTB(::nAcumColuna7 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL08"]  := ValorCTB(::nAcumColuna8 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL09"]  := ValorCTB(::nAcumColuna9 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL10"]  := ValorCTB(::nAcumColuna10,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL11"]  := ValorCTB(::nAcumColuna11,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMCOL12"]  := ValorCTB(::nAcumColuna12,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["TOTACUMPER"] := ValorCTB(::nAcumColuna1+::nAcumColuna2+::nAcumColuna3+::nAcumColuna4+::nAcumColuna5+::nAcumColuna6+;
	                                   ::nAcumColuna7+::nAcumColuna8+::nAcumColuna9+::nAcumColuna10+::nAcumColuna11+::nAcumColuna12;
                                       ,,,20-2,nDecimais,.T.,cPicture,cNormal, , , , , ,::lPrintZero,.F.)


    ::nAcumGrpColuna1  += iif(lSoma, cArqTmp->COLUNA1,  0)
    ::nAcumGrpColuna2  += iif(lSoma, cArqTmp->COLUNA2,  0)
    ::nAcumGrpColuna3  += iif(lSoma, cArqTmp->COLUNA3,  0)
    ::nAcumGrpColuna4  += iif(lSoma, cArqTmp->COLUNA4,  0)
    ::nAcumGrpColuna5  += iif(lSoma, cArqTmp->COLUNA5,  0)
    ::nAcumGrpColuna6  += iif(lSoma, cArqTmp->COLUNA6,  0)
    ::nAcumGrpColuna7  += iif(lSoma, cArqTmp->COLUNA7,  0)
    ::nAcumGrpColuna8  += iif(lSoma, cArqTmp->COLUNA8,  0)
    ::nAcumGrpColuna9  += iif(lSoma, cArqTmp->COLUNA9,  0)
    ::nAcumGrpColuna10 += iif(lSoma, cArqTmp->COLUNA10, 0)
    ::nAcumGrpColuna11 += iif(lSoma, cArqTmp->COLUNA11, 0)
    ::nAcumGrpColuna12 += iif(lSoma, cArqTmp->COLUNA12, 0)

    ::JItens["ACUMGRPCOL01"] := ValorCTB(::nAcumGrpColuna1 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL02"] := ValorCTB(::nAcumGrpColuna2 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL03"] := ValorCTB(::nAcumGrpColuna3 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL04"] := ValorCTB(::nAcumGrpColuna4 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL05"] := ValorCTB(::nAcumGrpColuna5 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL06"] := ValorCTB(::nAcumGrpColuna6 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL07"] := ValorCTB(::nAcumGrpColuna7 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL08"] := ValorCTB(::nAcumGrpColuna8 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL09"] := ValorCTB(::nAcumGrpColuna9 ,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL10"] := ValorCTB(::nAcumGrpColuna10,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL11"] := ValorCTB(::nAcumGrpColuna11,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["ACUMGRPCOL12"] := ValorCTB(::nAcumGrpColuna12,,,::aTamVal[1],nDecimais,.T.,cPicture,"", , , , , ,::lPrintZero,.F.)
    ::JItens["TOTACUMGRP"]   := ValorCTB(::nAcumGrpColuna1+::nAcumGrpColuna2+::nAcumGrpColuna3+::nAcumGrpColuna4+::nAcumGrpColuna5+::nAcumGrpColuna6+;
                                         ::nAcumGrpColuna7+::nAcumGrpColuna8+::nAcumGrpColuna9+::nAcumGrpColuna10+::nAcumGrpColuna11+::nAcumGrpColuna12;
                                         ,,,20-2,nDecimais,.T.,cPicture,cNormal, , , , , ,::lPrintZero,.F.)

    //Pula registro para validar se trocou o grupo
    cArqTmp->(DbSkip())

    //Se trocou grupo, appenda os valores e reseta as variaveis
    If cGrupoBkp <> cArqTMP->GRUPO
        ::nAcumGrpColuna1  := 0
        ::nAcumGrpColuna2  := 0
        ::nAcumGrpColuna3  := 0
        ::nAcumGrpColuna4  := 0
        ::nAcumGrpColuna5  := 0
        ::nAcumGrpColuna6  := 0
        ::nAcumGrpColuna7  := 0
        ::nAcumGrpColuna8  := 0
        ::nAcumGrpColuna9  := 0
        ::nAcumGrpColuna10 := 0
        ::nAcumGrpColuna11 := 0
        ::nAcumGrpColuna12 := 0
    EndIf

    //Volta registro pulado
    cArqTmp->(DbSkip(-1))

return

//-------------------------------------------------------------------
/*{Protheus.doc} ExecDBSkipTemp
Se .T., pula registros de acordo com as validações do método
 
@return lógico: lRet
 
@author Renan Gremes
@since 25/11/2024
@version 1.0
*/
//-------------------------------------------------------------------

method ExecDBSkipTemp(cArqTmp As character) as logical class Accountx12MonthsSmartViewBusinessObject
   
    local lRet := .F. as logical
    
    if MV_PAR05 == 1        // Apenas sinteticas
        lRet := !(cArqTmp->TIPOCONTA == "1")
    elseif MV_PAR05 == 2    // Apenas analiticas
        lRet := !(cArqTmp->TIPOCONTA == "2")
    endif

return lRet
