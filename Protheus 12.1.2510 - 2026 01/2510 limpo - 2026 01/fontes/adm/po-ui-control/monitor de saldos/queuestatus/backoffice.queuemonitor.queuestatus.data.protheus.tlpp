#include "tlpp-core.th"

namespace totvs.protheus.backoffice.queuemonitor.queuestatus

//-------------------------------------------------------------------
/*/{Protheus.doc} QueueStatusProtheusData
Classe responsável pela consulta de dados

@author Totvs
/*/
//-------------------------------------------------------------------
class QueueStatusProtheusData from FWAdapterBaseV2
    Public method new()
    Public method getAll()
    static method getData() As object
endclass

//-------------------------------------------------------------------
/*/{Protheus.doc} QueueStatusProtheusData
Metodo construtor

@author Totvs
/*/
//-------------------------------------------------------------------
method new(cVerbo as Character, lList as Logical) Class QueueStatusProtheusData
    Default cVerbo := "GET"
    Default lList  := .T.
    _Super:New(cVerbo, lList)
return

//-------------------------------------------------------------------
/*/{Protheus.doc} QueueStatusProtheusData
Método para chamada e validação do tratamento de dados

@author Totvs
/*/
//-------------------------------------------------------------------
method getData() class QueueStatusProtheusData As Object
    static __oActiveData As Object

    If ValType(__oActiveData) == "U"
        __oActiveData := QueueStatusProtheusData():new()
    EndIf
return __oActiveData

//-------------------------------------------------------------------
/*/{Protheus.doc} getAll
Metodo responsável pela busca das configuracoes do conciliador

@author Totvs
/*/
//-------------------------------------------------------------------
method getAll() class QueueStatusProtheusData
    Local cQuery As Character
    Local cAliasAux := GetNextAlias()
    Local cReturn   := '{"status": 0}'

    cQuery += " SELECT ISNULL(COUNT(1),0) STATUS "
	cQuery += " FROM "+RetSQLName("CQA")+"	WHERE D_E_L_E_T_ = ' ' "
    cQuery := ChangeQuery(cQuery)
    
    dbUseArea( .T., "TOPCONN", TcGenQry(,,cQuery), cAliasAux, .T., .T. )   

    If !(cAliasAux)->(Eof())
        cReturn := '{"status": '+CValToChar((cAliasAux)->STATUS)+'}'    
    EndIf
    (cAliasAux)->(dbCloseArea())

return cReturn
