#INCLUDE "FINA996.ch"
#INCLUDE "Protheus.ch"

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณ FINA996  บAutor  ณ	Bruno Schmidt    บ Data ณ 20/02/2013  บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณLe o arquivo de retorno 			                          บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณSigaFis                                                     บฑฑ
ฑฑฬออออออออออฯอัออออออออัออออออออออออออัออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบLuisEnrํquezณ10/02/17ณSERINN001-1122ณ-Se realiza merge para modifica-  บฑฑ
ฑฑบ            ณ        ณ              ณ cion en creacion de tabla tempo- บฑฑ
ฑฑบ            ณ        ณ              ณ ral  PRO, se usa clase FWTempora บฑฑ
ฑฑบ            ณ        ณ              ณ -ry Table en lugar de funcion    บฑฑ
ฑฑบ            ณ        ณ              ณ CriaTrab (CTREE).                บฑฑ
ฑฑศออออออออออออฯออออออออฯออออออออออออออฯออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/      
Function FINA996()                     

Local aArqTmp	 := {}
Local aCarga	 := {}
Local cTitulo	 := ""
Local cErro	 := ""
Local cSolucao := ""
Local cTexto   := ""
Local lCarga   := .F.
Local nRegProc := 0
Local nRegAtu  := 0

Private oTmpTable := Nil

If FINA996Wiz()
	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
	//ณCarrega no arquivo temporario as informacoes do arquivo de retornoณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
    Processa({|| aCarga := FINA996Le(@aArqTmp)})
    lCarga := aCarga[01]

    If lCarga
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
		//ณAtualiza tabelas com as informacoes do retornoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
        Processa({|| FINA996ATU(aCarga[02],@nRegProc,@nRegAtu)})
			 
        cTexto  += STR0048+AllTrim(Str(nRegProc,10))+CHR(13)+CHR(10)    // "Registros processados: "
        cTexto  += STR0049+AllTrim(Str(nRegAtu,10))+CHR(13)+CHR(10)     // "Registros atualizados: " 
        cTexto  := STR0050+CHR(13)+CHR(10)+""+CHR(13)+CHR(10)+cTexto    // "Importa็ใo de arquivo concluida "
        
        DEFINE MSDIALOG oDlg TITLE STR0051 From 3,0 to 270,320 PIXEL // "Importa็ใo de Reten็ใo de Lucros" 

            DEFINE FONT oFont NAME "Tahoma" SIZE 7,15   //6,15
            @ 5,6 GET oMemo  VAR cTexto MEMO SIZE 150,108 OF oDlg PIXEL
    
            oMemo:bRClicked := {||AllwaysTrue()}
            oMemo:oFont     := oFont
            oMemo:lReadOnly := .t.
        
            DEFINE SBUTTON  FROM 118,130 TYPE 1 ACTION oDlg:End() ENABLE OF oDlg PIXEL //Apaga
        
        ACTIVATE MSDIALOG oDlg CENTER
			 
    Else
        cTitulo 	:= STR0024		//"Importa็ใo nใo realizada"
        cErro		:= STR0025		//"A importa็ใo do arquivo de retorno nใo foi realizada "
        cErro		+= STR0026		//"por nใo existirem informa็๕es de retorno no arquivo "
        cErro		+= STR0027		//"texto informado. "
        cSolucao	:= STR0028		//"Verifique se o arquivo de retorno informado nas "
        cSolucao	+= STR0029		//"perguntas da rotina ้ o enviado pela Reproweb "
        cSolucao	+= STR0030		//"e processe esta rotina novamente."
        xMagHelpFis(cTitulo,cErro,cSolucao)
    Endif
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
		//ณExcluindo o arquivo temporario criadoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
    dbSelectArea(aArqTmp[1,2])
    dbCloseArea()
    If &(aArqTmp[1,1]) <> Nil   
		&(aArqTmp[1,1]):Delete()  
		&(aArqTmp[1,1]) := Nil 
	EndIf     
Else
    cTitulo 	:= STR0018 				//"Implementa็ใo nใo efetuada"
    cErro		:= STR0019 				//"A implementa็ใo do processo de atualiza็ใo"
    cErro		+= STR0020 				//"Reproweb nใo foi efetuada corretamente."
    cSolucao	:= STR0021 				//"verifique a documenta็ใo que acompanha a rotina e "
    cSolucao	+= STR0022 				//"execute todos os procedimentos indicados e processe "
    cSolucao	+= STR0023 				//"esta rotina novamente."
    xMagHelpFis(cTitulo,cErro,cSolucao)
Endif

Return(.T.)

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณFINA996Wiz  บAutor  ณ   Bruno Schmidt    บ Data ณ 20/02/2013  บฑฑ
ฑฑฬออออออออออุออออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณMonta a wizard com as perguntas a rotina de importacao        บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณReproweb                                                      บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function FINA996Wiz()

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณDeclaracao das variaveisณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
Local aTxtPre 		:= {}
Local aPaineis 		:= {}

Local cTitObj1		:= ""                
Local cMask			:= Replicate("X",245)
	
Local nPos			:= 0
	
Local lRet			:= 0
Local cCab			:= STR0001 //"Importa็ใo do Arquivo Reproweb"
//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณMonta wizard com as perguntas necessariasณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
aAdd(aTxtPre,STR0001) //"Importa็ใo do Arquivo "
aAdd(aTxtPre,STR0002) //"Aten็ใo"
aAdd(aTxtPre,STR0003) //"Preencha corretamente as informa็๕es solicitadas."
aAdd(aTxtPre,Alltrim(STR0004)+" "+cCab+Alltrim(STR0005)+" "+Alltrim(STR0006))	
										//"Esta rotina ira importar o arquivo de retorno disponibilizado pela Reproweb       "
										//", contendo informa็๕es sobre fornecedores     "
										//"em um deternimado perํodo."

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณPainel 1 - Informacoes da Empresa    ณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
aAdd(aPaineis,{})
nPos :=	Len(aPaineis)
aAdd(aPaineis[nPos],STR0007) //"Assistente de parametriza็ใo" 
aAdd(aPaineis[nPos],STR0008) //"Informa็๕es sobre o arquivo de retorno: "
aAdd(aPaineis[nPos],{})

cTitObj1 :=	STR0009 //"Arquivo de retorno: "
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{1,cTitObj1,,,,,,})
aAdd(aPaineis[nPos][3],{2,"",cMask,1,,,,245,,.T.})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})
aAdd(aPaineis[nPos][3],{0,"",,,,,,})

lRet :=	xMagWizard(aTxtPre,aPaineis,"Rproweb")
	
Return(lRet)   

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณFINA996Tmp  บAutor  ณ   Bruno Schmidt    บ Data ณ 20/02/2013  บฑฑ
ฑฑฬออออออออออุออออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณCria o arquivo temporario para importacao                     บฑฑ
ฑฑบ          ณ                                                              บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณReproweb                                                      บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function FINA996Tmp()

Local aArqPRO   := {}                                 
Local aArqTmp	:= {}
Local aOrdem := {}

AADD(aArqPRO,{"CUIT"    ,"C",11 ,0})
AADD(aArqPRO,{"PERFISC" ,"C",04 ,0})
AADD(aArqPRO,{"PORC"	,"C",03 ,0})
AADD(aArqPRO,{"DTPUBLI" ,"C",10 ,0})
AADD(aArqPRO,{"DTVIGEN"	,"C",10 ,0})
AADD(aArqPRO,{"IMPORT"		,"C",01,0}) 
AADD(aArqPRO,{"ERRO"		,"C",35,0}) 

oTmpTable := FWTemporaryTable():New("PRO")
oTmpTable:SetFields( aArqPRO ) 

aOrdem	:=	{"CUIT"} 

oTmpTable:AddIndex("IN1", aOrdem) 

oTmpTable:Create() 

aArqTmp := {{"oTmpTable","PRO"}}

Return(aArqTmp)

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณ FINA996Le  บAutor  ณ   Bruno Schmidt    บ Data ณ 20/02/2013  บฑฑ
ฑฑฬออออออออออุออออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณLe arquivo de retorno e carrega o arquivo temporario          บฑฑ
ฑฑบ          ณpara atualizar cadastro de Fornecedor.                        บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณReproweb                                                      บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function FINA996Le(aArqTmp)

Local aWizard		:= {}
Local aInforma      := {}
	
Local lRet			:= !xMagLeWiz("Rproweb",@aWizard,.T.)
	
Local cArqProc		:= Alltrim(aWizard[01][01])
Local cTitulo		:= ""
Local cErro			:= ""
Local cSolucao		:= ""
Local cLinha		:= ""
Local cChar			:= ""

Local lCarga		:= .F.   
Local lArqValido	:= .F.

Local nCont			:= 0
Local nX            := 0 

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณCria o arquivo temporario para a importacaoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
aArqTmp := FINA996TMP()                                  

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณVerifica se o arquivo existe no diretorio indicadoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
If File(cArqProc) .And. !lRet

	nHandle	:=	FOpen(cArqProc)
	nTam	:=	FSeek(nHandle,0,2)
	FSeek(nHandle,0,0)
	ProcRegua(nTam)

	FT_FUse(cArqProc)
	FT_FGotop()

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
	//ณVerifica se o arquivo aberto e um arquivo valido com o mesmo CGC do SM0ณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
	lArqValido 	:= .T.	
	cChar  		:= "."       
	nCont	    := 0
	
	cLinha := ""
  	cLinha := FT_FREADLN()	
	
	If lArqValido 
		FT_FGotop()
		FSeek(nHandle,0,0)
		cChar  := ","		
		cLinha := ""		

		While (!FT_FEof()) 		
			IncProc()
			cLinha := ""        
			aDadosSA := {}
		    aInforma := {}	            
   			cLinha := FT_FREADLN()
        	RecLock("PRO",.T.)
        			For nX := 1 to 8
        				If nX ==  8
        			   	 	AADD (aInforma,Alltrim(SubStr(cLinha,1,(nPos-1))))
        				Else
	        	        	nPos := at(";",cLinha)
	        	        	AADD (aInforma,Alltrim(SubStr(cLinha,1,(nPos-1))))
	        	        	cLinha := SubStr(cLinha,nPos+1,Len(cLinha))
	        	        EndIf	
        	        nEXT
					PRO->CUIT  	 := aInforma [2]
					PRO->PERFISC := aInforma [4] 
					PRO->PORC  	 := aInforma [5] 
					PRO->DTPUBLI :=  aInforma [7] 
					PRO->DTVIGEN := aInforma [8] 
				
			FT_FSkip()
		Enddo 
		lCarga := .T.        
	Else
		lCarga := .F.
	Endif	
	FT_FUse()
	FClose(nHandle)
Else 
	cTitulo 	:= STR0011 						//"Arquivo de importa็ใo nใo localizado"	
	cErro		:= STR0012 + cArqProc			//"Nใo foi localizado no diret๓rio "
	cErro		+= STR0013 + STR0014 	        //" o arquivo "," indicado nas perguntas "
	cErro		+= STR0015 						//"da rotina."
	cSolucao	:= STR0016 						//"Informe o diret๓rio e o nome do arquivo "
	cSolucao	+= STR0017 						//"corretamente e processe a rotina novamente."
	xMagHelpFis(cTitulo,cErro,cSolucao)
	lCarga := .F.
Endif

Return({lCarga,cArqProc})

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณFINA996ATU  บAutor  ณ	  Bruno Schmidt    บ Data ณ 20/02/2013  บฑฑ
ฑฑฬออออออออออุออออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณAtualiza tabela do Protheus com as informacoes retornadas     บฑฑ
ฑฑบ          ณpela tabela de Fornecedores                        	        บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณReproweb                                                      บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/                                                                                                    
Static Function FINA996ATU(cCarga,nRegProc,nRegAtu)


	nRegProc := PRO->(LastRec())
	ProcRegua(nRegProc)

	SA2->(dbSetOrder(3))

	PRO->(dbGoTop())
	While !(PRO->(Eof()))

		IncProc()
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
		//ณAtualizando tabelas posicionadasณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
		If SA2->(MsSeek(xFilial("SA2")+Alltrim(PRO->CUIT)))
			While !SA2->(EOF()) .And. xFilial("SA2") == SA2->A2_FILIAL .And. Alltrim(PRO->CUIT) == Alltrim(SA2->A2_CGC)
				Begin Transaction
					RecLock("SA2",.F.)
					SA2->A2_PORGAN	:= 100 - Val(PRO->PORC)
					If FieldPos("A2_DTICALG") > 0 .And. FieldPos("A2_DTFCALG") > 0
						SA2->A2_DTICALG	:= Ctod(PRO->DTPUBLI)
						SA2->A2_DTFCALG := Ctod(PRO->DTVIGEN)
					EndIf
					MsUnLock()
				End Transaction
				SA2->(dbSkip())
			EndDo

			nRegAtu++
			
			RecLock("PRO",.F.)
			PRO->ERRO :=STR0041 //"Importado"
			MsUnLock()
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
			//ณSe houve algum erro na atualizacao das tabelasณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
			RecLock("PRO",.F.)
			PRO->IMPORT	:= "1"
			PRO->ERRO	:= STR0031 //"Fornecedor nใo encontrado"
			MsUnLock() 	
		EndIf
		PRO->(dbSkip())
	Enddo


Return(.T.)	
