#INCLUDE "PROTHEUS.CH"
#INCLUDE "GPRA070.CH"
#INCLUDE "GPRDEF.CH"

/*


Ŀ
Funo    GPRC010    Autora  Marcos Alves          Data  03/09/04 
Ĵ
Descrio  Manutencao das pesquisas respondidas                       
Ĵ
 Uso       SIGAGPR                                                    
ٱ


*/
Function GPRA070(aRotAuto,nOpc)

//Ŀ
// Declaracao de Variaveis                                             
//
Private cCadastro 	:= STR0001    	// " Manuteno Resultados "
Private cString   	:= "SKJ"      	// Alias de Trabalho

Private aRotina 	:= MenuDef()

//Ŀ
// Definicao de variaveis para rotina de inclusao automatica    
//
Private l070Auto := ( aRotAuto <> NIL )

nOpc := IIF(nOpc == NIL, 3, nOpc)

dbSelectArea(cString)
dbSetOrder(1)
If l070Auto
	MsRotAuto(nOpc,aRotAuto,cString)
Else
	mBrowse( 6,1,22,75,cString)
Endif	

Return Nil

/*/

Ŀ
Funo     MenuDef   Autor  Conrado Q. Gomes       Data  13.12.06 
Ĵ
Descrio  Definio do aRotina (Menu funcional)                      
Ĵ
Sintaxe    MenuDef()                                                  
Ĵ
Parametros                                                            
Ĵ
 Uso       SIGAGPR                                                    
ٱ


/*/
Static Function MenuDef()
	Local aRotina := {	{STR0002 ,"AxPesqui"   ,0 ,1 ,0 ,.F.} ,;	//"Pesquisar"
	             		{STR0003 ,"AxVisual"   ,0 ,2 ,0 ,.T.} ,;	//"Visualizar"
	             		{STR0004 ,"GPRA070EXC" ,0 ,3 ,0 ,.T.} }	//"Excluir"
Return(aRotina)

/*


Ŀ
Funo    GPRA070EXC Autor   Marcos Alves          Data  03/09/04 
Ĵ
Descrio  Rotina para exclusao das respostas                         
Ĵ
Sintaxe    GPRA070EXC(ExpC1,ExpN1,ExpN2)                              
Ĵ
Parametros ExpC1 = Alias do arquivo                                   
           ExpN1 = Numero do registro                                 
           ExpN2 = Opcao selecionada                                  
Ĵ
 Uso       SIGAGPR                                                    
ٱ


*/
Function GPRA070EXC(cAlias,nReg,nOpc)
//Ŀ
// Tratamento para as rotinas automaticas                              
//
If !l070Auto 
	If !MsgNoYes(STR0005) //"Confirma Exclusao?"
	   Return Nil
	Endif
EndIf
//Ŀ
// Processa a exclusao                                                 
//
DbSelectArea("SKK")
DbSetOrder(1)
DbSeek(xFilial("SKK") + SKJ->KJ_RESPPQ)
While !Eof() .AND. SKK->KK_RESPPQ == SKJ->KJ_RESPPQ
	//Ŀ
	// Processa a exclusao dos campos memos                                
	//
	If !Empty(SKK->KK_CODISSE)
		dbSelectArea("SYP")
		dbSeek(xFilial("SYP")+SKK->KK_CODISSE)
		While !Eof() .and. SYP->YP_CHAVE == SKK->KK_CODISSE
			Reclock("SYP",.F.)
			dbDelete()
			MsUnlock()
			dbSkip()
		End
		dbSelectArea("SKK")
	Endif			
	//Ŀ
	// Processa a exclusao dos detalhes das questoes/alternativas/coluna   
	//
	RecLock("SKK",.F.)
	DbDelete()
	MsUnlock()
	dbSkip()
End         
RecLock(cAlias,.F.)
DbDelete()
MsUnlock()
Return Nil